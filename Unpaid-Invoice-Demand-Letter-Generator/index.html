<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unpaid Invoice Demand Letter Generator | Professional Collection Tool</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Generate professional demand letters for unpaid invoices. Perfect for SaaS businesses, freelancers, contractors, and small businesses. Get paid faster with legally compliant collection letters.">
    <meta name="keywords" content="unpaid invoice, demand letter, collection letter, freelancer, SaaS, contractor, small business, accounts receivable">
    
    <!-- Styles -->
    <link rel="stylesheet" href="../Tenant-Security-Deposit-Generator/styles.css">
    
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
    
    <style>
        /* Custom styles for invoice generator */
        .form-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-row-three {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .letter-content {
            line-height: 1.6;
            font-family: 'Times New Roman', serif;
            font-size: 14px;
        }
        
        .letter-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #000;
        }
        
        .letter-date {
            text-align: right;
            margin-bottom: 2rem;
        }
        
        .letter-body p {
            margin-bottom: 1rem;
        }
        
        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .invoice-table th,
        .invoice-table td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        
        .invoice-table th {
            background-color: #f3f4f6;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-row-three {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Load dependencies -->
    <script src="../Tenant-Security-Deposit-Generator/paywall-system.js"></script>
    
    <script>
        const { useState, useRef, useEffect } = React;

        // Icon component
        const Icon = ({ name, style = {} }) => React.createElement('i', {
            'data-feather': name,
            style: style
        });

        // Main Invoice Generator Component
        const InvoiceGenerator = () => {
            // State management
            const [currentTab, setCurrentTab] = useState(0);
            const [hasPaywallAccess, setHasPaywallAccess] = useState(false);
            const [eSignLoading, setESignLoading] = useState(false);
            const previewRef = useRef(null);
            
            // Form data state
            const [formData, setFormData] = useState({
                // Business Information
                businessName: '',
                businessEmail: '',
                businessPhone: '',
                businessAddress: '',
                
                // Client Information
                clientName: '',
                clientEmail: '',
                contactPerson: '',
                clientAddress: '',
                
                // Invoice Details
                invoiceNumber: '',
                invoiceDate: '',
                dueDate: '',
                totalAmount: '',
                currency: 'USD',
                workDescription: '',
                
                // Collection Options
                demandTone: 'professional',
                paymentDeadline: '10',
                interestRate: '1.5',
                reportCredit: true,
                collectionAgency: true,
                legalAction: true,
                lienRights: false,
                stopServices: true,
                copyrightClaim: false,
                industryReporting: false,
                
                // Business Type (for specialized strategies)
                businessType: 'general',
                
                // Previous Communication
                previousAttempts: '',
                
                // Urgency Level
                urgencyLevel: 'standard'
                
            });

            // Tab definitions
            const tabs = [
                { id: 'details', label: 'Invoice Details', icon: 'file-text' },
                { id: 'collection', label: 'Collection Strategy', icon: 'target' },
                { id: 'assessment', label: 'Case Assessment', icon: 'bar-chart-2' }
            ];

            // Paywall integration
            useEffect(() => {
                const checkPaymentStatus = () => {
                    if (window.PaywallSystem && window.PaywallSystem.hasAccess()) {
                        setHasPaywallAccess(true);
                        return true;
                    }
                    return false;
                };
                
                if (!checkPaymentStatus()) {
                    setTimeout(() => {
                        if (window.PaywallSystem && window.PaywallSystem.makePreviewNonCopyable) {
                            window.PaywallSystem.makePreviewNonCopyable();
                        }
                    }, 1000);
                } else {
                    setTimeout(() => {
                        if (window.PaywallSystem && window.PaywallSystem.enablePreviewInteraction) {
                            window.PaywallSystem.enablePreviewInteraction();
                        }
                    }, 1000);
                }

                // Set default dates
                const today = new Date();
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                const sixtyDaysAgo = new Date();
                sixtyDaysAgo.setDate(sixtyDaysAgo.getDate() - 60);
                
                setFormData(prev => ({
                    ...prev,
                    invoiceDate: thirtyDaysAgo.toISOString().split('T')[0],
                    dueDate: sixtyDaysAgo.toISOString().split('T')[0]
                }));

                // Initialize feather icons
                if (window.feather) {
                    window.feather.replace();
                }
            }, []);

            // Update form data
            const updateFormData = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            // Generate letter content
            const generateLetterContent = () => {
                const currencySymbol = formData.currency === 'USD' ? '$' : formData.currency === 'EUR' ? '‚Ç¨' : formData.currency === 'GBP' ? '¬£' : '$';
                const formattedAmount = `${currencySymbol}${formData.totalAmount || '[Amount]'}`;
                
                // Calculate days overdue
                let daysOverdue = 0;
                if (formData.dueDate) {
                    const dueDateObj = new Date(formData.dueDate);
                    const today = new Date();
                    daysOverdue = Math.ceil((today - dueDateObj) / (1000 * 60 * 60 * 24));
                }

                // Generate consequences list
                let consequences = [];
                if (formData.reportCredit) {
                    consequences.push('Reporting this debt to credit bureaus, which may damage your credit score');
                }
                if (formData.collectionAgency) {
                    consequences.push('Referral to a professional collection agency');
                }
                if (formData.legalAction) {
                    consequences.push('Legal action seeking judgment, attorney fees, and court costs');
                }
                if (formData.lienRights) {
                    consequences.push('Filing of mechanic\'s lien against your property (where applicable)');
                }
                if (formData.stopServices) {
                    consequences.push('Immediate suspension of all services and access');
                }
                if (formData.copyrightClaim) {
                    consequences.push('Copyright infringement claim and removal of creative work');
                }
                if (formData.industryReporting) {
                    consequences.push('Reporting to industry associations and professional networks');
                }
                consequences.unshift(`Late fees and interest charges at ${formData.interestRate || '1.5'}% per month`);

                // Generate tone-specific demand paragraph
                let demandParagraph = '';
                switch(formData.demandTone) {
                    case 'professional':
                        demandParagraph = `We respectfully request payment of this outstanding invoice within <strong>${formData.paymentDeadline} days</strong> of receiving this notice. We value our business relationship and would prefer to resolve this matter amicably.`;
                        break;
                    case 'firm':
                        demandParagraph = `Payment of this outstanding debt is required within <strong>${formData.paymentDeadline} days</strong> of receiving this notice. Continued non-payment will force us to pursue more aggressive collection measures.`;
                        break;
                    case 'urgent':
                        demandParagraph = `<strong>IMMEDIATE PAYMENT REQUIRED:</strong> This debt must be paid in full within <strong>${formData.paymentDeadline} days</strong> or we will proceed with collection action without further notice.`;
                        break;
                }

                return `
                    <div class="letter-header">
                        <h2>DEMAND FOR PAYMENT</h2>
                        <p><strong>UNPAID INVOICE COLLECTION NOTICE</strong></p>
                    </div>
                    
                    <div class="letter-date">
                        <p>${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <div class="letter-body">
                        <p><strong>TO:</strong> ${formData.clientName || '[Client Name]'}<br>
                        ${formData.clientAddress || '[Client Address]'}</p>
                        
                        <p><strong>FROM:</strong> ${formData.businessName || '[Your Business Name]'}<br>
                        ${formData.businessAddress || '[Your Business Address]'}<br>
                        Email: ${formData.businessEmail || '[Your Email]'}<br>
                        Phone: ${formData.businessPhone || '[Your Phone]'}</p>
                        
                        <p><strong>RE: DEMAND FOR PAYMENT - INVOICE #${formData.invoiceNumber || '[Invoice Number]'}</strong></p>
                        
                        <p>This letter serves as formal notice that your account is seriously past due. Despite our previous attempts to collect this debt, payment remains outstanding.</p>
                        
                        <p><strong>INVOICE DETAILS:</strong></p>
                        <table class="invoice-table">
                            <tr>
                                <th>Invoice Number</th>
                                <th>Invoice Date</th>
                                <th>Due Date</th>
                                <th>Amount Owed</th>
                                <th>Days Overdue</th>
                            </tr>
                            <tr>
                                <td>${formData.invoiceNumber || '[Invoice Number]'}</td>
                                <td>${formData.invoiceDate || '[Invoice Date]'}</td>
                                <td>${formData.dueDate || '[Due Date]'}</td>
                                <td>${formattedAmount}</td>
                                <td>${daysOverdue > 0 ? daysOverdue : '0'}</td>
                            </tr>
                        </table>
                        
                        <p><strong>Services Provided:</strong> ${formData.workDescription || '[Work Description]'}</p>
                        
                        <p>${demandParagraph}</p>
                        
                        <p><strong>Consequences of Non-Payment:</strong></p>
                        <ul>
                            ${consequences.map(c => `<li>${c}</li>`).join('')}
                        </ul>
                        
                        <p><strong>PAYMENT INSTRUCTIONS:</strong><br>
                        Please remit payment immediately to avoid further collection action. Contact us at ${formData.businessEmail || '[Your Email]'} to arrange payment or discuss payment plans.</p>
                        
                        <p>This letter is an attempt to collect a debt. Any information obtained will be used for that purpose.</p>
                        
                        <p>Sincerely,<br><br>
                        ${formData.businessName || '[Your Business Name]'}</p>
                    </div>
                `;
            };

            // Copy to clipboard functionality
            const copyToClipboard = () => {
                if (!hasPaywallAccess) {
                    if (window.PaywallSystem) {
                        window.PaywallSystem.showAccessDenied('copy');
                        window.PaywallSystem.createPaywallModal(() => {
                            if (window.PaywallSystem && window.PaywallSystem.hasAccess()) {
                                setHasPaywallAccess(true);
                                window.PaywallSystem.enablePreviewInteraction();
                                const content = generateLetterContent().replace(/<[^>]*>/g, '');
                                navigator.clipboard.writeText(content);
                                alert('Demand letter copied to clipboard!');
                            }
                        });
                    }
                    return;
                }
                const content = generateLetterContent().replace(/<[^>]*>/g, '');
                navigator.clipboard.writeText(content).then(() => {
                    alert('Demand letter copied to clipboard!');
                });
            };

            // Download letter
            const downloadLetter = () => {
                if (!hasPaywallAccess) {
                    if (window.PaywallSystem) {
                        window.PaywallSystem.showAccessDenied('download');
                        window.PaywallSystem.createPaywallModal(() => {
                            if (window.PaywallSystem && window.PaywallSystem.hasAccess()) {
                                setHasPaywallAccess(true);
                                window.PaywallSystem.enablePreviewInteraction();
                                downloadWordDoc();
                            }
                        });
                    }
                    return;
                }
                downloadWordDoc();
            };

            const downloadWordDoc = () => {
                const letterContent = generateLetterContent();
                const fullDocument = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Demand Letter - Invoice ${formData.invoiceNumber}</title>
                        <style>
                            body { font-family: 'Times New Roman', serif; line-height: 1.6; margin: 1in; }
                            .letter-header { text-align: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #000; }
                            .letter-date { text-align: right; margin-bottom: 2rem; }
                            .invoice-table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
                            .invoice-table th, .invoice-table td { border: 1px solid #000; padding: 8px; text-align: left; }
                            .invoice-table th { background-color: #f3f4f6; }
                        </style>
                    </head>
                    <body>
                        ${letterContent}
                    </body>
                    </html>
                `;
                
                const blob = new Blob([fullDocument], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Demand_Letter_Invoice_${formData.invoiceNumber || 'Draft'}.doc`;
                link.click();
                URL.revokeObjectURL(url);
            };

            // E-Sign Document Function
            const eSignDocument = async () => {
                if (!hasPaywallAccess) {
                    if (window.PaywallSystem) {
                        window.PaywallSystem.showAccessDenied('esign');
                        window.PaywallSystem.createPaywallModal(() => {
                            if (window.PaywallSystem && window.PaywallSystem.hasAccess()) {
                                setHasPaywallAccess(true);
                                window.PaywallSystem.enablePreviewInteraction();
                                eSignDocument();
                            }
                        });
                    }
                    return;
                }
                
                // Check eSignature click limit (5 clicks per payment)
                if (window.PaywallSystem && !window.PaywallSystem.canClickESignature()) {
                    const paymentStatus = window.PaywallSystem.getPaymentStatus();
                    const clickCount = paymentStatus.esignatureClicks || 0;
                    alert(`üö´ eSignature Click Limit Reached\\n\\nYou have used ${clickCount}/5 eSignature clicks for this payment.\\n\\n‚ö†Ô∏è Each click sends a document to our API and regenerates it, costing us API fees even if you don't ultimately sign.\\n\\nTo create more eSignatures, please make a new payment.`);
                    return;
                }

                // Show warning about API costs
                const proceed = confirm(`üìù eSignature API Notice\\n\\n‚ö†Ô∏è IMPORTANT: This button sends your document to eSignatures.com API and costs us money for each click, even if you don't complete the signing.\\n\\n‚úÖ Please ensure your document is complete and correct before proceeding.\\n\\nüî¢ You have ${5 - (window.PaywallSystem?.getPaymentStatus()?.esignatureClicks || 0)} API calls remaining.\\n\\nProceed with eSignature creation?`);
                
                if (!proceed) {
                    return;
                }

                // Increment click counter
                if (window.PaywallSystem) {
                    window.PaywallSystem.incrementESignatureClicks();
                }
                
                // Use pre-filled test credentials for quick testing
                const testEmail = 'owner@terms.law';
                const testName = formData.businessName || 'Test Business Owner';
                
                // Validate required fields (use test data if not provided)
                const signerEmail = formData.businessEmail || testEmail;
                const signerName = formData.businessName || testName;
                
                if (!signerEmail || !signerName) {
                    alert('Please fill in your business name and email address before signing the document.');
                    return;
                }
                
                try {
                    setESignLoading(true);
                    console.log("eSignature button clicked with test mode");
                    
                    const finalDocumentText = generateLetterContent().replace(/<[^>]*>/g, '');
                    const documentTitle = `Unpaid Invoice Demand Letter - Invoice #${formData.invoiceNumber || 'Draft'}`;

                    // eSignatures.com API call with test mode
                    const apiData = {
                        test: "yes", // TEST MODE - no charges
                        template: {
                            title: documentTitle,
                            content: finalDocumentText,
                            content_type: "text"
                        },
                        signers: [{
                            email: signerEmail,
                            name: signerName,
                            role: "signer"
                        }]
                    };

                    console.log("Sending to eSignatures.com API (TEST MODE):", apiData);

                    // Use API endpoint (compatible with Vercel/Netlify deployment)
                    const response = await fetch('/api/esignatures-api', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(apiData)
                    });

                    const result = await response.json();
                    console.log("eSignatures.com API response:", result);
                    
                    if (response.ok && result.signing_url) {
                        // Open signing URL in new window
                        window.open(result.signing_url, '_blank', 'width=1000,height=800,scrollbars=yes,resizable=yes');
                        
                        // Show success message
                        alert(`‚úÖ eSignature Created Successfully!\\n\\nüìß Document sent to: ${signerEmail}\\n\\nüîó Signing link opened in new window\\n\\n‚ö†Ô∏è TEST MODE: This is a test signature and won't create legal obligations.\\n\\nüí° For production use, contact support to enable live mode.`);
                        
                    } else {
                        throw new Error(result.message || 'Failed to create eSignature contract');
                    }

                } catch (error) {
                    console.error("eSignature error:", error);
                    
                    // Fallback demo mode
                    alert(`‚ö†Ô∏è eSignature API Error\\n\\n${error.message}\\n\\nüîÑ Demo Mode Activated\\n\\nThis would create a real eSignature in production. For testing, please ensure:\\n\\n1. API endpoint is configured\\n2. eSignatures.com credentials are set\\n3. CORS settings allow API calls\\n\\nContact support for production setup.`);
                    
                } finally {
                    setESignLoading(false);
                }
            };

            // Tab content renderers
            const renderDetailsTab = () => {
                return React.createElement('div', { className: 'tab-content' }, [
                    // Business Information Section
                    React.createElement('div', { key: 'business-section', className: 'form-section' }, [
                        React.createElement('h3', { key: 'title' }, 'Your Business Information'),
                        React.createElement('div', { key: 'business-name', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Business/Your Name *'),
                            React.createElement('input', {
                                key: 'input',
                                type: 'text',
                                value: formData.businessName,
                                onChange: (e) => updateFormData('businessName', e.target.value),
                                placeholder: 'ABC Consulting LLC'
                            })
                        ]),
                        React.createElement('div', { key: 'business-contact', className: 'form-row' }, [
                            React.createElement('div', { key: 'email', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Email Address *'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'email',
                                    value: formData.businessEmail,
                                    onChange: (e) => updateFormData('businessEmail', e.target.value),
                                    placeholder: 'billing@abcconsulting.com'
                                })
                            ]),
                            React.createElement('div', { key: 'phone', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Phone Number'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'tel',
                                    value: formData.businessPhone,
                                    onChange: (e) => updateFormData('businessPhone', e.target.value),
                                    placeholder: '(555) 123-4567'
                                })
                            ])
                        ]),
                        React.createElement('div', { key: 'business-address', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Business Address'),
                            React.createElement('textarea', {
                                key: 'input',
                                value: formData.businessAddress,
                                onChange: (e) => updateFormData('businessAddress', e.target.value),
                                placeholder: '123 Business Ave\nSuite 100\nCity, State 12345'
                            })
                        ])
                    ]),

                    // Client Information Section
                    React.createElement('div', { key: 'client-section', className: 'form-section' }, [
                        React.createElement('h3', { key: 'title' }, 'Client/Debtor Information'),
                        React.createElement('div', { key: 'client-name', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Client Name/Company *'),
                            React.createElement('input', {
                                key: 'input',
                                type: 'text',
                                value: formData.clientName,
                                onChange: (e) => updateFormData('clientName', e.target.value),
                                placeholder: 'XYZ Corporation'
                            })
                        ]),
                        React.createElement('div', { key: 'client-contact', className: 'form-row' }, [
                            React.createElement('div', { key: 'email', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Client Email'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'email',
                                    value: formData.clientEmail,
                                    onChange: (e) => updateFormData('clientEmail', e.target.value),
                                    placeholder: 'ap@xyzcorp.com'
                                })
                            ]),
                            React.createElement('div', { key: 'person', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Contact Person'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'text',
                                    value: formData.contactPerson,
                                    onChange: (e) => updateFormData('contactPerson', e.target.value),
                                    placeholder: 'John Smith'
                                })
                            ])
                        ]),
                        React.createElement('div', { key: 'client-address', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Client Address'),
                            React.createElement('textarea', {
                                key: 'input',
                                value: formData.clientAddress,
                                onChange: (e) => updateFormData('clientAddress', e.target.value),
                                placeholder: '456 Client St\nCity, State 67890'
                            })
                        ])
                    ]),

                    // Invoice Details Section
                    React.createElement('div', { key: 'invoice-section', className: 'form-section' }, [
                        React.createElement('h3', { key: 'title' }, 'Invoice Details'),
                        React.createElement('div', { key: 'invoice-basic', className: 'form-row-three' }, [
                            React.createElement('div', { key: 'number', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Invoice Number *'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'text',
                                    value: formData.invoiceNumber,
                                    onChange: (e) => updateFormData('invoiceNumber', e.target.value),
                                    placeholder: 'INV-2024-001'
                                })
                            ]),
                            React.createElement('div', { key: 'date', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Invoice Date *'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'date',
                                    value: formData.invoiceDate,
                                    onChange: (e) => updateFormData('invoiceDate', e.target.value)
                                })
                            ]),
                            React.createElement('div', { key: 'due', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Due Date *'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'date',
                                    value: formData.dueDate,
                                    onChange: (e) => updateFormData('dueDate', e.target.value)
                                })
                            ])
                        ]),
                        React.createElement('div', { key: 'invoice-amount', className: 'form-row' }, [
                            React.createElement('div', { key: 'amount', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Total Amount Owed *'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'number',
                                    step: '0.01',
                                    value: formData.totalAmount,
                                    onChange: (e) => updateFormData('totalAmount', e.target.value),
                                    placeholder: '5000.00'
                                })
                            ]),
                            React.createElement('div', { key: 'currency', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Currency'),
                                React.createElement('select', {
                                    key: 'input',
                                    value: formData.currency,
                                    onChange: (e) => updateFormData('currency', e.target.value)
                                }, [
                                    React.createElement('option', { key: 'usd', value: 'USD' }, 'USD ($)'),
                                    React.createElement('option', { key: 'eur', value: 'EUR' }, 'EUR (‚Ç¨)'),
                                    React.createElement('option', { key: 'gbp', value: 'GBP' }, 'GBP (¬£)'),
                                    React.createElement('option', { key: 'cad', value: 'CAD' }, 'CAD ($)')
                                ])
                            ])
                        ]),
                        React.createElement('div', { key: 'work-desc', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Description of Work/Services *'),
                            React.createElement('textarea', {
                                key: 'input',
                                value: formData.workDescription,
                                onChange: (e) => updateFormData('workDescription', e.target.value),
                                placeholder: 'Web development services for e-commerce platform...'
                            })
                        ])
                    ])
                ]);
            };

            // Collection Strategy Tab
            const renderCollectionTab = () => {
                return React.createElement('div', { className: 'tab-content' }, [
                    React.createElement('div', { key: 'collection-section', className: 'form-section' }, [
                        React.createElement('h3', { key: 'title' }, 'Collection Strategy'),
                        React.createElement('div', { key: 'tone', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Letter Tone'),
                            React.createElement('select', {
                                key: 'input',
                                value: formData.demandTone,
                                onChange: (e) => updateFormData('demandTone', e.target.value)
                            }, [
                                React.createElement('option', { key: 'professional', value: 'professional' }, 'Professional (Recommended)'),
                                React.createElement('option', { key: 'firm', value: 'firm' }, 'Firm but Respectful'),
                                React.createElement('option', { key: 'urgent', value: 'urgent' }, 'Urgent Collection')
                            ])
                        ]),
                        React.createElement('div', { key: 'timing', className: 'form-row' }, [
                            React.createElement('div', { key: 'deadline', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Payment Deadline (Days from today)'),
                                React.createElement('select', {
                                    key: 'input',
                                    value: formData.paymentDeadline,
                                    onChange: (e) => updateFormData('paymentDeadline', e.target.value)
                                }, [
                                    React.createElement('option', { key: '7', value: '7' }, '7 Days'),
                                    React.createElement('option', { key: '10', value: '10' }, '10 Days'),
                                    React.createElement('option', { key: '14', value: '14' }, '14 Days'),
                                    React.createElement('option', { key: '30', value: '30' }, '30 Days')
                                ])
                            ]),
                            React.createElement('div', { key: 'interest', className: 'form-group' }, [
                                React.createElement('label', { key: 'label' }, 'Late Fee/Interest Rate (%)'),
                                React.createElement('input', {
                                    key: 'input',
                                    type: 'number',
                                    step: '0.1',
                                    value: formData.interestRate,
                                    onChange: (e) => updateFormData('interestRate', e.target.value),
                                    placeholder: '1.5'
                                })
                            ])
                        ]),
                        React.createElement('div', { key: 'business-type', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Business Type üìä'),
                            React.createElement('select', {
                                key: 'input',
                                value: formData.businessType,
                                onChange: (e) => updateFormData('businessType', e.target.value),
                                title: 'Different business types have different collection leverage and legal advantages'
                            }, [
                                React.createElement('option', { key: 'general', value: 'general' }, 'General Business'),
                                React.createElement('option', { key: 'saas', value: 'saas' }, 'SaaS/Software'),
                                React.createElement('option', { key: 'creative', value: 'creative' }, 'Creative/Design Services'),
                                React.createElement('option', { key: 'construction', value: 'construction' }, 'Construction/Contracting'),
                                React.createElement('option', { key: 'consulting', value: 'consulting' }, 'Consulting Services'),
                                React.createElement('option', { key: 'freelance', value: 'freelance' }, 'Freelance Services')
                            ])
                        ]),
                        React.createElement('div', { key: 'urgency', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Collection Urgency ‚è∞'),
                            React.createElement('select', {
                                key: 'input',
                                value: formData.urgencyLevel,
                                onChange: (e) => updateFormData('urgencyLevel', e.target.value),
                                title: 'Urgency level affects the tone and escalation timeline of your demand letter'
                            }, [
                                React.createElement('option', { key: 'standard', value: 'standard' }, 'Standard Collection'),
                                React.createElement('option', { key: 'urgent', value: 'urgent' }, 'Urgent - Client Unresponsive'),
                                React.createElement('option', { key: 'critical', value: 'critical' }, 'Critical - Suspected Insolvency')
                            ])
                        ]),
                        React.createElement('div', { key: 'consequences', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Collection Actions ‚öôÔ∏è'),
                            React.createElement('div', { key: 'grid', style: { display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.5rem' } }, [
                                React.createElement('div', { key: 'credit', className: 'checkbox-group' }, [
                                    React.createElement('input', {
                                        key: 'input',
                                        type: 'checkbox',
                                        checked: formData.reportCredit,
                                        onChange: (e) => updateFormData('reportCredit', e.target.checked),
                                        title: 'Report unpaid debt to business credit agencies (Experian, Dun & Bradstreet)'
                                    }),
                                    React.createElement('label', { key: 'label' }, 'Credit Reporting üìä')
                                ]),
                                React.createElement('div', { key: 'collection', className: 'checkbox-group' }, [
                                    React.createElement('input', {
                                        key: 'input',
                                        type: 'checkbox',
                                        checked: formData.collectionAgency,
                                        onChange: (e) => updateFormData('collectionAgency', e.target.checked),
                                        title: 'Refer to professional collection agency (typically 25-50% of collected amount)'
                                    }),
                                    React.createElement('label', { key: 'label' }, 'Collection Agency üè¢')
                                ]),
                                React.createElement('div', { key: 'legal', className: 'checkbox-group' }, [
                                    React.createElement('input', {
                                        key: 'input',
                                        type: 'checkbox',
                                        checked: formData.legalAction,
                                        onChange: (e) => updateFormData('legalAction', e.target.checked),
                                        title: 'Pursue legal action through small claims court or civil litigation'
                                    }),
                                    React.createElement('label', { key: 'label' }, 'Legal Action ‚öñÔ∏è')
                                ]),
                                React.createElement('div', { key: 'lien', className: 'checkbox-group' }, [
                                    React.createElement('input', {
                                        key: 'input',
                                        type: 'checkbox',
                                        checked: formData.lienRights,
                                        onChange: (e) => updateFormData('lienRights', e.target.checked),
                                        title: 'For construction/improvement work - file mechanic\'s lien against property'
                                    }),
                                    React.createElement('label', { key: 'label' }, 'Mechanic\'s Lien üî®')
                                ]),
                                React.createElement('div', { key: 'services', className: 'checkbox-group' }, [
                                    React.createElement('input', {
                                        key: 'input',
                                        type: 'checkbox',
                                        checked: formData.stopServices,
                                        onChange: (e) => updateFormData('stopServices', e.target.checked),
                                        title: 'Suspend ongoing services, access, or support until payment received'
                                    }),
                                    React.createElement('label', { key: 'label' }, 'Service Suspension üö´')
                                ]),
                                React.createElement('div', { key: 'copyright', className: 'checkbox-group' }, [
                                    React.createElement('input', {
                                        key: 'input',
                                        type: 'checkbox',
                                        checked: formData.copyrightClaim,
                                        onChange: (e) => updateFormData('copyrightClaim', e.target.checked),
                                        title: 'For creative work - retain copyright and demand removal of work until payment'
                                    }),
                                    React.createElement('label', { key: 'label' }, 'Copyright Retention ¬©Ô∏è')
                                ]),
                                React.createElement('div', { key: 'industry', className: 'checkbox-group' }, [
                                    React.createElement('input', {
                                        key: 'input',
                                        type: 'checkbox',
                                        checked: formData.industryReporting,
                                        onChange: (e) => updateFormData('industryReporting', e.target.checked),
                                        title: 'Report non-payment to industry groups, professional associations, or review sites'
                                    }),
                                    React.createElement('label', { key: 'label' }, 'Industry Reporting üì¢')
                                ])
                            ])
                        ])
                    ]),
                    React.createElement('div', { key: 'communication-section', className: 'form-section' }, [
                        React.createElement('h3', { key: 'title' }, 'Previous Attempts'),
                        React.createElement('div', { key: 'attempts', className: 'form-group' }, [
                            React.createElement('label', { key: 'label' }, 'Previous Collection Attempts'),
                            React.createElement('textarea', {
                                key: 'input',
                                value: formData.previousAttempts,
                                onChange: (e) => updateFormData('previousAttempts', e.target.value),
                                placeholder: 'Email sent on [date], phone call on [date], etc.'
                            })
                        ])
                    ])
                ]);
            };

            // Case Assessment & Legal Strategy Tab
            const renderAssessmentTab = () => {
                // Calculate case strength
                const calculateCaseStrength = () => {
                    let score = 0;
                    let factors = [];
                    
                    // Basic contract elements
                    if (formData.invoiceNumber && formData.totalAmount) {
                        score += 20;
                        factors.push('‚úÖ Clear invoice documentation');
                    }
                    
                    // Time factor
                    if (formData.dueDate) {
                        const daysOverdue = Math.ceil((new Date() - new Date(formData.dueDate)) / (1000 * 60 * 60 * 24));
                        if (daysOverdue > 30) {
                            score += 15;
                            factors.push(`‚úÖ Significantly overdue (${daysOverdue} days)`);
                        } else if (daysOverdue > 0) {
                            score += 10;
                            factors.push(`‚úÖ Past due (${daysOverdue} days)`);
                        }
                    }
                    
                    // Communication attempts
                    if (formData.previousAttempts && formData.previousAttempts.length > 20) {
                        score += 15;
                        factors.push('‚úÖ Documented collection attempts');
                    }
                    
                    // Business relationship
                    if (formData.workDescription && formData.workDescription.length > 30) {
                        score += 10;
                        factors.push('‚úÖ Clear scope of work documented');
                    }
                    
                    // Business contact info
                    if (formData.clientEmail || formData.contactPerson) {
                        score += 10;
                        factors.push('‚úÖ Client contact information available');
                    }
                    
                    // Collection leverage
                    if (formData.stopServices) score += 10;
                    if (formData.lienRights) score += 15;
                    if (formData.copyrightClaim) score += 15;
                    
                    // Business type advantages
                    if (formData.businessType === 'saas') {
                        score += 10;
                        factors.push('‚úÖ SaaS leverage (service suspension)');
                    } else if (formData.businessType === 'construction') {
                        score += 15;
                        factors.push('‚úÖ Construction leverage (lien rights)');
                    } else if (formData.businessType === 'creative') {
                        score += 12;
                        factors.push('‚úÖ Creative leverage (copyright retention)');
                    }
                    
                    return { score: Math.min(score, 100), factors };
                };
                
                const assessment = calculateCaseStrength();
                
                const getStrengthColor = (score) => {
                    if (score >= 80) return '#10b981';
                    if (score >= 60) return '#f59e0b';
                    if (score >= 40) return '#ef4444';
                    return '#6b7280';
                };
                
                const getStrengthLabel = (score) => {
                    if (score >= 80) return 'Very Strong';
                    if (score >= 60) return 'Strong';
                    if (score >= 40) return 'Moderate';
                    return 'Weak';
                };
                
                return React.createElement('div', { className: 'tab-content' }, [
                    // Case Strength Assessment
                    React.createElement('div', { key: 'strength-section', className: 'form-section' }, [
                        React.createElement('h3', { key: 'title' }, '‚öñÔ∏è Case Strength Assessment'),
                        React.createElement('div', { 
                            key: 'strength-meter',
                            style: {
                                background: '#f3f4f6',
                                borderRadius: '12px',
                                padding: '1.5rem',
                                marginBottom: '1rem'
                            }
                        }, [
                            React.createElement('div', {
                                key: 'score-display',
                                style: {
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'space-between',
                                    marginBottom: '1rem'
                                }
                            }, [
                                React.createElement('span', {
                                    key: 'score-text',
                                    style: { fontSize: '1.2rem', fontWeight: '600' }
                                }, `Case Strength: ${assessment.score}/100`),
                                React.createElement('span', {
                                    key: 'strength-label',
                                    style: {
                                        background: getStrengthColor(assessment.score),
                                        color: 'white',
                                        padding: '0.5rem 1rem',
                                        borderRadius: '6px',
                                        fontWeight: '600'
                                    }
                                }, getStrengthLabel(assessment.score))
                            ]),
                            React.createElement('div', {
                                key: 'progress-bar',
                                style: {
                                    background: '#e5e7eb',
                                    height: '12px',
                                    borderRadius: '6px',
                                    overflow: 'hidden'
                                }
                            }, [
                                React.createElement('div', {
                                    key: 'progress-fill',
                                    style: {
                                        background: getStrengthColor(assessment.score),
                                        height: '100%',
                                        width: `${assessment.score}%`,
                                        transition: 'width 0.3s ease'
                                    }
                                })
                            ])
                        ]),
                        React.createElement('div', { key: 'factors' }, [
                            React.createElement('h4', { key: 'factors-title' }, 'Strength Factors:'),
                            React.createElement('ul', { 
                                key: 'factors-list',
                                style: { listStyle: 'none', padding: 0 }
                            }, assessment.factors.map((factor, index) => 
                                React.createElement('li', {
                                    key: index,
                                    style: {
                                        padding: '0.25rem 0',
                                        color: '#059669'
                                    }
                                }, factor)
                            ))
                        ])
                    ]),
                    
                    // Legal Strategy Recommendations
                    React.createElement('div', { key: 'strategy-section', className: 'form-section' }, [
                        React.createElement('h3', { key: 'title' }, 'üéØ Recommended Legal Strategy'),
                        React.createElement('div', { key: 'strategy-grid', style: { display: 'grid', gap: '1rem' } }, [
                            // Immediate Actions
                            React.createElement('div', {
                                key: 'immediate',
                                style: {
                                    background: '#fef3c7',
                                    border: '1px solid #f59e0b',
                                    borderRadius: '8px',
                                    padding: '1rem'
                                }
                            }, [
                                React.createElement('h4', { key: 'title', style: { margin: '0 0 0.5rem 0', color: '#92400e' } }, '‚ö° Immediate Actions'),
                                React.createElement('ul', { key: 'list', style: { margin: 0 } }, [
                                    React.createElement('li', { key: '1' }, 'Send demand letter via certified mail with return receipt'),
                                    React.createElement('li', { key: '2' }, 'Email PDF copy for immediate delivery'),
                                    formData.stopServices && React.createElement('li', { key: '3' }, 'Suspend services/access immediately'),
                                    React.createElement('li', { key: '4' }, `Set ${formData.paymentDeadline}-day deadline for response`)
                                ].filter(Boolean))
                            ]),
                            
                            // Business-Specific Leverage
                            formData.businessType !== 'general' && React.createElement('div', {
                                key: 'leverage',
                                style: {
                                    background: '#dbeafe',
                                    border: '1px solid #3b82f6',
                                    borderRadius: '8px',
                                    padding: '1rem'
                                }
                            }, [
                                React.createElement('h4', { key: 'title', style: { margin: '0 0 0.5rem 0', color: '#1e40af' } }, 'üîß Industry-Specific Leverage'),
                                React.createElement('div', { key: 'content' }, 
                                    formData.businessType === 'saas' ? 'SaaS businesses have strong leverage through service suspension and data retention policies. Clients typically depend on your service for daily operations.' :
                                    formData.businessType === 'construction' ? 'Construction/contracting has the strongest collection rights through mechanic\'s liens, which create property liens that must be resolved before sale or refinancing.' :
                                    formData.businessType === 'creative' ? 'Creative professionals can leverage copyright retention and portfolio/reference removal as powerful collection tools.' :
                                    'General business collection strategies apply.'
                                )
                            ]),
                            
                            // Next Steps Timeline
                            React.createElement('div', {
                                key: 'timeline',
                                style: {
                                    background: '#ecfdf5',
                                    border: '1px solid #10b981',
                                    borderRadius: '8px',
                                    padding: '1rem'
                                }
                            }, [
                                React.createElement('h4', { key: 'title', style: { margin: '0 0 0.5rem 0', color: '#059669' } }, 'üìÖ Collection Timeline'),
                                React.createElement('ul', { key: 'list', style: { margin: 0 } }, [
                                    React.createElement('li', { key: '1' }, `Days 1-${formData.paymentDeadline}: Initial demand period`),
                                    React.createElement('li', { key: '2' }, `Day ${parseInt(formData.paymentDeadline) + 1}: Follow-up demand if no response`),
                                    React.createElement('li', { key: '3' }, `Day ${parseInt(formData.paymentDeadline) + 15}: Consider collection agency referral`),
                                    React.createElement('li', { key: '4' }, `Day ${parseInt(formData.paymentDeadline) + 30}: Prepare for legal action if amount > $1,000`)
                                ])
                            ])
                        ])
                    ]),
                    
                    // Risk Assessment
                    React.createElement('div', { key: 'risk-section', className: 'form-section' }, [
                        React.createElement('h3', { key: 'title' }, '‚ö†Ô∏è Risk Assessment & Considerations'),
                        React.createElement('div', { key: 'risks' }, [
                            React.createElement('div', {
                                key: 'cost-benefit',
                                style: {
                                    background: '#f3f4f6',
                                    borderRadius: '6px',
                                    padding: '1rem',
                                    marginBottom: '1rem'
                                }
                            }, [
                                React.createElement('h4', { key: 'title' }, 'üí∞ Cost-Benefit Analysis'),
                                React.createElement('p', { key: 'content', style: { margin: 0 } }, 
                                    `Amount: $${formData.totalAmount || '[Amount]'} | ${parseFloat(formData.totalAmount || 0) > 5000 ? 'High-value case - attorney consultation recommended' : parseFloat(formData.totalAmount || 0) > 1000 ? 'Medium-value case - consider small claims court' : 'Low-value case - focus on quick resolution strategies'}`
                                )
                            ]),
                            React.createElement('div', {
                                key: 'recommendations',
                                style: {
                                    background: '#f0f9ff',
                                    borderRadius: '6px',
                                    padding: '1rem'
                                }
                            }, [
                                React.createElement('h4', { key: 'title' }, 'üìã Professional Recommendations'),
                                React.createElement('ul', { key: 'list', style: { margin: 0 } }, [
                                    React.createElement('li', { key: '1' }, 'Document all communications and delivery confirmations'),
                                    React.createElement('li', { key: '2' }, 'Keep detailed records of services provided and client benefits received'),
                                    React.createElement('li', { key: '3' }, 'Consider settlement offers for 70-80% if client responds positively'),
                                    parseFloat(formData.totalAmount || 0) > 3000 && React.createElement('li', { key: '4' }, 'Consult with collection attorney for amounts over $3,000'),
                                    React.createElement('li', { key: '5' }, 'Report successful collections to business credit bureaus')
                                ].filter(Boolean))
                            ])
                        ])
                    ])
                ]);
            };

            // Main tab content renderer
            const renderTabContent = () => {
                switch(currentTab) {
                    case 0: return renderDetailsTab();
                    case 1: return renderCollectionTab();
                    case 2: return renderAssessmentTab();
                    default: return renderDetailsTab();
                }
            };

            // Render main component
            return React.createElement('div', { className: 'app-container' }, [
                // Header
                React.createElement('header', { key: 'header', className: 'app-header' }, [
                    React.createElement('h1', { key: 'title' }, 'üíº Unpaid Invoice Demand Letter Generator'),
                    React.createElement('p', { key: 'subtitle' }, 'Professional collection letters for SaaS businesses, freelancers, contractors, and small businesses')
                ]),
                
                // Main container
                React.createElement('div', { key: 'main', className: 'main-container' }, [
                    // Form pane
                    React.createElement('div', { key: 'form', className: 'form-pane' }, [
                        // Tab navigation
                        React.createElement('div', { key: 'tabs', className: 'tab-navigation' },
                            tabs.map((tab, index) => 
                                React.createElement('button', {
                                    key: tab.id,
                                    className: `tab-button ${currentTab === index ? 'active' : ''}`,
                                    onClick: () => setCurrentTab(index)
                                }, [
                                    React.createElement(Icon, { key: 'icon', name: tab.icon }),
                                    React.createElement('span', { key: 'label' }, tab.label)
                                ])
                            )
                        ),
                        
                        // Tab content
                        React.createElement('div', { key: 'content', className: 'tab-content-container' },
                            renderTabContent()
                        ),
                        
                        // Action buttons
                        React.createElement('div', { key: 'actions', className: 'action-buttons' }, [
                            // Navigation buttons
                            React.createElement('button', {
                                key: 'prev-tab',
                                className: 'btn btn-secondary',
                                disabled: currentTab === 0,
                                onClick: () => setCurrentTab(Math.max(0, currentTab - 1))
                            }, [
                                React.createElement(Icon, { key: 'icon', name: 'chevron-left' }),
                                React.createElement('span', { key: 'text' }, 'Previous')
                            ]),
                            React.createElement('button', {
                                key: 'next-tab',
                                className: 'btn btn-primary',
                                disabled: currentTab === tabs.length - 1,
                                onClick: () => setCurrentTab(Math.min(tabs.length - 1, currentTab + 1))
                            }, [
                                React.createElement('span', { key: 'text' }, 'Next'),
                                React.createElement(Icon, { key: 'icon', name: 'chevron-right' })
                            ]),
                            
                            // Document action buttons
                            React.createElement('button', {
                                key: 'copy',
                                className: 'btn btn-secondary',
                                onClick: copyToClipboard
                            }, [
                                React.createElement(Icon, { key: 'icon', name: 'copy' }),
                                React.createElement('span', { key: 'text' }, 'Copy')
                            ]),
                            
                            React.createElement('button', {
                                key: 'download',
                                className: 'btn btn-primary',
                                onClick: downloadLetter
                            }, [
                                React.createElement(Icon, { key: 'icon', name: 'download' }),
                                React.createElement('span', { key: 'text' }, 'Word Doc')
                            ]),
                            
                            React.createElement('button', {
                                key: 'esign',
                                className: 'btn btn-accent',
                                disabled: eSignLoading,
                                onClick: eSignDocument,
                                title: 'Send for electronic signature - uses API calls (limit 5 per payment)',
                                style: { backgroundColor: '#dc2626', color: 'white' }
                            }, [
                                React.createElement(Icon, { 
                                    key: 'icon', 
                                    name: eSignLoading ? 'loader' : 'edit-3',
                                    style: eSignLoading ? { animation: 'spin 1s linear infinite' } : {}
                                }),
                                React.createElement('span', { key: 'text' }, eSignLoading ? 'Processing...' : 'E-Sign')
                            ])
                        ])
                    ]),
                    
                    // Preview pane
                    React.createElement('div', { key: 'preview', className: 'preview-pane' }, [
                        React.createElement('div', { key: 'header', className: 'preview-header' }, [
                            React.createElement('h3', { key: 'title' }, 'Live Preview')
                        ]),
                        React.createElement('div', {
                            key: 'content',
                            className: 'preview-content',
                            ref: previewRef,
                            dangerouslySetInnerHTML: { 
                                __html: generateLetterContent()
                            }
                        })
                    ])
                ])
            ]);
        };

        // Render the component when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            ReactDOM.render(React.createElement(InvoiceGenerator), document.getElementById('root'));

            // Initialize feather icons after render
            setTimeout(() => {
                if (window.feather) {
                    window.feather.replace();
                }
            }, 100);

            // Initialize PayPal if available
            if (typeof PaywallSystem !== 'undefined') {
                PaywallSystem.initializePayPal().catch(console.error);
            }
        });
    </script>
</body>
</html>
