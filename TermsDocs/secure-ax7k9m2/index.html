<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
  <meta name="googlebot" content="noindex, nofollow">
  <title>Story Cannabis MSA - Redline Review | Sergei Tokmakov, Esq.</title>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;500;600&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #1a2e44;
      --primary-light: #2d4a6f;
      --accent: #8b5cf6;
      --surface: #ffffff;
      --bg: #f5f5f4;
      --border: #d4d4d4;
      --text: #1c1917;
      --text-muted: #57534e;
      --success: #166534;
      --success-bg: #dcfce7;
      --warning: #a16207;
      --warning-bg: #fef3c7;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    /* Confidential Header */
    .confidential-bar {
      background: #292524;
      color: #fafaf9;
      padding: 10px 20px;
      font-size: 0.75rem;
      text-align: center;
      letter-spacing: 0.5px;
    }

    /* Security Notice */
    .security-notice {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      border-bottom: 1px solid #a7f3d0;
      padding: 14px 40px;
    }

    .security-notice-inner {
      max-width: 1100px;
      margin: 0 auto;
      font-size: 0.85rem;
      color: #065f46;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .security-notice-inner strong {
      white-space: nowrap;
    }

    .shield-icon {
      font-size: 1.2rem;
    }

    /* Letterhead */
    .letterhead {
      background: var(--primary);
      color: white;
      padding: 28px 40px;
    }

    .letterhead-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }

    .letterhead h1 {
      font-family: 'Crimson Pro', Georgia, serif;
      font-size: 1.4rem;
      font-weight: 500;
      letter-spacing: 0.3px;
      margin-bottom: 4px;
    }

    .letterhead .subtitle {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .letterhead-date {
      text-align: right;
      font-size: 0.8rem;
      opacity: 0.9;
    }

    /* Main Container */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px;
    }

    /* Matter Header */
    .matter-header {
      margin-bottom: 36px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--border);
    }

    .matter-header h2 {
      font-family: 'Crimson Pro', Georgia, serif;
      font-size: 1.8rem;
      font-weight: 500;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .matter-meta {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Overview Box */
    .overview-box {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 24px 28px;
      margin-bottom: 32px;
    }

    .overview-box h3 {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .overview-box p {
      font-size: 0.95rem;
      line-height: 1.7;
      color: var(--text);
    }

    .overview-stats {
      display: flex;
      gap: 40px;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid #e7e5e4;
    }

    .stat {
      text-align: center;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: 600;
      color: var(--primary);
    }

    .stat-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
    }

    /* Document Cards */
    .docs-section h3 {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .doc-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      margin-bottom: 16px;
      overflow: hidden;
    }

    .doc-card-header {
      padding: 20px 24px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background 0.15s;
    }

    .doc-card-header:hover {
      background: #fafaf9;
    }

    .doc-title-area {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .doc-number {
      width: 32px;
      height: 32px;
      background: var(--primary);
      color: white;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .doc-title h4 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 2px;
    }

    .doc-title .doc-subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .doc-header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .expand-hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      font-style: italic;
    }

    .doc-card.expanded .expand-hint {
      display: none;
    }

    .redline-count {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 12px;
      background: var(--warning-bg);
      color: var(--warning);
    }

    .expand-icon {
      color: var(--text-muted);
      font-size: 1.2rem;
      transition: transform 0.2s;
    }

    .doc-card.expanded .expand-icon {
      transform: rotate(180deg);
    }

    .doc-card-body {
      display: none;
      padding: 0 24px 24px 24px;
      border-top: 1px solid #e7e5e4;
    }

    .doc-card.expanded .doc-card-body {
      display: block;
    }

    /* Changes List */
    .changes-section {
      padding: 20px 0;
    }

    .changes-section h5 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .change-item {
      padding: 10px 0;
      border-bottom: 1px solid #f5f5f4;
      font-size: 0.9rem;
    }

    .change-item:last-child {
      border-bottom: none;
    }

    .change-item strong {
      color: var(--primary);
    }

    .change-item .note {
      color: var(--text-muted);
      font-size: 0.85rem;
      margin-top: 4px;
      font-style: italic;
    }

    /* Rationale */
    .rationale-section {
      background: #fafaf9;
      border-radius: 6px;
      padding: 16px 20px;
      margin: 16px 0;
    }

    .rationale-section h5 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .rationale-section p {
      font-size: 0.9rem;
      line-height: 1.6;
    }

    /* Actions */
    .doc-actions {
      display: flex;
      gap: 10px;
      padding-top: 16px;
      border-top: 1px solid #e7e5e4;
    }

    .btn {
      padding: 10px 16px;
      font-size: 0.85rem;
      font-weight: 500;
      border-radius: 6px;
      cursor: pointer;
      border: none;
      transition: all 0.15s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-light);
    }

    .btn-secondary {
      background: white;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .btn-secondary:hover {
      background: #fafaf9;
    }

    /* Footer */
    .footer {
      margin-top: 48px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
      text-align: center;
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .footer a {
      color: var(--primary);
      text-decoration: none;
    }

    /* Toolbar */
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .toolbar-left, .toolbar-right {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .btn-sm {
      padding: 8px 14px;
      font-size: 0.8rem;
    }

    /* Feedback elements */
    .feedback-section {
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid #e7e5e4;
    }

    .feedback-section h5 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .feedback-item {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      padding: 12px 0;
      border-bottom: 1px solid #f5f5f4;
    }

    .feedback-item:last-child {
      border-bottom: none;
    }

    .feedback-select {
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 0.8rem;
      min-width: 120px;
      cursor: pointer;
      background: white;
    }

    .feedback-select.status-approved {
      background: #dcfce7;
      border-color: #86efac;
      color: #166534;
    }

    .feedback-select.status-declined {
      background: #fee2e2;
      border-color: #fca5a5;
      color: #991b1b;
    }

    .feedback-select.status-discuss {
      background: #fef3c7;
      border-color: #fcd34d;
      color: #92400e;
    }

    .feedback-label {
      flex: 1;
      font-size: 0.85rem;
      color: var(--text);
    }

    .feedback-note {
      width: 100%;
      margin-top: 12px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 0.85rem;
      font-family: inherit;
      resize: vertical;
      min-height: 60px;
    }

    .feedback-note:focus {
      outline: none;
      border-color: var(--accent);
    }

    .feedback-note::placeholder {
      color: #a8a29e;
    }

    .save-bar {
      position: sticky;
      bottom: 0;
      background: white;
      border-top: 1px solid var(--border);
      padding: 12px 40px;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
    }

    .btn-save {
      background: var(--accent);
      color: white;
    }

    .btn-save:hover {
      background: #7c3aed;
    }

    /* Issue Summary Table */
    .issues-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
      margin-top: 20px;
    }

    .issues-table th {
      text-align: left;
      padding: 10px 12px;
      background: #f5f5f4;
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.4px;
      color: var(--text-muted);
      border-bottom: 1px solid var(--border);
    }

    .issues-table td {
      padding: 12px;
      border-bottom: 1px solid #e7e5e4;
      vertical-align: top;
    }

    .issues-table tr:last-child td {
      border-bottom: none;
    }

    .check {
      color: var(--success);
      font-weight: 600;
    }

    .dash {
      color: #d4d4d4;
    }

    /* Editable text boxes with copy */
    .editable-box {
      position: relative;
    }

    .editable-content {
      border: 1px solid transparent;
      border-radius: 6px;
      padding: 2px 4px;
      margin: -2px -4px;
      transition: border-color 0.15s, background 0.15s;
    }

    .editable-content:hover {
      border-color: #e7e5e4;
      background: #fafaf9;
    }

    .editable-content:focus {
      outline: none;
      border-color: var(--accent);
      background: white;
    }

    .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 5px 10px;
      font-size: 0.7rem;
      background: white;
      border: 1px solid var(--border);
      border-radius: 4px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.15s;
      color: var(--text-muted);
    }

    .editable-box:hover .copy-btn,
    .copy-btn:focus {
      opacity: 1;
    }

    .copy-btn:hover {
      background: #f5f5f4;
      color: var(--text);
    }

    .copy-btn.copied {
      background: var(--success-bg);
      border-color: #86efac;
      color: var(--success);
    }

    /* Playbook Section */
    .playbook-section {
      margin-bottom: 32px;
    }

    .playbook-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .playbook-header h3 {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      margin: 0;
    }

    .playbook-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 16px;
    }

    .playbook-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }

    .playbook-card-header {
      padding: 14px 16px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fafaf9;
      border-bottom: 1px solid transparent;
      transition: background 0.15s;
    }

    .playbook-card-header:hover {
      background: #f5f5f4;
    }

    .playbook-card.expanded .playbook-card-header {
      border-bottom-color: var(--border);
    }

    .playbook-card-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
    }

    .playbook-tags {
      display: flex;
      gap: 6px;
      margin-top: 6px;
    }

    .playbook-tag {
      font-size: 0.65rem;
      padding: 2px 6px;
      border-radius: 3px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      font-weight: 600;
    }

    .playbook-tag.sla { background: #dbeafe; color: #1e40af; }
    .playbook-tag.ipaas { background: #fae8ff; color: #86198f; }
    .playbook-tag.pm { background: #dcfce7; color: #166534; }
    .playbook-tag.dw { background: #fef3c7; color: #92400e; }

    .playbook-expand {
      font-size: 0.75rem;
      color: var(--text-muted);
      transition: transform 0.2s;
    }

    .playbook-card.expanded .playbook-expand {
      transform: rotate(180deg);
    }

    .playbook-card-body {
      display: none;
      padding: 16px;
    }

    .playbook-card.expanded .playbook-card-body {
      display: block;
    }

    .playbook-tier {
      margin-bottom: 14px;
    }

    .playbook-tier:last-child {
      margin-bottom: 0;
    }

    .playbook-tier-label {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      margin-bottom: 6px;
    }

    .playbook-tier-label.must { color: #dc2626; }
    .playbook-tier-label.prefer { color: #d97706; }
    .playbook-tier-label.fallback { color: #6b7280; }

    .playbook-tier-content {
      font-size: 0.85rem;
      color: var(--text);
      line-height: 1.5;
    }

    .playbook-tier-content ul {
      margin: 0;
      padding-left: 18px;
    }

    .playbook-tier-content li {
      margin-bottom: 4px;
    }

    .playbook-script {
      margin-top: 14px;
      padding: 12px;
      background: #f5f5f4;
      border-radius: 6px;
      border-left: 3px solid var(--accent);
      position: relative;
    }

    .playbook-script-label {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      color: var(--text-muted);
      margin-bottom: 6px;
      font-weight: 600;
    }

    .playbook-script-text {
      font-size: 0.85rem;
      font-style: italic;
      color: var(--text);
      line-height: 1.5;
    }

    .playbook-copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 8px;
      font-size: 0.65rem;
      background: white;
      border: 1px solid var(--border);
      border-radius: 3px;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .playbook-script:hover .playbook-copy-btn {
      opacity: 1;
    }

    .playbook-copy-btn:hover {
      background: #f5f5f4;
    }

    /* Password Gate */
    .password-gate {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .password-gate.hidden {
      display: none;
    }

    .password-box {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 40px 48px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
    }

    .password-box h2 {
      font-family: 'Crimson Pro', Georgia, serif;
      font-size: 1.4rem;
      color: var(--primary);
      margin-bottom: 8px;
    }

    .password-box .subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 24px;
    }

    .password-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 1rem;
      font-family: inherit;
      text-align: center;
      letter-spacing: 2px;
      margin-bottom: 16px;
    }

    .password-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .password-input.error {
      border-color: #dc2626;
      background: #fef2f2;
    }

    .password-submit {
      width: 100%;
      padding: 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.15s;
    }

    .password-submit:hover {
      background: var(--primary-light);
    }

    .password-error {
      color: #dc2626;
      font-size: 0.8rem;
      margin-top: 12px;
      display: none;
    }

    .password-error.show {
      display: block;
    }

    .show-pwd-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 0.75rem;
      cursor: pointer;
      padding: 4px 8px;
    }

    .show-pwd-btn:hover {
      color: var(--text);
    }

    .main-content {
      display: none;
    }

    .main-content.visible {
      display: block;
    }
  </style>
</head>
<body>

<!-- Password Gate -->
<div class="password-gate" id="passwordGate">
  <div class="password-box">
    <h2>Secure Client Workroom</h2>
    <div class="subtitle">Enter the access code provided by counsel</div>
    <div style="position:relative;">
      <input type="password" class="password-input" id="passwordInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off" autofocus>
      <button type="button" class="show-pwd-btn" id="showPwdBtn" onclick="togglePasswordVisibility()">Show</button>
    </div>
    <button class="password-submit" onclick="checkPassword()">Access Workroom</button>
    <div class="password-error" id="passwordError">Incorrect access code. Please try again.</div>
  </div>
</div>

<div class="main-content" id="mainContent">

<div class="confidential-bar">
  üîí PRIVILEGED & CONFIDENTIAL ‚Äî ATTORNEY WORK PRODUCT
</div>

<div class="security-notice">
  <div class="security-notice-inner">
    <span class="shield-icon">üõ°Ô∏è</span>
    <div><strong>Secure Client Workroom</strong> ‚Äî This page is not indexed by search engines and cannot be found through browsing. Only those with the direct link and password can access it. Documents and communications here are protected by attorney-client privilege.</div>
  </div>
</div>

<header class="letterhead">
  <div class="letterhead-inner">
    <div>
      <h1>Sergei Tokmakov, Esq.</h1>
      <a href="https://apps.calbar.ca.gov/attorney/Licensee/Detail/279869" target="_blank" style="font-size:0.75rem;opacity:0.7;margin-top:2px;color:white;text-decoration:none;">California Bar #279869</a>
    </div>
    <div class="letterhead-date">
      December 15, 2025<br>
      <span style="opacity:0.7">NR-7f9x2k</span>
    </div>
  </div>
</header>

<div class="container">

  <div class="matter-header">
    <h2>Story Cannabis MSA ‚Äî Proposed Redlines</h2>
    <div class="matter-meta">
      Salve Consulting LLC ‚Üí Story Cannabis | Master Services Agreement Package (Effective 1/1/26)
    </div>
  </div>

  <div class="overview-box editable-box">
    <h3>Summary</h3>
    <button class="copy-btn" onclick="copyContent(this)">Copy</button>
    <div class="editable-content" contenteditable="true" data-field="summary">
      <p>
        The attached documents contain our proposed revisions to the Story Cannabis MSA package. The redlines fall into a few main categories: (1) clarifying payment terms and invoice timing to align cash flow with actual service delivery, (2) adding third-party integration risk allocation language‚Äîcritical given the heavy reliance on systems like Dutchie, Treez, Springbig that we don't control, (3) tightening up SLA response times and carving out appropriate exclusions, and (4) various cleanup items where the original drafts had inconsistent references or missing definitions.
      </p>
      <p style="margin-top:12px;">
        Each document below expands to show specific changes and the thinking behind them. The redlined Word files are available for download‚Äîthey're formatted as proper Track Changes so Story's counsel can review in the usual way.
      </p>
    </div>
    <div class="overview-stats">
      <div class="stat">
        <div class="stat-number">4</div>
        <div class="stat-label">Documents</div>
      </div>
      <div class="stat">
        <div class="stat-number">20</div>
        <div class="stat-label">Total Redlines</div>
      </div>
    </div>
  </div>

  <!-- Issues at a Glance -->
  <div class="overview-box">
    <h3>Issues at a Glance</h3>
    <table class="issues-table">
      <thead>
        <tr>
          <th style="width:40%">Issue</th>
          <th>SLA</th>
          <th>iPaaS</th>
          <th>PM</th>
          <th>DW</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <strong>Payment/Invoicing Structure</strong><br>
            <span style="color:var(--text-muted);font-size:0.8rem;">Setup fees at kick-off, monthly fees upon go-live, Net 30 with grace period, overage pricing</span>
          </td>
          <td class="dash">‚Äî</td>
          <td class="check">‚úì</td>
          <td class="check">‚úì</td>
          <td class="check">‚úì</td>
        </tr>
        <tr>
          <td>
            <strong>Third-Party Risk Exclusions</strong><br>
            <span style="color:var(--text-muted);font-size:0.8rem;">Carve-outs for Dutchie/Treez/Springbig outages, API changes, rate limits, credential expirations</span>
          </td>
          <td class="check">‚úì</td>
          <td class="check">‚úì</td>
          <td class="dash">‚Äî</td>
          <td class="dash">‚Äî</td>
        </tr>
        <tr>
          <td>
            <strong>Response Time / SLA Adjustments</strong><br>
            <span style="color:var(--text-muted);font-size:0.8rem;">Faster Sev 2 response (8hr‚Üí1hr), realistic Sev 3-4 windows, scope limitation clause</span>
          </td>
          <td class="check">‚úì</td>
          <td class="dash">‚Äî</td>
          <td class="dash">‚Äî</td>
          <td class="dash">‚Äî</td>
        </tr>
        <tr>
          <td>
            <strong>IP & Licensing Terms</strong><br>
            <span style="color:var(--text-muted);font-size:0.8rem;">Work product ownership, perpetual license grant, third-party component acknowledgments</span>
          </td>
          <td class="dash">‚Äî</td>
          <td class="check">‚úì</td>
          <td class="dash">‚Äî</td>
          <td class="dash">‚Äî</td>
        </tr>
        <tr>
          <td>
            <strong>Suspension/Non-Payment Rights</strong><br>
            <span style="color:var(--text-muted);font-size:0.8rem;">Provider can pause services after 45 days non-payment with 5-day notice</span>
          </td>
          <td class="dash">‚Äî</td>
          <td class="check">‚úì</td>
          <td class="check">‚úì</td>
          <td class="check">‚úì</td>
        </tr>
        <tr>
          <td>
            <strong>Effective Date / Reference Fixes</strong><br>
            <span style="color:var(--text-muted);font-size:0.8rem;">Consistent nomenclature, corrected cross-references, added Exhibit D definition</span>
          </td>
          <td class="dash">‚Äî</td>
          <td class="check">‚úì</td>
          <td class="check">‚úì</td>
          <td class="dash">‚Äî</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Negotiation Playbook -->
  <div class="playbook-section">
    <div class="playbook-header">
      <h3>Negotiation Playbook</h3>
      <span style="font-size:0.75rem;color:var(--text-muted);">Internal reference ‚Äî click cards to expand</span>
    </div>
    <div class="playbook-grid">

      <!-- Card 1: Third-Party Risk -->
      <div class="playbook-card" id="pb-thirdparty">
        <div class="playbook-card-header" onclick="togglePlaybook('pb-thirdparty')">
          <div>
            <div class="playbook-card-title">Third-Party Dependency Risk</div>
            <div class="playbook-tags">
              <span class="playbook-tag sla">SLA</span>
              <span class="playbook-tag ipaas">iPaaS</span>
            </div>
          </div>
          <span class="playbook-expand">‚ñº</span>
        </div>
        <div class="playbook-card-body">
          <div class="playbook-tier">
            <div class="playbook-tier-label must">Must Have</div>
            <div class="playbook-tier-content">
              <ul>
                <li>No SLA breach/credits for third-party outages beyond our control</li>
                <li>Provider obligations limited to: monitor ‚Üí notify ‚Üí reasonable workaround</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label prefer">Prefer</div>
            <div class="playbook-tier-content">
              <ul>
                <li>Timeline extension when third-party events block progress</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label fallback">Fallback</div>
            <div class="playbook-tier-content">
              <ul>
                <li>A: Credits only if Provider fails to communicate/triage per process</li>
                <li>B: Cap exposure with minimal credit + "sole remedy" clause</li>
              </ul>
            </div>
          </div>
          <div class="playbook-script">
            <button class="playbook-copy-btn" onclick="copyScript(this, event)">Copy</button>
            <div class="playbook-script-label">What to say</div>
            <div class="playbook-script-text">"We can't guarantee performance of systems we don't control. We'll commit to coordination and transparency, but not to financial penalties for third-party outages."</div>
          </div>
        </div>
      </div>

      <!-- Card 2: Change Orders -->
      <div class="playbook-card" id="pb-changeorders">
        <div class="playbook-card-header" onclick="togglePlaybook('pb-changeorders')">
          <div>
            <div class="playbook-card-title">Change Orders / Scope Control</div>
            <div class="playbook-tags">
              <span class="playbook-tag ipaas">iPaaS</span>
              <span class="playbook-tag pm">PM</span>
              <span class="playbook-tag dw">DW</span>
            </div>
          </div>
          <span class="playbook-expand">‚ñº</span>
        </div>
        <div class="playbook-card-body">
          <div class="playbook-tier">
            <div class="playbook-tier-label must">Must Have</div>
            <div class="playbook-tier-content">
              <ul>
                <li>No out-of-scope work without written Change Order (CO)</li>
                <li>CO must state scope, fees, and schedule impact</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label prefer">Prefer</div>
            <div class="playbook-tier-content">
              <ul>
                <li>Fast path: CO templates + 48-72h impact estimate window</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label fallback">Fallback</div>
            <div class="playbook-tier-content">
              <ul>
                <li>A: Limited T&M up to small cap for urgent work, then CO required</li>
                <li>B: Email approval for rate + hours + description (paper trail)</li>
              </ul>
            </div>
          </div>
          <div class="playbook-script">
            <button class="playbook-copy-btn" onclick="copyScript(this, event)">Copy</button>
            <div class="playbook-script-label">What to say</div>
            <div class="playbook-script-text">"This is how we prevent budget surprises for you and scope creep for us‚Äîeveryone wins."</div>
          </div>
        </div>
      </div>

      <!-- Card 3: Payment & Suspension -->
      <div class="playbook-card" id="pb-payment">
        <div class="playbook-card-header" onclick="togglePlaybook('pb-payment')">
          <div>
            <div class="playbook-card-title">Payment & Non-Payment Remedies</div>
            <div class="playbook-tags">
              <span class="playbook-tag ipaas">iPaaS</span>
              <span class="playbook-tag pm">PM</span>
              <span class="playbook-tag dw">DW</span>
            </div>
          </div>
          <span class="playbook-expand">‚ñº</span>
        </div>
        <div class="playbook-card-body">
          <div class="playbook-tier">
            <div class="playbook-tier-label must">Must Have</div>
            <div class="playbook-tier-content">
              <ul>
                <li>Clear invoice timing + Net terms</li>
                <li>Right to suspend for nonpayment after cure period</li>
                <li>Withhold deliverables until undisputed amounts paid</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label prefer">Prefer</div>
            <div class="playbook-tier-content">
              <ul>
                <li>Suspension carve-out for good faith disputes (if undisputed amounts current)</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label fallback">Fallback</div>
            <div class="playbook-tier-content">
              <ul>
                <li>A: Longer cure period (15‚Üí30 days) but keep suspension</li>
                <li>B: Remove suspension, keep deliverable release gating</li>
              </ul>
            </div>
          </div>
          <div class="playbook-script">
            <button class="playbook-copy-btn" onclick="copyScript(this, event)">Copy</button>
            <div class="playbook-script-label">What to say</div>
            <div class="playbook-script-text">"We're happy to be flexible on timing, but we need a predictable payment mechanism‚Äîespecially before releasing core deliverables."</div>
          </div>
        </div>
      </div>

      <!-- Card 4: SLA Response vs Resolution -->
      <div class="playbook-card" id="pb-sla">
        <div class="playbook-card-header" onclick="togglePlaybook('pb-sla')">
          <div>
            <div class="playbook-card-title">SLA: Response vs. Resolution</div>
            <div class="playbook-tags">
              <span class="playbook-tag sla">SLA</span>
            </div>
          </div>
          <span class="playbook-expand">‚ñº</span>
        </div>
        <div class="playbook-card-body">
          <div class="playbook-tier">
            <div class="playbook-tier-label must">Must Have</div>
            <div class="playbook-tier-content">
              <ul>
                <li>Response times = "acknowledge + triage started," not "resolved"</li>
                <li>Tie to Normal Business Hours (defined)</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label prefer">Prefer</div>
            <div class="playbook-tier-content">
              <ul>
                <li>"Commercially reasonable efforts" for resolution, no fixed resolution times</li>
                <li>Workaround standard for Sev 1 (restore first, permanent fix later)</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label fallback">Fallback</div>
            <div class="playbook-tier-content">
              <ul>
                <li>A: Resolution targets as best-efforts, excluding third-party issues</li>
                <li>B: Credits only for repeated misses (3 in 6 months), Provider-caused only</li>
              </ul>
            </div>
          </div>
          <div class="playbook-script">
            <button class="playbook-copy-btn" onclick="copyScript(this, event)">Copy</button>
            <div class="playbook-script-label">What to say</div>
            <div class="playbook-script-text">"We can commit to rapid triage; resolution timing depends on root cause, complexity, and third-party variables."</div>
          </div>
        </div>
      </div>

      <!-- Card 5: IP & Licensing -->
      <div class="playbook-card" id="pb-ip">
        <div class="playbook-card-header" onclick="togglePlaybook('pb-ip')">
          <div>
            <div class="playbook-card-title">IP Ownership & License Back</div>
            <div class="playbook-tags">
              <span class="playbook-tag ipaas">iPaaS</span>
              <span class="playbook-tag dw">DW</span>
            </div>
          </div>
          <span class="playbook-expand">‚ñº</span>
        </div>
        <div class="playbook-card-body">
          <div class="playbook-tier">
            <div class="playbook-tier-label must">Must Have</div>
            <div class="playbook-tier-content">
              <ul>
                <li>Provider retains ownership of reusable tooling/connectors/methods</li>
                <li>Customer gets internal-use license (conditioned on payment)</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label prefer">Prefer</div>
            <div class="playbook-tier-content">
              <ul>
                <li>Explicitly allow reuse of anonymized learnings and non-customer-specific components</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label fallback">Fallback</div>
            <div class="playbook-tier-content">
              <ul>
                <li>A: Broader internal license + "use for Customer's benefit" clause (avoid joint ownership)</li>
                <li>B: Assign customer-specific configs but keep underlying framework/provider IP</li>
              </ul>
            </div>
          </div>
          <div class="playbook-script">
            <button class="playbook-copy-btn" onclick="copyScript(this, event)">Copy</button>
            <div class="playbook-script-label">What to say</div>
            <div class="playbook-script-text">"We're not selling our platform IP; we are delivering configurations and outcomes you can use."</div>
          </div>
        </div>
      </div>

      <!-- Card 6: AI Agent Boundaries -->
      <div class="playbook-card" id="pb-ai">
        <div class="playbook-card-header" onclick="togglePlaybook('pb-ai')">
          <div>
            <div class="playbook-card-title">AI Agent Support Boundaries</div>
            <div class="playbook-tags">
              <span class="playbook-tag sla">SLA</span>
            </div>
          </div>
          <span class="playbook-expand">‚ñº</span>
        </div>
        <div class="playbook-card-body">
          <div class="playbook-tier">
            <div class="playbook-tier-label must">Must Have</div>
            <div class="playbook-tier-content">
              <ul>
                <li>AI = informational only, not advice or commitment to implement</li>
                <li>Not a substitute for formal ticketing</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label prefer">Prefer</div>
            <div class="playbook-tier-content">
              <ul>
                <li>AI output may be inaccurate; Customer responsible for validation</li>
              </ul>
            </div>
          </div>
          <div class="playbook-tier">
            <div class="playbook-tier-label fallback">Fallback</div>
            <div class="playbook-tier-content">
              <ul>
                <li>A: Keep disclaimers but soften "no reliance" phrasing</li>
                <li>B: Make AI feature "beta/pilot," subject to modification, no SLA penalties</li>
              </ul>
            </div>
          </div>
          <div class="playbook-script">
            <button class="playbook-copy-btn" onclick="copyScript(this, event)">Copy</button>
            <div class="playbook-script-label">What to say</div>
            <div class="playbook-script-text">"AI assistance is helpful but not deterministic; we're setting expectations so support remains reliable."</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="docs-section">
    <div class="toolbar">
      <h3 style="margin:0;">Documents</h3>
      <div class="toolbar-right">
        <button class="btn btn-secondary btn-sm" onclick="expandAll()">Expand All</button>
        <button class="btn btn-secondary btn-sm" onclick="collapseAll()">Collapse All</button>
        <button class="btn btn-primary btn-sm" onclick="downloadAll()">‚Üì Download All</button>
      </div>
    </div>

    <!-- SLA -->
    <div class="doc-card" id="doc-sla">
      <div class="doc-card-header" onclick="toggleCard('doc-sla')">
        <div class="doc-title-area">
          <div class="doc-number">1</div>
          <div class="doc-title">
            <h4>Service Level Agreement</h4>
            <div class="doc-subtitle">SALVE-STORY SLA (1.01.26)</div>
          </div>
        </div>
        <div class="doc-header-right">
          <span class="expand-hint">click to see details & rationale</span>
          <span class="redline-count">6 redlines</span>
          <span class="expand-icon">‚ñº</span>
        </div>
      </div>
      <div class="doc-card-body">
        <div class="changes-section editable-box">
          <h5>What Changed</h5>
          <button class="copy-btn" onclick="copyContent(this)">Copy</button>
          <div class="editable-content" contenteditable="true" data-field="sla-changes">
            <div class="change-item">
              <strong>Response Time Adjustments (Severity Levels 2-4)</strong> ‚Äî Tightened the response windows. Sev 2 goes from 8 hours down to 1 hour during business hours. Sev 3 and 4 extended slightly (1‚Üí3 days, 2‚Üí5 days) to be more realistic for lower-priority issues.
            </div>
            <div class="change-item">
              <strong>Scope Limitation Clause (new item e)</strong> ‚Äî Added language clarifying Provider makes no guarantees for inquiries outside defined scope. Customer is responsible for monitoring their own external matters.
              <div class="note">This one is important‚Äîprevents scope creep into areas we're not being paid to support.</div>
            </div>
            <div class="change-item">
              <strong>Third-Party Integration Exclusions (items m-r)</strong> ‚Äî New exclusion items after Force Majeure covering API outages, rate limiting, credential issues, and third-party policy changes for systems like Dutchie, Treez, etc.
            </div>
            <div class="change-item">
              <strong>AI Agent Disclaimer</strong> ‚Äî Added disclaimer that AI Agent support is "as-is" and doesn't constitute formal support tickets or trigger SLA commitments.
            </div>
          </div>
        </div>

        <div class="rationale-section editable-box">
          <h5>Why These Matter</h5>
          <button class="copy-btn" onclick="copyContent(this)">Copy</button>
          <div class="editable-content" contenteditable="true" data-field="sla-rationale">
            <p>
              The third-party exclusions are non-negotiable from our perspective. When Dutchie's API goes down at 2am, that's not something we can control or fix‚Äîand we shouldn't be on the hook for SLA credits because of it. The response time adjustments balance faster response for critical issues against realistic timelines for routine matters. The AI disclaimer is prophylactic; we don't want someone arguing that chatting with the AI agent counts as "opening a ticket."
            </p>
          </div>
        </div>

        <div class="doc-actions">
          <a href="SALVE-STORY%20SLA%20(1.01.26)%20-%20REDLINED.docx" class="btn btn-primary" download>
            Download Redlined Version
          </a>
        </div>

        <div class="feedback-section">
          <h5>Notes</h5>
          <textarea class="feedback-note" data-item="sla" placeholder="Questions or comments on SLA redlines..."></textarea>
        </div>
      </div>
    </div>

    <!-- iPaaS SOW -->
    <div class="doc-card" id="doc-ipaas">
      <div class="doc-card-header" onclick="toggleCard('doc-ipaas')">
        <div class="doc-title-area">
          <div class="doc-number">2</div>
          <div class="doc-title">
            <h4>iPaaS Statement of Work</h4>
            <div class="doc-subtitle">Exhibit C-5 ‚Äî Integration Platform Services</div>
          </div>
        </div>
        <div class="doc-header-right">
          <span class="expand-hint">click to see details & rationale</span>
          <span class="redline-count">10 redlines</span>
          <span class="expand-icon">‚ñº</span>
        </div>
      </div>
      <div class="doc-card-body">
        <div class="changes-section editable-box">
          <h5>What Changed</h5>
          <button class="copy-btn" onclick="copyContent(this)">Copy</button>
          <div class="editable-content" contenteditable="true" data-field="ipaas-changes">
            <div class="change-item">
              <strong>Payment Terms Restructure</strong> ‚Äî Complete rewrite of Section 6.4. Setup fees now invoiced at kick-off (due before production deployment). Monthly fees commence when integration goes live, prorated for mid-month starts. Added event volume caps (100M/month) with overage pricing.
            </div>
            <div class="change-item">
              <strong>Third-Party Integration Dependencies (new Section 6.5)</strong> ‚Äî Four subsections covering: nature of dependencies, excluded events, Provider obligations during outages, and automatic timeline extensions.
              <div class="note">This is the heart of our risk allocation for iPaaS work.</div>
            </div>
            <div class="change-item">
              <strong>Change Management Process (new Section 8)</strong> ‚Äî Formal CO process: written request ‚Üí 5-day impact assessment ‚Üí 5-day customer response ‚Üí signed CO required. No work outside scope without executed CO.
            </div>
            <div class="change-item">
              <strong>IP & License Terms (Section 7)</strong> ‚Äî Fleshed out the bare-bones IP section with work product ownership, third-party component acknowledgments, customer data rights, and reservation of rights.
            </div>
            <div class="change-item">
              <strong>Exhibit D Definition & References</strong> ‚Äî Added definition for "Exhibit D: 2026 Technical Roadmap" and fixed broken reference in Section 3.2.3 that pointed to wrong section.
            </div>
            <div class="change-item">
              <strong>PM Services Clarification</strong> ‚Äî Explicit statement that project management is separate (Exhibit C-6) and not included in iPaaS fees.
            </div>
            <div class="change-item">
              <strong>Suspension Rights</strong> ‚Äî Provider can suspend after 45 days non-payment with 5 business days notice. Covers active integrations, deliverables, platform access, and new work.
            </div>
            <div class="change-item">
              <strong>Cleanup</strong> ‚Äî Fixed "any other C-5 SOW" ‚Üí "any other SOW" and "Effective Date" ‚Üí "C-5 SOW Effective Date" for clarity.
            </div>
          </div>
        </div>

        <div class="rationale-section editable-box">
          <h5>Why These Matter</h5>
          <button class="copy-btn" onclick="copyContent(this)">Copy</button>
          <div class="editable-content" contenteditable="true" data-field="ipaas-rationale">
            <p>
              This SOW has the most redlines because it's also the most complex engagement. The payment restructure aligns cash flow with delivery milestones rather than back-loading everything. The third-party dependencies section is critical‚Äîwe're building integrations with systems we don't own, and when Treez changes their API schema without warning, that's not our breach. The change management process protects both sides from scope creep and the "oh, we assumed that was included" conversations.
            </p>
          </div>
        </div>

        <div class="doc-actions">
          <a href="SALVE-STORY%20iPAAS%20SOW%20(01.01.26)%20-%20REDLINED.docx" class="btn btn-primary" download>
            Download Redlined Version
          </a>
        </div>

        <div class="feedback-section">
          <h5>Notes</h5>
          <textarea class="feedback-note" data-item="ipaas" placeholder="Questions or comments on iPaaS SOW redlines..."></textarea>
        </div>
      </div>
    </div>

    <!-- PM SOW -->
    <div class="doc-card" id="doc-pm">
      <div class="doc-card-header" onclick="toggleCard('doc-pm')">
        <div class="doc-title-area">
          <div class="doc-number">3</div>
          <div class="doc-title">
            <h4>Project Management SOW</h4>
            <div class="doc-subtitle">Exhibit C-6 ‚Äî PM Services for iPaaS Implementation</div>
          </div>
        </div>
        <div class="doc-header-right">
          <span class="expand-hint">click to see details & rationale</span>
          <span class="redline-count">5 redlines</span>
          <span class="expand-icon">‚ñº</span>
        </div>
      </div>
      <div class="doc-card-body">
        <div class="changes-section editable-box">
          <h5>What Changed</h5>
          <button class="copy-btn" onclick="copyContent(this)">Copy</button>
          <div class="editable-content" contenteditable="true" data-field="pm-changes">
            <div class="change-item">
              <strong>Payment Terms</strong> ‚Äî Aligned with same structure as iPaaS SOW (setup at kick-off, monthly upon commencement, Net 30 with 15-day grace).
            </div>
            <div class="change-item">
              <strong>Cross-Reference to Change Management</strong> ‚Äî Added reference to C-5 SOW Section 8 for change order process.
            </div>
            <div class="change-item">
              <strong>Relationship Clarification</strong> ‚Äî This SOW supports C-5 iPaaS implementation; made that explicit.
            </div>
            <div class="change-item">
              <strong>Effective Date Fix</strong> ‚Äî Same nomenclature cleanup as iPaaS.
            </div>
            <div class="change-item">
              <strong>Suspension Language</strong> ‚Äî Mirror of iPaaS suspension rights for non-payment.
            </div>
          </div>
        </div>

        <div class="rationale-section editable-box">
          <h5>Why These Matter</h5>
          <button class="copy-btn" onclick="copyContent(this)">Copy</button>
          <div class="editable-content" contenteditable="true" data-field="pm-rationale">
            <p>
              Mostly harmonization‚Äîwe want the PM SOW and iPaaS SOW to work together seamlessly. Same payment terms, same suspension rights, clear relationship between the two. The change management cross-reference avoids having to duplicate that whole section here.
            </p>
          </div>
        </div>

        <div class="doc-actions">
          <a href="SALVE-STORY%20PM%20SOW%20(01.01.26)%20-%20REDLINED.docx" class="btn btn-primary" download>
            Download Redlined Version
          </a>
        </div>

        <div class="feedback-section">
          <h5>Notes</h5>
          <textarea class="feedback-note" data-item="pm" placeholder="Questions or comments on PM SOW redlines..."></textarea>
        </div>
      </div>
    </div>

    <!-- DW SOW -->
    <div class="doc-card" id="doc-dw">
      <div class="doc-card-header" onclick="toggleCard('doc-dw')">
        <div class="doc-title-area">
          <div class="doc-number">4</div>
          <div class="doc-title">
            <h4>Data Warehouse SOW</h4>
            <div class="doc-subtitle">Exhibit C-4 ‚Äî Analytics & Reporting Services</div>
          </div>
        </div>
        <div class="doc-header-right">
          <span class="expand-hint">click to see details & rationale</span>
          <span class="redline-count">3 redlines</span>
          <span class="expand-icon">‚ñº</span>
        </div>
      </div>
      <div class="doc-card-body">
        <div class="changes-section editable-box">
          <h5>What Changed</h5>
          <button class="copy-btn" onclick="copyContent(this)">Copy</button>
          <div class="editable-content" contenteditable="true" data-field="dw-changes">
            <div class="change-item">
              <strong>Payment Terms</strong> ‚Äî Same alignment as other SOWs. Setup invoiced at kick-off, monthly upon go-live.
            </div>
            <div class="change-item">
              <strong>Suspension Rights</strong> ‚Äî Added ability to suspend services and withhold deliverables for non-payment after 45 days.
            </div>
            <div class="change-item">
              <strong>Monthly Fee Commencement</strong> ‚Äî Clarified that ongoing fees start when DW environment is actively receiving production data.
            </div>
          </div>
        </div>

        <div class="rationale-section editable-box">
          <h5>Why These Matter</h5>
          <button class="copy-btn" onclick="copyContent(this)">Copy</button>
          <div class="editable-content" contenteditable="true" data-field="dw-rationale">
            <p>
              The DW SOW was relatively clean to begin with. Main additions are consistency with the payment/suspension terms across all SOWs. We want a single, predictable framework for how invoicing and non-payment situations work across the entire engagement.
            </p>
          </div>
        </div>

        <div class="doc-actions">
          <a href="SALVE-STORY%20DW%20SOW%20(1.01.26)%20-%20REDLINED.docx" class="btn btn-primary" download>
            Download Redlined Version
          </a>
        </div>

        <div class="feedback-section">
          <h5>Notes</h5>
          <textarea class="feedback-note" data-item="dw" placeholder="Questions or comments on DW SOW redlines..."></textarea>
        </div>
      </div>
    </div>

  </div>

</div>


<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyCeACvK3MVTOOaWY4SWG1yNnrcA9ILkkaM",
  authDomain: "termsdocs.firebaseapp.com",
  databaseURL: "https://termsdocs-default-rtdb.firebaseio.com",
  projectId: "termsdocs",
  storageBucket: "termsdocs.firebasestorage.app",
  messagingSenderId: "62791617178",
  appId: "1:62791617178:web:ff79f24f40cc98e88aed23"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const workroomRef = db.ref('workrooms/NR-7f9x2k');

// Copy editable content to clipboard (preserves formatting as plain text)
function copyContent(btn) {
  const box = btn.closest('.editable-box');
  const content = box.querySelector('.editable-content');

  // Get text content (strips HTML but preserves line breaks)
  const text = content.innerText || content.textContent;

  navigator.clipboard.writeText(text).then(() => {
    const orig = btn.textContent;
    btn.textContent = 'Copied!';
    btn.style.background = '#dcfce7';
    btn.style.borderColor = '#86efac';
    btn.style.color = '#166534';
    btn.style.opacity = '1';
    setTimeout(() => {
      btn.textContent = orig;
      btn.style.background = '';
      btn.style.borderColor = '';
      btn.style.color = '';
    }, 1500);
  }).catch(err => {
    console.error('Copy failed:', err);
    btn.textContent = 'Failed';
    setTimeout(() => { btn.textContent = 'Copy'; }, 1500);
  });
}

function toggleCard(id) {
  const card = document.getElementById(id);
  card.classList.toggle('expanded');
}

function togglePlaybook(id) {
  const card = document.getElementById(id);
  card.classList.toggle('expanded');
}

function copyScript(btn, event) {
  event.stopPropagation();
  const scriptText = btn.parentElement.querySelector('.playbook-script-text').innerText;
  navigator.clipboard.writeText(scriptText).then(() => {
    const orig = btn.textContent;
    btn.textContent = 'Copied!';
    btn.style.background = '#dcfce7';
    btn.style.borderColor = '#86efac';
    btn.style.color = '#166534';
    btn.style.opacity = '1';
    setTimeout(() => {
      btn.textContent = orig;
      btn.style.background = '';
      btn.style.borderColor = '';
      btn.style.color = '';
    }, 1500);
  });
}

function expandAll() {
  document.querySelectorAll('.doc-card').forEach(card => card.classList.add('expanded'));
}

function collapseAll() {
  document.querySelectorAll('.doc-card').forEach(card => card.classList.remove('expanded'));
}

function downloadAll() {
  const files = [
    'SALVE-STORY%20SLA%20(1.01.26)%20-%20REDLINED.docx',
    'SALVE-STORY%20iPAAS%20SOW%20(01.01.26)%20-%20REDLINED.docx',
    'SALVE-STORY%20PM%20SOW%20(01.01.26)%20-%20REDLINED.docx',
    'SALVE-STORY%20DW%20SOW%20(1.01.26)%20-%20REDLINED.docx'
  ];
  files.forEach((file, i) => {
    setTimeout(() => {
      const a = document.createElement('a');
      a.href = file;
      a.download = decodeURIComponent(file);
      a.click();
    }, i * 500);
  });
}

// Save feedback to Firebase
function saveFeedback() {
  const data = {
    selections: {},
    notes: {},
    lastUpdated: new Date().toISOString()
  };

  document.querySelectorAll('.feedback-select').forEach(sel => {
    if (sel.value) data.selections[sel.dataset.item] = sel.value;
  });
  document.querySelectorAll('.feedback-note').forEach(note => {
    if (note.value.trim()) data.notes[note.dataset.item] = note.value;
  });

  workroomRef.child('feedback').set(data)
    .then(() => showSaveConfirm())
    .catch(err => {
      console.error('Save failed:', err);
      alert('Save failed. Check console for details.');
    });
}

// Load feedback from Firebase (real-time listener)
function setupRealtimeSync() {
  // Sync feedback (notes textareas)
  workroomRef.child('feedback').on('value', (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    // Update selections
    if (data.selections) {
      document.querySelectorAll('.feedback-select').forEach(sel => {
        if (data.selections[sel.dataset.item]) {
          sel.value = data.selections[sel.dataset.item];
        } else {
          sel.value = '';
        }
        updateSelectStyle(sel);
      });
    }

    // Update notes
    if (data.notes) {
      document.querySelectorAll('.feedback-note').forEach(note => {
        if (data.notes[note.dataset.item]) {
          note.value = data.notes[note.dataset.item];
        }
      });
    }

    // Show last updated
    if (data.lastUpdated) {
      updateLastSaved(data.lastUpdated);
    }
  });

  // Sync editable content (innerHTML preserved)
  workroomRef.child('editableContent').on('value', (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    document.querySelectorAll('.editable-content[data-field]').forEach(el => {
      const field = el.dataset.field;
      if (data[field] && !el.matches(':focus')) {
        el.innerHTML = data[field];
      }
    });
  });
}

// Save editable content to Firebase (debounced, preserves HTML)
let saveTimeout = null;
function saveEditableContent(el) {
  const field = el.dataset.field;
  if (!field) return;

  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(() => {
    const update = {};
    update[field] = el.innerHTML;
    workroomRef.child('editableContent').update(update);
  }, 800);
}

function updateSelectStyle(sel) {
  sel.classList.remove('status-approved', 'status-declined', 'status-discuss');
  if (sel.value === 'approved') sel.classList.add('status-approved');
  if (sel.value === 'declined') sel.classList.add('status-declined');
  if (sel.value === 'discuss') sel.classList.add('status-discuss');
}

function showSaveConfirm() {
  const btn = document.getElementById('saveBtn');
  const orig = btn.textContent;
  btn.textContent = 'Saved ‚úì';
  btn.style.background = '#166534';
  setTimeout(() => {
    btn.textContent = orig;
    btn.style.background = '';
  }, 1500);
}

function updateLastSaved(isoDate) {
  const date = new Date(isoDate);
  const formatted = date.toLocaleString('en-US', {
    month: 'short', day: 'numeric',
    hour: 'numeric', minute: '2-digit',
    hour12: true
  });
  const indicator = document.getElementById('lastSaved');
  if (indicator) indicator.textContent = 'Last saved: ' + formatted;
}

// Password protection
const ACCESS_CODE = 'Story2026';

function togglePasswordVisibility() {
  const input = document.getElementById('passwordInput');
  const btn = document.getElementById('showPwdBtn');
  if (input.type === 'password') {
    input.type = 'text';
    btn.textContent = 'Hide';
  } else {
    input.type = 'password';
    btn.textContent = 'Show';
  }
}

function checkPassword() {
  const input = document.getElementById('passwordInput');
  const error = document.getElementById('passwordError');

  if (input.value === ACCESS_CODE) {
    // Store in session
    sessionStorage.setItem('workroom_auth', 'true');
    unlockWorkroom();
  } else {
    input.classList.add('error');
    error.classList.add('show');
    input.value = '';
    setTimeout(() => {
      input.classList.remove('error');
    }, 500);
  }
}

function unlockWorkroom() {
  document.getElementById('passwordGate').classList.add('hidden');
  document.getElementById('mainContent').classList.add('visible');
}

// Check if already authenticated in this session
function checkAuth() {
  if (sessionStorage.getItem('workroom_auth') === 'true') {
    unlockWorkroom();
  }
}

// Allow Enter key to submit
document.getElementById('passwordInput').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') {
    checkPassword();
  }
});

document.addEventListener('DOMContentLoaded', function() {
  checkAuth();
  document.getElementById('doc-sla').classList.add('expanded');
  setupRealtimeSync();

  document.querySelectorAll('.feedback-select').forEach(sel => {
    sel.addEventListener('change', function() {
      updateSelectStyle(this);
    });
  });

  // Auto-save editable content on input (preserves formatting)
  document.querySelectorAll('.editable-content[data-field]').forEach(el => {
    el.addEventListener('input', function() {
      saveEditableContent(this);
    });
  });
});
</script>

</div><!-- end main-content -->

</body>
</html>
