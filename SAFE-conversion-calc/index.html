<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-901N2Y3CDZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-901N2Y3CDZ');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAFE Note Conversion Calculator</title>
    <style>
        :root {
            --primary-color: #0069ff;
            --secondary-color: #f8f9fa;
            --text-color: #333;
            --border-color: #dee2e6;
            --highlight-color: #ffff99;
            --success-color: #28a745;
            --warning-color: #ffc107;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .calculator-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 768px) {
            .calculator-container {
                flex-direction: row;
            }
        }
        
        .input-section {
            flex: 1;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        .preview-section {
            flex: 1;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            position: relative;
            overflow: auto;
            height: 600px;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }
        
        h2 {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .intro {
            margin-bottom: 20px;
        }
        
        .form-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 15px;
            cursor: pointer;
            font-weight: 500;
            border: none;
            background: none;
            color: var(--text-color);
        }
        
        .tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }
        
        .form-section {
            display: none;
        }
        
        .form-section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .tooltip {
            display: inline-block;
            margin-left: 5px;
            position: relative;
            cursor: help;
        }
        
        .tooltip-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
        }
        
        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 4px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: normal;
            font-size: 14px;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        input[type="number"],
        input[type="text"],
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 16px;
        }
        
        .percentage-input {
            position: relative;
        }
        
        .percentage-input input {
            padding-right: 30px;
        }
        
        .percentage-input::after {
            content: "%";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #0052cc;
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }
        
        .btn-secondary:hover {
            background-color: #e2e6ea;
        }
        
        .btn-disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .result-section {
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border-color);
        }
        
        .result-row:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 500;
        }
        
        .highlight {
            background-color: var(--highlight-color);
            animation: fadeHighlight 3s forwards;
        }
        
        @keyframes fadeHighlight {
            0% { background-color: var(--highlight-color); }
            70% { background-color: var(--highlight-color); }
            100% { background-color: transparent; }
        }
        
        .calendar-link {
            display: inline-block;
            margin-top: 20px;
            text-decoration: none;
            color: var(--primary-color);
        }
        
        .calendar-link:hover {
            text-decoration: underline;
        }
        
        .save-section {
            margin-top: 30px;
        }
        
        .explanation {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            border-radius: 4px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table, th, td {
            border: 1px solid var(--border-color);
        }

        th, td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: var(--secondary-color);
            font-weight: bold;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 20px;
            margin-bottom: 10px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="intro">
        <h1>SAFE Note Conversion Calculator</h1>
        <p>This calculator helps you visualize how SAFE (Simple Agreement for Future Equity) notes convert to equity and impact your company's cap table under different scenarios. Input your company details and SAFE terms to see the results of both post-money and pre-money conversions.</p>
    </div>
    
    <div class="calculator-container">
        <div class="input-section">
            <div class="form-tabs">
                <button class="tab active" data-tab="company">Company Info</button>
                <button class="tab" data-tab="safe">SAFE Details</button>
                <button class="tab" data-tab="financing">Financing</button>
                <button class="tab" data-tab="results">Results</button>
            </div>
            
            <form id="calculator-form">
                <!-- Company Info Section -->
                <div class="form-section active" id="company-section">
                    <h2>Company Information</h2>
                    
                    <div class="form-group">
                        <label for="company-name">Company Name</label>
                        <input type="text" id="company-name" name="company-name" placeholder="Your Startup, Inc.">
                    </div>
                    
                    <div class="form-group">
                        <label for="existing-shares">
                            Existing Shares Outstanding
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">The total number of shares issued by the company before any SAFE conversions or new equity rounds.</span>
                            </div>
                        </label>
                        <input type="number" id="existing-shares" name="existing-shares" placeholder="1000000" min="1" step="1000" value="1000000">
                    </div>
                    
                    <div class="form-group">
                        <label for="option-pool">
                            Option Pool Size
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">The percentage of shares reserved for employee options, expressed as a percentage of fully-diluted shares.</span>
                            </div>
                        </label>
                        <div class="percentage-input">
                            <input type="number" id="option-pool" name="option-pool" placeholder="10" min="0" max="100" value="10">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="button" class="btn-secondary" id="reset-button">Reset</button>
                        <button type="button" class="btn-primary" id="next-company">Next</button>
                    </div>
                </div>
                
                <!-- SAFE Details Section -->
                <div class="form-section" id="safe-section">
                    <h2>SAFE Note Details</h2>
                    
                    <div class="form-group">
                        <label for="safe-amount">
                            SAFE Investment Amount
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">The total amount raised through the SAFE note(s).</span>
                            </div>
                        </label>
                        <input type="number" id="safe-amount" name="safe-amount" placeholder="500000" min="1" step="10000" value="500000">
                    </div>
                    
                    <div class="form-group">
                        <label for="valuation-cap">
                            Valuation Cap
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">The maximum company valuation at which the SAFE will convert to equity.</span>
                            </div>
                        </label>
                        <input type="number" id="valuation-cap" name="valuation-cap" placeholder="3000000" min="1" step="500000" value="3000000">
                    </div>
                    
                    <div class="form-group">
                        <label for="discount-rate">
                            Discount Rate
                            <div class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">The percentage discount the SAFE holder receives on the price per share compared to new investors.</span>
                            </div>
                        </label>
                        <div class="percentage-input">
                            <input type="number" id="discount-rate" name="discount-rate" placeholder="20" min="0" max="100" value="20">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="safe-type">SAFE Type</label>
                        <select id="safe-type" name="safe-type">
                            <option value="post-money">Post-Money SAFE</option>
                            <option value="pre-money">Pre-Money SAFE</option>
                        </select>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="button" class="btn-secondary" id="prev-safe">Previous</button>
                        <button type="button" class="btn-primary" id="next-safe">Next</button>
                    </div>
                </div>
                
                <!-- Financing Section -->
                <div class="form-section" id="financing-section">
                    <h2>Equity Financing Details</h2>
                    
                    <div class="form-group">
                        <label for="financing-type">Triggering Event</label>
                        <select id="financing-type" name="financing-type">
                            <option value="equity-round">Equity Financing Round</option>
                            <option value="acquisition">Acquisition</option>
                        </select>
                    </div>
                    
                    <div id="equity-round-inputs">
                        <div class="form-group">
                            <label for="pre-money-valuation">
                                Pre-Money Valuation
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">The valuation of the company before the new investment is added.</span>
                                </div>
                            </label>
                            <input type="number" id="pre-money-valuation" name="pre-money-valuation" placeholder="5000000" min="1" step="500000" value="5000000">
                        </div>
                        
                        <div class="form-group">
                            <label for="new-investment">
                                New Investment Amount
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">The amount raised in the new equity financing round.</span>
                                </div>
                            </label>
                            <input type="number" id="new-investment" name="new-investment" placeholder="1000000" min="1" step="100000" value="1000000">
                        </div>
                    </div>
                    
                    <div id="acquisition-inputs" style="display: none;">
                        <div class="form-group">
                            <label for="acquisition-value">
                                Acquisition Value
                                <div class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">The total value at which the company is being acquired.</span>
                                </div>
                            </label>
                            <input type="number" id="acquisition-value" name="acquisition-value" placeholder="10000000" min="1" step="1000000" value="10000000">
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="button" class="btn-secondary" id="prev-financing">Previous</button>
                        <button type="button" class="btn-primary" id="calculate-button">Calculate Results</button>
                    </div>
                </div>
                
                <!-- Results Section -->
                <div class="form-section" id="results-section">
                    <h2>Conversion Results</h2>
                    
                    <div id="result-tabs" class="form-tabs">
                        <button class="tab active" data-result-tab="summary">Summary</button>
                        <button class="tab" data-result-tab="post-money">Post-Money Scenario</button>
                        <button class="tab" data-result-tab="pre-money">Pre-Money Scenario</button>
                    </div>
                    
                    <div id="summary-result" class="result-tab active">
                        <div class="result-section">
                            <h3>Key Metrics</h3>
                            <div class="result-row">
                                <span class="result-label">Post-Money SAFE Conversion Shares:</span>
                                <span id="post-money-shares">0</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Pre-Money SAFE Conversion Shares:</span>
                                <span id="pre-money-shares">0</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Post-Money SAFE Ownership %:</span>
                                <span id="post-money-ownership">0%</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Pre-Money SAFE Ownership %:</span>
                                <span id="pre-money-ownership">0%</span>
                            </div>
                            <div class="result-row">
                                <span class="result-label">Difference in Ownership:</span>
                                <span id="ownership-difference">0%</span>
                            </div>
                        </div>
                        
                        <div class="explanation" id="summary-explanation">
                            Complete the calculator to see a summary of the differences between post-money and pre-money SAFE conversions.
                        </div>
                    </div>
                    
                    <div id="post-money-result" class="result-tab">
                        <div class="result-section">
                            <h3>Post-Money SAFE Cap Table</h3>
                            <table id="post-money-table">
                                <thead>
                                    <tr>
                                        <th>Shareholder</th>
                                        <th>Pre-Money Shares</th>
                                        <th>Post-Money Shares</th>
                                        <th>Ownership %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Table rows will be populated via JavaScript -->
                                </tbody>
                            </table>
                            
                            <div class="chart-container">
                                <canvas id="post-money-chart"></canvas>
                            </div>
                            <div id="post-money-legend" class="legend"></div>
                        </div>
                        
                        <div class="explanation" id="post-money-explanation">
                            Complete the calculator to see the post-money SAFE conversion details.
                        </div>
                    </div>
                    
                    <div id="pre-money-result" class="result-tab">
                        <div class="result-section">
                            <h3>Pre-Money SAFE Cap Table</h3>
                            <table id="pre-money-table">
                                <thead>
                                    <tr>
                                        <th>Shareholder</th>
                                        <th>Pre-Money Shares</th>
                                        <th>Post-Money Shares</th>
                                        <th>Ownership %</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Table rows will be populated via JavaScript -->
                                </tbody>
                            </table>
                            
                            <div class="chart-container">
                                <canvas id="pre-money-chart"></canvas>
                            </div>
                            <div id="pre-money-legend" class="legend"></div>
                        </div>
                        
                        <div class="explanation" id="pre-money-explanation">
                            Complete the calculator to see the pre-money SAFE conversion details.
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="button" class="btn-secondary" id="prev-results">Previous</button>
                        <button type="button" class="btn-primary" id="recalculate-button">Recalculate</button>
                    </div>
                    
                    <div class="save-section">
                        <p>Need help structuring your SAFE notes or understanding cap table implications?</p>
                        <a href="https://calendly.com/sergei-tokmakov/30-minute-zoom-meeting" class="calendar-link" onclick="Calendly.initPopupWidget({url: 'https://calendly.com/sergei-tokmakov/30-minute-zoom-meeting'});return false;">Schedule a consultation</a>
                    </div>
                </div>
            </form>
        </div>
        
        <div class="preview-section" id="preview-pane">
            <h2>Live Preview</h2>
            <div id="preview-content">
                <p><strong>Company Information</strong></p>
                <p>Company Name: Your Startup, Inc.</p>
                <p>Existing Shares: 1,000,000</p>
                <p>Option Pool: 10%</p>
                
                <p><strong>SAFE Note Details</strong></p>
                <p>SAFE Investment: $500,000</p>
                <p>Valuation Cap: $3,000,000</p>
                <p>Discount Rate: 20%</p>
                <p>SAFE Type: Post-Money SAFE</p>
                
                <p><strong>Equity Financing Details</strong></p>
                <p>Triggering Event: Equity Financing Round</p>
                <p>Pre-Money Valuation: $5,000,000</p>
                <p>New Investment: $1,000,000</p>
                
                <p><strong>Post-Money SAFE Conversion</strong></p>
                <p>Conversion Price: $4.00 per share</p>
                <p>SAFE Conversion Shares: 125,000</p>
                <p>Total Post-Money Shares: 1,325,000</p>
                <p>SAFE Investor Ownership: 9.4%</p>
                
                <p><strong>Pre-Money SAFE Conversion</strong></p>
                <p>Conversion Price: $2.40 per share</p>
                <p>SAFE Conversion Shares: 208,333</p>
                <p>Total Post-Money Shares: 1,408,333</p>
                <p>SAFE Investor Ownership: 14.8%</p>
                
                <p><strong>Key Difference</strong></p>
                <p>The pre-money SAFE conversion results in 83,333 more shares (5.4% more ownership) for the SAFE investor compared to the post-money conversion.</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Charts variables
        let postMoneyChart = null;
        let preMoneyChart = null;
        
        // Tab navigation
        const tabs = document.querySelectorAll('.tab');
        const sections = document.querySelectorAll('.form-section');
        
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.getAttribute('data-tab');
                
                // Update active tab
                tabs.forEach(t => {
                    if (t.getAttribute('data-tab')) {
                        t.classList.remove('active');
                    }
                });
                tab.classList.add('active');
                
                // Show active section
                sections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === `${targetTab}-section`) {
                        section.classList.add('active');
                    }
                });
            });
        });
        
        // Result tab navigation
        const resultTabs = document.querySelectorAll('[data-result-tab]');
        const resultSections = document.querySelectorAll('.result-tab');
        
        resultTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const targetTab = tab.getAttribute('data-result-tab');
                
                // Update active tab
                resultTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Show active section
                resultSections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === `${targetTab}-result`) {
                        section.classList.add('active');
                    }
                });
            });
        });

        // Navigation buttons
        document.getElementById('next-company').addEventListener('click', () => {
            document.querySelector('[data-tab="safe"]').click();
        });
        
        document.getElementById('prev-safe').addEventListener('click', () => {
            document.querySelector('[data-tab="company"]').click();
        });
        
        document.getElementById('next-safe').addEventListener('click', () => {
            document.querySelector('[data-tab="financing"]').click();
        });
        
        document.getElementById('prev-financing').addEventListener('click', () => {
            document.querySelector('[data-tab="safe"]').click();
        });
        
        document.getElementById('prev-results').addEventListener('click', () => {
            document.querySelector('[data-tab="financing"]').click();
        });
        
        document.getElementById('calculate-button').addEventListener('click', () => {
            calculateResults();
            document.querySelector('[data-tab="results"]').click();
        });
        
        document.getElementById('recalculate-button').addEventListener('click', () => {
            calculateResults();
        });
        
        document.getElementById('reset-button').addEventListener('click', () => {
            document.getElementById('calculator-form').reset();
            updatePreview();
        });

        // Toggle financing inputs based on financing type
        document.getElementById('financing-type').addEventListener('change', function() {
            const financingType = this.value;
            const equityRoundInputs = document.getElementById('equity-round-inputs');
            const acquisitionInputs = document.getElementById('acquisition-inputs');
            
            if (financingType === 'equity-round') {
                equityRoundInputs.style.display = 'block';
                acquisitionInputs.style.display = 'none';
            } else {
                equityRoundInputs.style.display = 'none';
                acquisitionInputs.style.display = 'block';
            }
            
            updatePreview();
        });

        // Update preview when inputs change
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(input => {
            input.addEventListener('change', updatePreview);
            input.addEventListener('input', updatePreview);
        });

        // Initial preview update
        updatePreview();

        // Main function to update the preview pane
        function updatePreview() {
            const companyName = document.getElementById('company-name').value || 'Your Startup, Inc.';
            const existingShares = parseFloat(document.getElementById('existing-shares').value) || 1000000;
            const optionPool = parseFloat(document.getElementById('option-pool').value) || 10;
            const safeAmount = parseFloat(document.getElementById('safe-amount').value) || 500000;
            const valuationCap = parseFloat(document.getElementById('valuation-cap').value) || 3000000;
            const discountRate = parseFloat(document.getElementById('discount-rate').value) || 20;
            const safeType = document.getElementById('safe-type').value;
            const financingType = document.getElementById('financing-type').value;
            
            let preMoneyValuation, newInvestment, acquisitionValue;
            
            if (financingType === 'equity-round') {
                preMoneyValuation = parseFloat(document.getElementById('pre-money-valuation').value) || 5000000;
                newInvestment = parseFloat(document.getElementById('new-investment').value) || 1000000;
                acquisitionValue = 0;
            } else {
                preMoneyValuation = 0;
                newInvestment = 0;
                acquisitionValue = parseFloat(document.getElementById('acquisition-value').value) || 10000000;
            }
            
            // Calculate post-money and pre-money conversion results
            const postMoneyResults = financingType === 'equity-round' 
                ? calculatePostMoneyEquityRound(existingShares, safeAmount, valuationCap, discountRate, preMoneyValuation, newInvestment)
                : calculatePostMoneyAcquisition(existingShares, safeAmount, valuationCap, discountRate, acquisitionValue);
                
            const preMoneyResults = financingType === 'equity-round'
                ? calculatePreMoneyEquityRound(existingShares, safeAmount, valuationCap, discountRate, preMoneyValuation, newInvestment)
                : calculatePreMoneyAcquisition(existingShares, safeAmount, valuationCap, discountRate, acquisitionValue);
            
            // Calculate ownership difference
            const ownershipDifference = preMoneyResults.safeOwnership - postMoneyResults.safeOwnership;
            
            // Create preview HTML
            const financingDetails = financingType === 'equity-round'
                ? `<p>Triggering Event: Equity Financing Round</p>
                   <p>Pre-Money Valuation: ${formatCurrency(preMoneyValuation)}</p>
                   <p>New Investment: ${formatCurrency(newInvestment)}</p>`
                : `<p>Triggering Event: Acquisition</p>
                   <p>Acquisition Value: ${formatCurrency(acquisitionValue)}</p>`;
            
            const previewHTML = `
                <p><strong>Company Information</strong></p>
                <p>Company Name: ${companyName}</p>
                <p>Existing Shares: ${formatNumber(existingShares)}</p>
                <p>Option Pool: ${optionPool}%</p>
                
                <p><strong>SAFE Note Details</strong></p>
                <p>SAFE Investment: ${formatCurrency(safeAmount)}</p>
                <p>Valuation Cap: ${formatCurrency(valuationCap)}</p>
                <p>Discount Rate: ${discountRate}%</p>
                <p>SAFE Type: ${safeType === 'post-money' ? 'Post-Money SAFE' : 'Pre-Money SAFE'}</p>
                
                <p><strong>Equity Financing Details</strong></p>
                ${financingDetails}
                
                <p><strong>Post-Money SAFE Conversion</strong></p>
                <p>Conversion Price: ${formatCurrency(postMoneyResults.conversionPrice)} per share</p>
                <p>SAFE Conversion Shares: ${formatNumber(postMoneyResults.safeShares)}</p>
                <p>Total Post-Money Shares: ${formatNumber(postMoneyResults.totalShares)}</p>
                <p>SAFE Investor Ownership: ${formatPercentage(postMoneyResults.safeOwnership)}</p>
                
                <p><strong>Pre-Money SAFE Conversion</strong></p>
                <p>Conversion Price: ${formatCurrency(preMoneyResults.conversionPrice)} per share</p>
                <p>SAFE Conversion Shares: ${formatNumber(preMoneyResults.safeShares)}</p>
                <p>Total Post-Money Shares: ${formatNumber(preMoneyResults.totalShares)}</p>
                <p>SAFE Investor Ownership: ${formatPercentage(preMoneyResults.safeOwnership)}</p>
                
                <p><strong>Key Difference</strong></p>
                <p>The pre-money SAFE conversion results in ${formatNumber(preMoneyResults.safeShares - postMoneyResults.safeShares)} more shares (${formatPercentage(ownershipDifference)} more ownership) for the SAFE investor compared to the post-money conversion.</p>
            `;
            
            // Update preview content and add compare logic to highlight changes
            updateContentWithHighlights('preview-content', previewHTML);
        }

        // Function to calculate results and update the UI
        function calculateResults() {
            const companyName = document.getElementById('company-name').value || 'Your Startup, Inc.';
            const existingShares = parseFloat(document.getElementById('existing-shares').value) || 1000000;
            const optionPool = parseFloat(document.getElementById('option-pool').value) || 10;
            const safeAmount = parseFloat(document.getElementById('safe-amount').value) || 500000;
            const valuationCap = parseFloat(document.getElementById('valuation-cap').value) || 3000000;
            const discountRate = parseFloat(document.getElementById('discount-rate').value) || 20;
            const safeType = document.getElementById('safe-type').value;
            const financingType = document.getElementById('financing-type').value;
            
            let preMoneyValuation, newInvestment, acquisitionValue;
            
            if (financingType === 'equity-round') {
                preMoneyValuation = parseFloat(document.getElementById('pre-money-valuation').value) || 5000000;
                newInvestment = parseFloat(document.getElementById('new-investment').value) || 1000000;
                acquisitionValue = 0;
            } else {
                preMoneyValuation = 0;
                newInvestment = 0;
                acquisitionValue = parseFloat(document.getElementById('acquisition-value').value) || 10000000;
            }
            
            // Calculate post-money and pre-money conversion results
            const postMoneyResults = financingType === 'equity-round' 
                ? calculatePostMoneyEquityRound(existingShares, safeAmount, valuationCap, discountRate, preMoneyValuation, newInvestment)
                : calculatePostMoneyAcquisition(existingShares, safeAmount, valuationCap, discountRate, acquisitionValue);
                
            const preMoneyResults = financingType === 'equity-round'
                ? calculatePreMoneyEquityRound(existingShares, safeAmount, valuationCap, discountRate, preMoneyValuation, newInvestment)
                : calculatePreMoneyAcquisition(existingShares, safeAmount, valuationCap, discountRate, acquisitionValue);
            
            // Calculate ownership difference
            const ownershipDifference = preMoneyResults.safeOwnership - postMoneyResults.safeOwnership;
            
            // Update summary results
            document.getElementById('post-money-shares').textContent = formatNumber(postMoneyResults.safeShares);
            document.getElementById('pre-money-shares').textContent = formatNumber(preMoneyResults.safeShares);
            document.getElementById('post-money-ownership').textContent = formatPercentage(postMoneyResults.safeOwnership);
            document.getElementById('pre-money-ownership').textContent = formatPercentage(preMoneyResults.safeOwnership);
            document.getElementById('ownership-difference').textContent = formatPercentage(ownershipDifference);
            
            // Update summary explanation
            const summaryExplanation = `
                Based on your inputs, a ${safeType === 'post-money' ? 'post-money' : 'pre-money'} SAFE with a ${formatCurrency(valuationCap)} valuation cap and ${discountRate}% discount rate would convert to ${formatNumber(safeType === 'post-money' ? postMoneyResults.safeShares : preMoneyResults.safeShares)} shares upon a ${financingType === 'equity-round' ? formatCurrency(preMoneyValuation) + ' equity financing round' : formatCurrency(acquisitionValue) + ' acquisition'}.
                
                The key difference between post-money and pre-money SAFEs is that pre-money SAFEs convert at the pre-money valuation (before new capital is added), while post-money SAFEs convert based on the post-money valuation (after new capital is added). This results in pre-money SAFE holders receiving ${formatNumber(preMoneyResults.safeShares - postMoneyResults.safeShares)} more shares (${formatPercentage(ownershipDifference)} more ownership) than post-money SAFE holders.
                
                Pre-money SAFEs are generally more favorable to investors, while post-money SAFEs provide more certainty to founders about the dilution impact.
            `;
            document.getElementById('summary-explanation').textContent = summaryExplanation;
            
            // Update post-money table
            const postMoneyTable = document.getElementById('post-money-table').getElementsByTagName('tbody')[0];
            postMoneyTable.innerHTML = '';
            
            if (financingType === 'equity-round') {
                const founderRow = document.createElement('tr');
                founderRow.innerHTML = `
                    <td>Founders</td>
                    <td>${formatNumber(existingShares)}</td>
                    <td>${formatNumber(existingShares)}</td>
                    <td>${formatPercentage(existingShares / postMoneyResults.totalShares)}</td>
                `;
                postMoneyTable.appendChild(founderRow);
                
                const safeRow = document.createElement('tr');
                safeRow.innerHTML = `
                    <td>SAFE Investors</td>
                    <td>0</td>
                    <td>${formatNumber(postMoneyResults.safeShares)}</td>
                    <td>${formatPercentage(postMoneyResults.safeOwnership)}</td>
                `;
                postMoneyTable.appendChild(safeRow);
                
                const newInvestorRow = document.createElement('tr');
                newInvestorRow.innerHTML = `
                    <td>New Investors</td>
                    <td>0</td>
                    <td>${formatNumber(postMoneyResults.newInvestorShares)}</td>
                    <td>${formatPercentage(postMoneyResults.newInvestorShares / postMoneyResults.totalShares)}</td>
                `;
                postMoneyTable.appendChild(newInvestorRow);
                
                const totalRow = document.createElement('tr');
                totalRow.innerHTML = `
                    <td><strong>Total</strong></td>
                    <td><strong>${formatNumber(existingShares)}</strong></td>
                    <td><strong>${formatNumber(postMoneyResults.totalShares)}</strong></td>
                    <td><strong>100.0%</strong></td>
                `;
                postMoneyTable.appendChild(totalRow);
            } else {
                const founderRow = document.createElement('tr');
                founderRow.innerHTML = `
                    <td>Founders</td>
                    <td>${formatNumber(existingShares)}</td>
                    <td>${formatNumber(existingShares)}</td>
                    <td>${formatPercentage(existingShares / postMoneyResults.totalShares)}</td>
                `;
                postMoneyTable.appendChild(founderRow);
                
                const safeRow = document.createElement('tr');
                safeRow.innerHTML = `
                    <td>SAFE Investors</td>
                    <td>0</td>
                    <td>${formatNumber(postMoneyResults.safeShares)}</td>
                    <td>${formatPercentage(postMoneyResults.safeOwnership)}</td>
                `;
                postMoneyTable.appendChild(safeRow);
                
                const totalRow = document.createElement('tr');
                totalRow.innerHTML = `
                    <td><strong>Total</strong></td>
                    <td><strong>${formatNumber(existingShares)}</strong></td>
                    <td><strong>${formatNumber(postMoneyResults.totalShares)}</strong></td>
                    <td><strong>100.0%</strong></td>
                `;
                postMoneyTable.appendChild(totalRow);
            }
            
            // Update pre-money table
            const preMoneyTable = document.getElementById('pre-money-table').getElementsByTagName('tbody')[0];
            preMoneyTable.innerHTML = '';
            
            if (financingType === 'equity-round') {
                const founderRow = document.createElement('tr');
                founderRow.innerHTML = `
                    <td>Founders</td>
                    <td>${formatNumber(existingShares)}</td>
                    <td>${formatNumber(existingShares)}</td>
                    <td>${formatPercentage(existingShares / preMoneyResults.totalShares)}</td>
                `;
                preMoneyTable.appendChild(founderRow);
                
                const safeRow = document.createElement('tr');
                safeRow.innerHTML = `
                    <td>SAFE Investors</td>
                    <td>0</td>
                    <td>${formatNumber(preMoneyResults.safeShares)}</td>
                    <td>${formatPercentage(preMoneyResults.safeOwnership)}</td>
                `;
                preMoneyTable.appendChild(safeRow);
                
                const newInvestorRow = document.createElement('tr');
                newInvestorRow.innerHTML = `
                    <td>New Investors</td>
                    <td>0</td>
                    <td>${formatNumber(preMoneyResults.newInvestorShares)}</td>
                    <td>${formatPercentage(preMoneyResults.newInvestorShares / preMoneyResults.totalShares)}</td>
                `;
                preMoneyTable.appendChild(newInvestorRow);
                
                const totalRow = document.createElement('tr');
                totalRow.innerHTML = `
                    <td><strong>Total</strong></td>
                    <td><strong>${formatNumber(existingShares)}</strong></td>
                    <td><strong>${formatNumber(preMoneyResults.totalShares)}</strong></td>
                    <td><strong>100.0%</strong></td>
                `;
                preMoneyTable.appendChild(totalRow);
            } else {
                const founderRow = document.createElement('tr');
                founderRow.innerHTML = `
                    <td>Founders</td>
                    <td>${formatNumber(existingShares)}</td>
                    <td>${formatNumber(existingShares)}</td>
                    <td>${formatPercentage(existingShares / preMoneyResults.totalShares)}</td>
                `;
                preMoneyTable.appendChild(founderRow);
                
                const safeRow = document.createElement('tr');
                safeRow.innerHTML = `
                    <td>SAFE Investors</td>
                    <td>0</td>
                    <td>${formatNumber(preMoneyResults.safeShares)}</td>
                    <td>${formatPercentage(preMoneyResults.safeOwnership)}</td>
                `;
                preMoneyTable.appendChild(safeRow);
                
                const totalRow = document.createElement('tr');
                totalRow.innerHTML = `
                    <td><strong>Total</strong></td>
                    <td><strong>${formatNumber(existingShares)}</strong></td>
                    <td><strong>${formatNumber(preMoneyResults.totalShares)}</strong></td>
                    <td><strong>100.0%</strong></td>
                `;
                preMoneyTable.appendChild(totalRow);
            }
            
            // Update post-money explanation
            const postMoneyExplanation = financingType === 'equity-round'
                ? `In a post-money SAFE conversion during an equity financing round, the SAFE converts based on the post-money valuation (${formatCurrency(preMoneyValuation + newInvestment)}). The conversion price is calculated as the lower of: (1) the price per share with the discount applied (${formatCurrency(postMoneyResults.discountedPrice)} per share) or (2) the price per share based on the valuation cap (${formatCurrency(postMoneyResults.cappedPrice)} per share). In this case, the conversion price is ${formatCurrency(postMoneyResults.conversionPrice)} per share, resulting in ${formatNumber(postMoneyResults.safeShares)} shares for the SAFE investor, which represents ${formatPercentage(postMoneyResults.safeOwnership)} ownership.`
                : `In a post-money SAFE conversion during an acquisition, the SAFE converts based on the acquisition value (${formatCurrency(acquisitionValue)}). The conversion price is calculated as the lower of: (1) the price per share with the discount applied (${formatCurrency(postMoneyResults.discountedPrice)} per share) or (2) the price per share based on the valuation cap (${formatCurrency(postMoneyResults.cappedPrice)} per share). In this case, the conversion price is ${formatCurrency(postMoneyResults.conversionPrice)} per share, resulting in ${formatNumber(postMoneyResults.safeShares)} shares for the SAFE investor, which represents ${formatPercentage(postMoneyResults.safeOwnership)} ownership.`;
            document.getElementById('post-money-explanation').textContent = postMoneyExplanation;
            
            // Update pre-money explanation
            const preMoneyExplanation = financingType === 'equity-round'
                ? `In a pre-money SAFE conversion during an equity financing round, the SAFE converts based on the pre-money valuation (${formatCurrency(preMoneyValuation)}). The conversion price is calculated as the lower of: (1) the price per share with the discount applied (${formatCurrency(preMoneyResults.discountedPrice)} per share) or (2) the price per share based on the valuation cap (${formatCurrency(preMoneyResults.cappedPrice)} per share). In this case, the conversion price is ${formatCurrency(preMoneyResults.conversionPrice)} per share, resulting in ${formatNumber(preMoneyResults.safeShares)} shares for the SAFE investor, which represents ${formatPercentage(preMoneyResults.safeOwnership)} ownership.`
                : `In a pre-money SAFE conversion during an acquisition, the SAFE converts based on the pre-acquisition value. The conversion price is calculated as the lower of: (1) the price per share with the discount applied (${formatCurrency(preMoneyResults.discountedPrice)} per share) or (2) the price per share based on the valuation cap (${formatCurrency(preMoneyResults.cappedPrice)} per share). In this case, the conversion price is ${formatCurrency(preMoneyResults.conversionPrice)} per share, resulting in ${formatNumber(preMoneyResults.safeShares)} shares for the SAFE investor, which represents ${formatPercentage(preMoneyResults.safeOwnership)} ownership.`;
            document.getElementById('pre-money-explanation').textContent = preMoneyExplanation;
            
            // Update charts
            updateCharts(postMoneyResults, preMoneyResults, financingType);
            
            // Update preview
            updatePreview();
        }
        
        // Function to calculate post-money SAFE conversion in equity round
        function calculatePostMoneyEquityRound(existingShares, safeAmount, valuationCap, discountRate, preMoneyValuation, newInvestment) {
            const postMoneyValuation = preMoneyValuation + newInvestment;
            
            // Calculate price per share based on pre-money valuation
            const pricePerShare = preMoneyValuation / existingShares;
            
            // Calculate price with discount
            const discountedPrice = pricePerShare * (1 - discountRate / 100);
            
            // Calculate price based on valuation cap
            const cappedPrice = valuationCap / existingShares;
            
            // Use the lower of the two prices
            const conversionPrice = Math.min(discountedPrice, cappedPrice);
            
            // Calculate SAFE conversion shares
            const safeShares = Math.round(safeAmount / conversionPrice);
            
            // Calculate new investor shares
            const newInvestorShares = Math.round(newInvestment / pricePerShare);
            
            // Calculate total shares
            const totalShares = existingShares + safeShares + newInvestorShares;
            
            // Calculate SAFE ownership percentage
            const safeOwnership = safeShares / totalShares;
            
            return {
                conversionPrice,
                discountedPrice,
                cappedPrice,
                safeShares,
                newInvestorShares,
                totalShares,
                safeOwnership
            };
        }
        
        // Function to calculate pre-money SAFE conversion in equity round
        function calculatePreMoneyEquityRound(existingShares, safeAmount, valuationCap, discountRate, preMoneyValuation, newInvestment) {
            // Calculate price per share based on pre-money valuation
            const pricePerShare = preMoneyValuation / existingShares;
            
            // Calculate price with discount
            const discountedPrice = pricePerShare * (1 - discountRate / 100);
            
            // Calculate price based on valuation cap
            const cappedPrice = valuationCap / existingShares;
            
            // Use the lower of the two prices
            const conversionPrice = Math.min(discountedPrice, cappedPrice);
            
            // Calculate SAFE conversion shares
            const safeShares = Math.round(safeAmount / conversionPrice);
            
            // Calculate new investor shares
            const newInvestorShares = Math.round(newInvestment / pricePerShare);
            
            // Calculate total shares
            const totalShares = existingShares + safeShares + newInvestorShares;
            
            // Calculate SAFE ownership percentage
            const safeOwnership = safeShares / totalShares;
            
            return {
                conversionPrice,
                discountedPrice,
                cappedPrice,
                safeShares,
                newInvestorShares,
                totalShares,
                safeOwnership
            };
        }
        
        // Function to calculate post-money SAFE conversion in acquisition
        function calculatePostMoneyAcquisition(existingShares, safeAmount, valuationCap, discountRate, acquisitionValue) {
            // Calculate price per share based on acquisition value
            const pricePerShare = acquisitionValue / existingShares;
            
            // Calculate price with discount
            const discountedPrice = pricePerShare * (1 - discountRate / 100);
            
            // Calculate price based on valuation cap
            const cappedPrice = valuationCap / existingShares;
            
            // Use the lower of the two prices
            const conversionPrice = Math.min(discountedPrice, cappedPrice);
            
            // Calculate SAFE conversion shares
            const safeShares = Math.round(safeAmount / conversionPrice);
            
            // Calculate total shares
            const totalShares = existingShares + safeShares;
            
            // Calculate SAFE ownership percentage
            const safeOwnership = safeShares / totalShares;
            
            return {
                conversionPrice,
                discountedPrice,
                cappedPrice,
                safeShares,
                newInvestorShares: 0,
                totalShares,
                safeOwnership
            };
        }
        
        // Function to calculate pre-money SAFE conversion in acquisition
        function calculatePreMoneyAcquisition(existingShares, safeAmount, valuationCap, discountRate, acquisitionValue) {
            // Calculate price per share based on acquisition value
            const pricePerShare = acquisitionValue / existingShares;
            
            // Calculate price with discount
            const discountedPrice = pricePerShare * (1 - discountRate / 100);
            
            // Calculate price based on valuation cap
            const cappedPrice = valuationCap / existingShares;
            
            // Use the lower of the two prices
            const conversionPrice = Math.min(discountedPrice, cappedPrice);
            
            // Calculate SAFE conversion shares
            const safeShares = Math.round(safeAmount / conversionPrice);
            
            // Calculate total shares
            const totalShares = existingShares + safeShares;
            
            // Calculate SAFE ownership percentage
            const safeOwnership = safeShares / totalShares;
            
            return {
                conversionPrice,
                discountedPrice,
                cappedPrice,
                safeShares,
                newInvestorShares: 0,
                totalShares,
                safeOwnership
            };
        }
        
        // Update charts based on calculation results
        function updateCharts(postMoneyResults, preMoneyResults, financingType) {
            const postMoneyChartCtx = document.getElementById('post-money-chart').getContext('2d');
            const preMoneyChartCtx = document.getElementById('pre-money-chart').getContext('2d');
            
            // Destroy existing charts if they exist
            if (postMoneyChart) {
                postMoneyChart.destroy();
            }
            
            if (preMoneyChart) {
                preMoneyChart.destroy();
            }
            
            // Define chart colors
            const chartColors = [
                '#0069ff',
                '#28a745',
                '#ffc107',
                '#dc3545'
            ];
            
            // Create post-money chart data
            let postMoneyData, postMoneyLabels;
            
            if (financingType === 'equity-round') {
                postMoneyData = [
                    Math.round(postMoneyResults.totalShares - postMoneyResults.safeShares - postMoneyResults.newInvestorShares),
                    postMoneyResults.safeShares,
                    postMoneyResults.newInvestorShares
                ];
                postMoneyLabels = ['Founders', 'SAFE Investors', 'New Investors'];
            } else {
                postMoneyData = [
                    Math.round(postMoneyResults.totalShares - postMoneyResults.safeShares),
                    postMoneyResults.safeShares
                ];
                postMoneyLabels = ['Founders', 'SAFE Investors'];
            }
            
            // Create pre-money chart data
            let preMoneyData, preMoneyLabels;
            
            if (financingType === 'equity-round') {
                preMoneyData = [
                    Math.round(preMoneyResults.totalShares - preMoneyResults.safeShares - preMoneyResults.newInvestorShares),
                    preMoneyResults.safeShares,
                    preMoneyResults.newInvestorShares
                ];
                preMoneyLabels = ['Founders', 'SAFE Investors', 'New Investors'];
            } else {
                preMoneyData = [
                    Math.round(preMoneyResults.totalShares - preMoneyResults.safeShares),
                    preMoneyResults.safeShares
                ];
                preMoneyLabels = ['Founders', 'SAFE Investors'];
            }
            
            // Create post-money chart
            postMoneyChart = new Chart(postMoneyChartCtx, {
                type: 'pie',
                data: {
                    labels: postMoneyLabels,
                    datasets: [{
                        data: postMoneyData,
                        backgroundColor: chartColors.slice(0, postMoneyData.length),
                        borderColor: '#ffffff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = Math.round((value / postMoneyResults.totalShares) * 1000) / 10;
                                    return label + ': ' + formatNumber(value) + ' shares (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // Create pre-money chart
            preMoneyChart = new Chart(preMoneyChartCtx, {
                type: 'pie',
                data: {
                    labels: preMoneyLabels,
                    datasets: [{
                        data: preMoneyData,
                        backgroundColor: chartColors.slice(0, preMoneyData.length),
                        borderColor: '#ffffff',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = Math.round((value / preMoneyResults.totalShares) * 1000) / 10;
                                    return label + ': ' + formatNumber(value) + ' shares (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // Create post-money legend
            const postMoneyLegend = document.getElementById('post-money-legend');
            postMoneyLegend.innerHTML = '';
            
            postMoneyLabels.forEach((label, index) => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const legendColor = document.createElement('div');
                legendColor.className = 'legend-color';
                legendColor.style.backgroundColor = chartColors[index];
                
                const legendText = document.createElement('span');
                legendText.textContent = label + ': ' + formatPercentage(postMoneyData[index] / postMoneyResults.totalShares);
                
                legendItem.appendChild(legendColor);
                legendItem.appendChild(legendText);
                postMoneyLegend.appendChild(legendItem);
            });
            
            // Create pre-money legend
            const preMoneyLegend = document.getElementById('pre-money-legend');
            preMoneyLegend.innerHTML = '';
            
            preMoneyLabels.forEach((label, index) => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                
                const legendColor = document.createElement('div');
                legendColor.className = 'legend-color';
                legendColor.style.backgroundColor = chartColors[index];
                
                const legendText = document.createElement('span');
                legendText.textContent = label + ': ' + formatPercentage(preMoneyData[index] / preMoneyResults.totalShares);
                
                legendItem.appendChild(legendColor);
                legendItem.appendChild(legendText);
                preMoneyLegend.appendChild(legendItem);
            });
        }

        // Helper function to format currency
        function formatCurrency(amount) {
            return '$' + amount.toLocaleString('en-US', { 
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        // Helper function to format number
        function formatNumber(number) {
            return Math.round(number).toLocaleString('en-US');
        }
        
        // Helper function to format percentage
        function formatPercentage(decimal) {
            return (decimal * 100).toFixed(1) + '%';
        }

        // Function to update content with highlights for changed text
        function updateContentWithHighlights(elementId, newHTML) {
            const container = document.getElementById(elementId);
            const oldHTML = container.innerHTML;
            
            // Update the content
            container.innerHTML = newHTML;
            
            // Highlight changes (simplified approach - in a real implementation, 
            // you would want a more sophisticated diff algorithm)
            if (oldHTML) {
                const oldParagraphs = getTextNodes(oldHTML);
                const newParagraphs = Array.from(container.childNodes).filter(node => 
                    node.nodeType === Node.ELEMENT_NODE && node.tagName === 'P'
                );
                
                newParagraphs.forEach((newP, i) => {
                    if (i < oldParagraphs.length) {
                        const oldText = oldParagraphs[i];
                        const newText = newP.textContent;
                        
                        if (oldText !== newText) {
                            highlightChanges(newP, oldText, newText);
                        }
                    }
                });
            }
        }

        // Extract text content from HTML string
        function getTextNodes(html) {
            const div = document.createElement('div');
            div.innerHTML = html;
            return Array.from(div.querySelectorAll('p')).map(p => p.textContent);
        }

        // Highlight changes in text (simplified version)
        function highlightChanges(element, oldText, newText) {
            // This is a simplified approach - in a real implementation,
            // you would want to use a proper diff algorithm to identify exactly what changed
            element.classList.add('highlight');
            
            // Scroll to the highlighted element if it's not in view
            const container = document.getElementById('preview-pane');
            const isInView = 
                element.offsetTop >= container.scrollTop && 
                element.offsetTop <= container.scrollTop + container.clientHeight;
                
            if (!isInView) {
                container.scrollTop = element.offsetTop - 100;
            }
        }
    </script>
</body>
</html>
