<!DOCTYPE html>
<html>
<head>
    <title>NDA API Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        textarea { width: 100%; height: 100px; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è NDA API Debug Test</h1>
    
    <div class="test-section">
        <h3>Test 1: API Connectivity</h3>
        <button onclick="testAPIConnectivity()">Test API Endpoint</button>
        <div id="connectivityResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 2: Simple NDA Analysis</h3>
        <textarea id="testNDA" placeholder="Paste test NDA text here...">This Non-Disclosure Agreement is entered into between Company A and Company B for the purpose of sharing confidential information. The receiving party agrees to keep all information confidential for a period of 2 years.</textarea>
        <br>
        <button onclick="testNDAAnalysis()">Test NDA Analysis</button>
        <div id="ndaResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>Test 3: Compare with Working API</h3>
        <button onclick="testWorkingAPI()">Test Interior Design API (Working)</button>
        <div id="workingResult" class="result"></div>
    </div>

    <script>
        async function testAPIConnectivity() {
            const result = document.getElementById('connectivityResult');
            result.innerHTML = 'Testing API connectivity...';
            
            try {
                const response = await fetch('https://template-generator-aob3.vercel.app/api/nda-risk-chat', {
                    method: 'OPTIONS',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                result.innerHTML = `<span class="success">‚úÖ API Endpoint Accessible</span><br>
                    Status: ${response.status}<br>
                    OK: ${response.ok}`;
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå API Connectivity Failed</span><br>
                    Error: ${error.message}`;
            }
        }

        async function testNDAAnalysis() {
            const result = document.getElementById('ndaResult');
            const ndaText = document.getElementById('testNDA').value;
            result.innerHTML = 'Analyzing NDA...';
            
            const testMessage = {
                role: 'user',
                content: `Please analyze this NDA and determine if it's okay to sign as-is. Consider the industry context: technology.\n\nNDA TEXT:\n${ndaText}`
            };
            
            try {
                console.log('üîç Sending request:', { messages: [testMessage] });
                
                const response = await fetch('https://template-generator-aob3.vercel.app/api/nda-risk-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: [testMessage] })
                });
                
                console.log('üîç Response status:', response.status);
                console.log('üîç Response headers:', [...response.headers]);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('üîç Response data:', data);
                    result.innerHTML = `<span class="success">‚úÖ Analysis Successful</span><br>
                        <strong>Model Used:</strong> ${data.model}<br>
                        <strong>Response:</strong><div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; max-height: 300px; overflow-y: auto;">${data.response}</div>`;
                } else {
                    const errorData = await response.text();
                    console.error('üîç Error response:', errorData);
                    result.innerHTML = `<span class="error">‚ùå Analysis Failed</span><br>
                        Status: ${response.status}<br>
                        Response: <pre>${errorData}</pre>`;
                }
            } catch (error) {
                console.error('üîç Request error:', error);
                result.innerHTML = `<span class="error">‚ùå Request Failed</span><br>
                    Error: ${error.message}`;
            }
        }

        async function testWorkingAPI() {
            const result = document.getElementById('workingResult');
            result.innerHTML = 'Testing working API...';
            
            const testMessage = {
                role: 'user',
                content: 'Quick test: Can I terminate a difficult client?'
            };
            
            try {
                const response = await fetch('https://template-generator-aob3.vercel.app/api/interior-design-chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: [testMessage] })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    result.innerHTML = `<span class="success">‚úÖ Working API Successful</span><br>
                        <strong>Model Used:</strong> ${data.model}<br>
                        <strong>Response Preview:</strong> ${data.response.substring(0, 200)}...`;
                } else {
                    const errorData = await response.text();
                    result.innerHTML = `<span class="error">‚ùå Working API Failed</span><br>
                        Status: ${response.status}<br>
                        Response: ${errorData}`;
                }
            } catch (error) {
                result.innerHTML = `<span class="error">‚ùå Working API Error</span><br>
                    Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>