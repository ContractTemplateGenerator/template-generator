<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's Your Case Worth? | Free Legal Case Evaluator | Terms.Law</title>
    <meta name="description" content="Free case value calculator built by a California attorney. Get realistic settlement ranges, collection probability, and strategic options based on real litigation experience.">

    <!-- React + Babel for JSX -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-901N2Y3CDZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-901N2Y3CDZ');
    </script>

    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --primary-dark: #1e3a8a;
            --success: #059669;
            --success-light: #10b981;
            --warning: #d97706;
            --danger: #dc2626;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }
        .logo span { color: var(--gray-600); font-weight: 400; }

        /* Main Layout - Split Screen */
        .main-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: minmax(380px, 420px) 1fr;
            gap: 1.5rem;
            min-height: calc(100vh - 70px);
        }

        @media (max-width: 1100px) {
            .main-container { grid-template-columns: 1fr; }
            .form-panel { position: relative !important; top: 0 !important; }
        }

        /* Form Panel (Left) */
        .form-panel {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 85px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }
        .form-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        .form-subtitle {
            color: var(--gray-500);
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        .calc-lang-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 1.5rem;
        }
        .calc-lang-flag {
            width: 32px;
            height: 22px;
            border-radius: 4px;
            border: 2px solid transparent;
            cursor: pointer;
            opacity: 0.5;
            transition: all 0.2s ease;
            background-size: cover;
            background-position: center;
        }
        .calc-lang-flag:hover { opacity: 0.8; transform: scale(1.1); }
        .calc-lang-flag.active { opacity: 1; border-color: var(--primary); transform: scale(1.1); }
        .calc-lang-flag.en { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30"><rect fill="%23002868" width="60" height="30"/><g fill="%23fff"><rect width="60" height="3.5" y="3.5"/><rect width="60" height="3.5" y="10.5"/><rect width="60" height="3.5" y="17.5"/><rect width="60" height="3.5" y="24.5"/></g><rect fill="%23bf0a30" width="60" height="3.5" y="7"/><rect fill="%23bf0a30" width="60" height="3.5" y="14"/><rect fill="%23bf0a30" width="60" height="3.5" y="21"/><rect fill="%23002868" width="24" height="16"/></svg>'); }
        .calc-lang-flag.ru { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9 6"><rect fill="%23fff" width="9" height="3"/><rect fill="%230039a6" y="2" width="9" height="2"/><rect fill="%23d52b1e" y="4" width="9" height="2"/></svg>'); }
        .calc-lang-flag.es { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3 2"><rect fill="%23006847" width="1" height="2"/><rect fill="%23fff" x="1" width="1" height="2"/><rect fill="%23ce1126" x="2" width="1" height="2"/></svg>'); }

        /* Form Sections */
        .form-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--gray-100);
        }
        .form-section:last-child { border-bottom: none; margin-bottom: 0; }
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 1rem;
        }
        .section-icon {
            width: 32px;
            height: 32px;
            background: var(--primary-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.95rem;
        }
        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        /* Form Fields */
        .field-group { margin-bottom: 1rem; }
        .field-label {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.4rem;
        }
        .help-icon {
            width: 15px;
            height: 15px;
            background: var(--gray-300);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            color: white;
            cursor: help;
            position: relative;
        }
        .help-icon:hover .tooltip { display: block; }
        .tooltip {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-800);
            color: white;
            padding: 0.6rem 0.85rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 400;
            width: 220px;
            z-index: 1000;
            line-height: 1.4;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--gray-800);
        }

        /* Amount Input with Arrows */
        .amount-input-wrapper {
            display: flex;
            align-items: center;
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            overflow: hidden;
            transition: border-color 0.2s;
        }
        .amount-input-wrapper:focus-within { border-color: var(--primary-light); }
        .amount-prefix {
            padding: 0.65rem 0.65rem 0.65rem 0.85rem;
            color: var(--gray-500);
            font-size: 1rem;
            font-weight: 500;
            background: var(--gray-100);
        }
        .amount-input {
            flex: 1;
            border: none;
            padding: 0.65rem;
            font-size: 1rem;
            font-weight: 600;
            background: transparent;
            outline: none;
            min-width: 0;
        }
        .amount-arrows {
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--gray-200);
        }
        .arrow-btn {
            padding: 0.35rem 0.65rem;
            background: var(--gray-100);
            border: none;
            cursor: pointer;
            color: var(--gray-600);
            transition: all 0.15s;
            font-size: 0.75rem;
        }
        .arrow-btn:hover { background: var(--primary-light); color: white; }
        .arrow-btn:first-child { border-bottom: 1px solid var(--gray-200); }

        /* Select & Input */
        .form-select, .form-input {
            width: 100%;
            padding: 0.6rem 0.85rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.9rem;
            background: var(--gray-50);
            transition: border-color 0.2s;
            outline: none;
        }
        .form-select:focus, .form-input:focus { border-color: var(--primary-light); }

        /* Option Buttons */
        .option-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }
        .option-btn {
            flex: 1;
            min-width: 70px;
            padding: 0.5rem 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--gray-600);
            transition: all 0.15s;
            text-align: center;
        }
        .option-btn:hover { border-color: var(--primary-light); color: var(--primary); }
        .option-btn.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* ============== RESULTS PANEL (Right) ============== */
        .results-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .result-card {
            background: white;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 1.25rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .result-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .card-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        /* Top Row - Gauge + EV Side by Side */
        .top-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 900px) {
            .top-row { grid-template-columns: 1fr; }
        }

        /* Gauge */
        .gauge-card { text-align: center; padding: 1.5rem; }
        .gauge-container {
            width: 200px;
            height: 115px;
            margin: 0 auto 1rem;
            position: relative;
        }
        .gauge-svg { width: 100%; height: 100%; }
        .gauge-bg { fill: none; stroke: var(--gray-200); stroke-width: 18; }
        .gauge-fill {
            fill: none;
            stroke-width: 18;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease-out, stroke 0.3s;
        }
        .gauge-value {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }
        .gauge-percent {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gray-900);
            line-height: 1;
        }
        .gauge-label-text {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 0.15rem;
        }
        .gauge-status {
            display: inline-block;
            padding: 0.35rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .gauge-status.excellent { background: #dcfce7; color: #166534; }
        .gauge-status.good { background: #dbeafe; color: #1e40af; }
        .gauge-status.moderate { background: #fef3c7; color: #92400e; }
        .gauge-status.weak { background: #fee2e2; color: #991b1b; }

        /* EV Card */
        .ev-card {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .ev-main {
            display: flex;
            align-items: baseline;
            gap: 0.4rem;
            margin-bottom: 0.35rem;
        }
        .ev-amount {
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1;
        }
        .ev-label-text { font-size: 0.9rem; opacity: 0.9; }
        .ev-subtitle {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 1rem;
        }
        .ev-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        .ev-stat { text-align: center; }
        .ev-stat-value { font-size: 1.15rem; font-weight: 700; }
        .ev-stat-label {
            font-size: 0.65rem;
            opacity: 0.75;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        /* Reality Check Card (warning style by default) */
        .truth-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
        }
        .truth-icon { font-size: 1.5rem; }
        .truth-text {
            font-size: 0.9rem;
            color: #78350f;
            font-weight: 500;
            line-height: 1.5;
        }
        /* Positive variant (green) */
        .truth-card.truth-positive {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 2px solid #10b981;
        }
        .truth-card.truth-positive .truth-text {
            color: #065f46;
        }
        .truth-card.truth-positive .truth-icon {
            color: #059669;
        }

        /* Stability Card */
        .stability-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.3rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .stability-badge.high { background: #dcfce7; color: #166534; }
        .stability-badge.medium { background: #fef3c7; color: #92400e; }
        .stability-badge.low { background: #fee2e2; color: #991b1b; }
        .sensitivity-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0;
            font-size: 0.8rem;
            color: var(--gray-600);
        }
        .sensitivity-bar {
            flex: 1;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }
        .sensitivity-fill {
            height: 100%;
            background: var(--primary-light);
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Outcome Bars */
        .outcome-bars { display: flex; flex-direction: column; gap: 0.6rem; }
        .outcome-row { display: flex; align-items: center; gap: 0.75rem; }
        .outcome-label {
            width: 85px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--gray-600);
        }
        .outcome-bar-container {
            flex: 1;
            height: 24px;
            background: var(--gray-100);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        .outcome-bar {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            min-width: fit-content;
        }
        .outcome-bar.full { background: linear-gradient(90deg, #059669, #10b981); }
        .outcome-bar.partial { background: linear-gradient(90deg, #2563eb, #3b82f6); }
        .outcome-bar.lowball { background: linear-gradient(90deg, #d97706, #f59e0b); }
        .outcome-bar.nothing { background: linear-gradient(90deg, #dc2626, #ef4444); }
        .outcome-percent { font-size: 0.7rem; font-weight: 700; color: white; }
        .outcome-amount {
            font-size: 0.75rem;
            color: var(--gray-500);
            min-width: 70px;
            text-align: right;
        }

        /* Settlement Range */
        .range-visual {
            height: 10px;
            background: var(--gray-100);
            border-radius: 5px;
            position: relative;
            margin: 0.75rem 0 0.5rem;
        }
        .range-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            border-radius: 5px;
            transition: all 0.5s ease-out;
        }
        .range-marker {
            position: absolute;
            top: -6px;
            width: 3px;
            height: 22px;
            background: var(--gray-800);
            border-radius: 2px;
            transform: translateX(-50%);
        }
        .range-labels { display: flex; justify-content: space-between; }
        .range-label { text-align: center; }
        .range-value { font-size: 1.1rem; font-weight: 700; color: var(--gray-800); }
        .range-desc { font-size: 0.65rem; color: var(--gray-500); }

        /* Pathways */
        .pathways-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 0.75rem;
        }
        .pathway-card {
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            padding: 1rem;
            transition: all 0.2s;
            cursor: pointer;
        }
        .pathway-card:hover {
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        .pathway-card.recommended {
            border-color: var(--success);
            background: rgba(5, 150, 105, 0.03);
        }
        .pathway-badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 50px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 0.5rem;
        }
        .pathway-badge.best { background: #dcfce7; color: #166534; }
        .pathway-badge.good { background: #dbeafe; color: #1e40af; }
        .pathway-badge.option { background: var(--gray-100); color: var(--gray-600); }
        .pathway-name { font-size: 0.95rem; font-weight: 600; color: var(--gray-800); margin-bottom: 0.35rem; }
        .pathway-ev { font-size: 1.25rem; font-weight: 700; color: var(--primary); margin-bottom: 0.15rem; }
        .pathway-time { font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.75rem; }
        .pathway-list { list-style: none; font-size: 0.75rem; }
        .pathway-list li {
            padding: 0.15rem 0 0.15rem 1rem;
            position: relative;
        }
        .pathway-list.pros li::before { content: '+'; position: absolute; left: 0; color: var(--success); font-weight: 700; }
        .pathway-list.cons li::before { content: '-'; position: absolute; left: 0; color: var(--danger); font-weight: 700; }

        /* Legal Analysis */
        .analysis-section {
            padding: 0.85rem;
            background: var(--gray-50);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }
        .analysis-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .driver-list { list-style: none; }
        .driver-item {
            display: flex;
            align-items: flex-start;
            gap: 0.4rem;
            padding: 0.35rem 0;
            font-size: 0.8rem;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-200);
        }
        .driver-item:last-child { border-bottom: none; }
        .driver-icon { flex-shrink: 0; font-size: 0.9rem; }
        .driver-icon.positive { color: var(--success); }
        .driver-icon.negative { color: var(--danger); }

        /* Defense Cards */
        .defense-card {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 0.85rem;
            margin-bottom: 0.75rem;
        }
        .defense-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-weight: 600;
            font-size: 0.85rem;
            color: #92400e;
            margin-bottom: 0.35rem;
        }
        .defense-story {
            font-size: 0.8rem;
            color: #78350f;
            font-style: italic;
        }
        .rebuttal-card {
            background: #dcfce7;
            border: 1px solid #86efac;
            border-radius: 8px;
            padding: 0.85rem;
        }
        .rebuttal-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-weight: 600;
            font-size: 0.85rem;
            color: #166534;
            margin-bottom: 0.35rem;
        }
        .rebuttal-list { list-style: none; }
        .rebuttal-list li {
            font-size: 0.8rem;
            color: #14532d;
            padding: 0.25rem 0 0.25rem 1rem;
            position: relative;
        }
        .rebuttal-list li::before {
            content: '>';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: 700;
        }

        /* Settlement Structures */
        .structure-card {
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 0.85rem;
            margin-bottom: 0.5rem;
        }
        .structure-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }
        .structure-desc { font-size: 0.75rem; color: var(--gray-600); }

        /* Checklist */
        .checklist-card {
            border: 2px solid var(--primary-light);
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            padding: 0.45rem 0;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }
        .checklist-item:last-child { border-bottom: none; }
        .checklist-check {
            width: 16px;
            height: 16px;
            border: 2px solid var(--primary-light);
            border-radius: 3px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .checklist-text { font-size: 0.8rem; color: var(--gray-700); }

        /* CTA */
        .cta-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            text-align: center;
        }
        .cta-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.35rem; }
        .cta-text { opacity: 0.9; margin-bottom: 1rem; font-size: 0.85rem; }
        .cta-buttons { display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap; }
        .cta-btn {
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            text-decoration: none;
        }
        .cta-btn.primary { background: white; color: var(--primary); }
        .cta-btn.primary:hover { background: var(--gray-100); transform: translateY(-2px); }
        .cta-btn.secondary {
            background: transparent;
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
        }
        .cta-btn.secondary:hover { background: rgba(255,255,255,0.1); border-color: white; }

        /* Delta Toast */
        .delta-toast {
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--gray-800);
            color: white;
            padding: 0.6rem 1.25rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            opacity: 0;
            transition: all 0.3s ease-out;
            z-index: 1000;
        }
        .delta-toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .delta-toast.positive { background: var(--success); }
        .delta-toast.negative { background: var(--danger); }

        /* Collapsible */
        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 0.5rem 0;
        }
        .collapsible-icon { transition: transform 0.2s; font-size: 0.8rem; }
        .collapsible-icon.open { transform: rotate(180deg); }
        .collapsible-content {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.open { max-height: 2000px; }

        /* Disclaimer */
        .disclaimer {
            font-size: 0.7rem;
            color: var(--gray-500);
            text-align: center;
            padding: 0.75rem;
            border-top: 1px solid var(--gray-200);
            margin-top: 0.5rem;
        }

        /* Demand Letter Generator Panel */
        .demand-letter-panel {
            background: white;
            border-radius: 14px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-top: 1rem;
            overflow: hidden;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; max-height: 0; transform: translateY(-10px); }
            to { opacity: 1; max-height: 2000px; transform: translateY(0); }
        }
        .demand-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .demand-header h3 { font-size: 1.1rem; margin: 0; }
        .demand-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .demand-close:hover { background: rgba(255,255,255,0.3); }
        .demand-content { padding: 1.5rem; }
        .demand-intro {
            background: #eff6ff;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: var(--gray-700);
        }
        .demand-paragraph {
            margin-bottom: 1.5rem;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            overflow: hidden;
        }
        .demand-paragraph-header {
            background: var(--gray-50);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .demand-paragraph-num {
            background: var(--primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
        }
        .demand-paragraph-title {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 0.9rem;
        }
        .demand-paragraph-purpose {
            margin-left: auto;
            font-size: 0.7rem;
            color: var(--gray-500);
            font-style: italic;
        }
        .demand-paragraph-body {
            padding: 1rem;
        }
        .demand-text {
            width: 100%;
            min-height: 80px;
            padding: 0.75rem;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.85rem;
            line-height: 1.6;
            resize: vertical;
            background: white;
        }
        .demand-text:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .demand-tip {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--gray-500);
            display: flex;
            align-items: flex-start;
            gap: 0.35rem;
        }
        .demand-tip-icon { color: var(--warning); }
        .demand-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-200);
        }
        .demand-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        .demand-btn.primary {
            background: var(--primary);
            color: white;
        }
        .demand-btn.primary:hover {
            background: var(--primary-dark);
        }
        .demand-btn.secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        .demand-btn.secondary:hover {
            background: var(--gray-200);
        }
        .custom-badge {
            display: inline-block;
            background: #dcfce7;
            color: #166534;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-left: 0.5rem;
        }

        @media (max-width: 768px) {
            .main-container { padding: 1rem; }
            .ev-breakdown { grid-template-columns: 1fr; }
            .pathways-grid { grid-template-columns: 1fr; }
        }
        /* Embed mode adjustments - target both html and body */
        html.embed-mode, body.embed-mode { background: white; }
        html.embed-mode .header, body.embed-mode .header { display: none; }
        html.embed-mode .main-container, body.embed-mode .main-container {
            min-height: auto;
            padding: 0.5rem;
        }
        html.embed-mode .form-panel, body.embed-mode .form-panel {
            position: relative;
            top: 0;
            max-height: none;
        }
    </style>
    <script>
        // Check embed mode early and apply to html element
        (function() {
            var params = new URLSearchParams(window.location.search);
            if (params.get('embed') === 'true') {
                document.documentElement.classList.add('embed-mode');
            }
        })();
    </script>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">Terms<span>.Law</span></a>
            <nav>
                <a href="/Templates/" style="color: var(--gray-600); text-decoration: none; font-size: 0.85rem;">Generators</a>
            </nav>
        </div>
    </header>
    <script>
        // Hide header in embed mode
        if (new URLSearchParams(window.location.search).get('embed') === 'true') {
            document.body.classList.add('embed-mode');
        }
    </script>

    <div id="root">
        <div style="display:flex;align-items:center;justify-content:center;height:50vh;color:#64748b;">
            <div style="text-align:center;">
                <div style="font-size:1.5rem;margin-bottom:0.5rem;">Loading Calculator...</div>
                <div style="font-size:0.85rem;">If this persists, check browser console for errors</div>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // ============== CALCULATION ENGINE ==============
        const calculateCase = (formData) => {
            const {
                amount = 0,
                contractType = 'signed',
                deliveryProof = 'strong',
                acceptanceStrength = 'explicit',
                disputeLevel = 'none',
                scopeMess = 'none',
                defendantType = 'small_biz',
                assetInfo = 'none',
                feeClause = 'no',
                guaranty = 'no',
                outOfState = false,
                daysOverdue = 90,
                behaviorPattern = 'normal',
                oralStrength = 'none',      // For oral: 'dealing', 'admission', 'witness', 'none'
                termsRelevant = 'yes'       // For written: 'yes', 'partial', 'no'
            } = formData;

            // Paper Value
            const interestRate = 0.10;
            const interestAmount = amount * interestRate * (Math.max(0, daysOverdue) / 365);
            const paperValue = amount + interestAmount;

            // === SCORES ===
            let fts = 0; // Formation & Terms

            // WRITTEN CONTRACTS - value depends on whether terms actually address this dispute
            // A written contract with irrelevant terms isn't much better than no contract
            if (contractType === 'signed') {
                if (termsRelevant === 'yes') fts += 30;       // Gold standard: clear terms that apply
                else if (termsRelevant === 'partial') fts += 18; // Some terms apply, others don't
                else fts += 8;                                 // Written but terms don't help this dispute
            } else if (contractType === 'po') {
                if (termsRelevant === 'yes') fts += 25;       // PO with applicable terms
                else if (termsRelevant === 'partial') fts += 15;
                else fts += 5;                                 // PO exists but terms don't apply
            } else if (contractType === 'email') {
                if (termsRelevant === 'yes') fts += 15;       // Email chain with clear terms
                else if (termsRelevant === 'partial') fts += 8;
                else fts += 2;                                 // Email exists but no relevant terms
            } else {
                // ORAL CONTRACTS - much bigger penalty, varies by corroborating evidence
                // Base penalty is severe, can be mitigated by supporting factors
                if (oralStrength === 'dealing') fts -= 18;     // Course of dealing shows established pattern
                else if (oralStrength === 'admission') fts -= 22; // They admitted it but still oral
                else if (oralStrength === 'witness') fts -= 28;   // Third-party can corroborate
                else fts -= 35;                                   // Pure "he said/she said" - worst case
            }
            if (feeClause === 'yes') fts += 7;

            let pas = 0; // Performance & Acceptance
            if (deliveryProof === 'strong') pas += 25;
            else if (deliveryProof === 'some') pas += 12;
            if (acceptanceStrength === 'explicit') pas += 25;
            else if (acceptanceStrength === 'implied') pas += 15;
            if (disputeLevel === 'none') pas += 20;

            let dfs = 0; // Defenses & Friction
            if (disputeLevel === 'specific') dfs += 25;
            else if (disputeLevel === 'vague') dfs += 12;
            if (scopeMess === 'heavy') dfs += 20;
            else if (scopeMess === 'some') dfs += 10;
            if (outOfState) dfs += 15;

            let cs = 0; // Collectability
            if (defendantType === 'large') cs += 90;
            else if (defendantType === 'mid') cs += 75;
            else if (defendantType === 'small_biz') cs += 55;
            else cs += 40;
            if (assetInfo === 'bank' || assetInfo === 'processor') cs += 15;
            else if (assetInfo === 'employer') cs += 10;
            if (guaranty === 'yes') cs += 20;

            let ls = 0; // Leverage
            if (feeClause === 'yes') ls += 15;
            if (guaranty === 'yes') ls += 20;

            // === PROBABILITIES ===
            const sigmoid = (x) => 1 / (1 + Math.exp(-x));
            const pLiability = sigmoid(0.055 * (fts + pas - dfs) - 1.2);
            const pDamages = sigmoid(0.06 * (pas - dfs * 0.5) - 0.6);
            const pCollect = sigmoid(0.07 * cs - 3.5);
            const pEarly = sigmoid(0.04 * (ls + cs - dfs) - 0.8);
            const successProb = pLiability * 0.4 + pDamages * 0.2 + pCollect * 0.25 + pEarly * 0.15;

            // === OUTCOMES ===
            const fullPayProb = successProb * pCollect * (disputeLevel === 'none' ? 0.55 : 0.25);
            const partialProb = successProb * pCollect * 0.35;
            const lowballProb = (1 - successProb) * 0.35;
            const nothingProb = Math.max(0, 1 - fullPayProb - partialProb - lowballProb);

            const fullPayAmount = paperValue * 0.95;
            const partialAmount = paperValue * 0.65;
            const lowballAmount = paperValue * 0.25;

            // === SETTLEMENT RANGE ===
            const settlementLow = amount * (0.35 + pLiability * 0.15);
            const settlementMid = amount * (0.55 + pLiability * 0.2);
            const settlementHigh = paperValue * (0.8 + pCollect * 0.1);

            // === EXPECTED VALUE ===
            const grossEV = (fullPayProb * fullPayAmount) + (partialProb * partialAmount) + (lowballProb * lowballAmount);
            const demandCost = 450;
            const smallClaimsCost = 150;
            const civilCost = 2500;

            const nevDemand = (grossEV * pEarly * 0.75) - demandCost;
            const nevSmallClaims = (grossEV * pCollect) - smallClaimsCost;
            const nevCivil = (grossEV * pCollect * 1.1) - civilCost;

            const paths = [
                { name: 'demand', nev: nevDemand },
                { name: 'small_claims', nev: nevSmallClaims },
                { name: 'civil', nev: nevCivil }
            ];
            const bestPath = paths.reduce((a, b) => a.nev > b.nev ? a : b);

            // === GAUGE LABEL ===
            let gaugeLabel = 'Moderate leverage';
            let gaugeStatus = 'moderate';
            if (pLiability >= 0.75 && deliveryProof === 'strong' && pCollect >= 0.7) {
                gaugeLabel = 'Judge-friendly & collectible';
                gaugeStatus = 'excellent';
            } else if (pLiability >= 0.7 && pCollect < 0.5) {
                gaugeLabel = 'Paper-strong, wallet-weak';
                gaugeStatus = 'moderate';
            } else if (scopeMess === 'heavy' || disputeLevel === 'specific') {
                gaugeLabel = 'Fact-messy (expect haircuts)';
                gaugeStatus = 'moderate';
            } else if (deliveryProof === 'none' || acceptanceStrength === 'none') {
                gaugeLabel = 'Proof gap risk';
                gaugeStatus = 'weak';
            } else if (successProb >= 0.7) {
                gaugeLabel = 'Strong position';
                gaugeStatus = 'good';
            }

            // === STABILITY ===
            let unknownCount = 0;
            if (feeClause === 'unknown') unknownCount++;
            if (guaranty === 'unknown') unknownCount++;
            if (assetInfo === 'none') unknownCount++;

            const evSpread = Math.abs(nevSmallClaims - nevDemand);
            let stability = 'high';
            if (unknownCount >= 2 || evSpread > amount * 0.3) stability = 'low';
            else if (unknownCount >= 1 || evSpread > amount * 0.15) stability = 'medium';

            // === SENSITIVITY (what moves EV most) ===
            const sensitivity = [
                { name: 'Collectability', impact: pCollect < 0.6 ? 85 : 45 },
                { name: 'Acceptance Proof', impact: acceptanceStrength === 'none' ? 80 : 30 },
                { name: 'Dispute Level', impact: disputeLevel !== 'none' ? 70 : 25 }
            ].sort((a, b) => b.impact - a.impact);

            // === TOP DRIVERS ===
            const drivers = [];
            // CONTRACT TYPE WARNINGS - More nuanced now
            if (contractType === 'oral') {
                if (oralStrength === 'none') {
                    drivers.push({ type: 'negative', text: 'ORAL CONTRACT (no corroboration): Pure "he said/she said." Courts skeptical. Major credibility battle. Find ANY writing - texts, emails, anything!' });
                } else if (oralStrength === 'witness') {
                    drivers.push({ type: 'negative', text: 'ORAL CONTRACT (witness): Third-party helps but courts still prefer written terms. Witness credibility will be attacked.' });
                } else if (oralStrength === 'admission') {
                    drivers.push({ type: 'negative', text: 'ORAL CONTRACT (admission exists): Their admission helps prove the deal existed, but specific terms still disputable.' });
                } else {
                    drivers.push({ type: 'moderate', text: 'ORAL CONTRACT (course of dealing): Past transactions establish pattern, but still weaker than written terms.' });
                }
            } else if (termsRelevant === 'no') {
                drivers.push({ type: 'negative', text: 'CONTRACT EXISTS but terms don\'t address this dispute. Written agreement is almost worthless if it\'s silent on the issue.' });
            } else if (termsRelevant === 'partial') {
                drivers.push({ type: 'moderate', text: 'CONTRACT PARTIALLY APPLIES: Some terms help, others don\'t. Expect arguments about what the contract covers.' });
            }
            if (deliveryProof === 'strong') {
                drivers.push({ type: 'positive', text: 'Strong documentation supports your claim.' });
            }
            if (acceptanceStrength === 'explicit') {
                drivers.push({ type: 'positive', text: 'Explicit acceptance shrinks quality dispute leverage.' });
            }
            if (disputeLevel === 'none') {
                drivers.push({ type: 'positive', text: 'No dispute raised. Clean breach pattern.' });
            }
            if (feeClause === 'yes') {
                drivers.push({ type: 'positive', text: 'Fee clause increases defendant\'s downside.' });
            }
            if (assetInfo !== 'none') {
                drivers.push({ type: 'positive', text: 'You have a path to money. Collection probability up.' });
            }
            if (contractType === 'signed') {
                drivers.push({ type: 'positive', text: 'Signed contract = clear terms. Strongest legal position.' });
            }
            if (deliveryProof === 'none' || acceptanceStrength === 'none') {
                drivers.push({ type: 'negative', text: 'Proof gap. Outcomes shift to haircuts without docs.' });
            }
            if (disputeLevel === 'specific') {
                drivers.push({ type: 'negative', text: 'Specific dispute increases haircut probability.' });
            }
            if (scopeMess === 'heavy') {
                drivers.push({ type: 'negative', text: 'Scope mess invites offsets and delay.' });
            }
            if (pCollect < 0.5) {
                drivers.push({ type: 'negative', text: 'Collectability is the choke point.' });
            }
            if (outOfState) {
                drivers.push({ type: 'negative', text: 'Out-of-state friction adds cost/time.' });
            }

            // === REALITY CHECK ===
            let hardTruth = '';
            let isPositiveOutlook = false;
            // CONTRACT ISSUES are #1 - check oral and termsRelevant first
            if (contractType === 'oral' && oralStrength === 'none') {
                hardTruth = 'ORAL CONTRACT: Worth the paper it\'s written on. Pure "he said/she said" — courts hate this. They\'ll dispute price, scope, timeline, everything. Find ANY corroboration: texts, emails, voicemails, partial payments, witnesses. Without it, your case is a credibility contest.';
            } else if (contractType === 'oral' && oralStrength === 'witness') {
                hardTruth = 'ORAL CONTRACT (witness only): Third-party witness helps but expect credibility attacks. Still weaker than any written term. Their lawyer will try to discredit your witness.';
            } else if (contractType === 'oral') {
                hardTruth = 'ORAL CONTRACT: Even with corroboration, oral deals invite disputes on specific terms. Courts prefer written evidence. Your case is viable but expect pushback on details.';
            } else if (termsRelevant === 'no') {
                hardTruth = 'CONTRACT EXISTS but doesn\'t cover this dispute. Having a written agreement is almost useless if it\'s silent on the issue. You\'re essentially arguing without contractual support.';
            } else if (termsRelevant === 'partial') {
                hardTruth = 'CONTRACT PARTIALLY APPLIES: Some terms help your case, others don\'t. Expect arguments about what the contract actually covers. Focus on the provisions that DO apply.';
            } else if (pCollect < 0.5 && pLiability >= 0.6) {
                hardTruth = 'I see this pattern often: strong paper claim, but collectability is the bottleneck. In my experience, you need to locate assets before spending on escalation — otherwise you end up with a judgment you can\'t collect.';
            } else if (deliveryProof === 'none' || acceptanceStrength === 'none') {
                hardTruth = 'Your biggest weakness is proof. I\'ve seen cases swing dramatically on a single acceptance email or signed delivery receipt. Find any documentation you can — it could add hundreds to your expected recovery.';
            } else if (disputeLevel === 'specific') {
                hardTruth = 'With a specific dispute on the table, expect a haircut negotiation, not a clean win. In most cases I handle like this, the winning strategy is: anchor high, but prepare for partial recovery.';
            } else if (Math.max(nevDemand, nevSmallClaims, nevCivil) < 200) {
                hardTruth = 'I\'ll be honest: the numbers look thin here. Before spending money on escalation, I\'d want to see if there\'s a way to improve leverage — better documentation, identified assets, or a stronger contract angle.';
            } else {
                hardTruth = 'Based on these inputs, the numbers support action. In my experience, cases with this profile are worth pursuing with a demand letter or escalation.';
                isPositiveOutlook = true;
            }

            // === DEFENDANT BEHAVIOR PROFILE ===
            let behaviorProfile = '';
            if (defendantType === 'large') {
                behaviorProfile = 'Large companies typically pay when your packet is clean. Their internal cost of fighting is often larger than the invoice.';
            } else if (defendantType === 'small_biz' && behaviorPattern === 'ghosting') {
                behaviorProfile = 'Ghosting pattern suggests either cashflow problems or hoping you\'ll give up. Escalation often breaks the silence.';
            } else if (defendantType === 'small_biz') {
                behaviorProfile = 'Small businesses optimize for cashflow. Expect payment plan requests or haircut offers.';
            } else {
                behaviorProfile = 'Individual defendants are unpredictable. Confirm they have assets before spending on escalation.';
            }

            // === PRIMARY DEFENSE ===
            let primaryDefense = 'none';
            let defenseScore = { quality: 0, acceptance: 0, scope: 0, conditional: 0 };
            if (disputeLevel === 'specific') defenseScore.quality += 35;
            if (disputeLevel === 'vague') defenseScore.quality += 15;
            if (acceptanceStrength === 'none') defenseScore.acceptance += 35;
            if (scopeMess === 'heavy') defenseScore.scope += 40;
            if (scopeMess === 'some') defenseScore.scope += 20;
            if (deliveryProof === 'none') defenseScore.acceptance += 25;

            const maxDefense = Object.entries(defenseScore).reduce((a, b) => b[1] > a[1] ? b : a);
            if (maxDefense[1] > 20) primaryDefense = maxDefense[0];

            // === CHECKLIST ===
            const checklist = [];
            if (deliveryProof !== 'strong') {
                checklist.push('Pull full paper trail: agreement, invoice(s), delivery proof, follow-ups.');
            }
            if (acceptanceStrength === 'none') {
                checklist.push('Get written acknowledgment confirming receipt/use.');
            }
            if (disputeLevel !== 'none') {
                checklist.push('Force specificity: demand itemized defects + dollar offsets.');
            }
            if (assetInfo === 'none') {
                checklist.push('Identify collection hook: bank, processor, or employer.');
            }
            if (pCollect < 0.5) {
                checklist.push('Demand payment mechanics in any settlement: wire by date.');
            }
            if (guaranty === 'unknown') {
                checklist.push('Check for personal guaranty (signature block, credit app).');
            }
            checklist.push('Prepare small-claims packet: 1-page timeline + labeled exhibits.');

            // === NEXT STEP ===
            let nextStep = 'Start with a tight demand package: exhibits + deadline + clear escalation path.';
            if (pCollect < 0.5) {
                nextStep = 'Prioritize collectability: identify where the money is first.';
            } else if (deliveryProof === 'none' || acceptanceStrength === 'none') {
                nextStep = 'Fix the proof gap before escalating. One document can change EV.';
            }

            // === SETTLEMENT STRUCTURES ===
            const settlementStructures = [
                { title: 'Fast Pay', desc: `Wire $${Math.round(settlementMid).toLocaleString()} by [date] -> mutual release. Best when they want this over.` },
                { title: 'Payment Plan', desc: `First payment today + auto-default clause + stipulated judgment. For cashflow-constrained defendants.` },
                { title: 'Disputed Delta', desc: `Pay undisputed $${Math.round(amount * 0.7).toLocaleString()} now + cure window for alleged defects.` }
            ];

            return {
                amount, paperValue, interestAmount, grossEV,
                bestNEV: Math.max(nevDemand, nevSmallClaims, nevCivil),
                successProb, pLiability, pDamages, pCollect, pEarly,
                outcomes: {
                    full: { prob: fullPayProb, amount: fullPayAmount },
                    partial: { prob: partialProb, amount: partialAmount },
                    lowball: { prob: lowballProb, amount: lowballAmount },
                    nothing: { prob: nothingProb, amount: 0 }
                },
                settlement: { low: settlementLow, mid: settlementMid, high: settlementHigh },
                paths: {
                    demand: { nev: nevDemand, time: '1-4 weeks', cost: demandCost },
                    smallClaims: { nev: nevSmallClaims, time: '2-4 months', cost: smallClaimsCost },
                    civil: { nev: nevCivil, time: '6-12 months', cost: civilCost }
                },
                bestPath: bestPath.name,
                gaugeLabel, gaugeStatus,
                stability, sensitivity,
                drivers: drivers.slice(0, 4),
                hardTruth,
                isPositiveOutlook,
                behaviorProfile,
                primaryDefense,
                checklist: checklist.slice(0, 5),
                nextStep,
                settlementStructures,
                scores: { fts, pas, dfs, cs, ls }
            };
        };

        // ============== DEFENSE CONTENT ==============
        const getDefenseContent = (defense, formData) => {
            const defenses = {
                quality: {
                    name: 'Quality / Defect Dispute',
                    story: '"The work was defective and didn\'t meet specs."',
                    rebuttals: [
                        formData.acceptanceStrength === 'explicit' ? 'You approved the deliverable. After acceptance, "defect" is narrow offset territory.' : null,
                        'No contemporaneous complaint = late-raised bargaining, not genuine rejection.',
                        'Even with issues, remedy is not $0. Pay undisputed + prove offset.',
                        'Demand itemized defect list with dollar offsets within 5 days.',
                        'Silence after delivery is implied acceptance in most jurisdictions.',
                    ].filter(Boolean),
                    counterOffense: 'Force specificity: "List each defect with (a) contract spec violated, (b) your dollar offset, (c) evidence. Vague complaints won\'t fly in court."'
                },
                acceptance: {
                    name: 'No Acceptance / Not Delivered',
                    story: '"Payment wasn\'t due because work wasn\'t delivered or accepted."',
                    rebuttals: [
                        formData.deliveryProof === 'strong' ? 'Delivered with documented proof (files, logs, handoff).' : null,
                        'Silence after review = constructive acceptance under UCC 2-606.',
                        'Identify what\'s incomplete. Undisputed portion payable now.',
                        'If you used the deliverable, you accepted it. Benefits received = payment due.',
                        'The burden shifts to them to prove non-delivery after your evidence.',
                    ].filter(Boolean),
                    counterOffense: 'Flip the burden: "What exactly wasn\'t delivered? Be specific. Everything you don\'t list is admitted as delivered."'
                },
                scope: {
                    name: 'Scope Change / "Not Included"',
                    story: '"That work wasn\'t authorized or in scope."',
                    rebuttals: [
                        'Each item maps to request + deliverable with docs.',
                        'Base scope undisputed - payable now. Fight only the delta.',
                        'Course of dealing: similar requests were paid before.',
                        'Your emails requested this work. Authorization is documented.',
                        'Quantum meruit: You received benefit, you pay reasonable value.',
                    ],
                    counterOffense: 'Anchor on the undisputed: "Even if [disputed item] is carved out, the remaining $X is due immediately. Separate fights."'
                },
                conditional: {
                    name: 'Conditional Payment / "Not Due Yet"',
                    story: '"Payment was contingent on [milestone/approval/third party]."',
                    rebuttals: [
                        'Condition was satisfied OR waived by your conduct.',
                        'They can\'t create conditions that don\'t appear in the agreement.',
                        'Good faith prevents manufactured conditions to avoid payment.',
                        'The condition was within your control - you can\'t benefit from own delay.',
                    ],
                    counterOffense: 'Call the bluff: "Show me where in our agreement this condition appears. Absent that, payment is due unconditionally."'
                },
                none: {
                    name: 'No Strong Defense Expected',
                    story: 'No significant defense pattern. Straightforward breach.',
                    rebuttals: [
                        'Push for immediate payment with clear deadline.',
                        'Any defense must be specific, itemized, evidence-backed.',
                        'Silence is not a defense. Time to pay.',
                    ],
                    counterOffense: 'Apply pressure: "You\'ve had [X days] to raise legitimate issues. Your silence confirms the debt. Pay by [date] or expect escalation."'
                }
            };
            return defenses[defense] || defenses.none;
        };

        // ============== COMPONENTS ==============
        const Tooltip = ({ text }) => (
            <span className="help-icon">?<span className="tooltip">{text}</span></span>
        );

        const AmountInput = ({ value, onChange }) => {
            const handleIncrement = (delta) => {
                const current = parseFloat(value) || 0;
                const step = current < 1000 ? 100 : current < 10000 ? 500 : 1000;
                onChange(Math.max(0, current + (delta * step)));
            };
            return (
                <div className="amount-input-wrapper">
                    <span className="amount-prefix">$</span>
                    <input type="number" className="amount-input" value={value || ''} onChange={(e) => onChange(parseFloat(e.target.value) || 0)} placeholder="5,000" />
                    <div className="amount-arrows">
                        <button className="arrow-btn" onClick={() => handleIncrement(1)}>+</button>
                        <button className="arrow-btn" onClick={() => handleIncrement(-1)}>-</button>
                    </div>
                </div>
            );
        };

        const OptionGroup = ({ options, value, onChange }) => (
            <div className="option-group">
                {options.map(opt => (
                    <button key={opt.value} className={`option-btn ${value === opt.value ? 'selected' : ''}`} onClick={() => onChange(opt.value)}>
                        {opt.label}
                    </button>
                ))}
            </div>
        );

        const Gauge = ({ percent, label, status, hasUserInput }) => {
            const radius = 70;
            const circumference = Math.PI * radius;
            const offset = circumference - (percent / 100) * circumference;
            const getColor = () => {
                if (!hasUserInput) return '#d1d5db'; // Grey when no input
                if (percent >= 70) return '#059669';
                if (percent >= 50) return '#3b82f6';
                if (percent >= 30) return '#d97706';
                return '#dc2626';
            };
            return (
                <div className={`gauge-card result-card ${!hasUserInput ? 'gauge-inactive' : ''}`}>
                    <div className="card-header"><span className="card-title">My Read on Your Case</span></div>
                    <div className="gauge-container">
                        <svg className="gauge-svg" viewBox="0 0 160 95">
                            <path className="gauge-bg" d="M 15 80 A 65 65 0 0 1 145 80" fill="none" />
                            <path className="gauge-fill" d="M 15 80 A 65 65 0 0 1 145 80" fill="none" stroke={getColor()} strokeDasharray={circumference} strokeDashoffset={offset} />
                        </svg>
                        <div className="gauge-value">
                            <div className="gauge-percent" style={!hasUserInput ? {color: '#9ca3af'} : {}}>{hasUserInput ? Math.round(percent) + '%' : '—'}</div>
                            <div className="gauge-label-text">{hasUserInput ? 'Success' : 'Enter details'}</div>
                        </div>
                    </div>
                    <div className={`gauge-status ${hasUserInput ? status : ''}`} style={!hasUserInput ? {background: '#f3f4f6', color: '#9ca3af'} : {}}>
                        {hasUserInput ? label : 'Fill in your case details to see analysis'}
                    </div>
                </div>
            );
        };

        const EVCard = ({ calc }) => (
            <div className="result-card ev-card">
                <div className="ev-main">
                    <span className="ev-amount">${Math.round(calc.bestNEV).toLocaleString()}</span>
                    <span className="ev-label-text">Net EV</span>
                </div>
                <div className="ev-subtitle">Paper ${Math.round(calc.paperValue).toLocaleString()} adjusted for risk, collection, costs</div>
                <div className="ev-breakdown">
                    <div className="ev-stat"><div className="ev-stat-value">{Math.round(calc.pLiability * 100)}%</div><div className="ev-stat-label">Win Prob</div></div>
                    <div className="ev-stat"><div className="ev-stat-value">{Math.round(calc.pCollect * 100)}%</div><div className="ev-stat-label">Collect</div></div>
                    <div className="ev-stat"><div className="ev-stat-value">{Math.round(calc.pEarly * 100)}%</div><div className="ev-stat-label">Early Res</div></div>
                </div>
            </div>
        );

        // EV Calculation Breakdown
        const EVBreakdown = ({ calc }) => {
            const [expanded, setExpanded] = useState(false);

            return (
                <div className="result-card" style={{ background: '#fafafa' }}>
                    <div className="collapsible-header" onClick={() => setExpanded(!expanded)}>
                        <span className="card-title">How I Calculate Expected Value</span>
                        <span className={`collapsible-icon ${expanded ? 'open' : ''}`}>&#9660;</span>
                    </div>
                    <div className={`collapsible-content ${expanded ? 'open' : ''}`}>
                        <div style={{ padding: '0.75rem 0', fontSize: '0.8rem', color: 'var(--gray-600)' }}>

                            {/* Step 1: Paper Value */}
                            <div style={{ marginBottom: '1rem', padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid var(--gray-200)' }}>
                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--gray-800)' }}>1. Paper Value</div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.25rem' }}>
                                    <span>Principal owed</span>
                                    <span style={{ fontWeight: 600 }}>${calc.amount.toLocaleString()}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.25rem' }}>
                                    <span>+ Interest (10% annual)</span>
                                    <span style={{ fontWeight: 600 }}>+${Math.round(calc.interestAmount).toLocaleString()}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', borderTop: '1px solid var(--gray-200)', paddingTop: '0.5rem', marginTop: '0.5rem' }}>
                                    <span style={{ fontWeight: 600 }}>Paper Value</span>
                                    <span style={{ fontWeight: 700, color: 'var(--primary)' }}>${Math.round(calc.paperValue).toLocaleString()}</span>
                                </div>
                            </div>

                            {/* Step 2: Probability Scores */}
                            <div style={{ marginBottom: '1rem', padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid var(--gray-200)' }}>
                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--gray-800)' }}>2. Risk Probabilities</div>
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.5rem' }}>
                                    <div style={{ padding: '0.5rem', background: 'var(--gray-50)', borderRadius: '6px' }}>
                                        <div style={{ fontSize: '1.1rem', fontWeight: 700, color: calc.pLiability >= 0.7 ? 'var(--success)' : calc.pLiability >= 0.5 ? 'var(--warning)' : 'var(--danger)' }}>{Math.round(calc.pLiability * 100)}%</div>
                                        <div style={{ fontSize: '0.7rem', color: 'var(--gray-500)' }}>Win on liability</div>
                                    </div>
                                    <div style={{ padding: '0.5rem', background: 'var(--gray-50)', borderRadius: '6px' }}>
                                        <div style={{ fontSize: '1.1rem', fontWeight: 700, color: calc.pDamages >= 0.7 ? 'var(--success)' : calc.pDamages >= 0.5 ? 'var(--warning)' : 'var(--danger)' }}>{Math.round(calc.pDamages * 100)}%</div>
                                        <div style={{ fontSize: '0.7rem', color: 'var(--gray-500)' }}>Full damages</div>
                                    </div>
                                    <div style={{ padding: '0.5rem', background: 'var(--gray-50)', borderRadius: '6px' }}>
                                        <div style={{ fontSize: '1.1rem', fontWeight: 700, color: calc.pCollect >= 0.7 ? 'var(--success)' : calc.pCollect >= 0.5 ? 'var(--warning)' : 'var(--danger)' }}>{Math.round(calc.pCollect * 100)}%</div>
                                        <div style={{ fontSize: '0.7rem', color: 'var(--gray-500)' }}>Collectability</div>
                                    </div>
                                    <div style={{ padding: '0.5rem', background: 'var(--gray-50)', borderRadius: '6px' }}>
                                        <div style={{ fontSize: '1.1rem', fontWeight: 700, color: calc.pEarly >= 0.5 ? 'var(--success)' : 'var(--warning)' }}>{Math.round(calc.pEarly * 100)}%</div>
                                        <div style={{ fontSize: '0.7rem', color: 'var(--gray-500)' }}>Early settle</div>
                                    </div>
                                </div>
                            </div>

                            {/* Step 3: Outcome Distribution */}
                            <div style={{ marginBottom: '1rem', padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid var(--gray-200)' }}>
                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--gray-800)' }}>3. Expected Outcomes</div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>{Math.round(calc.outcomes.full.prob * 100)}% x Full (${Math.round(calc.outcomes.full.amount).toLocaleString()})</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.outcomes.full.prob * calc.outcomes.full.amount).toLocaleString()}</span>
                                </div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>{Math.round(calc.outcomes.partial.prob * 100)}% x Partial (${Math.round(calc.outcomes.partial.amount).toLocaleString()})</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.outcomes.partial.prob * calc.outcomes.partial.amount).toLocaleString()}</span>
                                </div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>{Math.round(calc.outcomes.lowball.prob * 100)}% x Lowball (${Math.round(calc.outcomes.lowball.amount).toLocaleString()})</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.outcomes.lowball.prob * calc.outcomes.lowball.amount).toLocaleString()}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', borderTop: '1px solid var(--gray-200)', paddingTop: '0.5rem', marginTop: '0.5rem' }}>
                                    <span style={{ fontWeight: 600 }}>Gross EV</span>
                                    <span style={{ fontWeight: 700, color: 'var(--primary)' }}>${Math.round(calc.grossEV).toLocaleString()}</span>
                                </div>
                            </div>

                            {/* Step 4: Net EV by Path */}
                            <div style={{ padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid var(--gray-200)' }}>
                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--gray-800)' }}>4. Net EV (after costs)</div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>Demand letter path</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.paths.demand.nev).toLocaleString()}</span>
                                </div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>Small claims path</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.paths.smallClaims.nev).toLocaleString()}</span>
                                </div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>Civil litigation path</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.paths.civil.nev).toLocaleString()}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', borderTop: '1px solid var(--gray-200)', paddingTop: '0.5rem', marginTop: '0.5rem', background: '#dcfce7', margin: '-0.5rem -0.75rem -0.75rem', padding: '0.75rem' }}>
                                    <span style={{ fontWeight: 600 }}>Best Path Net EV</span>
                                    <span style={{ fontWeight: 700, color: '#166534' }}>${Math.round(calc.bestNEV).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const RealityCheckCard = ({ truth, isPositive, hasUserInput }) => {
            if (!hasUserInput) {
                return (
                    <div className="result-card truth-card" style={{ background: '#f8fafc', border: '1px dashed #cbd5e1' }}>
                        <div className="card-header">
                            <span className="card-title" style={{ color: '#94a3b8' }}>
                                <span className="truth-icon" style={{ background: '#e2e8f0', color: '#94a3b8' }}>?</span>
                                Straight Talk — After You Enter Details
                            </span>
                        </div>
                        <p className="truth-text" style={{ color: '#94a3b8' }}>
                            I built this calculator from 13+ years of collection cases. Once you fill in your case details, I'll give you the same honest assessment I'd give in a paid consultation — including the hard truths most attorneys won't tell you until you've already paid.
                        </p>
                    </div>
                );
            }
            return (
            <div className={`result-card truth-card ${isPositive ? 'truth-positive' : ''}`}>
                <div className="card-header">
                    <span className="card-title">
                        <span className="truth-icon">{isPositive ? '✓' : '!'}</span>
                        {isPositive ? 'My Assessment' : 'Hard Truth'}
                    </span>
                </div>
                <div className="truth-text">{truth}</div>
            </div>
        );
        };

        const StabilityCard = ({ stability, sensitivity }) => (
            <div className="result-card">
                <div className="card-header">
                    <span className="card-title">How Confident Am I</span>
                    <span className={`stability-badge ${stability}`}>{stability === 'high' ? 'High' : stability === 'medium' ? 'Medium' : 'Low'}</span>
                </div>
                <div style={{ fontSize: '0.75rem', color: 'var(--gray-600)', marginBottom: '0.75rem' }}>
                    {stability === 'low' ? 'I\'d want more information before betting on these numbers.' : stability === 'medium' ? 'Reasonably confident, but these factors could shift things.' : 'I feel good about this estimate.'}
                </div>
                <div style={{ fontWeight: 600, fontSize: '0.75rem', marginBottom: '0.4rem', color: 'var(--gray-700)' }}>What could change my assessment:</div>
                {sensitivity.map((s, i) => (
                    <div key={i} className="sensitivity-item">
                        <span style={{ width: '100px' }}>{s.name}</span>
                        <div className="sensitivity-bar"><div className="sensitivity-fill" style={{ width: `${s.impact}%` }}></div></div>
                    </div>
                ))}
            </div>
        );

        const OutcomeBars = ({ outcomes }) => {
            const bars = [
                { key: 'full', label: 'Full Recovery', color: 'full' },
                { key: 'partial', label: 'Partial', color: 'partial' },
                { key: 'lowball', label: 'Lowball', color: 'lowball' },
                { key: 'nothing', label: 'Nothing', color: 'nothing' }
            ];
            return (
                <div className="result-card">
                    <div className="card-header"><span className="card-title">How I See This Playing Out</span></div>
                    <div className="outcome-bars">
                        {bars.map(bar => {
                            const outcome = outcomes[bar.key];
                            const pct = Math.round(outcome.prob * 100);
                            return (
                                <div key={bar.key} className="outcome-row">
                                    <span className="outcome-label">{bar.label}</span>
                                    <div className="outcome-bar-container">
                                        <div className={`outcome-bar ${bar.color}`} style={{ width: `${Math.max(pct, 8)}%` }}>
                                            <span className="outcome-percent">{pct}%</span>
                                        </div>
                                    </div>
                                    <span className="outcome-amount">${Math.round(outcome.amount).toLocaleString()}</span>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const SettlementRange = ({ settlement, amount }) => {
            const lowPct = (settlement.low / amount) * 100;
            const highPct = Math.min((settlement.high / amount) * 100, 110);
            const midPct = (settlement.mid / amount) * 100;
            return (
                <div className="result-card">
                    <div className="card-header"><span className="card-title">What I'd Aim For in Settlement</span></div>
                    <div className="range-visual">
                        <div className="range-fill" style={{ left: `${(lowPct / 110) * 100}%`, width: `${((highPct - lowPct) / 110) * 100}%` }} />
                        <div className="range-marker" style={{ left: `${(midPct / 110) * 100}%` }} />
                    </div>
                    <div className="range-labels">
                        <div className="range-label"><div className="range-value">${Math.round(settlement.low).toLocaleString()}</div><div className="range-desc">Floor</div></div>
                        <div className="range-label"><div className="range-value">${Math.round(settlement.mid).toLocaleString()}</div><div className="range-desc">Likely</div></div>
                        <div className="range-label"><div className="range-value">${Math.round(settlement.high).toLocaleString()}</div><div className="range-desc">Strong</div></div>
                    </div>
                </div>
            );
        };

        const SettlementStructures = ({ structures }) => (
            <div className="result-card">
                <div className="card-header"><span className="card-title">Settlement Approaches I'd Consider</span></div>
                {structures.map((s, i) => (
                    <div key={i} className="structure-card">
                        <div className="structure-title">{s.title}</div>
                        <div className="structure-desc">{s.desc}</div>
                    </div>
                ))}
            </div>
        );

        const PathwaysGrid = ({ calc, formData }) => {
            const getContent = (pathKey) => {
                const isRec = calc.bestPath === pathKey.replace('Claims', '_claims');
                const data = {
                    demand: { name: 'Demand Letter', pros: ['Lowest cost test', 'Fast resolution'], cons: ['No enforcement if ignored'] },
                    smallClaims: { name: 'Small Claims', pros: ['Low cost, no lawyer', 'Judgment adds pressure'], cons: ['Must appear in court'] },
                    civil: { name: 'Civil Litigation', pros: ['Maximum leverage', 'Discovery available'], cons: ['High cost ($2500+)', 'Long timeline'] }
                };
                return { ...data[pathKey], recommended: isRec };
            };
            return (
                <div className="result-card">
                    <div className="card-header"><span className="card-title">Your Options for Resolution</span></div>
                    <div className="pathways-grid">
                        {['demand', 'smallClaims', 'civil'].map(pk => {
                            const c = getContent(pk);
                            const p = calc.paths[pk];
                            return (
                                <div key={pk} className={`pathway-card ${c.recommended ? 'recommended' : ''}`}>
                                    <span className={`pathway-badge ${c.recommended ? 'best' : 'option'}`}>{c.recommended ? 'Best' : 'Option'}</span>
                                    <div className="pathway-name">{c.name}</div>
                                    <div className="pathway-ev">${Math.round(p.nev).toLocaleString()}</div>
                                    <div className="pathway-time">{p.time} | ${p.cost}</div>
                                    <ul className="pathway-list pros">{c.pros.map((p, i) => <li key={i}>{p}</li>)}</ul>
                                    <ul className="pathway-list cons">{c.cons.map((c, i) => <li key={i}>{c}</li>)}</ul>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const LegalAnalysis = ({ calc, formData }) => {
            const defense = getDefenseContent(calc.primaryDefense, formData);
            return (
                <div className="result-card">
                    <div className="card-header"><span className="card-title">My Legal Analysis</span></div>
                    <div className="analysis-section">
                        <div className="analysis-title">What I'm Looking At</div>
                        <ul className="driver-list">
                            {calc.drivers.map((d, i) => (
                                <li key={i} className="driver-item">
                                    <span className={`driver-icon ${d.type}`}>{d.type === 'positive' ? '+' : '-'}</span>
                                    <span>{d.text}</span>
                                </li>
                            ))}
                        </ul>
                    </div>

                    {/* Defense Playbook */}
                    <div className="defense-card">
                        <div className="defense-header">Defense I'd Expect: {defense.name}</div>
                        <div className="defense-story">{defense.story}</div>
                    </div>
                    <div className="rebuttal-card">
                        <div className="rebuttal-header">Your Rebuttal Arsenal</div>
                        <ul className="rebuttal-list">{defense.rebuttals.slice(0, 4).map((r, i) => <li key={i}>{r}</li>)}</ul>
                    </div>

                    {/* Counter-Offense */}
                    {defense.counterOffense && (
                        <div style={{
                            background: 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)',
                            border: '1px solid #93c5fd',
                            borderRadius: '8px',
                            padding: '0.85rem',
                            marginTop: '0.75rem'
                        }}>
                            <div style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '0.4rem',
                                fontWeight: 600,
                                fontSize: '0.85rem',
                                color: '#1e40af',
                                marginBottom: '0.35rem'
                            }}>
                                My Counter-Move
                            </div>
                            <div style={{ fontSize: '0.8rem', color: '#1e3a8a', fontStyle: 'italic' }}>
                                {defense.counterOffense}
                            </div>
                        </div>
                    )}

                    {calc.behaviorProfile && (
                        <div className="analysis-section" style={{ marginTop: '0.75rem' }}>
                            <div className="analysis-title">Defendant Profile</div>
                            <div style={{ fontSize: '0.8rem', color: 'var(--gray-600)' }}>{calc.behaviorProfile}</div>
                        </div>
                    )}
                </div>
            );
        };

        const Checklist = ({ items, nextStep }) => (
            <div className="result-card checklist-card">
                <div className="card-header"><span className="card-title">My Recommended Actions</span></div>
                <p style={{ marginBottom: '0.75rem', fontWeight: 500, color: 'var(--primary-dark)', fontSize: '0.85rem' }}>Your next step: {nextStep}</p>
                {items.map((item, i) => (
                    <div key={i} className="checklist-item">
                        <div className="checklist-check" />
                        <span className="checklist-text">{item}</span>
                    </div>
                ))}
            </div>
        );

        const CTACard = ({ calc, onGenerateLetter }) => {
            let headline = 'Ready to Pursue Your Case?';
            let subtext = 'Get a professional demand letter drafted and sent.';
            if (calc.bestNEV < 500) {
                headline = 'Improve Before Escalating';
                subtext = 'Focus on proof/collectability first. I can help identify leverage.';
            } else if (calc.pCollect < 0.5) {
                headline = 'Collection is Key';
                subtext = 'Case is strong. Let me help find where the money is.';
            }
            return (
                <div className="result-card cta-card">
                    <div className="cta-title">{headline}</div>
                    <div className="cta-text">{subtext}</div>
                    <div className="cta-buttons">
                        <button onClick={onGenerateLetter} className="cta-btn primary">Generate Demand Letter</button>
                        <a href="/intake/" className="cta-btn secondary">Start Your Case</a>
                    </div>
                </div>
            );
        };

        // ============== DEMAND LETTER GENERATOR ==============
        const DemandLetterGenerator = ({ formData, calc, onClose }) => {
            const amount = formData.amount || 5000;
            const daysOverdue = formData.daysOverdue || 90;
            const contractType = formData.contractType || 'signed';
            const deliveryProof = formData.deliveryProof || 'strong';
            const acceptanceStrength = formData.acceptanceStrength || 'explicit';
            const disputeLevel = formData.disputeLevel || 'none';

            // Personalization fields
            const [details, setDetails] = useState({
                yourName: '',
                yourCompany: '',
                yourEmail: '',
                defendantName: '',
                defendantCompany: '',
                serviceDescription: '',
                invoiceNumber: '',
                invoiceDate: '',
                paymentDeadline: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                paymentMethod: ''
            });

            const updateDetail = (key, value) => {
                setDetails(prev => ({ ...prev, [key]: value }));
            };

            // Contract description
            const contractDesc = {
                signed: 'a signed written agreement',
                po: 'a purchase order',
                email: 'email correspondence confirming the terms',
                oral: 'our verbal agreement (with supporting correspondence)'
            }[contractType];

            // Defense-specific language
            const defenseWarning = disputeLevel === 'specific'
                ? 'While you have raised certain concerns, these do not excuse the underlying payment obligation. Any disputed amounts can be addressed separately.'
                : disputeLevel === 'vague'
                ? 'Your general expressions of dissatisfaction do not constitute a valid defense to payment.'
                : '';

            // Dynamic letter generation based on personalization
            const generateLetter = () => {
                const defendant = details.defendantName || '[DEFENDANT NAME]';
                const defendantCo = details.defendantCompany ? ` of ${details.defendantCompany}` : '';
                const sender = details.yourName || '[YOUR NAME]';
                const senderCo = details.yourCompany ? `, ${details.yourCompany}` : '';
                const service = details.serviceDescription || '[DESCRIPTION OF SERVICES]';
                const invoice = details.invoiceNumber ? `Invoice #${details.invoiceNumber}` : 'the invoice';
                const deadline = details.paymentDeadline ? new Date(details.paymentDeadline).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) : '[DEADLINE DATE]';
                const payment = details.paymentMethod || '[PAYMENT INSTRUCTIONS]';

                return {
                    header: `${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}\n\nVIA EMAIL${details.yourEmail ? '' : ' AND CERTIFIED MAIL'}\n\n${defendant}${defendantCo}\n[ADDRESS]\n\nRe: Formal Demand for Payment - $${amount.toLocaleString()} Past Due${details.invoiceNumber ? ` (Invoice #${details.invoiceNumber})` : ''}\n\nDear ${defendant}:`,

                    p1: `I am writing on behalf of ${sender}${senderCo} to formally demand payment of $${amount.toLocaleString()} for ${service} rendered pursuant to ${contractDesc} between us. This amount, documented in ${invoice}, has been outstanding for ${daysOverdue} days and represents a clear breach of our agreement.`,

                    p2: `As you are aware, ${sender} performed and delivered the agreed-upon work in full. ${acceptanceStrength === 'explicit' ? 'You acknowledged receipt and approved the deliverables.' : acceptanceStrength === 'implied' ? 'You have used and benefited from these deliverables without objection.' : 'The work was completed as specified.'} ${deliveryProof === 'strong' ? 'I have comprehensive documentation including delivery records, correspondence, and your acknowledgments.' : deliveryProof === 'some' ? 'I have supporting documentation of performance.' : 'I can provide evidence of the work performed.'} Your obligation to pay is clear and unambiguous.`,

                    p3: `Despite multiple requests for payment, you have failed to remit the amount due. ${defenseWarning} Under applicable law, your failure to pay constitutes breach of contract, entitling ${sender} to recover the principal amount plus interest, costs of collection, and attorney's fees.`,

                    p4: `The expected recovery in litigation is approximately $${Math.round(calc.bestNEV).toLocaleString()}, accounting for collection probability and legal costs. ${calc.pLiability >= 0.7 ? 'The strength of this claim makes a favorable judgment highly likely.' : 'I am fully prepared to pursue this matter through the courts.'} A judgment will appear on your record and can affect your credit and business relationships.`,

                    p5: `To resolve this matter without litigation, I am willing to accept $${Math.round(calc.settlement.mid).toLocaleString()} if paid by ${deadline}. This represents a discount of ${Math.round((1 - calc.settlement.mid / calc.paperValue) * 100)}% from the full amount owed, including interest. After this date, I will pursue the full amount plus all available legal remedies.`,

                    p6: `Please remit payment by ${deadline} via ${payment}. If you wish to discuss settlement terms, contact ${details.yourEmail ? `me at ${details.yourEmail}` : 'me'} immediately. Absent payment or a good-faith settlement proposal by ${deadline}, I will proceed with legal action without further notice.`,

                    closing: `Sincerely,\n\n${sender}${senderCo}${details.yourEmail ? `\n${details.yourEmail}` : ''}`
                };
            };

            const [paragraphs, setParagraphs] = useState(generateLetter());

            // Regenerate letter when details change
            useEffect(() => {
                setParagraphs(generateLetter());
            }, [details, amount, daysOverdue, contractType, deliveryProof, acceptanceStrength, disputeLevel]);

            const updateParagraph = (key, value) => {
                setParagraphs(prev => ({ ...prev, [key]: value }));
            };

            const [copyStatus, setCopyStatus] = useState('');

            const copyToClipboard = () => {
                const fullLetter = `${paragraphs.header}\n\n${paragraphs.p1}\n\n${paragraphs.p2}\n\n${paragraphs.p3}\n\n${paragraphs.p4}\n\n${paragraphs.p5}\n\n${paragraphs.p6}\n\n${paragraphs.closing}`;
                navigator.clipboard.writeText(fullLetter);
                setCopyStatus('Copied!');
                setTimeout(() => setCopyStatus(''), 2000);
            };

            const downloadAsText = () => {
                const fullLetter = `${paragraphs.header}\n\n${paragraphs.p1}\n\n${paragraphs.p2}\n\n${paragraphs.p3}\n\n${paragraphs.p4}\n\n${paragraphs.p5}\n\n${paragraphs.p6}\n\n${paragraphs.closing}`;
                const blob = new Blob([fullLetter], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `demand-letter-${details.defendantName || 'draft'}-${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const paragraphConfig = [
                { key: 'p1', title: 'Opening Demand', purpose: 'State the claim clearly', tip: 'Be direct. State the amount, the basis (contract), and that this is a formal demand.' },
                { key: 'p2', title: 'Performance & Acceptance', purpose: 'Establish you delivered', tip: 'Reference specific deliverables, dates, and any acceptance/approval evidence you have.' },
                { key: 'p3', title: 'Breach & Consequences', purpose: 'Frame the breach legally', tip: 'Note the failure to pay despite requests. Address any disputes briefly but firmly.' },
                { key: 'p4', title: 'Litigation Preview', purpose: 'Show you\'ve done the math', tip: 'Showing you know the numbers signals you\'re serious. Mention judgment consequences.' },
                { key: 'p5', title: 'Settlement Offer', purpose: 'Give a clear exit ramp', tip: 'Offer a specific discount with a hard deadline. Make it easy to say yes.' },
                { key: 'p6', title: 'Call to Action', purpose: 'Specific next steps', tip: 'Provide exact payment instructions and a firm deadline. No ambiguity.' }
            ];

            return (
                <div className="demand-letter-panel">
                    <div className="demand-header">
                        <h3>Demand Letter Generator <span className="custom-badge">Live Preview</span></h3>
                        <button className="demand-close" onClick={onClose}>x</button>
                    </div>
                    <div className="demand-content">
                        {/* Personalization Fields */}
                        <div style={{
                            background: '#f0f9ff',
                            border: '1px solid #bae6fd',
                            borderRadius: '10px',
                            padding: '1rem',
                            marginBottom: '1.5rem'
                        }}>
                            <div style={{ fontWeight: 600, color: '#0369a1', marginBottom: '0.75rem', fontSize: '0.9rem' }}>
                                Fill in details to personalize your letter:
                            </div>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem' }}>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Your Name *</label>
                                    <input type="text" value={details.yourName} onChange={(e) => updateDetail('yourName', e.target.value)} placeholder="John Smith" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Your Company</label>
                                    <input type="text" value={details.yourCompany} onChange={(e) => updateDetail('yourCompany', e.target.value)} placeholder="ABC Consulting LLC" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Defendant Name *</label>
                                    <input type="text" value={details.defendantName} onChange={(e) => updateDetail('defendantName', e.target.value)} placeholder="Jane Doe" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Defendant Company</label>
                                    <input type="text" value={details.defendantCompany} onChange={(e) => updateDetail('defendantCompany', e.target.value)} placeholder="XYZ Corp" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div style={{ gridColumn: 'span 2' }}>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Service/Work Description *</label>
                                    <input type="text" value={details.serviceDescription} onChange={(e) => updateDetail('serviceDescription', e.target.value)} placeholder="web development services" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Invoice #</label>
                                    <input type="text" value={details.invoiceNumber} onChange={(e) => updateDetail('invoiceNumber', e.target.value)} placeholder="INV-2024-001" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Payment Deadline</label>
                                    <input type="date" value={details.paymentDeadline} onChange={(e) => updateDetail('paymentDeadline', e.target.value)} style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Your Email</label>
                                    <input type="email" value={details.yourEmail} onChange={(e) => updateDetail('yourEmail', e.target.value)} placeholder="you@email.com" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Payment Method</label>
                                    <input type="text" value={details.paymentMethod} onChange={(e) => updateDetail('paymentMethod', e.target.value)} placeholder="wire transfer, Zelle, or check" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                            </div>
                        </div>

                        <div className="demand-intro">
                            <strong>Letter Preview:</strong> Based on ${amount.toLocaleString()} owed, {contractType} contract, {daysOverdue} days overdue. Settlement offer: ${Math.round(calc.settlement.mid).toLocaleString()}
                        </div>

                        {/* Letter Header */}
                        <div className="demand-paragraph">
                            <div className="demand-paragraph-header">
                                <span className="demand-paragraph-num" style={{ background: '#64748b' }}>H</span>
                                <span className="demand-paragraph-title">Letter Header</span>
                                <span className="demand-paragraph-purpose">Date, addressee, subject line</span>
                            </div>
                            <div className="demand-paragraph-body">
                                <textarea className="demand-text" value={paragraphs.header} onChange={(e) => updateParagraph('header', e.target.value)} style={{ minHeight: '120px' }} />
                            </div>
                        </div>

                        {paragraphConfig.map((p, i) => (
                            <div key={p.key} className="demand-paragraph">
                                <div className="demand-paragraph-header">
                                    <span className="demand-paragraph-num">{i + 1}</span>
                                    <span className="demand-paragraph-title">{p.title}</span>
                                    <span className="demand-paragraph-purpose">{p.purpose}</span>
                                </div>
                                <div className="demand-paragraph-body">
                                    <textarea
                                        className="demand-text"
                                        value={paragraphs[p.key]}
                                        onChange={(e) => updateParagraph(p.key, e.target.value)}
                                    />
                                    <div className="demand-tip">
                                        <span className="demand-tip-icon">i</span>
                                        <span>{p.tip}</span>
                                    </div>
                                </div>
                            </div>
                        ))}

                        {/* Closing */}
                        <div className="demand-paragraph">
                            <div className="demand-paragraph-header">
                                <span className="demand-paragraph-num" style={{ background: '#64748b' }}>C</span>
                                <span className="demand-paragraph-title">Closing</span>
                                <span className="demand-paragraph-purpose">Sign-off</span>
                            </div>
                            <div className="demand-paragraph-body">
                                <textarea className="demand-text" value={paragraphs.closing} onChange={(e) => updateParagraph('closing', e.target.value)} style={{ minHeight: '60px' }} />
                            </div>
                        </div>

                        <div className="demand-actions">
                            <button className="demand-btn primary" onClick={copyToClipboard}>
                                {copyStatus || 'Copy Full Letter'}
                            </button>
                            <button className="demand-btn secondary" onClick={downloadAsText}>
                                Download .txt
                            </button>
                            <a href="/intake/" className="demand-btn secondary">
                                Get Attorney Help
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        // ============== MAIN APP ==============
        const App = () => {
            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const isEmbed = urlParams.get('embed') === 'true';
            const demandOnly = urlParams.get('demandOnly') === 'true';

            const [formData, setFormData] = useState({
                amount: 5000, contractType: 'signed', deliveryProof: 'strong', acceptanceStrength: 'explicit',
                disputeLevel: 'none', scopeMess: 'none', defendantType: 'small_biz', assetInfo: 'none',
                feeClause: 'no', guaranty: 'no', outOfState: false, daysOverdue: 90, behaviorPattern: 'normal',
                // Agreement strength fields
                oralStrength: 'none',       // For oral: 'dealing', 'admission', 'witness', 'none'
                termsRelevant: 'yes',       // For written: 'yes', 'partial', 'no'
                // Evidence detail fields
                deliveryProofType: 'files', // What type of delivery proof: 'files', 'emails', 'tracking', 'testimony'
                acceptanceType: 'written',  // Type of acceptance: 'written', 'used', 'partial_payment', 'silence'
                disputeType: 'quality',     // What they're disputing: 'quality', 'scope', 'price', 'timeline'
                // Defendant detail fields
                defendantBehavior: 'normal', // 'normal', 'ghosting', 'excuses', 'hostile'
                defendantAge: 'established', // 'startup', 'established', 'unknown' - affects collectability
                // Contract term detail fields
                feeClauseType: 'prevailing', // 'prevailing', 'loser', 'collection' - type of fee clause
                guarantyType: 'full'         // 'full', 'limited', 'unknown' - type of guaranty
            });
            const [deltaMessage, setDeltaMessage] = useState(null);
            const [prevNEV, setPrevNEV] = useState(null);
            const [showDemandLetter, setShowDemandLetter] = useState(demandOnly); // Auto-show if demandOnly
            const [hasUserInput, setHasUserInput] = useState(false); // Track if user has entered anything
            const [currentLang, setCurrentLang] = useState(() => localStorage.getItem('termslaw_lang') || 'en');

            // Translations for key UI elements
            const t = {
                en: {
                    formTitle: "What's Your Case Really Worth?",
                    formSubtitle: "13+ years of collection cases built into this calculator. I'll give you the same honest assessment I'd give in a paid consultation.",
                    yourClaim: "Your Claim",
                    amountOwed: "Amount Owed",
                    daysOverdue: "Days Overdue",
                    contractType: "Contract Type",
                    evidence: "Evidence",
                    deliveryProof: "Delivery Proof",
                    acceptance: "Acceptance",
                    defense: "Possible Defense",
                    defendant: "Defendant"
                },
                ru: {
                    formTitle: "Сколько стоит ваше дело?",
                    formSubtitle: "13+ лет опыта в делах о взыскании долгов. Я дам вам такую же честную оценку, как на платной консультации.",
                    yourClaim: "Ваше требование",
                    amountOwed: "Сумма долга",
                    daysOverdue: "Дней просрочки",
                    contractType: "Тип договора",
                    evidence: "Доказательства",
                    deliveryProof: "Подтверждение доставки",
                    acceptance: "Принятие",
                    defense: "Возможная защита",
                    defendant: "Должник"
                },
                es: {
                    formTitle: "¿Cuánto vale su caso realmente?",
                    formSubtitle: "13+ años de casos de cobranza integrados en esta calculadora. Le daré la misma evaluación honesta que daría en una consulta pagada.",
                    yourClaim: "Su reclamo",
                    amountOwed: "Monto adeudado",
                    daysOverdue: "Días de retraso",
                    contractType: "Tipo de contrato",
                    evidence: "Evidencia",
                    deliveryProof: "Prueba de entrega",
                    acceptance: "Aceptación",
                    defense: "Posible defensa",
                    defendant: "Demandado"
                }
            }[currentLang];

            const setLanguage = (lang) => {
                setCurrentLang(lang);
                localStorage.setItem('termslaw_lang', lang);
            };

            const updateField = useCallback((field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
                setHasUserInput(true); // User has made an input
            }, []);

            const calc = useMemo(() => calculateCase(formData), [formData]);

            useEffect(() => {
                if (prevNEV !== null && Math.abs(calc.bestNEV - prevNEV) > 50) {
                    const delta = calc.bestNEV - prevNEV;
                    setDeltaMessage({ text: delta > 0 ? `+$${Math.round(delta).toLocaleString()}` : `-$${Math.round(Math.abs(delta)).toLocaleString()}`, type: delta > 0 ? 'positive' : 'negative' });
                    setTimeout(() => setDeltaMessage(null), 2000);
                }
                setPrevNEV(calc.bestNEV);
            }, [calc.bestNEV]);

            // Demand-only mode: show just the demand letter generator
            if (demandOnly) {
                return (
                    <div style={{ padding: isEmbed ? '0' : '1.5rem', maxWidth: '900px', margin: '0 auto' }}>
                        <DemandLetterGenerator
                            formData={formData}
                            calc={calc}
                            onClose={() => {}}
                        />
                    </div>
                );
            }

            return (
                <div className={`main-container ${isEmbed ? 'embed-mode' : ''}`}>
                    {/* FORM */}
                    <div className="form-panel">
                        <h1 className="form-title">{t.formTitle}</h1>
                        <p className="form-subtitle">{t.formSubtitle}</p>
                        <div className="calc-lang-toggle">
                            <div className={`calc-lang-flag en ${currentLang === 'en' ? 'active' : ''}`} onClick={() => setLanguage('en')} title="English"></div>
                            <div className={`calc-lang-flag ru ${currentLang === 'ru' ? 'active' : ''}`} onClick={() => setLanguage('ru')} title="Русский"></div>
                            <div className={`calc-lang-flag es ${currentLang === 'es' ? 'active' : ''}`} onClick={() => setLanguage('es')} title="Español"></div>
                        </div>

                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon">$</div>
                                <span className="section-title">Your Claim</span>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Amount Owed <Tooltip text="Enter the total unpaid principal. The calculator adds 10% annual interest automatically. Include all invoices - courts prefer one action for related debts." /></label>
                                <AmountInput value={formData.amount} onChange={(v) => updateField('amount', v)} />
                            </div>
                            <div className="field-group">
                                <label className="field-label">Days Overdue</label>
                                <select className="form-select" value={formData.daysOverdue} onChange={(e) => updateField('daysOverdue', parseInt(e.target.value))}>
                                    <option value={30}>30 days</option><option value={60}>60 days</option><option value={90}>90 days</option>
                                    <option value={180}>6 months</option><option value={365}>1 year+</option>
                                </select>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Contract Type <Tooltip text="SIGNED = Gold standard, clear terms. PO/WRITTEN = Good evidence. EMAIL = Provable but weaker. ORAL = Major penalty - courts see 'he said/she said.' Find any writing you can!" /></label>
                                <OptionGroup options={[{value:'signed',label:'Signed'},{value:'po',label:'PO'},{value:'email',label:'Email'},{value:'oral',label:'Oral'}]} value={formData.contractType} onChange={(v)=>updateField('contractType',v)} />
                            </div>

                            {/* CONDITIONAL: Oral contract strength */}
                            {formData.contractType === 'oral' && (
                                <div className="field-group" style={{marginTop:'0.75rem', padding:'0.75rem', background:'#fef3c7', borderRadius:'8px', border:'1px solid #fcd34d'}}>
                                    <label className="field-label" style={{color:'#92400e'}}>What supports the oral agreement? <Tooltip text="Oral contracts are enforceable but harder to prove. Course of dealing (repeated past transactions) is strongest. Written admission by debtor helps. Third-party witness adds credibility. 'Just your word' is weakest." /></label>
                                    <select className="form-select" value={formData.oralStrength} onChange={(e) => updateField('oralStrength', e.target.value)} style={{marginTop:'0.5rem'}}>
                                        <option value="dealing">Course of dealing (past transactions, established pattern)</option>
                                        <option value="admission">They admitted it (text, email, voicemail)</option>
                                        <option value="witness">Third-party witness heard the agreement</option>
                                        <option value="none">Just your word vs. theirs (no corroboration)</option>
                                    </select>
                                </div>
                            )}

                            {/* CONDITIONAL: Written contract terms relevance */}
                            {(formData.contractType === 'signed' || formData.contractType === 'po' || formData.contractType === 'email') && (
                                <div className="field-group" style={{marginTop:'0.75rem', padding:'0.75rem', background:'#eff6ff', borderRadius:'8px', border:'1px solid #bfdbfe'}}>
                                    <label className="field-label" style={{color:'#1e40af'}}>Do the written terms address THIS dispute? <Tooltip text="A contract only helps if its terms apply. If the PO says 'Net 30' but you're disputing quality, the payment terms don't help the quality dispute. If the contract is silent on the issue you're fighting about, it's not much better than no contract." /></label>
                                    <select className="form-select" value={formData.termsRelevant} onChange={(e) => updateField('termsRelevant', e.target.value)} style={{marginTop:'0.5rem'}}>
                                        <option value="yes">Yes - terms directly address this issue</option>
                                        <option value="partial">Partially - some terms apply, others don't</option>
                                        <option value="no">No - contract exists but doesn't cover this dispute</option>
                                    </select>
                                </div>
                            )}
                        </div>

                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon" style={{background:'#059669'}}>E</div>
                                <span className="section-title">Evidence</span>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Delivery Proof <Tooltip text="STRONG = Files sent, delivery receipts, read confirmations. SOME = Emails discussing work. WEAK = No documentation. Best evidence: timestamped file transfers, signed delivery receipts." /></label>
                                <OptionGroup options={[{value:'strong',label:'Strong'},{value:'some',label:'Some'},{value:'none',label:'Weak'}]} value={formData.deliveryProof} onChange={(v)=>updateField('deliveryProof',v)} />
                            </div>

                            {/* CONDITIONAL: What kind of delivery proof? */}
                            {formData.deliveryProof === 'strong' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#ecfdf5', borderRadius:'8px', border:'1px solid #a7f3d0', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#047857', fontSize:'0.75rem'}}>What do you have?</label>
                                    <select className="form-select" value={formData.deliveryProofType} onChange={(e) => updateField('deliveryProofType', e.target.value)} style={{fontSize:'0.8rem', padding:'0.4rem'}}>
                                        <option value="files">Timestamped file transfers (Dropbox, Drive, email attachments)</option>
                                        <option value="tracking">Delivery tracking / signed receipt</option>
                                        <option value="emails">Email chain showing delivery + acknowledgment</option>
                                        <option value="portal">Client portal / project management logs</option>
                                    </select>
                                </div>
                            )}
                            {formData.deliveryProof === 'some' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>What's missing? Look for:</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        • <strong>Read receipts</strong> on emails<br/>
                                        • <strong>File access logs</strong> from shared drives<br/>
                                        • <strong>Screenshots</strong> of project portals<br/>
                                        • <strong>"Received"</strong> or <strong>"thanks"</strong> replies
                                    </div>
                                </div>
                            )}
                            {formData.deliveryProof === 'none' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fef2f2', borderRadius:'8px', border:'1px solid #fecaca', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#dc2626', fontSize:'0.75rem'}}>⚠️ Major weakness. Can you get:</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        • <strong>Witness statement</strong> from someone who saw delivery?<br/>
                                        • <strong>Partial payment</strong> history (implies receipt)?<br/>
                                        • <strong>Their use of the work</strong> (website live, etc.)?<br/>
                                        • <strong>Any communication</strong> referencing the deliverable?
                                    </div>
                                </div>
                            )}

                            <div className="field-group">
                                <label className="field-label">Acceptance <Tooltip text="EXPLICIT = They said 'approved', 'looks good', signed off. IMPLIED = They used it without complaint. NONE = Radio silence. Even 'thanks' or 'received' helps establish acceptance." /></label>
                                <OptionGroup options={[{value:'explicit',label:'Explicit'},{value:'implied',label:'Implied'},{value:'none',label:'None'}]} value={formData.acceptanceStrength} onChange={(v)=>updateField('acceptanceStrength',v)} />
                            </div>

                            {/* CONDITIONAL: Type of acceptance */}
                            {formData.acceptanceStrength === 'explicit' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#ecfdf5', borderRadius:'8px', border:'1px solid #a7f3d0', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#047857', fontSize:'0.75rem'}}>How did they accept?</label>
                                    <select className="form-select" value={formData.acceptanceType} onChange={(e) => updateField('acceptanceType', e.target.value)} style={{fontSize:'0.8rem', padding:'0.4rem'}}>
                                        <option value="written">Written approval ("approved", "looks good", "ship it")</option>
                                        <option value="signed">Signed acceptance / sign-off sheet</option>
                                        <option value="partial_payment">Made partial payment (strongest!)</option>
                                        <option value="published">Published/deployed the work publicly</option>
                                    </select>
                                </div>
                            )}
                            {formData.acceptanceStrength === 'implied' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>What implies acceptance?</label>
                                    <select className="form-select" value={formData.acceptanceType} onChange={(e) => updateField('acceptanceType', e.target.value)} style={{fontSize:'0.8rem', padding:'0.4rem'}}>
                                        <option value="used">They used/deployed it without complaint</option>
                                        <option value="silence">No complaints within reasonable time (30+ days)</option>
                                        <option value="continued">Continued working relationship after delivery</option>
                                        <option value="referenced">Referenced the work in other contexts</option>
                                    </select>
                                </div>
                            )}
                            {formData.acceptanceStrength === 'none' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fef2f2', borderRadius:'8px', border:'1px solid #fecaca', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#dc2626', fontSize:'0.75rem'}}>⚠️ No acceptance is risky. Look for:</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        • <strong>Any "thanks"</strong> or acknowledgment email<br/>
                                        • <strong>Did they use it?</strong> Website live? Product selling?<br/>
                                        • <strong>Partial payments</strong> imply acceptance<br/>
                                        • <strong>How long</strong> before they complained? (30+ days = implied OK)
                                    </div>
                                </div>
                            )}

                            <div className="field-group">
                                <label className="field-label">Quality Dispute <Tooltip text="NONE = No complaints raised. VAGUE = 'Not happy' without specifics. SPECIFIC = Itemized defects with dollar offsets. Specific disputes increase haircut probability but can be rebutted." /></label>
                                <OptionGroup options={[{value:'none',label:'None'},{value:'vague',label:'Vague'},{value:'specific',label:'Specific'}]} value={formData.disputeLevel} onChange={(v)=>updateField('disputeLevel',v)} />
                            </div>

                            {/* CONDITIONAL: What are they disputing? */}
                            {formData.disputeLevel === 'specific' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fef2f2', borderRadius:'8px', border:'1px solid #fecaca', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#dc2626', fontSize:'0.75rem'}}>What's the specific dispute?</label>
                                    <select className="form-select" value={formData.disputeType} onChange={(e) => updateField('disputeType', e.target.value)} style={{fontSize:'0.8rem', padding:'0.4rem'}}>
                                        <option value="quality">Quality defects (bugs, errors, poor workmanship)</option>
                                        <option value="incomplete">Incomplete delivery (missing features/items)</option>
                                        <option value="late">Late delivery (missed deadlines)</option>
                                        <option value="different">Different from what was ordered</option>
                                    </select>
                                    <div style={{color:'#78716c', fontSize:'0.7rem', marginTop:'0.4rem'}}>
                                        💡 <strong>Tip:</strong> Get them to itemize in writing. Vague complaints are harder to defend but also harder to prove. Specific = potential offset.
                                    </div>
                                </div>
                            )}
                            {formData.disputeLevel === 'vague' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>Vague complaints = weak defense</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        "I'm not happy" without specifics is hard to rebut BUT also hard for them to prove damages.<br/>
                                        💡 <strong>Strategy:</strong> Force specifics. Ask "What exactly is wrong? What would fix it?" in writing.
                                    </div>
                                </div>
                            )}

                            <div className="field-group">
                                <label className="field-label">Scope Issues <Tooltip text="NONE = Clear scope, no disputes. SOME = Minor 'that wasn't included' issues. HEAVY = Major scope confusion, change orders, unclear boundaries. Heavy scope mess invites offsets and delays." /></label>
                                <OptionGroup options={[{value:'none',label:'None'},{value:'some',label:'Some'},{value:'heavy',label:'Heavy'}]} value={formData.scopeMess} onChange={(v)=>updateField('scopeMess',v)} />
                            </div>

                            {/* CONDITIONAL: Scope issues detail */}
                            {formData.scopeMess === 'heavy' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fef2f2', borderRadius:'8px', border:'1px solid #fecaca', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#dc2626', fontSize:'0.75rem'}}>⚠️ Heavy scope issues = haircut territory</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        <strong>Expect:</strong> Offsets, counter-claims, "you didn't do what we asked"<br/>
                                        <strong>Mitigate by:</strong> Finding original scope docs, change order emails, any written agreement on extras<br/>
                                        💡 Focus on what WAS clearly agreed and delivered. Abandon fuzzy add-ons.
                                    </div>
                                </div>
                            )}
                            {formData.scopeMess === 'some' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>Minor scope issues are manageable</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        💡 <strong>Tip:</strong> Concede small points to win big ones. "I'll credit X if you pay for core deliverables."
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon" style={{background:'#d97706'}}>D</div>
                                <span className="section-title">Defendant</span>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Type <Tooltip text="LARGE = Big company, deep pockets, pay to avoid hassle. MID = Established business, usually collectible. SMALL = Small biz, cashflow dependent. INDIVIDUAL = Hardest to collect - verify assets first." /></label>
                                <OptionGroup options={[{value:'large',label:'Large'},{value:'mid',label:'Mid'},{value:'small_biz',label:'Small'},{value:'individual',label:'Person'}]} value={formData.defendantType} onChange={(v)=>updateField('defendantType',v)} />
                            </div>

                            {/* CONDITIONAL: Business age/stability */}
                            {(formData.defendantType === 'small_biz' || formData.defendantType === 'mid') && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>How established is this business?</label>
                                    <select className="form-select" value={formData.defendantAge} onChange={(e) => updateField('defendantAge', e.target.value)} style={{fontSize:'0.8rem', padding:'0.4rem'}}>
                                        <option value="established">Established (5+ years, physical location, employees)</option>
                                        <option value="growing">Growing (2-5 years, some track record)</option>
                                        <option value="startup">Startup/New (under 2 years, uncertain future)</option>
                                        <option value="unknown">Unknown / Can't tell</option>
                                    </select>
                                    <div style={{color:'#78716c', fontSize:'0.7rem', marginTop:'0.4rem'}}>
                                        💡 Startups may fold before paying. Check their website, LinkedIn, reviews for signs of health.
                                    </div>
                                </div>
                            )}
                            {formData.defendantType === 'individual' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fef2f2', borderRadius:'8px', border:'1px solid #fecaca', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#dc2626', fontSize:'0.75rem'}}>⚠️ Individuals are hardest to collect</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        <strong>Check before escalating:</strong><br/>
                                        • Do they own a home? (public records)<br/>
                                        • Are they employed? (can garnish wages)<br/>
                                        • Do they have a business? (asset to reach)<br/>
                                        💡 Judgment-proof defendants make lawsuits pointless. Verify assets first!
                                    </div>
                                </div>
                            )}
                            {formData.defendantType === 'large' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#ecfdf5', borderRadius:'8px', border:'1px solid #a7f3d0', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#047857', fontSize:'0.75rem'}}>✓ Large companies usually pay</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        Their internal cost of fighting exceeds most invoices. Get to the right person (AP, legal, exec) with clean documentation.
                                        💡 Key: Escalate to someone who can authorize payment, not gatekeepers.
                                    </div>
                                </div>
                            )}

                            <div className="field-group">
                                <label className="field-label">Know Where Money Is? <Tooltip text="BANK = You know their bank (can levy). PROCESSOR = Stripe, Square, etc. (can intercept). EMPLOYER = Can garnish wages. UNKNOWN = Biggest collection risk - find this before escalating!" /></label>
                                <OptionGroup options={[{value:'bank',label:'Bank'},{value:'processor',label:'Processor'},{value:'employer',label:'Employer'},{value:'none',label:'Unknown'}]} value={formData.assetInfo} onChange={(v)=>updateField('assetInfo',v)} />
                            </div>

                            {/* CONDITIONAL: Asset info tips */}
                            {formData.assetInfo === 'none' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fef2f2', borderRadius:'8px', border:'1px solid #fecaca', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#dc2626', fontSize:'0.75rem'}}>⚠️ Find assets BEFORE spending on litigation</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        <strong>How to find assets:</strong><br/>
                                        • <strong>Bank:</strong> Check old checks/payments they sent you<br/>
                                        • <strong>Payment processor:</strong> Look at their website checkout<br/>
                                        • <strong>Property:</strong> County assessor's office (free online)<br/>
                                        • <strong>Secretary of State:</strong> Business filings, registered agent<br/>
                                        💡 A judgment you can't collect is worthless paper.
                                    </div>
                                </div>
                            )}
                            {(formData.assetInfo === 'bank' || formData.assetInfo === 'processor') && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#ecfdf5', borderRadius:'8px', border:'1px solid #a7f3d0', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#047857', fontSize:'0.75rem'}}>✓ Good - you know where to collect</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        {formData.assetInfo === 'bank' ?
                                            'Bank levy is fast and effective once you have a judgment. Keep their account info documented.' :
                                            'Payment processors (Stripe, Square, PayPal) can be served with a levy. Effective for businesses with regular sales.'
                                        }
                                    </div>
                                </div>
                            )}

                            <div className="field-group">
                                <label className="field-label">Their Behavior Pattern <Tooltip text="NORMAL = Professional, just slow. GHOSTING = Not responding at all. EXCUSES = 'Check is in the mail' forever. HOSTILE = Threatening, combative. Pattern affects strategy." /></label>
                                <select className="form-select" value={formData.defendantBehavior} onChange={(e) => updateField('defendantBehavior', e.target.value)}>
                                    <option value="normal">Normal - responds professionally, just slow to pay</option>
                                    <option value="ghosting">Ghosting - total radio silence</option>
                                    <option value="excuses">Excuses - "next week" forever, broken promises</option>
                                    <option value="hostile">Hostile - aggressive, threatening, combative</option>
                                </select>
                            </div>

                            {/* CONDITIONAL: Behavior-based advice */}
                            {formData.defendantBehavior === 'ghosting' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>Ghosting usually means cash problems or hoping you'll give up</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        💡 <strong>Escalation often breaks the silence.</strong> Attorney letter or lawsuit filing tends to get attention. If still nothing, check if they're still in business.
                                    </div>
                                </div>
                            )}
                            {formData.defendantBehavior === 'hostile' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fef2f2', borderRadius:'8px', border:'1px solid #fecaca', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#dc2626', fontSize:'0.75rem'}}>⚠️ Hostile defendants often countersue</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        <strong>Expect:</strong> Counterclaims, harassment, drawn-out fight<br/>
                                        <strong>Strategy:</strong> Document everything, don't engage emotionally, let attorney handle<br/>
                                        💡 Hostile parties sometimes settle quickly when they see you won't back down.
                                    </div>
                                </div>
                            )}

                            <div className="field-group">
                                <label className="field-label">Location <Tooltip text="OUT OF STATE = Adds friction and cost. May need to file where they are, hire local counsel, or domesticate judgment. Adds ~$500-1500 in costs and delays." /></label>
                                <OptionGroup options={[{value:false,label:'Same State'},{value:true,label:'Out of State'}]} value={formData.outOfState} onChange={(v)=>updateField('outOfState',v)} />
                            </div>

                            {/* CONDITIONAL: Out of state implications */}
                            {formData.outOfState && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>Out-of-state adds complexity</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        <strong>Options:</strong><br/>
                                        • Sue where they are (may need local counsel)<br/>
                                        • Sue in your state if contract allows (forum selection clause?)<br/>
                                        • Domesticate judgment after winning (extra step)<br/>
                                        💡 Check contract for venue/jurisdiction clause first.
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon" style={{background:'#7c3aed'}}>T</div>
                                <span className="section-title">Contract Terms</span>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Fee Clause <Tooltip text="'Prevailing party' or 'loser pays' clause. If YES, defendant faces paying YOUR legal fees if they lose - huge leverage. Check your contract! Look for 'attorney fees', 'costs of collection'." /></label>
                                <OptionGroup options={[{value:'yes',label:'Yes'},{value:'no',label:'No'},{value:'unknown',label:'Unsure'}]} value={formData.feeClause} onChange={(v)=>updateField('feeClause',v)} />
                            </div>

                            {/* CONDITIONAL: Fee clause details */}
                            {formData.feeClause === 'yes' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#ecfdf5', borderRadius:'8px', border:'1px solid #a7f3d0', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#047857', fontSize:'0.75rem'}}>✓ Fee clauses are powerful leverage</label>
                                    <select className="form-select" value={formData.feeClauseType} onChange={(e) => updateField('feeClauseType', e.target.value)} style={{fontSize:'0.8rem', padding:'0.4rem'}}>
                                        <option value="prevailing">Prevailing party gets fees (best - if you win, they pay)</option>
                                        <option value="collection">Costs of collection clause (covers demand letter costs)</option>
                                        <option value="loser">Loser pays (risky if you might lose, but leverage if strong)</option>
                                    </select>
                                    <div style={{color:'#78716c', fontSize:'0.7rem', marginTop:'0.4rem'}}>
                                        💡 <strong>Strategy:</strong> Mention this in your demand letter. "Your liability for my legal fees grows daily."
                                    </div>
                                </div>
                            )}
                            {formData.feeClause === 'unknown' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>📄 Check your contract for:</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        • <strong>"Attorney fees"</strong> or <strong>"legal fees"</strong><br/>
                                        • <strong>"Costs of collection"</strong><br/>
                                        • <strong>"Prevailing party"</strong><br/>
                                        • <strong>"Loser pays"</strong><br/>
                                        💡 Even a one-way clause (only you can recover) is valuable leverage.
                                    </div>
                                </div>
                            )}

                            <div className="field-group">
                                <label className="field-label">Personal Guaranty <Tooltip text="Did an individual personally guarantee the business debt? If YES, you can pursue BOTH the company AND the person. Check signature blocks and any 'personal guaranty' or 'individually liable' language." /></label>
                                <OptionGroup options={[{value:'yes',label:'Yes'},{value:'no',label:'No'},{value:'unknown',label:'Unsure'}]} value={formData.guaranty} onChange={(v)=>updateField('guaranty',v)} />
                            </div>

                            {/* CONDITIONAL: Guaranty details */}
                            {formData.guaranty === 'yes' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#ecfdf5', borderRadius:'8px', border:'1px solid #a7f3d0', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#047857', fontSize:'0.75rem'}}>✓ Personal guaranty = two pockets to reach</label>
                                    <select className="form-select" value={formData.guarantyType} onChange={(e) => updateField('guarantyType', e.target.value)} style={{fontSize:'0.8rem', padding:'0.4rem'}}>
                                        <option value="full">Full guaranty (100% personal liability)</option>
                                        <option value="limited">Limited guaranty (capped amount or specific debts)</option>
                                        <option value="unknown">Not sure of the terms</option>
                                    </select>
                                    <div style={{color:'#78716c', fontSize:'0.7rem', marginTop:'0.4rem'}}>
                                        💡 <strong>Strategy:</strong> Even if company folds, you can chase the individual. Name BOTH in demand letter.
                                    </div>
                                </div>
                            )}
                            {formData.guaranty === 'unknown' && (
                                <div className="field-group" style={{marginTop:'0.5rem', padding:'0.6rem', background:'#fefce8', borderRadius:'8px', border:'1px solid #fde047', fontSize:'0.8rem'}}>
                                    <label className="field-label" style={{color:'#a16207', fontSize:'0.75rem'}}>📄 Check for personal guaranty:</label>
                                    <div style={{color:'#78716c', fontSize:'0.75rem', lineHeight:'1.4'}}>
                                        • Look at <strong>signature blocks</strong> - did owner sign personally too?<br/>
                                        • Search for <strong>"personally guarantee"</strong> or <strong>"individual liability"</strong><br/>
                                        • Check if they signed as <strong>"Owner"</strong> vs <strong>"on behalf of Company"</strong><br/>
                                        💡 Often hidden in the fine print. Worth finding - adds huge collection leverage!
                                    </div>
                                </div>
                            )}
                        </div>

                        <div className="disclaimer">
                            Educational estimate only. Not legal advice. Results vary by facts.
                        </div>
                    </div>

                    {/* RESULTS */}
                    <div className="results-panel">
                        <div className="top-row">
                            <Gauge percent={calc.successProb * 100} label={calc.gaugeLabel} status={calc.gaugeStatus} hasUserInput={hasUserInput} />
                            <EVCard calc={calc} />
                        </div>
                        <EVBreakdown calc={calc} />
                        <RealityCheckCard truth={calc.hardTruth} isPositive={calc.isPositiveOutlook} hasUserInput={hasUserInput} />
                        <StabilityCard stability={calc.stability} sensitivity={calc.sensitivity} />
                        <OutcomeBars outcomes={calc.outcomes} />
                        <SettlementRange settlement={calc.settlement} amount={calc.amount} />
                        <SettlementStructures structures={calc.settlementStructures} />
                        <PathwaysGrid calc={calc} formData={formData} />
                        <LegalAnalysis calc={calc} formData={formData} />
                        <Checklist items={calc.checklist} nextStep={calc.nextStep} />
                        <CTACard calc={calc} onGenerateLetter={() => setShowDemandLetter(true)} />

                        {showDemandLetter && (
                            <DemandLetterGenerator
                                formData={formData}
                                calc={calc}
                                onClose={() => setShowDemandLetter(false)}
                            />
                        )}
                    </div>

                    {deltaMessage && <div className={`delta-toast show ${deltaMessage.type}`}>{deltaMessage.text}</div>}
                </div>
            );
        };

        // Error boundary for debugging
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }
            render() {
                if (this.state.hasError) {
                    return (
                        <div style={{padding:'2rem',color:'#dc2626',textAlign:'center'}}>
                            <h2>Something went wrong</h2>
                            <pre style={{fontSize:'0.8rem',textAlign:'left',background:'#fef2f2',padding:'1rem',borderRadius:'8px',overflow:'auto'}}>
                                {this.state.error?.toString()}
                            </pre>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        try {
            ReactDOM.createRoot(document.getElementById('root')).render(
                <ErrorBoundary>
                    <App />
                </ErrorBoundary>
            );
        } catch (e) {
            console.error('React render error:', e);
            document.getElementById('root').innerHTML = '<div style="padding:2rem;color:#dc2626;">Error loading app: ' + e.message + '</div>';
        }
    </script>
</body>
</html>