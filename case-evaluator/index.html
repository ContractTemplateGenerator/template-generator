<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>What's Your Case Worth? | Free Legal Case Evaluator | Terms.Law</title>
    <meta name="description" content="Calculate your case's expected value with our advanced legal calculator. Get realistic settlement ranges, collection probability, and strategic options.">

    <!-- React + Babel for JSX -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-901N2Y3CDZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-901N2Y3CDZ');
    </script>

    <style>
        :root {
            --primary: #1e40af;
            --primary-light: #3b82f6;
            --primary-dark: #1e3a8a;
            --success: #059669;
            --success-light: #10b981;
            --warning: #d97706;
            --danger: #dc2626;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            color: var(--gray-800);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: white;
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }
        .logo span { color: var(--gray-600); font-weight: 400; }

        /* Main Layout - Split Screen */
        .main-container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: minmax(380px, 420px) 1fr;
            gap: 1.5rem;
            min-height: calc(100vh - 70px);
        }

        @media (max-width: 1100px) {
            .main-container { grid-template-columns: 1fr; }
            .form-panel { position: relative !important; top: 0 !important; }
        }

        /* Form Panel (Left) */
        .form-panel {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 85px;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }
        .form-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        .form-subtitle {
            color: var(--gray-500);
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        /* Form Sections */
        .form-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--gray-100);
        }
        .form-section:last-child { border-bottom: none; margin-bottom: 0; }
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 1rem;
        }
        .section-icon {
            width: 32px;
            height: 32px;
            background: var(--primary-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.95rem;
        }
        .section-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        /* Form Fields */
        .field-group { margin-bottom: 1rem; }
        .field-label {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.4rem;
        }
        .help-icon {
            width: 15px;
            height: 15px;
            background: var(--gray-300);
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            color: white;
            cursor: help;
            position: relative;
        }
        .help-icon:hover .tooltip { display: block; }
        .tooltip {
            display: none;
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--gray-800);
            color: white;
            padding: 0.6rem 0.85rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 400;
            width: 220px;
            z-index: 1000;
            line-height: 1.4;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: var(--gray-800);
        }

        /* Amount Input with Arrows */
        .amount-input-wrapper {
            display: flex;
            align-items: center;
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            overflow: hidden;
            transition: border-color 0.2s;
        }
        .amount-input-wrapper:focus-within { border-color: var(--primary-light); }
        .amount-prefix {
            padding: 0.65rem 0.65rem 0.65rem 0.85rem;
            color: var(--gray-500);
            font-size: 1rem;
            font-weight: 500;
            background: var(--gray-100);
        }
        .amount-input {
            flex: 1;
            border: none;
            padding: 0.65rem;
            font-size: 1rem;
            font-weight: 600;
            background: transparent;
            outline: none;
            min-width: 0;
        }
        .amount-arrows {
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--gray-200);
        }
        .arrow-btn {
            padding: 0.35rem 0.65rem;
            background: var(--gray-100);
            border: none;
            cursor: pointer;
            color: var(--gray-600);
            transition: all 0.15s;
            font-size: 0.75rem;
        }
        .arrow-btn:hover { background: var(--primary-light); color: white; }
        .arrow-btn:first-child { border-bottom: 1px solid var(--gray-200); }

        /* Select & Input */
        .form-select, .form-input {
            width: 100%;
            padding: 0.6rem 0.85rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.9rem;
            background: var(--gray-50);
            transition: border-color 0.2s;
            outline: none;
        }
        .form-select:focus, .form-input:focus { border-color: var(--primary-light); }

        /* Option Buttons */
        .option-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }
        .option-btn {
            flex: 1;
            min-width: 70px;
            padding: 0.5rem 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--gray-600);
            transition: all 0.15s;
            text-align: center;
        }
        .option-btn:hover { border-color: var(--primary-light); color: var(--primary); }
        .option-btn.selected {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* ============== RESULTS PANEL (Right) ============== */
        .results-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .result-card {
            background: white;
            border-radius: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 1.25rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .result-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        .card-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        /* Top Row - Gauge + EV Side by Side */
        .top-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 900px) {
            .top-row { grid-template-columns: 1fr; }
        }

        /* Gauge */
        .gauge-card { text-align: center; padding: 1.5rem; }
        .gauge-container {
            width: 200px;
            height: 115px;
            margin: 0 auto 1rem;
            position: relative;
        }
        .gauge-svg { width: 100%; height: 100%; }
        .gauge-bg { fill: none; stroke: var(--gray-200); stroke-width: 18; }
        .gauge-fill {
            fill: none;
            stroke-width: 18;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease-out, stroke 0.3s;
        }
        .gauge-value {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }
        .gauge-percent {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gray-900);
            line-height: 1;
        }
        .gauge-label-text {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-top: 0.15rem;
        }
        .gauge-status {
            display: inline-block;
            padding: 0.35rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .gauge-status.excellent { background: #dcfce7; color: #166534; }
        .gauge-status.good { background: #dbeafe; color: #1e40af; }
        .gauge-status.moderate { background: #fef3c7; color: #92400e; }
        .gauge-status.weak { background: #fee2e2; color: #991b1b; }

        /* EV Card */
        .ev-card {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .ev-main {
            display: flex;
            align-items: baseline;
            gap: 0.4rem;
            margin-bottom: 0.35rem;
        }
        .ev-amount {
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1;
        }
        .ev-label-text { font-size: 0.9rem; opacity: 0.9; }
        .ev-subtitle {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 1rem;
        }
        .ev-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        .ev-stat { text-align: center; }
        .ev-stat-value { font-size: 1.15rem; font-weight: 700; }
        .ev-stat-label {
            font-size: 0.65rem;
            opacity: 0.75;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        /* Hard Truth Card */
        .truth-card {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
        }
        .truth-icon { font-size: 1.5rem; }
        .truth-text {
            font-size: 0.9rem;
            color: #78350f;
            font-weight: 500;
            line-height: 1.5;
        }

        /* Stability Card */
        .stability-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.3rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .stability-badge.high { background: #dcfce7; color: #166534; }
        .stability-badge.medium { background: #fef3c7; color: #92400e; }
        .stability-badge.low { background: #fee2e2; color: #991b1b; }
        .sensitivity-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0;
            font-size: 0.8rem;
            color: var(--gray-600);
        }
        .sensitivity-bar {
            flex: 1;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
        }
        .sensitivity-fill {
            height: 100%;
            background: var(--primary-light);
            border-radius: 4px;
            transition: width 0.3s;
        }

        /* Outcome Bars */
        .outcome-bars { display: flex; flex-direction: column; gap: 0.6rem; }
        .outcome-row { display: flex; align-items: center; gap: 0.75rem; }
        .outcome-label {
            width: 85px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--gray-600);
        }
        .outcome-bar-container {
            flex: 1;
            height: 24px;
            background: var(--gray-100);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }
        .outcome-bar {
            height: 100%;
            border-radius: 6px;
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.5rem;
            min-width: fit-content;
        }
        .outcome-bar.full { background: linear-gradient(90deg, #059669, #10b981); }
        .outcome-bar.partial { background: linear-gradient(90deg, #2563eb, #3b82f6); }
        .outcome-bar.lowball { background: linear-gradient(90deg, #d97706, #f59e0b); }
        .outcome-bar.nothing { background: linear-gradient(90deg, #dc2626, #ef4444); }
        .outcome-percent { font-size: 0.7rem; font-weight: 700; color: white; }
        .outcome-amount {
            font-size: 0.75rem;
            color: var(--gray-500);
            min-width: 70px;
            text-align: right;
        }

        /* Settlement Range */
        .range-visual {
            height: 10px;
            background: var(--gray-100);
            border-radius: 5px;
            position: relative;
            margin: 0.75rem 0 0.5rem;
        }
        .range-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            border-radius: 5px;
            transition: all 0.5s ease-out;
        }
        .range-marker {
            position: absolute;
            top: -6px;
            width: 3px;
            height: 22px;
            background: var(--gray-800);
            border-radius: 2px;
            transform: translateX(-50%);
        }
        .range-labels { display: flex; justify-content: space-between; }
        .range-label { text-align: center; }
        .range-value { font-size: 1.1rem; font-weight: 700; color: var(--gray-800); }
        .range-desc { font-size: 0.65rem; color: var(--gray-500); }

        /* Pathways */
        .pathways-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 0.75rem;
        }
        .pathway-card {
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            padding: 1rem;
            transition: all 0.2s;
            cursor: pointer;
        }
        .pathway-card:hover {
            border-color: var(--primary-light);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        .pathway-card.recommended {
            border-color: var(--success);
            background: rgba(5, 150, 105, 0.03);
        }
        .pathway-badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 50px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-bottom: 0.5rem;
        }
        .pathway-badge.best { background: #dcfce7; color: #166534; }
        .pathway-badge.good { background: #dbeafe; color: #1e40af; }
        .pathway-badge.option { background: var(--gray-100); color: var(--gray-600); }
        .pathway-name { font-size: 0.95rem; font-weight: 600; color: var(--gray-800); margin-bottom: 0.35rem; }
        .pathway-ev { font-size: 1.25rem; font-weight: 700; color: var(--primary); margin-bottom: 0.15rem; }
        .pathway-time { font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.75rem; }
        .pathway-list { list-style: none; font-size: 0.75rem; }
        .pathway-list li {
            padding: 0.15rem 0 0.15rem 1rem;
            position: relative;
        }
        .pathway-list.pros li::before { content: '+'; position: absolute; left: 0; color: var(--success); font-weight: 700; }
        .pathway-list.cons li::before { content: '-'; position: absolute; left: 0; color: var(--danger); font-weight: 700; }

        /* Legal Analysis */
        .analysis-section {
            padding: 0.85rem;
            background: var(--gray-50);
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }
        .analysis-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        .driver-list { list-style: none; }
        .driver-item {
            display: flex;
            align-items: flex-start;
            gap: 0.4rem;
            padding: 0.35rem 0;
            font-size: 0.8rem;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-200);
        }
        .driver-item:last-child { border-bottom: none; }
        .driver-icon { flex-shrink: 0; font-size: 0.9rem; }
        .driver-icon.positive { color: var(--success); }
        .driver-icon.negative { color: var(--danger); }

        /* Defense Cards */
        .defense-card {
            background: #fef3c7;
            border: 1px solid #fcd34d;
            border-radius: 8px;
            padding: 0.85rem;
            margin-bottom: 0.75rem;
        }
        .defense-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-weight: 600;
            font-size: 0.85rem;
            color: #92400e;
            margin-bottom: 0.35rem;
        }
        .defense-story {
            font-size: 0.8rem;
            color: #78350f;
            font-style: italic;
        }
        .rebuttal-card {
            background: #dcfce7;
            border: 1px solid #86efac;
            border-radius: 8px;
            padding: 0.85rem;
        }
        .rebuttal-header {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-weight: 600;
            font-size: 0.85rem;
            color: #166534;
            margin-bottom: 0.35rem;
        }
        .rebuttal-list { list-style: none; }
        .rebuttal-list li {
            font-size: 0.8rem;
            color: #14532d;
            padding: 0.25rem 0 0.25rem 1rem;
            position: relative;
        }
        .rebuttal-list li::before {
            content: '>';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: 700;
        }

        /* Settlement Structures */
        .structure-card {
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 0.85rem;
            margin-bottom: 0.5rem;
        }
        .structure-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 0.25rem;
        }
        .structure-desc { font-size: 0.75rem; color: var(--gray-600); }

        /* Checklist */
        .checklist-card {
            border: 2px solid var(--primary-light);
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            padding: 0.45rem 0;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
        }
        .checklist-item:last-child { border-bottom: none; }
        .checklist-check {
            width: 16px;
            height: 16px;
            border: 2px solid var(--primary-light);
            border-radius: 3px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        .checklist-text { font-size: 0.8rem; color: var(--gray-700); }

        /* CTA */
        .cta-card {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            text-align: center;
        }
        .cta-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.35rem; }
        .cta-text { opacity: 0.9; margin-bottom: 1rem; font-size: 0.85rem; }
        .cta-buttons { display: flex; gap: 0.75rem; justify-content: center; flex-wrap: wrap; }
        .cta-btn {
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            text-decoration: none;
        }
        .cta-btn.primary { background: white; color: var(--primary); }
        .cta-btn.primary:hover { background: var(--gray-100); transform: translateY(-2px); }
        .cta-btn.secondary {
            background: transparent;
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
        }
        .cta-btn.secondary:hover { background: rgba(255,255,255,0.1); border-color: white; }

        /* Delta Toast */
        .delta-toast {
            position: fixed;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--gray-800);
            color: white;
            padding: 0.6rem 1.25rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 500;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            opacity: 0;
            transition: all 0.3s ease-out;
            z-index: 1000;
        }
        .delta-toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .delta-toast.positive { background: var(--success); }
        .delta-toast.negative { background: var(--danger); }

        /* Collapsible */
        .collapsible-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 0.5rem 0;
        }
        .collapsible-icon { transition: transform 0.2s; font-size: 0.8rem; }
        .collapsible-icon.open { transform: rotate(180deg); }
        .collapsible-content {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease-out;
        }
        .collapsible-content.open { max-height: 2000px; }

        /* Disclaimer */
        .disclaimer {
            font-size: 0.7rem;
            color: var(--gray-500);
            text-align: center;
            padding: 0.75rem;
            border-top: 1px solid var(--gray-200);
            margin-top: 0.5rem;
        }

        /* Demand Letter Generator Panel */
        .demand-letter-panel {
            background: white;
            border-radius: 14px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            margin-top: 1rem;
            overflow: hidden;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from { opacity: 0; max-height: 0; transform: translateY(-10px); }
            to { opacity: 1; max-height: 2000px; transform: translateY(0); }
        }
        .demand-header {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white;
            padding: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .demand-header h3 { font-size: 1.1rem; margin: 0; }
        .demand-close {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .demand-close:hover { background: rgba(255,255,255,0.3); }
        .demand-content { padding: 1.5rem; }
        .demand-intro {
            background: #eff6ff;
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: var(--gray-700);
        }
        .demand-paragraph {
            margin-bottom: 1.5rem;
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            overflow: hidden;
        }
        .demand-paragraph-header {
            background: var(--gray-50);
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .demand-paragraph-num {
            background: var(--primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 700;
        }
        .demand-paragraph-title {
            font-weight: 600;
            color: var(--gray-800);
            font-size: 0.9rem;
        }
        .demand-paragraph-purpose {
            margin-left: auto;
            font-size: 0.7rem;
            color: var(--gray-500);
            font-style: italic;
        }
        .demand-paragraph-body {
            padding: 1rem;
        }
        .demand-text {
            width: 100%;
            min-height: 80px;
            padding: 0.75rem;
            border: 1px solid var(--gray-200);
            border-radius: 6px;
            font-family: inherit;
            font-size: 0.85rem;
            line-height: 1.6;
            resize: vertical;
            background: white;
        }
        .demand-text:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .demand-tip {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--gray-500);
            display: flex;
            align-items: flex-start;
            gap: 0.35rem;
        }
        .demand-tip-icon { color: var(--warning); }
        .demand-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-200);
        }
        .demand-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        .demand-btn.primary {
            background: var(--primary);
            color: white;
        }
        .demand-btn.primary:hover {
            background: var(--primary-dark);
        }
        .demand-btn.secondary {
            background: var(--gray-100);
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        .demand-btn.secondary:hover {
            background: var(--gray-200);
        }
        .custom-badge {
            display: inline-block;
            background: #dcfce7;
            color: #166534;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-left: 0.5rem;
        }

        @media (max-width: 768px) {
            .main-container { padding: 1rem; }
            .ev-breakdown { grid-template-columns: 1fr; }
            .pathways-grid { grid-template-columns: 1fr; }
        }
        /* Embed mode adjustments - target both html and body */
        html.embed-mode, body.embed-mode { background: white; }
        html.embed-mode .header, body.embed-mode .header { display: none; }
        html.embed-mode .main-container, body.embed-mode .main-container {
            min-height: auto;
            padding: 0.5rem;
        }
        html.embed-mode .form-panel, body.embed-mode .form-panel {
            position: relative;
            top: 0;
            max-height: none;
        }
    </style>
    <script>
        // Check embed mode early and apply to html element
        (function() {
            var params = new URLSearchParams(window.location.search);
            if (params.get('embed') === 'true') {
                document.documentElement.classList.add('embed-mode');
            }
        })();
    </script>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">Terms<span>.Law</span></a>
            <nav>
                <a href="/Templates/" style="color: var(--gray-600); text-decoration: none; font-size: 0.85rem;">Generators</a>
            </nav>
        </div>
    </header>
    <script>
        // Hide header in embed mode
        if (new URLSearchParams(window.location.search).get('embed') === 'true') {
            document.body.classList.add('embed-mode');
        }
    </script>

    <div id="root">
        <div style="display:flex;align-items:center;justify-content:center;height:50vh;color:#64748b;">
            <div style="text-align:center;">
                <div style="font-size:1.5rem;margin-bottom:0.5rem;">Loading Calculator...</div>
                <div style="font-size:0.85rem;">If this persists, check browser console for errors</div>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // ============== CALCULATION ENGINE ==============
        const calculateCase = (formData) => {
            const {
                amount = 0,
                contractType = 'signed',
                deliveryProof = 'strong',
                acceptanceStrength = 'explicit',
                disputeLevel = 'none',
                scopeMess = 'none',
                defendantType = 'small_biz',
                assetInfo = 'none',
                feeClause = 'no',
                guaranty = 'no',
                outOfState = false,
                daysOverdue = 90,
                behaviorPattern = 'normal'
            } = formData;

            // Paper Value
            const interestRate = 0.10;
            const interestAmount = amount * interestRate * (Math.max(0, daysOverdue) / 365);
            const paperValue = amount + interestAmount;

            // === SCORES ===
            let fts = 0; // Formation & Terms
            // Oral contracts are SIGNIFICANTLY weaker - courts require corroborating evidence
            // "he said/she said" invites disputes, statutes of frauds issues, credibility battles
            if (contractType === 'signed') fts += 30;      // Gold standard: clear terms, signatures
            else if (contractType === 'po') fts += 25;      // Purchase order: still written evidence
            else if (contractType === 'email') fts += 15;   // Email chain: weaker but provable terms
            else fts -= 15;                                 // ORAL: major penalty - shifts burden, invites "I never agreed to that"
            if (feeClause === 'yes') fts += 7;

            let pas = 0; // Performance & Acceptance
            if (deliveryProof === 'strong') pas += 25;
            else if (deliveryProof === 'some') pas += 12;
            if (acceptanceStrength === 'explicit') pas += 25;
            else if (acceptanceStrength === 'implied') pas += 15;
            if (disputeLevel === 'none') pas += 20;

            let dfs = 0; // Defenses & Friction
            if (disputeLevel === 'specific') dfs += 25;
            else if (disputeLevel === 'vague') dfs += 12;
            if (scopeMess === 'heavy') dfs += 20;
            else if (scopeMess === 'some') dfs += 10;
            if (outOfState) dfs += 15;

            let cs = 0; // Collectability
            if (defendantType === 'large') cs += 90;
            else if (defendantType === 'mid') cs += 75;
            else if (defendantType === 'small_biz') cs += 55;
            else cs += 40;
            if (assetInfo === 'bank' || assetInfo === 'processor') cs += 15;
            else if (assetInfo === 'employer') cs += 10;
            if (guaranty === 'yes') cs += 20;

            let ls = 0; // Leverage
            if (feeClause === 'yes') ls += 15;
            if (guaranty === 'yes') ls += 20;

            // === PROBABILITIES ===
            const sigmoid = (x) => 1 / (1 + Math.exp(-x));
            const pLiability = sigmoid(0.055 * (fts + pas - dfs) - 1.2);
            const pDamages = sigmoid(0.06 * (pas - dfs * 0.5) - 0.6);
            const pCollect = sigmoid(0.07 * cs - 3.5);
            const pEarly = sigmoid(0.04 * (ls + cs - dfs) - 0.8);
            const successProb = pLiability * 0.4 + pDamages * 0.2 + pCollect * 0.25 + pEarly * 0.15;

            // === OUTCOMES ===
            const fullPayProb = successProb * pCollect * (disputeLevel === 'none' ? 0.55 : 0.25);
            const partialProb = successProb * pCollect * 0.35;
            const lowballProb = (1 - successProb) * 0.35;
            const nothingProb = Math.max(0, 1 - fullPayProb - partialProb - lowballProb);

            const fullPayAmount = paperValue * 0.95;
            const partialAmount = paperValue * 0.65;
            const lowballAmount = paperValue * 0.25;

            // === SETTLEMENT RANGE ===
            const settlementLow = amount * (0.35 + pLiability * 0.15);
            const settlementMid = amount * (0.55 + pLiability * 0.2);
            const settlementHigh = paperValue * (0.8 + pCollect * 0.1);

            // === EXPECTED VALUE ===
            const grossEV = (fullPayProb * fullPayAmount) + (partialProb * partialAmount) + (lowballProb * lowballAmount);
            const demandCost = 50;
            const smallClaimsCost = 150;
            const civilCost = 2500;

            const nevDemand = (grossEV * pEarly * 0.75) - demandCost;
            const nevSmallClaims = (grossEV * pCollect) - smallClaimsCost;
            const nevCivil = (grossEV * pCollect * 1.1) - civilCost;

            const paths = [
                { name: 'demand', nev: nevDemand },
                { name: 'small_claims', nev: nevSmallClaims },
                { name: 'civil', nev: nevCivil }
            ];
            const bestPath = paths.reduce((a, b) => a.nev > b.nev ? a : b);

            // === GAUGE LABEL ===
            let gaugeLabel = 'Moderate leverage';
            let gaugeStatus = 'moderate';
            if (pLiability >= 0.75 && deliveryProof === 'strong' && pCollect >= 0.7) {
                gaugeLabel = 'Judge-friendly & collectible';
                gaugeStatus = 'excellent';
            } else if (pLiability >= 0.7 && pCollect < 0.5) {
                gaugeLabel = 'Paper-strong, wallet-weak';
                gaugeStatus = 'moderate';
            } else if (scopeMess === 'heavy' || disputeLevel === 'specific') {
                gaugeLabel = 'Fact-messy (expect haircuts)';
                gaugeStatus = 'moderate';
            } else if (deliveryProof === 'none' || acceptanceStrength === 'none') {
                gaugeLabel = 'Proof gap risk';
                gaugeStatus = 'weak';
            } else if (successProb >= 0.7) {
                gaugeLabel = 'Strong position';
                gaugeStatus = 'good';
            }

            // === STABILITY ===
            let unknownCount = 0;
            if (feeClause === 'unknown') unknownCount++;
            if (guaranty === 'unknown') unknownCount++;
            if (assetInfo === 'none') unknownCount++;

            const evSpread = Math.abs(nevSmallClaims - nevDemand);
            let stability = 'high';
            if (unknownCount >= 2 || evSpread > amount * 0.3) stability = 'low';
            else if (unknownCount >= 1 || evSpread > amount * 0.15) stability = 'medium';

            // === SENSITIVITY (what moves EV most) ===
            const sensitivity = [
                { name: 'Collectability', impact: pCollect < 0.6 ? 85 : 45 },
                { name: 'Acceptance Proof', impact: acceptanceStrength === 'none' ? 80 : 30 },
                { name: 'Dispute Level', impact: disputeLevel !== 'none' ? 70 : 25 }
            ].sort((a, b) => b.impact - a.impact);

            // === TOP DRIVERS ===
            const drivers = [];
            // ORAL CONTRACT WARNING - This is a major issue
            if (contractType === 'oral') {
                drivers.push({ type: 'negative', text: 'ORAL CONTRACT: "He said/she said" invites disputes. No written terms = credibility battle. Courts skeptical.' });
            }
            if (deliveryProof === 'strong') {
                drivers.push({ type: 'positive', text: 'Strong documentation supports your claim.' });
            }
            if (acceptanceStrength === 'explicit') {
                drivers.push({ type: 'positive', text: 'Explicit acceptance shrinks quality dispute leverage.' });
            }
            if (disputeLevel === 'none') {
                drivers.push({ type: 'positive', text: 'No dispute raised. Clean breach pattern.' });
            }
            if (feeClause === 'yes') {
                drivers.push({ type: 'positive', text: 'Fee clause increases defendant\'s downside.' });
            }
            if (assetInfo !== 'none') {
                drivers.push({ type: 'positive', text: 'You have a path to money. Collection probability up.' });
            }
            if (contractType === 'signed') {
                drivers.push({ type: 'positive', text: 'Signed contract = clear terms. Strongest legal position.' });
            }
            if (deliveryProof === 'none' || acceptanceStrength === 'none') {
                drivers.push({ type: 'negative', text: 'Proof gap. Outcomes shift to haircuts without docs.' });
            }
            if (disputeLevel === 'specific') {
                drivers.push({ type: 'negative', text: 'Specific dispute increases haircut probability.' });
            }
            if (scopeMess === 'heavy') {
                drivers.push({ type: 'negative', text: 'Scope mess invites offsets and delay.' });
            }
            if (pCollect < 0.5) {
                drivers.push({ type: 'negative', text: 'Collectability is the choke point.' });
            }
            if (outOfState) {
                drivers.push({ type: 'negative', text: 'Out-of-state friction adds cost/time.' });
            }

            // === HARD TRUTH ===
            let hardTruth = '';
            // ORAL CONTRACT is the #1 issue - put it first
            if (contractType === 'oral') {
                hardTruth = 'ORAL CONTRACT WARNING: Without written terms, they can dispute the price, scope, timeline - everything. Courts see this as "he said/she said." Your EV drops 40-60%. Find ANY writing: texts, emails, even notes from the conversation.';
            } else if (pCollect < 0.5 && pLiability >= 0.6) {
                hardTruth = 'Your paper claim is strong, but collectability is the bottleneck. Focus on finding where the money is before spending on escalation.';
            } else if (deliveryProof === 'none' || acceptanceStrength === 'none') {
                hardTruth = 'Your biggest EV leak is proof. One clean acceptance document can add hundreds to your expected value.';
            } else if (disputeLevel === 'specific') {
                hardTruth = 'Expect a haircut negotiation, not a binary win. Anchor high but prepare for partial recovery.';
            } else if (Math.max(nevDemand, nevSmallClaims, nevCivil) < 200) {
                hardTruth = 'Net value looks thin. Consider whether the time/hassle is worth it, or find a way to improve leverage first.';
            } else {
                hardTruth = 'This looks like a real case worth pursuing. The math supports escalation.';
            }

            // === DEFENDANT BEHAVIOR PROFILE ===
            let behaviorProfile = '';
            if (defendantType === 'large') {
                behaviorProfile = 'Large companies typically pay when your packet is clean. Their internal cost of fighting is often larger than the invoice.';
            } else if (defendantType === 'small_biz' && behaviorPattern === 'ghosting') {
                behaviorProfile = 'Ghosting pattern suggests either cashflow problems or hoping you\'ll give up. Escalation often breaks the silence.';
            } else if (defendantType === 'small_biz') {
                behaviorProfile = 'Small businesses optimize for cashflow. Expect payment plan requests or haircut offers.';
            } else {
                behaviorProfile = 'Individual defendants are unpredictable. Confirm they have assets before spending on escalation.';
            }

            // === PRIMARY DEFENSE ===
            let primaryDefense = 'none';
            let defenseScore = { quality: 0, acceptance: 0, scope: 0, conditional: 0 };
            if (disputeLevel === 'specific') defenseScore.quality += 35;
            if (disputeLevel === 'vague') defenseScore.quality += 15;
            if (acceptanceStrength === 'none') defenseScore.acceptance += 35;
            if (scopeMess === 'heavy') defenseScore.scope += 40;
            if (scopeMess === 'some') defenseScore.scope += 20;
            if (deliveryProof === 'none') defenseScore.acceptance += 25;

            const maxDefense = Object.entries(defenseScore).reduce((a, b) => b[1] > a[1] ? b : a);
            if (maxDefense[1] > 20) primaryDefense = maxDefense[0];

            // === CHECKLIST ===
            const checklist = [];
            if (deliveryProof !== 'strong') {
                checklist.push('Pull full paper trail: agreement, invoice(s), delivery proof, follow-ups.');
            }
            if (acceptanceStrength === 'none') {
                checklist.push('Get written acknowledgment confirming receipt/use.');
            }
            if (disputeLevel !== 'none') {
                checklist.push('Force specificity: demand itemized defects + dollar offsets.');
            }
            if (assetInfo === 'none') {
                checklist.push('Identify collection hook: bank, processor, or employer.');
            }
            if (pCollect < 0.5) {
                checklist.push('Demand payment mechanics in any settlement: wire by date.');
            }
            if (guaranty === 'unknown') {
                checklist.push('Check for personal guaranty (signature block, credit app).');
            }
            checklist.push('Prepare small-claims packet: 1-page timeline + labeled exhibits.');

            // === NEXT STEP ===
            let nextStep = 'Start with a tight demand package: exhibits + deadline + clear escalation path.';
            if (pCollect < 0.5) {
                nextStep = 'Prioritize collectability: identify where the money is first.';
            } else if (deliveryProof === 'none' || acceptanceStrength === 'none') {
                nextStep = 'Fix the proof gap before escalating. One document can change EV.';
            }

            // === SETTLEMENT STRUCTURES ===
            const settlementStructures = [
                { title: 'Fast Pay', desc: `Wire $${Math.round(settlementMid).toLocaleString()} by [date] -> mutual release. Best when they want this over.` },
                { title: 'Payment Plan', desc: `First payment today + auto-default clause + stipulated judgment. For cashflow-constrained defendants.` },
                { title: 'Disputed Delta', desc: `Pay undisputed $${Math.round(amount * 0.7).toLocaleString()} now + cure window for alleged defects.` }
            ];

            return {
                amount, paperValue, interestAmount, grossEV,
                bestNEV: Math.max(nevDemand, nevSmallClaims, nevCivil),
                successProb, pLiability, pDamages, pCollect, pEarly,
                outcomes: {
                    full: { prob: fullPayProb, amount: fullPayAmount },
                    partial: { prob: partialProb, amount: partialAmount },
                    lowball: { prob: lowballProb, amount: lowballAmount },
                    nothing: { prob: nothingProb, amount: 0 }
                },
                settlement: { low: settlementLow, mid: settlementMid, high: settlementHigh },
                paths: {
                    demand: { nev: nevDemand, time: '1-4 weeks', cost: demandCost },
                    smallClaims: { nev: nevSmallClaims, time: '2-4 months', cost: smallClaimsCost },
                    civil: { nev: nevCivil, time: '6-12 months', cost: civilCost }
                },
                bestPath: bestPath.name,
                gaugeLabel, gaugeStatus,
                stability, sensitivity,
                drivers: drivers.slice(0, 4),
                hardTruth,
                behaviorProfile,
                primaryDefense,
                checklist: checklist.slice(0, 5),
                nextStep,
                settlementStructures,
                scores: { fts, pas, dfs, cs, ls }
            };
        };

        // ============== DEFENSE CONTENT ==============
        const getDefenseContent = (defense, formData) => {
            const defenses = {
                quality: {
                    name: 'Quality / Defect Dispute',
                    story: '"We refused to pay for defective work that didn\'t meet specs."',
                    rebuttals: [
                        formData.acceptanceStrength === 'explicit' ? 'You approved the deliverable. After acceptance, "defect" is narrow offset territory.' : null,
                        'No contemporaneous complaint = late-raised bargaining, not genuine rejection.',
                        'Even with issues, remedy is not $0. Pay undisputed + prove offset.',
                        'Demand itemized defect list with dollar offsets within 5 days.',
                        'Silence after delivery is implied acceptance in most jurisdictions.',
                    ].filter(Boolean),
                    counterOffense: 'Force specificity: "List each defect with (a) contract spec violated, (b) your dollar offset, (c) evidence. Vague complaints won\'t fly in court."'
                },
                acceptance: {
                    name: 'No Acceptance / Not Delivered',
                    story: '"Payment wasn\'t due because work wasn\'t delivered or accepted."',
                    rebuttals: [
                        formData.deliveryProof === 'strong' ? 'Delivered with documented proof (files, logs, handoff).' : null,
                        'Silence after review = constructive acceptance under UCC 2-606.',
                        'Identify what\'s incomplete. Undisputed portion payable now.',
                        'If you used the deliverable, you accepted it. Benefits received = payment due.',
                        'The burden shifts to you to prove non-delivery after our evidence.',
                    ].filter(Boolean),
                    counterOffense: 'Flip the burden: "What exactly wasn\'t delivered? Be specific. Everything you don\'t list is admitted as delivered."'
                },
                scope: {
                    name: 'Scope Change / "Not Included"',
                    story: '"That work wasn\'t authorized or in scope."',
                    rebuttals: [
                        'Each item maps to request + deliverable with docs.',
                        'Base scope undisputed - payable now. Fight only the delta.',
                        'Course of dealing: similar requests were paid before.',
                        'Your emails requested this work. Authorization is documented.',
                        'Quantum meruit: You received benefit, you pay reasonable value.',
                    ],
                    counterOffense: 'Anchor on the undisputed: "Even if [disputed item] is carved out, the remaining $X is due immediately. Separate fights."'
                },
                conditional: {
                    name: 'Conditional Payment / "Not Due Yet"',
                    story: '"Payment was contingent on [milestone/approval/third party]."',
                    rebuttals: [
                        'Condition was satisfied OR waived by your conduct.',
                        'You can\'t create conditions that don\'t appear in our agreement.',
                        'Good faith prevents manufactured conditions to avoid payment.',
                        'The condition was within your control - you can\'t benefit from own delay.',
                    ],
                    counterOffense: 'Call the bluff: "Show me where in our agreement this condition appears. Absent that, payment is due unconditionally."'
                },
                none: {
                    name: 'No Strong Defense Expected',
                    story: 'No significant defense pattern. Straightforward breach.',
                    rebuttals: [
                        'Push for immediate payment with clear deadline.',
                        'Any defense must be specific, itemized, evidence-backed.',
                        'Silence is not a defense. Time to pay.',
                    ],
                    counterOffense: 'Apply pressure: "You\'ve had [X days] to raise legitimate issues. Your silence confirms the debt. Pay by [date] or expect escalation."'
                }
            };
            return defenses[defense] || defenses.none;
        };

        // ============== COMPONENTS ==============
        const Tooltip = ({ text }) => (
            <span className="help-icon">?<span className="tooltip">{text}</span></span>
        );

        const AmountInput = ({ value, onChange }) => {
            const handleIncrement = (delta) => {
                const current = parseFloat(value) || 0;
                const step = current < 1000 ? 100 : current < 10000 ? 500 : 1000;
                onChange(Math.max(0, current + (delta * step)));
            };
            return (
                <div className="amount-input-wrapper">
                    <span className="amount-prefix">$</span>
                    <input type="number" className="amount-input" value={value || ''} onChange={(e) => onChange(parseFloat(e.target.value) || 0)} placeholder="5,000" />
                    <div className="amount-arrows">
                        <button className="arrow-btn" onClick={() => handleIncrement(1)}>+</button>
                        <button className="arrow-btn" onClick={() => handleIncrement(-1)}>-</button>
                    </div>
                </div>
            );
        };

        const OptionGroup = ({ options, value, onChange }) => (
            <div className="option-group">
                {options.map(opt => (
                    <button key={opt.value} className={`option-btn ${value === opt.value ? 'selected' : ''}`} onClick={() => onChange(opt.value)}>
                        {opt.label}
                    </button>
                ))}
            </div>
        );

        const Gauge = ({ percent, label, status }) => {
            const radius = 70;
            const circumference = Math.PI * radius;
            const offset = circumference - (percent / 100) * circumference;
            const getColor = () => {
                if (percent >= 70) return '#059669';
                if (percent >= 50) return '#3b82f6';
                if (percent >= 30) return '#d97706';
                return '#dc2626';
            };
            return (
                <div className="gauge-card result-card">
                    <div className="card-header"><span className="card-title">Case Strength</span></div>
                    <div className="gauge-container">
                        <svg className="gauge-svg" viewBox="0 0 160 95">
                            <path className="gauge-bg" d="M 15 80 A 65 65 0 0 1 145 80" fill="none" />
                            <path className="gauge-fill" d="M 15 80 A 65 65 0 0 1 145 80" fill="none" stroke={getColor()} strokeDasharray={circumference} strokeDashoffset={offset} />
                        </svg>
                        <div className="gauge-value">
                            <div className="gauge-percent">{Math.round(percent)}%</div>
                            <div className="gauge-label-text">Success</div>
                        </div>
                    </div>
                    <div className={`gauge-status ${status}`}>{label}</div>
                </div>
            );
        };

        const EVCard = ({ calc }) => (
            <div className="result-card ev-card">
                <div className="ev-main">
                    <span className="ev-amount">${Math.round(calc.bestNEV).toLocaleString()}</span>
                    <span className="ev-label-text">Net EV</span>
                </div>
                <div className="ev-subtitle">Paper ${Math.round(calc.paperValue).toLocaleString()} adjusted for risk, collection, costs</div>
                <div className="ev-breakdown">
                    <div className="ev-stat"><div className="ev-stat-value">{Math.round(calc.pLiability * 100)}%</div><div className="ev-stat-label">Win Prob</div></div>
                    <div className="ev-stat"><div className="ev-stat-value">{Math.round(calc.pCollect * 100)}%</div><div className="ev-stat-label">Collect</div></div>
                    <div className="ev-stat"><div className="ev-stat-value">{Math.round(calc.pEarly * 100)}%</div><div className="ev-stat-label">Early Res</div></div>
                </div>
            </div>
        );

        // EV Calculation Breakdown
        const EVBreakdown = ({ calc }) => {
            const [expanded, setExpanded] = useState(false);

            return (
                <div className="result-card" style={{ background: '#fafafa' }}>
                    <div className="collapsible-header" onClick={() => setExpanded(!expanded)}>
                        <span className="card-title">How We Calculated Your EV</span>
                        <span className={`collapsible-icon ${expanded ? 'open' : ''}`}>&#9660;</span>
                    </div>
                    <div className={`collapsible-content ${expanded ? 'open' : ''}`}>
                        <div style={{ padding: '0.75rem 0', fontSize: '0.8rem', color: 'var(--gray-600)' }}>

                            {/* Step 1: Paper Value */}
                            <div style={{ marginBottom: '1rem', padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid var(--gray-200)' }}>
                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--gray-800)' }}>1. Paper Value</div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.25rem' }}>
                                    <span>Principal owed</span>
                                    <span style={{ fontWeight: 600 }}>${calc.amount.toLocaleString()}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.25rem' }}>
                                    <span>+ Interest (10% annual)</span>
                                    <span style={{ fontWeight: 600 }}>+${Math.round(calc.interestAmount).toLocaleString()}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', borderTop: '1px solid var(--gray-200)', paddingTop: '0.5rem', marginTop: '0.5rem' }}>
                                    <span style={{ fontWeight: 600 }}>Paper Value</span>
                                    <span style={{ fontWeight: 700, color: 'var(--primary)' }}>${Math.round(calc.paperValue).toLocaleString()}</span>
                                </div>
                            </div>

                            {/* Step 2: Probability Scores */}
                            <div style={{ marginBottom: '1rem', padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid var(--gray-200)' }}>
                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--gray-800)' }}>2. Risk Probabilities</div>
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.5rem' }}>
                                    <div style={{ padding: '0.5rem', background: 'var(--gray-50)', borderRadius: '6px' }}>
                                        <div style={{ fontSize: '1.1rem', fontWeight: 700, color: calc.pLiability >= 0.7 ? 'var(--success)' : calc.pLiability >= 0.5 ? 'var(--warning)' : 'var(--danger)' }}>{Math.round(calc.pLiability * 100)}%</div>
                                        <div style={{ fontSize: '0.7rem', color: 'var(--gray-500)' }}>Win on liability</div>
                                    </div>
                                    <div style={{ padding: '0.5rem', background: 'var(--gray-50)', borderRadius: '6px' }}>
                                        <div style={{ fontSize: '1.1rem', fontWeight: 700, color: calc.pDamages >= 0.7 ? 'var(--success)' : calc.pDamages >= 0.5 ? 'var(--warning)' : 'var(--danger)' }}>{Math.round(calc.pDamages * 100)}%</div>
                                        <div style={{ fontSize: '0.7rem', color: 'var(--gray-500)' }}>Full damages</div>
                                    </div>
                                    <div style={{ padding: '0.5rem', background: 'var(--gray-50)', borderRadius: '6px' }}>
                                        <div style={{ fontSize: '1.1rem', fontWeight: 700, color: calc.pCollect >= 0.7 ? 'var(--success)' : calc.pCollect >= 0.5 ? 'var(--warning)' : 'var(--danger)' }}>{Math.round(calc.pCollect * 100)}%</div>
                                        <div style={{ fontSize: '0.7rem', color: 'var(--gray-500)' }}>Collectability</div>
                                    </div>
                                    <div style={{ padding: '0.5rem', background: 'var(--gray-50)', borderRadius: '6px' }}>
                                        <div style={{ fontSize: '1.1rem', fontWeight: 700, color: calc.pEarly >= 0.5 ? 'var(--success)' : 'var(--warning)' }}>{Math.round(calc.pEarly * 100)}%</div>
                                        <div style={{ fontSize: '0.7rem', color: 'var(--gray-500)' }}>Early settle</div>
                                    </div>
                                </div>
                            </div>

                            {/* Step 3: Outcome Distribution */}
                            <div style={{ marginBottom: '1rem', padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid var(--gray-200)' }}>
                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--gray-800)' }}>3. Expected Outcomes</div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>{Math.round(calc.outcomes.full.prob * 100)}% x Full (${Math.round(calc.outcomes.full.amount).toLocaleString()})</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.outcomes.full.prob * calc.outcomes.full.amount).toLocaleString()}</span>
                                </div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>{Math.round(calc.outcomes.partial.prob * 100)}% x Partial (${Math.round(calc.outcomes.partial.amount).toLocaleString()})</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.outcomes.partial.prob * calc.outcomes.partial.amount).toLocaleString()}</span>
                                </div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>{Math.round(calc.outcomes.lowball.prob * 100)}% x Lowball (${Math.round(calc.outcomes.lowball.amount).toLocaleString()})</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.outcomes.lowball.prob * calc.outcomes.lowball.amount).toLocaleString()}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', borderTop: '1px solid var(--gray-200)', paddingTop: '0.5rem', marginTop: '0.5rem' }}>
                                    <span style={{ fontWeight: 600 }}>Gross EV</span>
                                    <span style={{ fontWeight: 700, color: 'var(--primary)' }}>${Math.round(calc.grossEV).toLocaleString()}</span>
                                </div>
                            </div>

                            {/* Step 4: Net EV by Path */}
                            <div style={{ padding: '0.75rem', background: 'white', borderRadius: '8px', border: '1px solid var(--gray-200)' }}>
                                <div style={{ fontWeight: 600, marginBottom: '0.5rem', color: 'var(--gray-800)' }}>4. Net EV (after costs)</div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>Demand letter path</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.paths.demand.nev).toLocaleString()}</span>
                                </div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>Small claims path</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.paths.smallClaims.nev).toLocaleString()}</span>
                                </div>
                                <div style={{ marginBottom: '0.25rem', display: 'flex', justifyContent: 'space-between' }}>
                                    <span>Civil litigation path</span>
                                    <span style={{ fontWeight: 600 }}>${Math.round(calc.paths.civil.nev).toLocaleString()}</span>
                                </div>
                                <div style={{ display: 'flex', justifyContent: 'space-between', borderTop: '1px solid var(--gray-200)', paddingTop: '0.5rem', marginTop: '0.5rem', background: '#dcfce7', margin: '-0.5rem -0.75rem -0.75rem', padding: '0.75rem' }}>
                                    <span style={{ fontWeight: 600 }}>Best Path Net EV</span>
                                    <span style={{ fontWeight: 700, color: '#166534' }}>${Math.round(calc.bestNEV).toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const HardTruthCard = ({ truth }) => (
            <div className="result-card truth-card">
                <div className="card-header">
                    <span className="card-title"><span className="truth-icon">!</span> Hard Truth</span>
                </div>
                <div className="truth-text">{truth}</div>
            </div>
        );

        const StabilityCard = ({ stability, sensitivity }) => (
            <div className="result-card">
                <div className="card-header">
                    <span className="card-title">Estimate Stability</span>
                    <span className={`stability-badge ${stability}`}>{stability === 'high' ? 'High' : stability === 'medium' ? 'Medium' : 'Low'}</span>
                </div>
                <div style={{ fontSize: '0.75rem', color: 'var(--gray-600)', marginBottom: '0.75rem' }}>
                    {stability === 'low' ? 'Result could swing significantly. Focus on unknowns below.' : stability === 'medium' ? 'Some uncertainty. Clarifying these factors would tighten the estimate.' : 'Estimate is relatively stable.'}
                </div>
                <div style={{ fontWeight: 600, fontSize: '0.75rem', marginBottom: '0.4rem', color: 'var(--gray-700)' }}>What moves your EV most:</div>
                {sensitivity.map((s, i) => (
                    <div key={i} className="sensitivity-item">
                        <span style={{ width: '100px' }}>{s.name}</span>
                        <div className="sensitivity-bar"><div className="sensitivity-fill" style={{ width: `${s.impact}%` }}></div></div>
                    </div>
                ))}
            </div>
        );

        const OutcomeBars = ({ outcomes }) => {
            const bars = [
                { key: 'full', label: 'Full Recovery', color: 'full' },
                { key: 'partial', label: 'Partial', color: 'partial' },
                { key: 'lowball', label: 'Lowball', color: 'lowball' },
                { key: 'nothing', label: 'Nothing', color: 'nothing' }
            ];
            return (
                <div className="result-card">
                    <div className="card-header"><span className="card-title">Outcome Distribution</span></div>
                    <div className="outcome-bars">
                        {bars.map(bar => {
                            const outcome = outcomes[bar.key];
                            const pct = Math.round(outcome.prob * 100);
                            return (
                                <div key={bar.key} className="outcome-row">
                                    <span className="outcome-label">{bar.label}</span>
                                    <div className="outcome-bar-container">
                                        <div className={`outcome-bar ${bar.color}`} style={{ width: `${Math.max(pct, 8)}%` }}>
                                            <span className="outcome-percent">{pct}%</span>
                                        </div>
                                    </div>
                                    <span className="outcome-amount">${Math.round(outcome.amount).toLocaleString()}</span>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const SettlementRange = ({ settlement, amount }) => {
            const lowPct = (settlement.low / amount) * 100;
            const highPct = Math.min((settlement.high / amount) * 100, 110);
            const midPct = (settlement.mid / amount) * 100;
            return (
                <div className="result-card">
                    <div className="card-header"><span className="card-title">Settlement Range</span></div>
                    <div className="range-visual">
                        <div className="range-fill" style={{ left: `${(lowPct / 110) * 100}%`, width: `${((highPct - lowPct) / 110) * 100}%` }} />
                        <div className="range-marker" style={{ left: `${(midPct / 110) * 100}%` }} />
                    </div>
                    <div className="range-labels">
                        <div className="range-label"><div className="range-value">${Math.round(settlement.low).toLocaleString()}</div><div className="range-desc">Floor</div></div>
                        <div className="range-label"><div className="range-value">${Math.round(settlement.mid).toLocaleString()}</div><div className="range-desc">Likely</div></div>
                        <div className="range-label"><div className="range-value">${Math.round(settlement.high).toLocaleString()}</div><div className="range-desc">Strong</div></div>
                    </div>
                </div>
            );
        };

        const SettlementStructures = ({ structures }) => (
            <div className="result-card">
                <div className="card-header"><span className="card-title">Settlement Structures</span></div>
                {structures.map((s, i) => (
                    <div key={i} className="structure-card">
                        <div className="structure-title">{s.title}</div>
                        <div className="structure-desc">{s.desc}</div>
                    </div>
                ))}
            </div>
        );

        const PathwaysGrid = ({ calc, formData }) => {
            const getContent = (pathKey) => {
                const isRec = calc.bestPath === pathKey.replace('Claims', '_claims');
                const data = {
                    demand: { name: 'Demand Letter', pros: ['Lowest cost test', 'Fast resolution'], cons: ['No enforcement if ignored'] },
                    smallClaims: { name: 'Small Claims', pros: ['Low cost, no lawyer', 'Judgment adds pressure'], cons: ['Must appear in court'] },
                    civil: { name: 'Civil Litigation', pros: ['Maximum leverage', 'Discovery available'], cons: ['High cost ($2500+)', 'Long timeline'] }
                };
                return { ...data[pathKey], recommended: isRec };
            };
            return (
                <div className="result-card">
                    <div className="card-header"><span className="card-title">Resolution Pathways</span></div>
                    <div className="pathways-grid">
                        {['demand', 'smallClaims', 'civil'].map(pk => {
                            const c = getContent(pk);
                            const p = calc.paths[pk];
                            return (
                                <div key={pk} className={`pathway-card ${c.recommended ? 'recommended' : ''}`}>
                                    <span className={`pathway-badge ${c.recommended ? 'best' : 'option'}`}>{c.recommended ? 'Best' : 'Option'}</span>
                                    <div className="pathway-name">{c.name}</div>
                                    <div className="pathway-ev">${Math.round(p.nev).toLocaleString()}</div>
                                    <div className="pathway-time">{p.time} | ${p.cost}</div>
                                    <ul className="pathway-list pros">{c.pros.map((p, i) => <li key={i}>{p}</li>)}</ul>
                                    <ul className="pathway-list cons">{c.cons.map((c, i) => <li key={i}>{c}</li>)}</ul>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const LegalAnalysis = ({ calc, formData }) => {
            const defense = getDefenseContent(calc.primaryDefense, formData);
            return (
                <div className="result-card">
                    <div className="card-header"><span className="card-title">Legal Analysis</span></div>
                    <div className="analysis-section">
                        <div className="analysis-title">Top Drivers</div>
                        <ul className="driver-list">
                            {calc.drivers.map((d, i) => (
                                <li key={i} className="driver-item">
                                    <span className={`driver-icon ${d.type}`}>{d.type === 'positive' ? '+' : '-'}</span>
                                    <span>{d.text}</span>
                                </li>
                            ))}
                        </ul>
                    </div>

                    {/* Defense Playbook */}
                    <div className="defense-card">
                        <div className="defense-header">Likely Defense: {defense.name}</div>
                        <div className="defense-story">{defense.story}</div>
                    </div>
                    <div className="rebuttal-card">
                        <div className="rebuttal-header">Your Rebuttal Arsenal</div>
                        <ul className="rebuttal-list">{defense.rebuttals.slice(0, 4).map((r, i) => <li key={i}>{r}</li>)}</ul>
                    </div>

                    {/* Counter-Offense */}
                    {defense.counterOffense && (
                        <div style={{
                            background: 'linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)',
                            border: '1px solid #93c5fd',
                            borderRadius: '8px',
                            padding: '0.85rem',
                            marginTop: '0.75rem'
                        }}>
                            <div style={{
                                display: 'flex',
                                alignItems: 'center',
                                gap: '0.4rem',
                                fontWeight: 600,
                                fontSize: '0.85rem',
                                color: '#1e40af',
                                marginBottom: '0.35rem'
                            }}>
                                Counter-Offense Strategy
                            </div>
                            <div style={{ fontSize: '0.8rem', color: '#1e3a8a', fontStyle: 'italic' }}>
                                {defense.counterOffense}
                            </div>
                        </div>
                    )}

                    {calc.behaviorProfile && (
                        <div className="analysis-section" style={{ marginTop: '0.75rem' }}>
                            <div className="analysis-title">Defendant Profile</div>
                            <div style={{ fontSize: '0.8rem', color: 'var(--gray-600)' }}>{calc.behaviorProfile}</div>
                        </div>
                    )}
                </div>
            );
        };

        const Checklist = ({ items, nextStep }) => (
            <div className="result-card checklist-card">
                <div className="card-header"><span className="card-title">Action Checklist</span></div>
                <p style={{ marginBottom: '0.75rem', fontWeight: 500, color: 'var(--primary-dark)', fontSize: '0.85rem' }}>Next: {nextStep}</p>
                {items.map((item, i) => (
                    <div key={i} className="checklist-item">
                        <div className="checklist-check" />
                        <span className="checklist-text">{item}</span>
                    </div>
                ))}
            </div>
        );

        const CTACard = ({ calc, onGenerateLetter }) => {
            let headline = 'Ready to Pursue Your Case?';
            let subtext = 'Get a professional demand letter drafted and sent.';
            if (calc.bestNEV < 500) {
                headline = 'Improve Before Escalating';
                subtext = 'Focus on proof/collectability first. We can help identify leverage.';
            } else if (calc.pCollect < 0.5) {
                headline = 'Collection is Key';
                subtext = 'Case is strong. Let us help find where the money is.';
            }
            return (
                <div className="result-card cta-card">
                    <div className="cta-title">{headline}</div>
                    <div className="cta-text">{subtext}</div>
                    <div className="cta-buttons">
                        <button onClick={onGenerateLetter} className="cta-btn primary">Generate Demand Letter</button>
                        <a href="/intake/" className="cta-btn secondary">Start Your Case</a>
                    </div>
                </div>
            );
        };

        // ============== DEMAND LETTER GENERATOR ==============
        const DemandLetterGenerator = ({ formData, calc, onClose }) => {
            const amount = formData.amount || 5000;
            const daysOverdue = formData.daysOverdue || 90;
            const contractType = formData.contractType || 'signed';
            const deliveryProof = formData.deliveryProof || 'strong';
            const acceptanceStrength = formData.acceptanceStrength || 'explicit';
            const disputeLevel = formData.disputeLevel || 'none';

            // Personalization fields
            const [details, setDetails] = useState({
                yourName: '',
                yourCompany: '',
                yourEmail: '',
                defendantName: '',
                defendantCompany: '',
                serviceDescription: '',
                invoiceNumber: '',
                invoiceDate: '',
                paymentDeadline: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                paymentMethod: ''
            });

            const updateDetail = (key, value) => {
                setDetails(prev => ({ ...prev, [key]: value }));
            };

            // Contract description
            const contractDesc = {
                signed: 'a signed written agreement',
                po: 'a purchase order',
                email: 'email correspondence confirming the terms',
                oral: 'our verbal agreement (with supporting correspondence)'
            }[contractType];

            // Defense-specific language
            const defenseWarning = disputeLevel === 'specific'
                ? 'While you have raised certain concerns, these do not excuse the underlying payment obligation. Any disputed amounts can be addressed separately.'
                : disputeLevel === 'vague'
                ? 'Your general expressions of dissatisfaction do not constitute a valid defense to payment.'
                : '';

            // Dynamic letter generation based on personalization
            const generateLetter = () => {
                const defendant = details.defendantName || '[DEFENDANT NAME]';
                const defendantCo = details.defendantCompany ? ` of ${details.defendantCompany}` : '';
                const sender = details.yourName || '[YOUR NAME]';
                const senderCo = details.yourCompany ? `, ${details.yourCompany}` : '';
                const service = details.serviceDescription || '[DESCRIPTION OF SERVICES]';
                const invoice = details.invoiceNumber ? `Invoice #${details.invoiceNumber}` : 'the invoice';
                const deadline = details.paymentDeadline ? new Date(details.paymentDeadline).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) : '[DEADLINE DATE]';
                const payment = details.paymentMethod || '[PAYMENT INSTRUCTIONS]';

                return {
                    header: `${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}\n\nVIA EMAIL${details.yourEmail ? '' : ' AND CERTIFIED MAIL'}\n\n${defendant}${defendantCo}\n[ADDRESS]\n\nRe: Formal Demand for Payment - $${amount.toLocaleString()} Past Due${details.invoiceNumber ? ` (Invoice #${details.invoiceNumber})` : ''}\n\nDear ${defendant}:`,

                    p1: `I am writing on behalf of ${sender}${senderCo} to formally demand payment of $${amount.toLocaleString()} for ${service} rendered pursuant to ${contractDesc} between us. This amount, documented in ${invoice}, has been outstanding for ${daysOverdue} days and represents a clear breach of our agreement.`,

                    p2: `As you are aware, ${sender} performed and delivered the agreed-upon work in full. ${acceptanceStrength === 'explicit' ? 'You acknowledged receipt and approved the deliverables.' : acceptanceStrength === 'implied' ? 'You have used and benefited from these deliverables without objection.' : 'The work was completed as specified.'} ${deliveryProof === 'strong' ? 'We have comprehensive documentation including delivery records, correspondence, and your acknowledgments.' : deliveryProof === 'some' ? 'We have supporting documentation of performance.' : 'We can provide evidence of the work performed.'} Your obligation to pay is clear and unambiguous.`,

                    p3: `Despite multiple requests for payment, you have failed to remit the amount due. ${defenseWarning} Under applicable law, your failure to pay constitutes breach of contract, entitling ${sender} to recover the principal amount plus interest, costs of collection, and attorney's fees.`,

                    p4: `Our expected recovery in litigation is approximately $${Math.round(calc.bestNEV).toLocaleString()}, accounting for collection probability and legal costs. ${calc.pLiability >= 0.7 ? 'The strength of this claim makes a favorable judgment highly likely.' : 'We are fully prepared to pursue this matter through the courts.'} A judgment will appear on your record and can affect your credit and business relationships.`,

                    p5: `To resolve this matter without litigation, we are willing to accept $${Math.round(calc.settlement.mid).toLocaleString()} if paid by ${deadline}. This represents a discount of ${Math.round((1 - calc.settlement.mid / calc.paperValue) * 100)}% from the full amount owed, including interest. After this date, we will pursue the full amount plus all available legal remedies.`,

                    p6: `Please remit payment by ${deadline} via ${payment}. If you wish to discuss settlement terms, contact ${details.yourEmail ? `me at ${details.yourEmail}` : 'me'} immediately. Absent payment or a good-faith settlement proposal by ${deadline}, we will proceed with legal action without further notice.`,

                    closing: `Sincerely,\n\n${sender}${senderCo}${details.yourEmail ? `\n${details.yourEmail}` : ''}`
                };
            };

            const [paragraphs, setParagraphs] = useState(generateLetter());

            // Regenerate letter when details change
            useEffect(() => {
                setParagraphs(generateLetter());
            }, [details, amount, daysOverdue, contractType, deliveryProof, acceptanceStrength, disputeLevel]);

            const updateParagraph = (key, value) => {
                setParagraphs(prev => ({ ...prev, [key]: value }));
            };

            const [copyStatus, setCopyStatus] = useState('');

            const copyToClipboard = () => {
                const fullLetter = `${paragraphs.header}\n\n${paragraphs.p1}\n\n${paragraphs.p2}\n\n${paragraphs.p3}\n\n${paragraphs.p4}\n\n${paragraphs.p5}\n\n${paragraphs.p6}\n\n${paragraphs.closing}`;
                navigator.clipboard.writeText(fullLetter);
                setCopyStatus('Copied!');
                setTimeout(() => setCopyStatus(''), 2000);
            };

            const downloadAsText = () => {
                const fullLetter = `${paragraphs.header}\n\n${paragraphs.p1}\n\n${paragraphs.p2}\n\n${paragraphs.p3}\n\n${paragraphs.p4}\n\n${paragraphs.p5}\n\n${paragraphs.p6}\n\n${paragraphs.closing}`;
                const blob = new Blob([fullLetter], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `demand-letter-${details.defendantName || 'draft'}-${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const paragraphConfig = [
                { key: 'p1', title: 'Opening Demand', purpose: 'State the claim clearly', tip: 'Be direct. State the amount, the basis (contract), and that this is a formal demand.' },
                { key: 'p2', title: 'Performance & Acceptance', purpose: 'Establish you delivered', tip: 'Reference specific deliverables, dates, and any acceptance/approval evidence you have.' },
                { key: 'p3', title: 'Breach & Consequences', purpose: 'Frame the breach legally', tip: 'Note the failure to pay despite requests. Address any disputes briefly but firmly.' },
                { key: 'p4', title: 'Litigation Preview', purpose: 'Show you\'ve done the math', tip: 'Showing you know the numbers signals you\'re serious. Mention judgment consequences.' },
                { key: 'p5', title: 'Settlement Offer', purpose: 'Give a clear exit ramp', tip: 'Offer a specific discount with a hard deadline. Make it easy to say yes.' },
                { key: 'p6', title: 'Call to Action', purpose: 'Specific next steps', tip: 'Provide exact payment instructions and a firm deadline. No ambiguity.' }
            ];

            return (
                <div className="demand-letter-panel">
                    <div className="demand-header">
                        <h3>Demand Letter Generator <span className="custom-badge">Live Preview</span></h3>
                        <button className="demand-close" onClick={onClose}>x</button>
                    </div>
                    <div className="demand-content">
                        {/* Personalization Fields */}
                        <div style={{
                            background: '#f0f9ff',
                            border: '1px solid #bae6fd',
                            borderRadius: '10px',
                            padding: '1rem',
                            marginBottom: '1.5rem'
                        }}>
                            <div style={{ fontWeight: 600, color: '#0369a1', marginBottom: '0.75rem', fontSize: '0.9rem' }}>
                                Fill in details to personalize your letter:
                            </div>
                            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '0.75rem' }}>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Your Name *</label>
                                    <input type="text" value={details.yourName} onChange={(e) => updateDetail('yourName', e.target.value)} placeholder="John Smith" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Your Company</label>
                                    <input type="text" value={details.yourCompany} onChange={(e) => updateDetail('yourCompany', e.target.value)} placeholder="ABC Consulting LLC" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Defendant Name *</label>
                                    <input type="text" value={details.defendantName} onChange={(e) => updateDetail('defendantName', e.target.value)} placeholder="Jane Doe" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Defendant Company</label>
                                    <input type="text" value={details.defendantCompany} onChange={(e) => updateDetail('defendantCompany', e.target.value)} placeholder="XYZ Corp" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div style={{ gridColumn: 'span 2' }}>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Service/Work Description *</label>
                                    <input type="text" value={details.serviceDescription} onChange={(e) => updateDetail('serviceDescription', e.target.value)} placeholder="web development services" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Invoice #</label>
                                    <input type="text" value={details.invoiceNumber} onChange={(e) => updateDetail('invoiceNumber', e.target.value)} placeholder="INV-2024-001" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Payment Deadline</label>
                                    <input type="date" value={details.paymentDeadline} onChange={(e) => updateDetail('paymentDeadline', e.target.value)} style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Your Email</label>
                                    <input type="email" value={details.yourEmail} onChange={(e) => updateDetail('yourEmail', e.target.value)} placeholder="you@email.com" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                                <div>
                                    <label style={{ fontSize: '0.75rem', color: '#64748b', display: 'block', marginBottom: '0.2rem' }}>Payment Method</label>
                                    <input type="text" value={details.paymentMethod} onChange={(e) => updateDetail('paymentMethod', e.target.value)} placeholder="wire transfer, Zelle, or check" style={{ width: '100%', padding: '0.5rem', border: '1px solid #cbd5e1', borderRadius: '6px', fontSize: '0.85rem' }} />
                                </div>
                            </div>
                        </div>

                        <div className="demand-intro">
                            <strong>Letter Preview:</strong> Based on ${amount.toLocaleString()} owed, {contractType} contract, {daysOverdue} days overdue. Settlement offer: ${Math.round(calc.settlement.mid).toLocaleString()}
                        </div>

                        {/* Letter Header */}
                        <div className="demand-paragraph">
                            <div className="demand-paragraph-header">
                                <span className="demand-paragraph-num" style={{ background: '#64748b' }}>H</span>
                                <span className="demand-paragraph-title">Letter Header</span>
                                <span className="demand-paragraph-purpose">Date, addressee, subject line</span>
                            </div>
                            <div className="demand-paragraph-body">
                                <textarea className="demand-text" value={paragraphs.header} onChange={(e) => updateParagraph('header', e.target.value)} style={{ minHeight: '120px' }} />
                            </div>
                        </div>

                        {paragraphConfig.map((p, i) => (
                            <div key={p.key} className="demand-paragraph">
                                <div className="demand-paragraph-header">
                                    <span className="demand-paragraph-num">{i + 1}</span>
                                    <span className="demand-paragraph-title">{p.title}</span>
                                    <span className="demand-paragraph-purpose">{p.purpose}</span>
                                </div>
                                <div className="demand-paragraph-body">
                                    <textarea
                                        className="demand-text"
                                        value={paragraphs[p.key]}
                                        onChange={(e) => updateParagraph(p.key, e.target.value)}
                                    />
                                    <div className="demand-tip">
                                        <span className="demand-tip-icon">i</span>
                                        <span>{p.tip}</span>
                                    </div>
                                </div>
                            </div>
                        ))}

                        {/* Closing */}
                        <div className="demand-paragraph">
                            <div className="demand-paragraph-header">
                                <span className="demand-paragraph-num" style={{ background: '#64748b' }}>C</span>
                                <span className="demand-paragraph-title">Closing</span>
                                <span className="demand-paragraph-purpose">Sign-off</span>
                            </div>
                            <div className="demand-paragraph-body">
                                <textarea className="demand-text" value={paragraphs.closing} onChange={(e) => updateParagraph('closing', e.target.value)} style={{ minHeight: '60px' }} />
                            </div>
                        </div>

                        <div className="demand-actions">
                            <button className="demand-btn primary" onClick={copyToClipboard}>
                                {copyStatus || 'Copy Full Letter'}
                            </button>
                            <button className="demand-btn secondary" onClick={downloadAsText}>
                                Download .txt
                            </button>
                            <a href="/intake/" className="demand-btn secondary">
                                Get Attorney Help
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        // ============== MAIN APP ==============
        const App = () => {
            // Parse URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const isEmbed = urlParams.get('embed') === 'true';
            const demandOnly = urlParams.get('demandOnly') === 'true';

            const [formData, setFormData] = useState({
                amount: 5000, contractType: 'signed', deliveryProof: 'strong', acceptanceStrength: 'explicit',
                disputeLevel: 'none', scopeMess: 'none', defendantType: 'small_biz', assetInfo: 'none',
                feeClause: 'no', guaranty: 'no', outOfState: false, daysOverdue: 90, behaviorPattern: 'normal'
            });
            const [deltaMessage, setDeltaMessage] = useState(null);
            const [prevNEV, setPrevNEV] = useState(null);
            const [showDemandLetter, setShowDemandLetter] = useState(demandOnly); // Auto-show if demandOnly

            const updateField = useCallback((field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            }, []);

            const calc = useMemo(() => calculateCase(formData), [formData]);

            useEffect(() => {
                if (prevNEV !== null && Math.abs(calc.bestNEV - prevNEV) > 50) {
                    const delta = calc.bestNEV - prevNEV;
                    setDeltaMessage({ text: delta > 0 ? `+$${Math.round(delta).toLocaleString()}` : `-$${Math.round(Math.abs(delta)).toLocaleString()}`, type: delta > 0 ? 'positive' : 'negative' });
                    setTimeout(() => setDeltaMessage(null), 2000);
                }
                setPrevNEV(calc.bestNEV);
            }, [calc.bestNEV]);

            // Demand-only mode: show just the demand letter generator
            if (demandOnly) {
                return (
                    <div style={{ padding: isEmbed ? '0' : '1.5rem', maxWidth: '900px', margin: '0 auto' }}>
                        <DemandLetterGenerator
                            formData={formData}
                            calc={calc}
                            onClose={() => {}}
                        />
                    </div>
                );
            }

            return (
                <div className={`main-container ${isEmbed ? 'embed-mode' : ''}`}>
                    {/* FORM */}
                    <div className="form-panel">
                        <h1 className="form-title">What's Your Case Worth?</h1>
                        <p className="form-subtitle">Live preview updates as you answer</p>

                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon">$</div>
                                <span className="section-title">Your Claim</span>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Amount Owed <Tooltip text="Enter the total unpaid principal. We add 10% annual interest automatically. Include all invoices - courts prefer one action for related debts." /></label>
                                <AmountInput value={formData.amount} onChange={(v) => updateField('amount', v)} />
                            </div>
                            <div className="field-group">
                                <label className="field-label">Days Overdue</label>
                                <select className="form-select" value={formData.daysOverdue} onChange={(e) => updateField('daysOverdue', parseInt(e.target.value))}>
                                    <option value={30}>30 days</option><option value={60}>60 days</option><option value={90}>90 days</option>
                                    <option value={180}>6 months</option><option value={365}>1 year+</option>
                                </select>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Contract Type <Tooltip text="SIGNED = Gold standard, clear terms. PO/WRITTEN = Good evidence. EMAIL = Provable but weaker. ORAL = Major penalty - courts see 'he said/she said.' Find any writing you can!" /></label>
                                <OptionGroup options={[{value:'signed',label:'Signed'},{value:'po',label:'PO'},{value:'email',label:'Email'},{value:'oral',label:'Oral'}]} value={formData.contractType} onChange={(v)=>updateField('contractType',v)} />
                            </div>
                        </div>

                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon" style={{background:'#059669'}}>E</div>
                                <span className="section-title">Evidence</span>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Delivery Proof <Tooltip text="STRONG = Files sent, delivery receipts, read confirmations. SOME = Emails discussing work. WEAK = No documentation. Best evidence: timestamped file transfers, signed delivery receipts." /></label>
                                <OptionGroup options={[{value:'strong',label:'Strong'},{value:'some',label:'Some'},{value:'none',label:'Weak'}]} value={formData.deliveryProof} onChange={(v)=>updateField('deliveryProof',v)} />
                            </div>
                            <div className="field-group">
                                <label className="field-label">Acceptance <Tooltip text="EXPLICIT = They said 'approved', 'looks good', signed off. IMPLIED = They used it without complaint. NONE = Radio silence. Even 'thanks' or 'received' helps establish acceptance." /></label>
                                <OptionGroup options={[{value:'explicit',label:'Explicit'},{value:'implied',label:'Implied'},{value:'none',label:'None'}]} value={formData.acceptanceStrength} onChange={(v)=>updateField('acceptanceStrength',v)} />
                            </div>
                            <div className="field-group">
                                <label className="field-label">Quality Dispute <Tooltip text="NONE = No complaints raised. VAGUE = 'Not happy' without specifics. SPECIFIC = Itemized defects with dollar offsets. Specific disputes increase haircut probability but can be rebutted." /></label>
                                <OptionGroup options={[{value:'none',label:'None'},{value:'vague',label:'Vague'},{value:'specific',label:'Specific'}]} value={formData.disputeLevel} onChange={(v)=>updateField('disputeLevel',v)} />
                            </div>
                            <div className="field-group">
                                <label className="field-label">Scope Issues <Tooltip text="NONE = Clear scope, no disputes. SOME = Minor 'that wasn't included' issues. HEAVY = Major scope confusion, change orders, unclear boundaries. Heavy scope mess invites offsets and delays." /></label>
                                <OptionGroup options={[{value:'none',label:'None'},{value:'some',label:'Some'},{value:'heavy',label:'Heavy'}]} value={formData.scopeMess} onChange={(v)=>updateField('scopeMess',v)} />
                            </div>
                        </div>

                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon" style={{background:'#d97706'}}>D</div>
                                <span className="section-title">Defendant</span>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Type <Tooltip text="LARGE = Big company, deep pockets, pay to avoid hassle. MID = Established business, usually collectible. SMALL = Small biz, cashflow dependent. INDIVIDUAL = Hardest to collect - verify assets first." /></label>
                                <OptionGroup options={[{value:'large',label:'Large'},{value:'mid',label:'Mid'},{value:'small_biz',label:'Small'},{value:'individual',label:'Person'}]} value={formData.defendantType} onChange={(v)=>updateField('defendantType',v)} />
                            </div>
                            <div className="field-group">
                                <label className="field-label">Know Where Money Is? <Tooltip text="BANK = You know their bank (can levy). PROCESSOR = Stripe, Square, etc. (can intercept). EMPLOYER = Can garnish wages. UNKNOWN = Biggest collection risk - find this before escalating!" /></label>
                                <OptionGroup options={[{value:'bank',label:'Bank'},{value:'processor',label:'Processor'},{value:'employer',label:'Employer'},{value:'none',label:'Unknown'}]} value={formData.assetInfo} onChange={(v)=>updateField('assetInfo',v)} />
                            </div>
                            <div className="field-group">
                                <label className="field-label">Location <Tooltip text="OUT OF STATE = Adds friction and cost. May need to file where they are, hire local counsel, or domesticate judgment. Adds ~$500-1500 in costs and delays." /></label>
                                <OptionGroup options={[{value:false,label:'Same State'},{value:true,label:'Out of State'}]} value={formData.outOfState} onChange={(v)=>updateField('outOfState',v)} />
                            </div>
                        </div>

                        <div className="form-section">
                            <div className="section-header">
                                <div className="section-icon" style={{background:'#7c3aed'}}>T</div>
                                <span className="section-title">Contract Terms</span>
                            </div>
                            <div className="field-group">
                                <label className="field-label">Fee Clause <Tooltip text="'Prevailing party' or 'loser pays' clause. If YES, defendant faces paying YOUR legal fees if they lose - huge leverage. Check your contract! Look for 'attorney fees', 'costs of collection'." /></label>
                                <OptionGroup options={[{value:'yes',label:'Yes'},{value:'no',label:'No'},{value:'unknown',label:'Unsure'}]} value={formData.feeClause} onChange={(v)=>updateField('feeClause',v)} />
                            </div>
                            <div className="field-group">
                                <label className="field-label">Personal Guaranty <Tooltip text="Did an individual personally guarantee the business debt? If YES, you can pursue BOTH the company AND the person. Check signature blocks and any 'personal guaranty' or 'individually liable' language." /></label>
                                <OptionGroup options={[{value:'yes',label:'Yes'},{value:'no',label:'No'},{value:'unknown',label:'Unsure'}]} value={formData.guaranty} onChange={(v)=>updateField('guaranty',v)} />
                            </div>
                        </div>

                        <div className="disclaimer">
                            Educational estimate only. Not legal advice. Results vary by facts.
                        </div>
                    </div>

                    {/* RESULTS */}
                    <div className="results-panel">
                        <div className="top-row">
                            <Gauge percent={calc.successProb * 100} label={calc.gaugeLabel} status={calc.gaugeStatus} />
                            <EVCard calc={calc} />
                        </div>
                        <EVBreakdown calc={calc} />
                        <HardTruthCard truth={calc.hardTruth} />
                        <StabilityCard stability={calc.stability} sensitivity={calc.sensitivity} />
                        <OutcomeBars outcomes={calc.outcomes} />
                        <SettlementRange settlement={calc.settlement} amount={calc.amount} />
                        <SettlementStructures structures={calc.settlementStructures} />
                        <PathwaysGrid calc={calc} formData={formData} />
                        <LegalAnalysis calc={calc} formData={formData} />
                        <Checklist items={calc.checklist} nextStep={calc.nextStep} />
                        <CTACard calc={calc} onGenerateLetter={() => setShowDemandLetter(true)} />

                        {showDemandLetter && (
                            <DemandLetterGenerator
                                formData={formData}
                                calc={calc}
                                onClose={() => setShowDemandLetter(false)}
                            />
                        )}
                    </div>

                    {deltaMessage && <div className={`delta-toast show ${deltaMessage.type}`}>{deltaMessage.text}</div>}
                </div>
            );
        };

        // Error boundary for debugging
        class ErrorBoundary extends React.Component {
            constructor(props) {
                super(props);
                this.state = { hasError: false, error: null };
            }
            static getDerivedStateFromError(error) {
                return { hasError: true, error };
            }
            render() {
                if (this.state.hasError) {
                    return (
                        <div style={{padding:'2rem',color:'#dc2626',textAlign:'center'}}>
                            <h2>Something went wrong</h2>
                            <pre style={{fontSize:'0.8rem',textAlign:'left',background:'#fef2f2',padding:'1rem',borderRadius:'8px',overflow:'auto'}}>
                                {this.state.error?.toString()}
                            </pre>
                        </div>
                    );
                }
                return this.props.children;
            }
        }

        try {
            ReactDOM.createRoot(document.getElementById('root')).render(
                <ErrorBoundary>
                    <App />
                </ErrorBoundary>
            );
        } catch (e) {
            console.error('React render error:', e);
            document.getElementById('root').innerHTML = '<div style="padding:2rem;color:#dc2626;">Error loading app: ' + e.message + '</div>';
        }
    </script>
</body>
</html>