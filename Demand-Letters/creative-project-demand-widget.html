<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-901N2Y3CDZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-901N2Y3CDZ');
    </script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creative Project Demand Widget</title>
<style>
    :root {
        --bg:#f3f5fb;
        --panel:#ffffff;
        --accent:#4b59f0;
        --accent-soft:#eff0ff;
        --border:#d9deef;
        --muted:#60657a;
        --dark:#1f2538;
        --orange:#f27f4c;
        --teal:#3fbfa6;
    }
    *{box-sizing:border-box;font-family:"Inter",-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;}
    body{margin:0;background:var(--bg);color:var(--dark);}    
    .widget-frame{max-width:1200px;margin:0 auto;padding:26px;}
    .panel{background:var(--panel);border-radius:22px;border:1px solid var(--border);box-shadow:0 25px 60px rgba(33,37,68,.12);overflow:hidden;}
    .intro{padding:24px 32px;border-bottom:1px solid var(--border);line-height:1.55;color:var(--muted);font-size:15px;}
    .tabs-bar{display:flex;flex-wrap:wrap;gap:8px;padding:18px 24px;border-bottom:1px solid var(--border);background:linear-gradient(120deg,#f9f9ff,#f2f6ff);}    
    .tabchip{border:1px solid var(--border);background:#fff;color:var(--muted);padding:10px 16px;border-radius:999px;font-weight:600;font-size:14px;cursor:pointer;transition:.2s;}
    .tabchip.active{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 8px 18px rgba(76,89,240,.28);}    
    .tabview{display:none;padding:28px 32px;line-height:1.55;color:var(--dark);}    
    .tabview.active{display:block;}
    .section-note{font-weight:700;font-size:15px;margin-bottom:14px;color:var(--dark);letter-spacing:.01em;}
    .card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;}
    .info-card{border:1px solid var(--border);border-radius:16px;background:#fff;padding:16px;box-shadow:0 8px 24px rgba(33,39,70,.08);min-height:150px;}
    .tag{display:inline-flex;align-items:center;font-size:12px;font-weight:600;color:#fff;padding:2px 10px;border-radius:999px;margin-bottom:10px;}
    .tag.orange{background:var(--orange);}    
    .tag.teal{background:var(--teal);}    
    .tag.blue{background:var(--accent);}    
    .tag.gray{background:#8b90a9;}    
    .list{margin:0;padding-left:18px;color:var(--muted);font-size:14px;}
    .list li{margin-bottom:6px;}
    .dual-column{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:18px;}
    .timeline{border-left:3px solid var(--border);padding-left:16px;}
    .timeline-item{margin-bottom:12px;}
    .timeline-item span{font-weight:600;color:var(--accent);margin-right:8px;}
    .generator-shell{display:flex;gap:20px;flex-wrap:wrap;}
    .form-pane{flex:1 1 360px;border:1px solid var(--border);border-radius:18px;background:#f8f9ff;padding:18px;overflow:auto;max-height:520px;}
    .form-pane label{display:block;font-size:13px;font-weight:600;margin-top:12px;color:var(--dark);}    
    .form-pane input,.form-pane select,.form-pane textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--border);font-size:14px;color:var(--dark);background:#fff;}
    .form-pane textarea{min-height:70px;}
    .preview-pane{flex:1 1 420px;border:1px solid var(--border);border-radius:18px;background:#fff;padding:18px;display:flex;flex-direction:column;max-height:520px;}
    .preview-box{flex:1;border:1px solid var(--border);border-radius:14px;padding:14px;overflow-y:auto;font-size:14px;background:#fff;line-height:1.55;white-space:pre-wrap;}
    .preview-section{margin-bottom:14px;}
    .preview-label{font-size:12px;font-weight:700;color:var(--muted);letter-spacing:.08em;text-transform:uppercase;margin-bottom:4px;}
    .preview-text{white-space:pre-wrap;}
    .field-highlight{animation:flash 1.2s ease;}
    @keyframes flash{0%{background:#fff5c4;}100%{background:transparent;}}
    .copy-button{margin-top:14px;border:none;background:var(--accent);color:#fff;font-weight:600;padding:10px 16px;border-radius:10px;cursor:pointer;box-shadow:0 12px 28px rgba(75,89,240,.35);}    
    .inline-pill{display:flex;gap:10px;align-items:flex-start;padding:12px;border:1px dashed var(--border);border-radius:14px;background:#f6f6ff;margin-bottom:12px;font-size:13px;color:var(--muted);}    
    @media(max-width:820px){.generator-shell{flex-direction:column;} .form-pane,.preview-pane{max-height:none;}}
</style>
</head>
<body>
<div class="widget-frame">
<div class="panel">
    <div class="intro">Creative disputes are messy hybrids of contract law, IP ownership, safety issues, and reputation fallout. These tabs condense the full playbook into checklists you can skim in minutes before drafting a letter.</div>
    <div class="tabs-bar">
        <button class="tabchip active" data-tab="brief">Quick Brief</button>
        <button class="tabchip" data-tab="contract">Contract Reality</button>
        <button class="tabchip" data-tab="breach">Breach Diagnostics</button>
        <button class="tabchip" data-tab="evidence">Evidence Builder</button>
        <button class="tabchip" data-tab="ip">Safety & IP</button>
        <button class="tabchip" data-tab="generator">Demand Letter Lab</button>
    </div>
    <div id="brief" class="tabview active">
        <div class="section-note">Creative projects fail differently than plain invoices – align your tactics.</div>
        <div class="card-grid">
            <div class="info-card">
                <div class="tag blue">Deliverable Drift</div>
                <div>Define success in technical terms (frame rate, runtime, deliverable list). Arguments about “vibes” rarely win. If specs were never written, acknowledge ambiguity and focus on provable promises.</div>
            </div>
            <div class="info-card">
                <div class="tag teal">Layered Rights</div>
                <div>Every project stacks copyrights and right-of-publicity interests. Money settlement may need to include who keeps raw footage, what portfolio use is allowed, and whether music/performances can appear elsewhere.</div>
            </div>
            <div class="info-card">
                <div class="tag orange">Screenshot Contracts</div>
                <div>Email threads and DMs become the contract. Quote only the portions you can defend in court; do not rely on “we discussed this on the phone” unless you have follow-up confirmations.</div>
            </div>
            <div class="info-card">
                <div class="tag gray">Emotion vs. Narrative</div>
                <div>Clients feel embarrassed; creatives feel disrespected. A demand letter translates that emotion into timeline + breach + remedy so the other side (and any mediator) can see the logic.</div>
            </div>
        </div>
        <div class="inline-pill"><strong>Fast question</strong><div>Is the dispute about non-performance, partial delivery, or IP misuse? Everything else flows from that classification.</div></div>
    </div>
    <div id="contract" class="tabview">
        <div class="section-note">Do you actually have a contract? Almost always yes – but prove the terms.</div>
        <div class="dual-column">
            <div class="info-card">
                <div class="tag blue">Enforceability Basics</div>
                <ul class="list">
                    <li>Capable parties + mutual consent + lawful purpose + consideration</li>
                    <li>Messages showing date, price, and deliverable satisfy “writing” for most disputes</li>
                    <li>Quote provisions you can live with if the judge reads them literally</li>
                </ul>
            </div>
            <div class="info-card">
                <div class="tag teal">Reading the Document</div>
                <ul class="list">
                    <li>Courts read the agreement as a whole – conflicting clauses can hurt you</li>
                    <li>Revision and milestone clauses are leverage only when specific dates exist</li>
                    <li>If it’s all screenshots, organize them chronologically before you start writing</li>
                </ul>
            </div>
        </div>
        <div class="timeline" style="margin-top:18px;">
            <div class="timeline-item"><span>1.</span>List the messages that form the offer (budget, scope, timeline).</div>
            <div class="timeline-item"><span>2.</span>Attach or reference payment confirmations tying back to those messages.</div>
            <div class="timeline-item"><span>3.</span>Note any legal clauses (IP transfer, arbitration, safety) that impact leverage.</div>
        </div>
    </div>
    <div id="breach" class="tabview">
        <div class="section-note">Label the breach so the demand reads like a courtroom story.</div>
        <div class="card-grid">
            <div class="info-card">
                <div class="tag blue">Complete Non-Performance</div>
                <div>Funds cleared but no shoot or deliverable ever happened. Demand typically equals full refund + documentable consequential losses (rental fees, talent cancellation, missed release).</div>
            </div>
            <div class="info-card">
                <div class="tag teal">Partial Delivery</div>
                <div>Scenes shot, raw footage exists, but post stalled. Decide between firm completion deadline, transfer of raw assets, or refund portion that reflects unfinished work.</div>
            </div>
            <div class="info-card">
                <div class="tag orange">Defective Deliverable</div>
                <div>Files miss explicit specs (wrong resolution, missing deliverables). For purely stylistic complaints, temper the demand and focus on objective issues.</div>
            </div>
            <div class="info-card">
                <div class="tag gray">Missed Deadlines</div>
                <div>If release date was central, cite “time is of the essence.” Otherwise explain why the delay is unreasonable in this project context (promo run, booked venues, ad spend).</div>
            </div>
        </div>
    </div>
    <div id="evidence" class="tabview">
        <div class="section-note">Persuasion = proof + timeline. Gather these before you send anything.</div>
        <div class="card-grid">
            <div class="info-card">
                <div class="tag blue">Agreement Materials</div>
                <ul class="list">
                    <li>Contracts, order forms, accepted proposals</li>
                    <li>Emails/DMs confirming scope, budget, revisions</li>
                    <li>Change-order history mapped by date</li>
                </ul>
            </div>
            <div class="info-card">
                <div class="tag teal">Payment Trail</div>
                <ul class="list">
                    <li>Invoices, PayPal/Stripe records, bank statements</li>
                    <li>Proof of chargebacks or refunds</li>
                    <li>Replacement costs or lost-opp math</li>
                </ul>
            </div>
            <div class="info-card">
                <div class="tag orange">Project File</div>
                <ul class="list">
                    <li>Call sheets, permits, talent agreements</li>
                    <li>Edit drafts, review notes, delivered materials with timestamps</li>
                    <li>Proof you delivered stems/approvals the other side claims were missing</li>
                </ul>
            </div>
            <div class="info-card">
                <div class="tag gray">Communications & Safety</div>
                <ul class="list">
                    <li>Full text/DM exports showing timeline</li>
                    <li>Incident log if harassment or unsafe behavior occurred</li>
                    <li>Existing restraining orders or police reports referenced factually</li>
                </ul>
            </div>
        </div>
        <div class="inline-pill"><strong>Damage math</strong><div>List direct damages (fees paid/owed) and realistic consequential damages before drafting so your ask has a defensible anchor.</div></div>
    </div>
    <div id="ip" class="tabview">
        <div class="section-note">Address safety, publicity, and IP or the dispute will repeat.</div>
        <div class="dual-column">
            <div class="info-card">
                <div class="tag orange">Safety & Harassment</div>
                <div style="color:var(--muted);font-size:14px;">
                    Refer to incidents with dates/locations. State that future contact must be in writing, cite any restraining orders, and keep accusations factual. This builds credibility if a court later reviews the letter.
                </div>
            </div>
            <div class="info-card">
                <div class="tag teal">IP & Portfolio Use</div>
                <div style="color:var(--muted);font-size:14px;">
                    Footage owner retains copyright unless there is a work-for-hire or assignment. Talent keeps publicity rights. Settlements often trade payment for specific licenses (client finishes edit, creator keeps limited reel use, etc.).
                </div>
            </div>
        </div>
        <div class="info-card" style="margin-top:18px;">
            <div class="tag blue">Social Media Fallout</div>
            <div style="color:var(--muted);font-size:14px;">
                Identify harmful posts precisely and request removal plus mutual non-disparagement. Avoid threatening defamation unless statements are clearly false factual claims. Remember: anything you post can become Exhibit A.
            </div>
        </div>
    </div>
    <div id="generator" class="tabview">
        <div class="section-note">Demand Letter Lab • Fill what you have, skip what you don’t. Live preview auto-highlights updates.</div>
        <div class="generator-shell">
            <form class="form-pane" onsubmit="return false;">
                <label>Project / Working Title</label>
                <input type="text" id="field-project" placeholder="Music video for 'Neon Hours'">
                <label>Your Role</label>
                <input type="text" id="field-role" placeholder="Artist / Director / Production company">
                <label>Recipient Name / Company</label>
                <input type="text" id="field-recipient" placeholder="Example: Silver Lens Collective">
                <label>Amount in Dispute (optional)</label>
                <input type="number" step="0.01" id="field-amount" placeholder="8500">
                <label>Output Format</label>
                <select id="field-format">
                    <option value="letter" selected>Formal letter</option>
                    <option value="email">Email body</option>
                </select>
                <label>Letter Tone</label>
                <select id="field-tone">
                    <option value="neutral" selected>Professional / neutral</option>
                    <option value="diplomatic">Very diplomatic</option>
                    <option value="firm">Firm / litigation-ready</option>
                </select>
                <label>Agreement Snapshot</label>
                <textarea id="field-agreement" placeholder="Contract confirmed Jan 12 via countersigned treatment & budget."></textarea>
                <label>Production / Deliverable Notes</label>
                <textarea id="field-production" placeholder="Shot list included aerial and warehouse setups; deliverables included 4K final + social cut + raw drive."></textarea>
                <label>Promised Delivery / Milestones</label>
                <textarea id="field-delivery" placeholder="Rough cut due April 5, final color and sound April 12 tied to single release campaign."></textarea>
                <label>Breach Type</label>
                <select id="field-breach">
                    <option value="">Select</option>
                    <option value="no-performance">Complete non-performance</option>
                    <option value="raw-delivered">Shoot done, edit/links missing</option>
                    <option value="defective">Files delivered but fail specs</option>
                    <option value="deadline">Deadline missed / release jeopardized</option>
                </select>
                <label>Key Timeline Points</label>
                <textarea id="field-timeline" placeholder="Booked Feb 10, paid 50% Feb 15, shoot March 2-3, promised edit March 20, no delivery as of May 1."></textarea>
                <label>Evidence Shortlist</label>
                <textarea id="field-evidence" placeholder="Signed order form; Stripe receipt; Dropbox logs; March 28 text confirming you delivered stems."></textarea>
                <label>Safety or IP Issues (optional)</label>
                <textarea id="field-safety" placeholder="April 5 rehearsal disrupted by uninvited manager; safety concerns documented; all future contact must be written."></textarea>
                <label>Social / Reputation Issues (optional)</label>
                <textarea id="field-social" placeholder="Client posted on IG accusing our crew of theft on May 2; request removal as part of settlement."></textarea>
                <label>IP / Rights Demands (optional)</label>
                <textarea id="field-ip" placeholder="Need raw RED files plus license to finish edit elsewhere; confirm we can use select shots in reel."></textarea>
                <label>Resolution Checklist</label>
                <div style="border:1px solid var(--border);border-radius:12px;padding:10px;background:#fff;display:grid;gap:6px;font-size:13px;color:var(--muted);">
                    <label><input type="checkbox" id="res-refund"> Refund outstanding fees</label>
                    <label><input type="checkbox" id="res-raw"> Deliver raw footage / project files</label>
                    <label><input type="checkbox" id="res-edit"> Deliver final edit by date</label>
                    <label><input type="checkbox" id="res-nondisp"> Remove posts / agree to non-disparagement</label>
                </div>
                <label>Custom Notes (optional)</label>
                <textarea id="field-resolution" placeholder="Any additional settlement terms or clarifications."></textarea>
                <label>Preferred Escalation Path</label>
                <select id="field-escalation">
                    <option value="small-claims" selected>Small claims court</option>
                    <option value="arbitration">Arbitration (platform or contract)</option>
                    <option value="copyright">Copyright Claims Board / IP action</option>
                    <option value="civil">Civil court / litigation</option>
                </select>
                <label>Response Deadline</label>
                <input type="text" id="field-deadline" placeholder="Example: June 12, 2025">
                <button type="button" id="clear-btn" style="margin-top:12px;border:1px solid var(--border);background:#fff;border-radius:10px;padding:8px 12px;font-weight:600;color:var(--muted);cursor:pointer;">Clear Form</button>
            </form>
            <div class="preview-pane">
                <div id="preview" class="preview-box"></div>
                <button class="copy-button" type="button" onclick="copyPreview()">Copy Demand Letter Text</button>
            </div>
        </div>
    </div>
</div>
</div>
<script>
const inputs = {
    project: document.getElementById('field-project'),
    role: document.getElementById('field-role'),
    recipient: document.getElementById('field-recipient'),
    amount: document.getElementById('field-amount'),
    format: document.getElementById('field-format'),
    tone: document.getElementById('field-tone'),
    agreement: document.getElementById('field-agreement'),
    production: document.getElementById('field-production'),
    delivery: document.getElementById('field-delivery'),
    breach: document.getElementById('field-breach'),
    timeline: document.getElementById('field-timeline'),
    evidence: document.getElementById('field-evidence'),
    safety: document.getElementById('field-safety'),
    social: document.getElementById('field-social'),
    ip: document.getElementById('field-ip'),
    resolution: document.getElementById('field-resolution'),
    escalation: document.getElementById('field-escalation'),
    deadline: document.getElementById('field-deadline')
};
const resolutionChecks = {
    refund: document.getElementById('res-refund'),
    raw: document.getElementById('res-raw'),
    edit: document.getElementById('res-edit'),
    nondisp: document.getElementById('res-nondisp')
};
const state = {
    project:'',role:'',recipient:'',amount:'',format:'letter',tone:'neutral',agreement:'',production:'',delivery:'',breach:'',timeline:'',evidence:'',safety:'',social:'',ip:'',resolution:'',escalation:'small-claims',deadline:'',
    resRefund:false,resRaw:false,resEdit:false,resNondisp:false
};
const preview = document.getElementById('preview');
const highlightMap = {
    project:'intro',
    role:'intro',
    recipient:'intro',
    amount:'breach',
    agreement:'timeline',
    production:'timeline',
    delivery:'breach',
    breach:'breach',
    tone:'deadline',
    format:'intro',
    timeline:'timeline',
    evidence:'evidence',
    safety:'safety',
    social:'social',
    ip:'rights',
    resolution:'resolution',
    escalation:'deadline',
    deadline:'deadline',
    'res-refund':'resolution',
    'res-raw':'resolution',
    'res-edit':'resolution',
    'res-nondisp':'resolution'
};
const breachMap = {
    'no-performance':'Funds cleared and production never occurred. This is complete non-performance under the agreement.',
    'raw-delivered':'Production days were completed and raw assets exist, yet no edit or delivery link has been provided.',
    'defective':'Files were delivered but fail explicit specs (resolution, format, missing scenes).',
    'deadline':'Release-driven timeline was confirmed, yet delivery dates slipped beyond what the project can absorb.'
};
Object.keys(inputs).forEach(key=>{
    inputs[key].addEventListener('input',()=>{
        state[key]=inputs[key].value.trim();
        persistState();
        renderPreview(key);
    });
});
Object.entries(resolutionChecks).forEach(([key,el])=>{
    el.addEventListener('change',()=>{
        const stateKey = `res${key.charAt(0).toUpperCase()+key.slice(1)}`;
        state[stateKey]=el.checked;
        persistState();
        renderPreview(`res-${key}`);
    });
});
document.getElementById('clear-btn').addEventListener('click',()=>{
    Object.keys(state).forEach(k=>{
        if(typeof state[k]==='boolean') state[k]=false; else state[k]='';
    });
    state.tone='neutral';
    state.format='letter';
    state.escalation='small-claims';
    updateInputsFromState();
    persistState();
    renderPreview();
});
const toneMap = {
    neutral:'Our goal is to close this out efficiently, but we are prepared to escalate if necessary.',
    diplomatic:'We strongly prefer to resolve this cooperatively and avoid consuming more budget or public attention.',
    firm:'Absent prompt resolution we will pursue all available remedies, including arbitration, small-claims court, or copyright claims.'
};
function escapeHTML(str){
    if(!str) return '';
    return str.replace(/[&<>]/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;' }[c]));
}
function formatCurrency(v){
    if(!v) return '';
    const num = Number(v);
    if(!num) return '';
    return num.toLocaleString('en-US',{style:'currency',currency:'USD'});
}
function autoResolution(){
    const clauses=[];
    if(state.resRefund) clauses.push('refund the outstanding fees');
    if(state.resRaw) clauses.push('deliver all raw footage and project files');
    if(state.resEdit) clauses.push('deliver the finished edit and promised assets by a firm date');
    if(state.resNondisp) clauses.push('remove disparaging posts and confirm mutual non-disparagement');
    if(!clauses.length) return '';
    return `Requested resolution: ${clauses.join('; ')}.`;
}
const escalationMap = {
    'small-claims':'If we cannot resolve this now, I will file in small-claims court without further notice.',
    'arbitration':'If unresolved, I will initiate arbitration through the platform/contract process and seek recovery of fees and costs.',
    'copyright':'If unauthorized use continues, I will file a copyright claim (CCB or federal court) seeking takedowns and statutory damages.',
    'civil':'Failing prompt resolution, I will escalate in civil court and seek all available remedies including attorneys’ fees where permitted.'
};
function renderPreview(changed){
    const today = new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
    const project = escapeHTML(state.project || 'our creative engagement');
    const recipient = escapeHTML(state.recipient || 'your team');
    const roleLine = state.role ? `I am writing in my capacity as ${escapeHTML(state.role)}.` : '';
    const amountLine = state.amount ? `Outstanding Amount: ${formatCurrency(state.amount)}.` : '';
    const breachLine = state.breach ? breachMap[state.breach] : 'Your contractual obligations are overdue or incomplete.';
    const deliveryLine = state.delivery ? escapeHTML(state.delivery) : '';
    const agreementLine = state.agreement ? escapeHTML(state.agreement) : '';
    const productionLine = state.production ? escapeHTML(state.production) : '';
    const timelineLine = state.timeline ? escapeHTML(state.timeline) : '';
    const evidenceLine = state.evidence ? escapeHTML(state.evidence) : '';
    const safetyLine = state.safety ? escapeHTML(state.safety) : '';
    const socialLine = state.social ? escapeHTML(state.social) : '';
    const ipLine = state.ip ? escapeHTML(state.ip) : '';
    const autoRes = autoResolution();
    const customRes = state.resolution ? escapeHTML(state.resolution) : '';
    const resolutionCombined = [autoRes, customRes].filter(Boolean).join(' ');
    const deadlineLine = state.deadline ? `Please provide a written response by ${escapeHTML(state.deadline)}.` : 'Please provide a prompt written response so we can avoid escalation.';
    const toneLine = toneMap[state.tone || 'neutral'];
    const escalationLine = escalationMap[state.escalation || 'small-claims'];

    const sections = [];
    if(state.format === 'letter'){
        sections.push(sectionHTML('', 'intro', `Date: ${today}`));
        sections.push(sectionHTML('', 'intro', 'Via Email / Written Notice'));
        sections.push(sectionHTML('', 'intro', `Re: ${project}`));
    } else {
        sections.push(sectionHTML('', 'intro', `Hi ${recipient || 'there'},`));
    }
    sections.push(sectionHTML('', 'intro', `This letter summarizes the performance failures by ${recipient} and demands a business resolution. ${roleLine}`));
    sections.push(sectionHTML('Background', 'timeline', [agreementLine, productionLine, timelineLine].filter(Boolean).join(' ')));
    sections.push(sectionHTML('Breach', 'breach', [amountLine, breachLine, deliveryLine].filter(Boolean).join(' ')));
    sections.push(sectionHTML('Evidence', 'evidence', evidenceLine || 'Documentation includes the signed agreement, payment confirmations, and production materials referenced above.'));
    if(safetyLine) sections.push(sectionHTML('Safety / IP Context', 'safety', safetyLine));
    if(socialLine) sections.push(sectionHTML('Social / Reputation Issues', 'social', socialLine));
    if(ipLine) sections.push(sectionHTML('Rights & Usage', 'rights', ipLine));
    sections.push(sectionHTML('Requested Resolution', 'resolution', resolutionCombined || 'Please confirm how you intend to close out this project without further delay.'));
    sections.push(sectionHTML('Deadline & Next Steps', 'deadline', `${deadlineLine} ${toneLine} ${escalationLine}`));
    sections.push(sectionHTML('', '', 'All further communications should occur in writing. Preserve all footage, edits, communications, invoices, and related materials for potential proceedings.'));
    if(state.format === 'email'){
        sections.push(sectionHTML('', '', 'Thanks,'));
        sections.push(sectionHTML('', '', escapeHTML(state.role || '')));
    } else {
        sections.push(sectionHTML('', '', 'Sincerely,'));
        sections.push(sectionHTML('', '', escapeHTML(state.role || '____________________')));
    }

    preview.innerHTML = sections.filter(Boolean).join('');
    persistState();
    highlightField(changed);
}
function sectionHTML(label, field, text){
    if(!text) return '';
    const labelHTML = label ? `<div class="preview-label">${label}</div>` : '';
    const fieldAttr = field ? ` data-field="${field}"` : '';
    return `<div class="preview-section">${labelHTML}<div class="preview-text"${fieldAttr}>${text}</div></div>`;
}
function highlightField(field){
    if(!field) return;
    const targetField = highlightMap[field];
    if(!targetField) return;
    const el = preview.querySelector(`[data-field="${targetField}"]`);
    if(!el) return;
    el.classList.add('field-highlight');
    clearTimeout(highlightField.timer);
    highlightField.timer = setTimeout(()=>el.classList.remove('field-highlight'),1200);
}
function updateInputsFromState(){
    Object.keys(inputs).forEach(key=>{
        let fallback='';
        if(key==='tone') fallback='neutral';
        if(key==='format') fallback='letter';
        if(key==='escalation') fallback='small-claims';
        inputs[key].value = state[key] || fallback;
    });
    resolutionChecks.refund.checked = !!state.resRefund;
    resolutionChecks.raw.checked = !!state.resRaw;
    resolutionChecks.edit.checked = !!state.resEdit;
    resolutionChecks.nondisp.checked = !!state.resNondisp;
}
function persistState(){
    localStorage.setItem('creative-demand-state', JSON.stringify(state));
}
function hydrateState(){
    const saved = localStorage.getItem('creative-demand-state');
    if(!saved) return;
    try{
        const data = JSON.parse(saved);
        Object.assign(state,data);
        updateInputsFromState();
    }catch(e){
        console.warn('State parse error',e);
    }
}
function copyPreview(){
    const text = preview.innerText.trim();
    if(!text){alert('Enter a few details first.');return;}
    if(navigator.clipboard){navigator.clipboard.writeText(text).then(()=>alert('Demand letter text copied.')).catch(fallback);} else fallback();
    function fallback(){
        const temp=document.createElement('textarea');
        temp.value=text;document.body.appendChild(temp);temp.select();document.execCommand('copy');document.body.removeChild(temp);alert('Demand letter text copied.');
    }
}
hydrateState();
renderPreview();

document.querySelectorAll('.tabchip').forEach(btn=>{
    btn.addEventListener('click',()=>{
        document.querySelectorAll('.tabchip').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.tabview').forEach(v=>v.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
    });
});
</script>
</body>
</html>
