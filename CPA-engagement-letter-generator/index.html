<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CPA Engagement Letter Generator</title>
  <style>
    /* Base Styles */
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --accent-color: #27ae60;
      --bg-color: #f9fafb;
      --card-bg: #ffffff;
      --text-primary: #333333;
      --text-secondary: #666666;
      --border-color: #e0e0e0;
      --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      --border-radius: 8px;
      --transition: all 0.3s ease;
      --highlight-color: #ffff8d;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    
    body {
      background-color: var(--bg-color);
      color: var(--text-primary);
      line-height: 1.6;
      padding: 20px;
    }
    
    /* Container Styles */
    .generator-container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    
    /* Header Styles */
    .generator-header {
      background-color: var(--primary-color);
      color: white;
      padding: 25px;
      text-align: center;
    }
    
    .generator-header h1 {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .generator-header p {
      font-size: 16px;
      opacity: 0.9;
    }
    
    /* Content Layout */
    .generator-content {
      display: flex;
      min-height: 600px;
    }
    
    /* Form Styles */
    .form-container {
      flex: 1;
      padding: 25px;
      border-right: 1px solid var(--border-color);
      overflow-y: auto;
      max-height: 800px;
    }
    
    .form-section {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .form-section:last-child {
      border-bottom: none;
    }
    
    .form-section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 5px;
      color: var(--text-primary);
    }
    
    .form-input {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-size: 14px;
      color: var(--text-primary);
      background-color: white;
      transition: var(--transition);
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    
    textarea.form-input {
      min-height: 80px;
      resize: vertical;
    }
    
    .form-helper {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }
    
    /* Radio and Checkbox Styles */
    .options-group {
      margin-bottom: 15px;
    }
    
    .option-item {
      display: flex;
      align-items: flex-start;
      padding: 8px 10px;
      margin-bottom: 8px;
      background-color: #f5f7fa;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .option-item:hover {
      background-color: #eef2f7;
    }
    
    .option-item.selected {
      background-color: #e8f6f3;
      border-color: var(--accent-color);
    }
    
    .option-item input[type="radio"],
    .option-item input[type="checkbox"] {
      margin-right: 10px;
      margin-top: 3px;
    }
    
    .option-content {
      flex: 1;
    }
    
    .option-label {
      font-weight: 500;
      display: block;
      margin-bottom: 2px;
    }
    
    .option-description {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    /* Form Actions */
    .form-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 25px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .btn {
      padding: 10px 16px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      border: none;
      text-align: center;
    }
    
    .btn-reset {
      background-color: #f1f1f1;
      color: var(--text-primary);
    }
    
    .btn-reset:hover {
      background-color: #e4e4e4;
    }
    
    .btn-copy {
      background-color: var(--secondary-color);
      color: white;
    }
    
    .btn-copy:hover {
      background-color: #2980b9;
    }
    
    .btn-download {
      background-color: var(--accent-color);
      color: white;
    }
    
    .btn-download:hover {
      background-color: #219653;
    }
    
    .copy-message {
      display: none;
      font-size: 14px;
      color: #27ae60;
      margin-left: 10px;
    }
    
    .btn-consult {
      display: block;
      width: 100%;
      margin-top: 15px;
      padding: 12px;
      background-color: var(--primary-color);
      color: white;
      text-decoration: none;
      text-align: center;
      border-radius: 4px;
      font-weight: 500;
      transition: var(--transition);
    }
    
    .btn-consult:hover {
      background-color: #1e2a37;
    }
    
    /* Preview Styles */
    .preview-container {
      flex: 1;
      padding: 25px;
      position: relative;
    }
    
    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .preview-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--primary-color);
    }
    
    .preview-note {
      font-size: 12px;
      color: var(--text-secondary);
      font-style: italic;
    }
    
    .preview-box {
      height: 700px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 25px;
      background-color: white;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-primary);
    }
    
    /* Document Styles */
    .document-template {
      font-family: Arial, sans-serif;
    }
    
    .document-title {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
    }
    
    .document-section {
      margin-bottom: 20px;
    }
    
    .section-title {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    
    .section-content {
      margin-bottom: 15px;
    }
    
    .field-label {
      font-weight: bold;
    }
    
    /* Highlight Effect */
    .highlight {
      background-color: var(--highlight-color);
      transition: background-color 0.5s ease;
    }
    
    /* Responsive Styles */
    @media (max-width: 1024px) {
      .generator-content {
        flex-direction: column;
      }
      
      .form-container {
        border-right: none;
        border-bottom: 1px solid var(--border-color);
        max-height: none;
      }
      
      .preview-box {
        height: 500px;
      }
    }
    
    @media (max-width: 768px) {
      .generator-container {
        margin: 0;
        border-radius: 0;
      }
      
      .generator-header {
        padding: 20px;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
      
      .copy-message {
        margin-left: 0;
        margin-top: 5px;
        text-align: center;
      }
    }
    
    @media print {
      body {
        background-color: white;
        padding: 0;
      }
      
      .generator-container {
        box-shadow: none;
        border-radius: 0;
      }
      
      .generator-header,
      .form-container,
      .preview-header,
      .form-actions,
      .btn-consult {
        display: none;
      }
      
      .generator-content {
        display: block;
      }
      
      .preview-container {
        padding: 0;
      }
      
      .preview-box {
        height: auto;
        overflow: visible;
        border: none;
        padding: 0;
      }
    }
    
    .tabs {
      display: flex;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    
    .tab {
      padding: 10px 15px;
      cursor: pointer;
      border: 1px solid var(--border-color);
      border-bottom: none;
      border-radius: 4px 4px 0 0;
      background-color: #f8f8f8;
      margin-right: 5px;
      margin-bottom: -1px;
    }
    
    .tab.active {
      background-color: white;
      border-color: var(--border-color);
      border-bottom-color: white;
      font-weight: bold;
      color: var(--secondary-color);
    }
    
    .tab-content {
      display: none;
      border-top: 1px solid var(--border-color);
      padding-top: 15px;
    }
    
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="generator-container">
    <div class="generator-header">
      <h1>CPA Engagement Letter Generator</h1>
      <p>Create a customized engagement letter for CPA services</p>
    </div>
    
    <div class="generator-content">
      <!-- Form Container -->
      <div class="form-container">
        <form id="cpaForm">
          <div class="tabs">
            <div class="tab active" data-tab="basic-info">Basic Info</div>
            <div class="tab" data-tab="services">Services</div>
            <div class="tab" data-tab="fees">Fees & Timeline</div>
            <div class="tab" data-tab="terms">Terms & Conditions</div>
          </div>
          
          <!-- Basic Info Tab -->
          <div class="tab-content active" id="basic-info">
            <div class="form-section">
              <h2 class="form-section-title">CPA Firm Information</h2>
              
              <div class="form-group">
                <label for="cpaFirmName">CPA Firm Name</label>
                <input type="text" id="cpaFirmName" class="form-input" value="Smith & Associates, CPAs">
              </div>
              
              <div class="form-group">
                <label for="cpaAddress">CPA Firm Address</label>
                <input type="text" id="cpaAddress" class="form-input" value="123 Financial Way, Suite 500, Accounting City, CA 90210">
              </div>
              
              <div class="form-group">
                <label for="cpaPhone">Phone Number</label>
                <input type="text" id="cpaPhone" class="form-input" value="(555) 123-4567">
              </div>
              
              <div class="form-group">
                <label for="cpaEmail">Email Address</label>
                <input type="email" id="cpaEmail" class="form-input" value="info@smithcpas.com">
              </div>
              
              <div class="form-group">
                <label for="cpaPartnerName">Partner Name</label>
                <input type="text" id="cpaPartnerName" class="form-input" value="John Smith, CPA">
              </div>
            </div>
            
            <div class="form-section">
              <h2 class="form-section-title">Client Information</h2>
              
              <div class="form-group">
                <label for="clientName">Client Name</label>
                <input type="text" id="clientName" class="form-input" value="XYZ Corporation">
              </div>
              
              <div class="form-group">
                <label for="clientAddress">Client Address</label>
                <input type="text" id="clientAddress" class="form-input" value="456 Business Blvd, Enterprise, CA 90211">
              </div>
              
              <div class="form-group">
                <label for="clientContact">Primary Contact Person</label>
                <input type="text" id="clientContact" class="form-input" value="Jane Smith, CFO">
              </div>
              
              <div class="form-group">
                <label for="entityType">Client Entity Type</label>
                <select id="entityType" class="form-input">
                  <option value="Corporation" selected>Corporation</option>
                  <option value="S-Corporation">S-Corporation</option>
                  <option value="LLC">Limited Liability Company (LLC)</option>
                  <option value="Partnership">Partnership</option>
                  <option value="SoleProprietorship">Sole Proprietorship</option>
                  <option value="NonProfit">Non-Profit Organization</option>
                  <option value="Individual">Individual</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="letterDate">Date of Letter</label>
                <input type="date" id="letterDate" class="form-input" value="2025-04-28">
              </div>
            </div>
          </div>
          
          <!-- Services Tab -->
          <div class="tab-content" id="services">
            <div class="form-section">
              <h2 class="form-section-title">Service Type</h2>
              
              <div class="form-group">
                <label>Primary Service Category</label>
                <div class="options-group">
                  <label class="option-item selected">
                    <input type="radio" name="serviceType" value="Tax" checked>
                    <div class="option-content">
                      <span class="option-label">Tax Services</span>
                      <span class="option-description">Tax return preparation and planning</span>
                    </div>
                  </label>
                  
                  <label class="option-item">
                    <input type="radio" name="serviceType" value="Audit">
                    <div class="option-content">
                      <span class="option-label">Audit & Attest</span>
                      <span class="option-description">Financial statement audits and reviews</span>
                    </div>
                  </label>
                  
                  <label class="option-item">
                    <input type="radio" name="serviceType" value="Advisory">
                    <div class="option-content">
                      <span class="option-label">Advisory Services</span>
                      <span class="option-description">Business consulting and financial advisory</span>
                    </div>
                  </label>
                  
                  <label class="option-item">
                    <input type="radio" name="serviceType" value="Bookkeeping">
                    <div class="option-content">
                      <span class="option-label">Bookkeeping</span>
                      <span class="option-description">Regular financial record-keeping</span>
                    </div>
                  </label>
                </div>
              </div>
              
              <div id="taxServiceDetails" class="service-details">
                <div class="form-group">
                  <label>Tax Returns to Prepare</label>
                  <div class="options-group">
                    <label class="option-item selected">
                      <input type="checkbox" name="taxReturns" value="Federal" checked>
                      <div class="option-content">
                        <span class="option-label">Federal Income Tax Returns</span>
                      </div>
                    </label>
                    
                    <label class="option-item selected">
                      <input type="checkbox" name="taxReturns" value="State" checked>
                      <div class="option-content">
                        <span class="option-label">State Income Tax Returns</span>
                      </div>
                    </label>
                    
                    <label class="option-item">
                      <input type="checkbox" name="taxReturns" value="Local">
                      <div class="option-content">
                        <span class="option-label">Local Tax Returns</span>
                      </div>
                    </label>
                    
                    <label class="option-item">
                      <input type="checkbox" name="taxReturns" value="Sales">
                      <div class="option-content">
                        <span class="option-label">Sales Tax Returns</span>
                      </div>
                    </label>
                    
                    <label class="option-item">
                      <input type="checkbox" name="taxReturns" value="Payroll">
                      <div class="option-content">
                        <span class="option-label">Payroll Tax Returns</span>
                      </div>
                    </label>
                  </div>
                </div>
                
                <div class="form-group">
                  <label for="taxYear">Tax Year</label>
                  <input type="text" id="taxYear" class="form-input" value="2024">
                </div>
              </div>
            </div>
            
            <div class="form-section">
              <h2 class="form-section-title">Service Exclusions</h2>
              
              <div class="form-group">
                <label for="serviceExclusions">Explicitly Excluded Services</label>
                <textarea id="serviceExclusions" class="form-input">1. Detecting fraud or other irregularities
2. Verifying the accuracy of information provided by the client
3. Filing extensions without specific authorization
4. Representing the client in audit or collection proceedings without a separate engagement
5. Preparing returns for related entities unless specifically engaged to do so</textarea>
              </div>
            </div>
          </div>
          
          <!-- Fees & Timeline Tab -->
          <div class="tab-content" id="fees">
            <div class="form-section">
              <h2 class="form-section-title">Fee Structure</h2>
              
              <div class="form-group">
                <label>Fee Arrangement</label>
                <div class="options-group">
                  <label class="option-item selected">
                    <input type="radio" name="feeStructure" value="Fixed" checked>
                    <div class="option-content">
                      <span class="option-label">Fixed Fee</span>
                      <span class="option-description">Set price for defined services</span>
                    </div>
                  </label>
                  
                  <label class="option-item">
                    <input type="radio" name="feeStructure" value="Hourly">
                    <div class="option-content">
                      <span class="option-label">Hourly Rate</span>
                      <span class="option-description">Billed based on time spent</span>
                    </div>
                  </label>
                  
                  <label class="option-item">
                    <input type="radio" name="feeStructure" value="Monthly">
                    <div class="option-content">
                      <span class="option-label">Monthly Retainer</span>
                      <span class="option-description">Regular monthly fee</span>
                    </div>
                  </label>
                </div>
              </div>
              
              <div id="fixedFeeDetails" class="fee-details">
                <div class="form-group">
                  <label for="fixedFeeAmount">Fixed Fee Amount</label>
                  <input type="text" id="fixedFeeAmount" class="form-input" value="$5,000">
                </div>
                
                <div class="form-group">
                  <label>Payment Schedule</label>
                  <div class="options-group">
                    <label class="option-item">
                      <input type="radio" name="paymentSchedule" value="Upfront">
                      <div class="option-content">
                        <span class="option-label">100% Upfront</span>
                      </div>
                    </label>
                    
                    <label class="option-item selected">
                      <input type="radio" name="paymentSchedule" value="Split" checked>
                      <div class="option-content">
                        <span class="option-label">50% Upfront, 50% Upon Completion</span>
                      </div>
                    </label>
                    
                    <label class="option-item">
                      <input type="radio" name="paymentSchedule" value="Completion">
                      <div class="option-content">
                        <span class="option-label">100% Upon Completion</span>
                      </div>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-section">
              <h2 class="form-section-title">Timeline</h2>
              
              <div class="form-group">
                <label for="startDate">Engagement Start Date</label>
                <input type="date" id="startDate" class="form-input" value="2025-05-01">
              </div>
              
              <div class="form-group">
                <label for="endDate">Estimated Completion Date</label>
                <input type="date" id="endDate" class="form-input" value="2025-06-30">
              </div>
              
              <div class="form-group">
                <label for="clientDeadline">Client Information Deadline</label>
                <input type="date" id="clientDeadline" class="form-input" value="2025-05-15">
              </div>
            </div>
          </div>
          
          <!-- Terms & Conditions Tab -->
          <div class="tab-content" id="terms">
            <div class="form-section">
              <h2 class="form-section-title">Legal Provisions</h2>
              
              <div class="form-group">
                <label for="governingState">Governing State Law</label>
                <select id="governingState" class="form-input">
                  <option value="Alabama">Alabama</option>
                  <option value="Alaska">Alaska</option>
                  <option value="Arizona">Arizona</option>
                  <option value="Arkansas">Arkansas</option>
                  <option value="California" selected>California</option>
                  <option value="Colorado">Colorado</option>
                  <option value="Connecticut">Connecticut</option>
                  <option value="Delaware">Delaware</option>
                  <option value="Florida">Florida</option>
                  <option value="Georgia">Georgia</option>
                  <option value="Hawaii">Hawaii</option>
                  <option value="Idaho">Idaho</option>
                  <option value="Illinois">Illinois</option>
                  <option value="Indiana">Indiana</option>
                  <option value="Iowa">Iowa</option>
                  <option value="Kansas">Kansas</option>
                  <option value="Kentucky">Kentucky</option>
                  <option value="Louisiana">Louisiana</option>
                  <option value="Maine">Maine</option>
                  <option value="Maryland">Maryland</option>
                  <option value="Massachusetts">Massachusetts</option>
                  <option value="Michigan">Michigan</option>
                  <option value="Minnesota">Minnesota</option>
                  <option value="Mississippi">Mississippi</option>
                  <option value="Missouri">Missouri</option>
                  <option value="Montana">Montana</option>
                  <option value="Nebraska">Nebraska</option>
                  <option value="Nevada">Nevada</option>
                  <option value="New Hampshire">New Hampshire</option>
                  <option value="New Jersey">New Jersey</option>
                  <option value="New Mexico">New Mexico</option>
                  <option value="New York">New York</option>
                  <option value="North Carolina">North Carolina</option>
                  <option value="North Dakota">North Dakota</option>
                  <option value="Ohio">Ohio</option>
                  <option value="Oklahoma">Oklahoma</option>
                  <option value="Oregon">Oregon</option>
                  <option value="Pennsylvania">Pennsylvania</option>
                  <option value="Rhode Island">Rhode Island</option>
                  <option value="South Carolina">South Carolina</option>
                  <option value="South Dakota">South Dakota</option>
                  <option value="Tennessee">Tennessee</option>
                  <option value="Texas">Texas</option>
                  <option value="Utah">Utah</option>
                  <option value="Vermont">Vermont</option>
                  <option value="Virginia">Virginia</option>
                  <option value="Washington">Washington</option>
                  <option value="West Virginia">West Virginia</option>
                  <option value="Wisconsin">Wisconsin</option>
                  <option value="Wyoming">Wyoming</option>
                </select>
              </div>
              
              <div class="form-group">
                <label>Dispute Resolution Method</label>
                <div class="options-group">
                  <label class="option-item">
                    <input type="radio" name="disputeResolution" value="Mediation">
                    <div class="option-content">
                      <span class="option-label">Mediation Only</span>
                    </div>
                  </label>
                  
                  <label class="option-item selected">
                    <input type="radio" name="disputeResolution" value="MediationArbitration" checked>
                    <div class="option-content">
                      <span class="option-label">Mediation then Arbitration</span>
                    </div>
                  </label>
                  
                  <label class="option-item">
                    <input type="radio" name="disputeResolution" value="Arbitration">
                    <div class="option-content">
                      <span class="option-label">Arbitration Only</span>
                    </div>
                  </label>
                  
                  <label class="option-item">
                    <input type="radio" name="disputeResolution" value="Litigation">
                    <div class="option-content">
                      <span class="option-label">Litigation</span>
                    </div>
                  </label>
                </div>
              </div>
            </div>
            
            <div class="form-section">
              <h2 class="form-section-title">Additional Terms</h2>
              
              <div class="form-group">
                <label for="additionalTerms">Additional Terms and Conditions</label>
                <textarea id="additionalTerms" class="form-input">This engagement letter constitutes the entire agreement between the parties with respect to the services described herein and supersedes all prior agreements, understandings, or representations. Any modification to this engagement letter must be in writing and signed by both parties.</textarea>
              </div>
            </div>
          </div>
          
          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" id="copyBtn" class="btn btn-copy">Copy Agreement</button>
            <span id="copyMessage" class="copy-message">Agreement copied!</span>
            <button type="button" id="downloadBtn" class="btn btn-download">Download as DOCX</button>
            <button type="reset" id="resetBtn" class="btn btn-reset">Reset Form</button>
          </div>
          
          <a href="#" class="btn-consult" onclick="Calendly.initPopupWidget({url: 'https://calendly.com/sergei-tokmakov/30-minute-zoom-meeting'});return false;">
            Schedule Legal Consultation
          </a>
        </form>
      </div>
      
      <!-- Preview Container -->
      <div class="preview-container">
        <div class="preview-header">
          <div class="preview-title">Agreement Preview</div>
          <div class="preview-note">Updates as you complete the form</div>
        </div>
        
        <div class="preview-box">
          <div class="document-template" id="agreementPreview">
            <!-- Document content will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Libraries for DOCX download -->
  <script src="https://cdn.jsdelivr.net/npm/docx@7.8.2/build/index.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  
  <!-- Calendly Integration -->
  <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
  <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('cpaForm');
      const preview = document.getElementById('agreementPreview');
      const copyBtn = document.getElementById('copyBtn');
      const copyMessage = document.getElementById('copyMessage');
      const downloadBtn = document.getElementById('downloadBtn');
      const resetBtn = document.getElementById('resetBtn');
      
      // Set current date if not already set
      if (!document.getElementById('letterDate').value) {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('letterDate').value = today;
      }
      
      // Format date from YYYY-MM-DD to readable format
      function formatDate(dateString) {
        if (!dateString) return '';
        
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      }
      
      // Tab navigation
      const tabs = document.querySelectorAll('.tab');
      const tabContents = document.querySelectorAll('.tab-content');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          
          // Remove active class from all tabs and contents
          tabs.forEach(t => t.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          
          // Add active class to selected tab and content
          this.classList.add('active');
          document.getElementById(tabId).classList.add('active');
        });
      });
      
      // Option items toggle
      const optionItems = document.querySelectorAll('.option-item');
      
      optionItems.forEach(item => {
        item.addEventListener('click', function(e) {
          const input = this.querySelector('input');
          
          // Don't toggle if clicked directly on input
          if (e.target === input) return;
          
          if (input.type === 'radio') {
            // For radio buttons
            const name = input.name;
            document.querySelectorAll(`input[name="${name}"]`).forEach(radio => {
              radio.checked = false;
              radio.closest('.option-item').classList.remove('selected');
            });
            input.checked = true;
            this.classList.add('selected');
          } else {
            // For checkboxes
            input.checked = !input.checked;
            this.classList.toggle('selected', input.checked);
          }
          
          // Handle service type change
          if (input.name === 'serviceType') {
            updateServiceDetails(input.value);
          }
          
          // Handle fee structure change
          if (input.name === 'feeStructure') {
            updateFeeDetails(input.value);
          }
          
          // Update preview
          updatePreview();
        });
      });
      
      // Service type details toggle
      function updateServiceDetails(serviceType) {
        // Hide all service details
        document.querySelectorAll('.service-details').forEach(details => {
          details.style.display = 'none';
        });
        
        // Show selected service details
        if (serviceType === 'Tax') {
          document.getElementById('taxServiceDetails').style.display = 'block';
        }
      }
      
      // Fee structure details toggle
      function updateFeeDetails(feeStructure) {
        // Hide all fee details
        document.querySelectorAll('.fee-details').forEach(details => {
          details.style.display = 'none';
        });
        
        // Show selected fee details
        if (feeStructure === 'Fixed') {
          document.getElementById('fixedFeeDetails').style.display = 'block';
        }
      }
      
      // Update preview on form input changes
      form.addEventListener('input', function() {
        updatePreview();
        copyMessage.style.display = 'none';
      });
      
      // Handle form inputs with radio/checkbox changes
      document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
        input.addEventListener('change', function() {
          updatePreview();
          copyMessage.style.display = 'none';
        });
      });
      
      // Reset form button
      resetBtn.addEventListener('click', function() {
        setTimeout(() => {
          // Reset option item selections
          document.querySelectorAll('.option-item').forEach(item => {
            const input = item.querySelector('input');
            if (input) {
              item.classList.toggle('selected', input.checked);
            }
          });
          
          // Reset service and fee details
          updateServiceDetails('Tax');
          updateFeeDetails('Fixed');
          
          // Update preview
          updatePreview();
          copyMessage.style.display = 'none';
        }, 10);
      });
      
      // Copy agreement to clipboard
      copyBtn.addEventListener('click', function() {
        const agreementText = preview.innerText;
        
        navigator.clipboard.writeText(agreementText)
          .then(() => {
            copyMessage.style.display = 'inline-block';
            setTimeout(() => {
              copyMessage.style.display = 'none';
            }, 3000);
          })
          .catch(err => {
            console.error('Could not copy text:', err);
            alert('Failed to copy text. Please try manually selecting and copying the text.');
          });
      });
      
      // Download as DOCX
      downloadBtn.addEventListener('click', function() {
        try {
          // Access docx library
          const docx = window.docx;
          if (!docx) {
            throw new Error("DOCX library not loaded");
          }
          
          const clientName = document.getElementById('clientName').value || 'Client';
          const filename = `CPA_Engagement_Letter_${clientName.replace(/[^a-z0-9]/gi, '_')}.docx`;
          
          // Create document sections
          const sections = [];
          
          // Get all needed values from form
          const cpaFirmName = document.getElementById('cpaFirmName').value;
          const cpaAddress = document.getElementById('cpaAddress').value;
          const clientAddress = document.getElementById('clientAddress').value;
          const clientContact = document.getElementById('clientContact').value;
          const letterDate = formatDate(document.getElementById('letterDate').value);
          const cpaPartnerName = document.getElementById('cpaPartnerName').value;
          
          // Create title
          sections.push(
            new docx.Paragraph({
              alignment: docx.AlignmentType.CENTER,
              spacing: {
                before: 200,
                after: 200
              },
              children: [
                new docx.TextRun({
                  text: "ENGAGEMENT LETTER",
                  bold: true,
                  size: 28
                })
              ]
            })
          );
          
          // Create letterhead and date
          sections.push(
            new docx.Paragraph({
              alignment: docx.AlignmentType.LEFT,
              spacing: {
                before: 100,
                after: 200
              },
              children: [
                new docx.TextRun({
                  text: cpaFirmName,
                  bold: true,
                  size: 24
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              alignment: docx.AlignmentType.LEFT,
              spacing: {
                before: 100,
                after: 300
              },
              children: [
                new docx.TextRun({
                  text: letterDate,
                  size: 24
                })
              ]
            })
          );
          
          // Client address
          sections.push(
            new docx.Paragraph({
              children: [
                new docx.TextRun({
                  text: clientName
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              children: [
                new docx.TextRun({
                  text: clientAddress
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              spacing: {
                after: 200
              },
              children: [
                new docx.TextRun({
                  text: `Attention: ${clientContact}`
                })
              ]
            })
          );
          
          // Get the rest of the agreement text (main body)
          const mainSections = document.querySelectorAll('#agreementPreview .document-section');
          mainSections.forEach(section => {
            // Add section title
            const titleElement = section.querySelector('.section-title');
            if (titleElement) {
              sections.push(
                new docx.Paragraph({
                  spacing: {
                    before: 200,
                    after: 100
                  },
                  children: [
                    new docx.TextRun({
                      text: titleElement.textContent,
                      bold: true,
                      size: 24
                    })
                  ]
                })
              );
            }
            
            // Add section paragraphs
            const contentParagraphs = section.querySelectorAll('.section-content p');
            contentParagraphs.forEach(paragraph => {
              sections.push(
                new docx.Paragraph({
                  spacing: {
                    before: 100,
                    after: 100
                  },
                  children: [
                    new docx.TextRun({
                      text: paragraph.textContent
                    })
                  ]
                })
              );
            });
          });
          
          // Add signature section
          sections.push(
            new docx.Paragraph({
              spacing: {
                before: 300,
                after: 100
              },
              children: [
                new docx.TextRun({
                  text: "Sincerely,"
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              spacing: {
                before: 200,
                after: 300
              },
              children: [
                new docx.TextRun({
                  text: cpaPartnerName + "\n" + cpaFirmName
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              spacing: {
                before: 300,
                after: 100
              },
              children: [
                new docx.TextRun({
                  text: "ACCEPTED AND AGREED:"
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              spacing: {
                before: 200,
                after: 100
              },
              children: [
                new docx.TextRun({
                  text: "___________________________________"
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              spacing: {
                before: 100,
                after: 100
              },
              children: [
                new docx.TextRun({
                  text: clientName
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              spacing: {
                before: 100,
                after: 100
              },
              children: [
                new docx.TextRun({
                  text: `By: ${clientContact}`
                })
              ]
            })
          );
          
          sections.push(
            new docx.Paragraph({
              spacing: {
                before: 100,
                after: 100
              },
              children: [
                new docx.TextRun({
                  text: "Date: _____________________"
                })
              ]
            })
          );
          
          // Create the document with all sections
          const doc = new docx.Document({
            sections: [{
              properties: {
                page: {
                  margin: {
                    top: 1440, // 1 inch (in twips)
                    right: 1440,
                    bottom: 1440,
                    left: 1440
                  }
                }
              },
              children: sections
            }]
          });
          
          // Generate and save DOCX file
          docx.Packer.toBlob(doc)
            .then(blob => {
              window.saveAs(blob, filename);
            })
            .catch(error => {
              console.error("Error saving document:", error);
              alert("Failed to generate document. Please try again.");
            });
        } catch (error) {
          console.error("Error creating document:", error);
          alert("Failed to generate document. Please try again.");
        }
      });
      
      // Update preview function - generates the preview HTML
      function updatePreview() {
        // Get values from form
        const cpaFirmName = document.getElementById('cpaFirmName').value;
        const cpaAddress = document.getElementById('cpaAddress').value;
        const cpaPhone = document.getElementById('cpaPhone').value;
        const cpaEmail = document.getElementById('cpaEmail').value;
        const cpaPartnerName = document.getElementById('cpaPartnerName').value;
        
        const clientName = document.getElementById('clientName').value;
        const clientAddress = document.getElementById('clientAddress').value;
        const clientContact = document.getElementById('clientContact').value;
        const entityType = document.getElementById('entityType').value;
        const letterDate = formatDate(document.getElementById('letterDate').value);
        
        // Get service type
        const serviceType = document.querySelector('input[name="serviceType"]:checked').value;
        
        // Get tax returns if tax service
        let taxReturns = [];
        if (serviceType === 'Tax') {
          document.querySelectorAll('input[name="taxReturns"]:checked').forEach(checkbox => {
            taxReturns.push(checkbox.value);
          });
        }
        const taxYear = document.getElementById('taxYear').value;
        
        // Get service exclusions
        const serviceExclusions = document.getElementById('serviceExclusions').value;
        
        // Get fee structure
        const feeStructure = document.querySelector('input[name="feeStructure"]:checked').value;
        let feeDetails = '';
        
        if (feeStructure === 'Fixed') {
          const fixedFeeAmount = document.getElementById('fixedFeeAmount').value;
          const paymentSchedule = document.querySelector('input[name="paymentSchedule"]:checked').value;
          
          feeDetails = `Our fee for the services described above will be ${fixedFeeAmount}. `;
          
          if (paymentSchedule === 'Upfront') {
            feeDetails += 'The full amount is due upon signing this engagement letter.';
          } else if (paymentSchedule === 'Split') {
            feeDetails += '50% of the fee is due upon signing this engagement letter, with the remaining 50% due upon completion of the engagement.';
          } else {
            feeDetails += 'The full amount is due upon completion of the engagement.';
          }
        } else if (feeStructure === 'Hourly') {
          feeDetails = 'Our fees will be based on the time spent by our personnel. We will provide you with an estimate of our fees after we have had the opportunity to assess the scope of work required.';
        } else if (feeStructure === 'Monthly') {
          feeDetails = 'Our fee for the services described above will be billed as a monthly retainer. The amount will be determined based on the scope of services required.';
        }
        
        // Get timeline
        const startDate = formatDate(document.getElementById('startDate').value);
        const endDate = formatDate(document.getElementById('endDate').value);
        const clientDeadline = formatDate(document.getElementById('clientDeadline').value);
        
        // Get legal provisions
        const governingState = document.getElementById('governingState').value;
        const disputeResolution = document.querySelector('input[name="disputeResolution"]:checked').value;
        
        let disputeResolutionText = '';
        if (disputeResolution === 'Mediation') {
          disputeResolutionText = 'Any dispute or claim arising out of or relating to this engagement shall first be submitted to mediation.';
        } else if (disputeResolution === 'MediationArbitration') {
          disputeResolutionText = 'Disputes shall first be submitted to mediation administered by the American Arbitration Association. If mediation is unsuccessful, the dispute shall be settled by binding arbitration.';
        } else if (disputeResolution === 'Arbitration') {
          disputeResolutionText = 'Any dispute or claim arising out of or relating to this engagement shall be settled by binding arbitration administered by the American Arbitration Association.';
        } else {
          disputeResolutionText = 'Any dispute or claim arising out of or relating to this engagement may be resolved through litigation in the appropriate courts.';
        }
        
        // Get additional terms
        const additionalTerms = document.getElementById('additionalTerms').value;
        
        // Build the preview HTML
        let previewHtml = `
          <div class="document-title">CPA ENGAGEMENT LETTER</div>
          
          <div class="document-section" id="section-letterhead">
            <div class="section-content">
              <p><strong>${cpaFirmName}</strong></p>
              <p>${cpaAddress}</p>
              <p>Phone: ${cpaPhone} | Email: ${cpaEmail}</p>
              <p>${letterDate}</p>
              
              <p style="margin-top: 20px;">${clientName}</p>
              <p>${clientAddress}</p>
              <p>Attention: ${clientContact}</p>
              
              <p style="margin-top: 20px;">Re: Engagement Letter for Professional Services</p>
            </div>
          </div>
          
          <div class="document-section" id="section-intro">
            <div class="section-content">
              <p>Dear ${clientContact.split(',')[0]}:</p>
              
              <p>Thank you for selecting ${cpaFirmName} ("we", "us", "our") to provide professional services to ${clientName} ("you", "your", "Client"). This engagement letter outlines the terms and conditions of our engagement, as well as the nature and limitations of the services we will provide.</p>
            </div>
          </div>
          
          <div class="document-section" id="section-services">
            <div class="section-title">1. SCOPE OF SERVICES</div>
            <div class="section-content">
              ${serviceType === 'Tax' ? `
                <p>We will prepare the following tax returns for ${clientName} for the ${taxYear} tax year:</p>
                <p>${taxReturns.map(type => {
                  if (type === 'Federal') return 'Federal income tax returns';
                  if (type === 'State') return 'State income tax returns';
                  if (type === 'Local') return 'Local tax returns';
                  if (type === 'Sales') return 'Sales tax returns';
                  if (type === 'Payroll') return 'Payroll tax returns';
                  return type;
                }).join('<br>')}</p>
              ` : serviceType === 'Audit' ? `
                <p>We will perform an examination of the financial statements of ${clientName} in accordance with auditing standards generally accepted in the United States of America.</p>
              ` : serviceType === 'Advisory' ? `
                <p>We will provide advisory services to ${clientName} in connection with business and financial matters as requested and agreed upon.</p>
              ` : `
                <p>We will provide bookkeeping services to ${clientName} including preparation of financial statements, bank reconciliations, and other record-keeping functions as agreed upon.</p>
              `}
              
              <p><strong>Service Exclusions:</strong> Our engagement specifically excludes the following services:</p>
              <p>${serviceExclusions}</p>
            </div>
          </div>
          
          <div class="document-section" id="section-fees">
            <div class="section-title">2. FEES AND BILLING</div>
            <div class="section-content">
              <p>${feeDetails}</p>
              
              <p>Out-of-pocket expenses such as database charges, travel expenses, and courier fees will be billed in addition to our professional fees unless specified otherwise.</p>
            </div>
          </div>
          
          <div class="document-section" id="section-timeline">
            <div class="section-title">3. TIMELINE AND DELIVERABLES</div>
            <div class="section-content">
              <p>This engagement will begin on ${startDate} and is expected to be completed by ${endDate}.</p>
              
              <p>You must provide all information necessary for the completion of our services by ${clientDeadline}. Failure to provide required information in a timely manner may result in delays in the completion of our services.</p>
            </div>
          </div>
          
          <div class="document-section" id="section-responsibilities">
            <div class="section-title">4. RESPONSIBILITIES</div>
            <div class="section-content">
              <p><strong>Client Responsibilities:</strong> You are responsible for the accuracy and completeness of all information provided to us. You agree to provide us with accurate and complete information necessary to perform the services outlined in this engagement letter.</p>
              
              <p><strong>Our Responsibilities:</strong> We will perform our services in accordance with applicable professional standards. We will maintain client confidentiality and provide timely communication regarding the progress of our services.</p>
            </div>
          </div>
          
          <div class="document-section" id="section-legal">
            <div class="section-title">5. LEGAL PROVISIONS</div>
            <div class="section-content">
              <p><strong>Governing Law:</strong> This engagement letter shall be governed by and construed in accordance with the laws of the State of ${governingState}, without giving effect to any choice or conflict of law provision or rule.</p>
              
              <p><strong>Dispute Resolution:</strong> ${disputeResolutionText}</p>
              
              <p><strong>Limitation of Liability:</strong> Our liability to you for any claim arising from our services shall not exceed the fees paid by you for the services that are the subject of the claim.</p>
              
              <p><strong>Termination:</strong> Either party may terminate this engagement upon 30 days' written notice to the other party. Upon termination, you shall be obligated to compensate us for all time expended and to reimburse us for all out-of-pocket expenditures through the date of termination.</p>
            </div>
          </div>
          
          <div class="document-section" id="section-additional">
            <div class="section-title">6. ADDITIONAL TERMS</div>
            <div class="section-content">
              <p>${additionalTerms}</p>
            </div>
          </div>
          
          <div class="document-section" id="section-acceptance">
            <div class="section-title">7. ACCEPTANCE</div>
            <div class="section-content">
              <p>If the services and terms outlined in this engagement letter are in accordance with your understanding of our agreement, please sign and return a copy to us.</p>
              
              <p>We appreciate the opportunity to be of service to you and look forward to working with you and your team.</p>
            </div>
          </div>
          
          <div class="document-section" id="section-signature">
            <div class="section-content">
              <p style="margin-top: 20px;">Sincerely,</p>
              <p style="margin-top: 20px;">${cpaPartnerName}</p>
              <p>${cpaFirmName}</p>
              
              <p style="margin-top: 40px;"><strong>ACCEPTED AND AGREED:</strong></p>
              <p style="margin-top: 20px;">____________________________________</p>
              <p>${clientName}</p>
              <p>By: ${clientContact}</p>
              <p style="margin-top: 10px;">Date: ______________________________</p>
            </div>
          </div>
        `;
        
        // Update the preview
        preview.innerHTML = previewHtml;
      }
      
      // Initialize preview
      updatePreview();
      
      // Initialize service and fee details visibility
      updateServiceDetails('Tax');
      updateFeeDetails('Fixed');
    });
  </script>
</body>
</html>
