<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>California Employment Agreement Generator | terms.law</title>
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- React 17 (more stable) -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.18.13/babel.min.js"></script>
    
    <!-- Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
    <!-- Error logging -->
    <script>
        // Set up error handlers
        window.addEventListener('error', function(event) {
            console.error('Error caught:', event.error);
            logErrorToPage('JavaScript Error: ' + event.error.message);
        });
        
        function logErrorToPage(message) {
            const rootElement = document.getElementById('root');
            if (rootElement) {
                const errorDiv = document.createElement('div');
                errorDiv.style.backgroundColor = '#fee2e2';
                errorDiv.style.color = '#b91c1c';
                errorDiv.style.padding = '1rem';
                errorDiv.style.margin = '1rem 0';
                errorDiv.style.borderRadius = '0.375rem';
                errorDiv.style.borderLeft = '4px solid #ef4444';
                errorDiv.innerHTML = `
                    <h3 style="margin-top:0;margin-bottom:0.5rem;">Error Detected</h3>
                    <p style="margin-bottom:0.5rem;">${message}</p>
                    <p style="margin-bottom:0;">Please try the <a href="fallback.html" style="color:#3b82f6;text-decoration:underline;">simplified version</a> if this persists.</p>
                `;
                
                // Add it after the loading message
                const loadingMessage = rootElement.querySelector('div[style*="display: flex"]');
                if (loadingMessage) {
                    loadingMessage.after(errorDiv);
                } else {
                    rootElement.appendChild(errorDiv);
                }
            }
        }
    </script>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; color: #3b82f6;">
            <div style="text-align: center;">
                <div>Loading California Employment Agreement Generator...</div>
                <div style="margin-top: 1rem;">If this message persists, please refresh the page.</div>
            </div>
        </div>
    </div>
    
    <!-- Word Document Generator Script -->
    <script type="text/babel" src="docx-generator.js"></script>
    
    <!-- California Tooltips Script -->
    <script type="text/babel" src="california-tooltips.js"></script>
    
    <!-- Main Application Script -->
    <script type="text/babel" src="california-employment-agreement.js"></script>
    
    <!-- App Renderer Script -->
    <script type="text/babel">
        // Wait for all components to load then render the app
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                try {
                    // Check if App component exists (should be made global by the patch)
                    if (typeof App === 'undefined') {
                        throw new Error("App component not available. Please check browser console for details.");
                    }
                    
                    // Render the app
                    ReactDOM.render(
                        React.createElement(App),
                        document.getElementById('root')
                    );
                    
                    // Initialize Feather icons
                    setTimeout(function() {
                        if (window.feather) {
                            window.feather.replace();
                        }
                    }, 500);
                    
                    console.log("App rendered successfully");
                } catch (error) {
                    console.error("Error rendering application:", error);
                    logErrorToPage(error.message);
                }
            }, 1000);
        });
    </script>
    
    <!-- Automatic fallback if main version doesn't load -->
    <script>
        setTimeout(function() {
            const rootElement = document.getElementById('root');
            const loadingMessage = rootElement.querySelector('div[style*="display: flex"]');
            
            if (loadingMessage && rootElement.contains(loadingMessage)) {
                console.log("Application failed to load after timeout, redirecting to fallback");
                window.location.href = "fallback.html";
            }
        }, 8000);
    </script>
    
    <!-- Calendly Integration -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
    <script type="text/javascript">
        window.onload = function() { 
            Calendly.initBadgeWidget({ 
                url: 'https://calendly.com/sergei-tokmakov/30-minute-zoom-meeting?hide_gdpr_banner=1', 
                text: 'Schedule time with me', 
                color: '#0069ff', 
                textColor: '#ffffff' 
            }); 
        }
    </script>
</body>
</html>