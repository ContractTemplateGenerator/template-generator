<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Border Issue Spotter | Terms.Law</title>
    <meta name="description" content="Identify withholding issues, IP enforceability concerns, and labor law considerations for international equity-for-services arrangements.">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-901N2Y3CDZ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-901N2Y3CDZ');
    </script>

    <style>
        :root {
            --bg-dark: #0a0f1a;
            --bg-card: #111827;
            --bg-card-hover: #1a2332;
            --bg-input: #1f2937;
            --accent-blue: #3b82f6;
            --accent-blue-hover: #2563eb;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --accent-cyan: #06b6d4;
            --accent-yellow: #eab308;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --border-color: #1f2937;
            --border-focus: #3b82f6;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-blue);
            text-decoration: none;
        }

        .logo span { color: var(--text-secondary); font-weight: 400; }

        .breadcrumbs {
            padding: 1rem 2rem;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
        }

        .breadcrumbs-content {
            max-width: 1400px;
            margin: 0 auto;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .breadcrumbs a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .breadcrumbs a:hover { color: var(--accent-blue); }
        .breadcrumbs span { color: var(--text-primary); }

        .main-layout {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            min-height: calc(100vh - 120px);
        }

        .sidebar {
            width: 280px;
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            padding: 1.5rem;
            position: sticky;
            top: 120px;
            height: calc(100vh - 120px);
            overflow-y: auto;
        }

        .sidebar-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .sidebar-nav { list-style: none; }
        .sidebar-nav li { margin-bottom: 0.25rem; }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .sidebar-nav a:hover {
            background: var(--bg-input);
            color: var(--text-primary);
        }

        .sidebar-nav a.active {
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent-blue);
        }

        .sidebar-nav .icon { width: 20px; height: 20px; opacity: 0.7; }
        .sidebar-divider { height: 1px; background: var(--border-color); margin: 1.5rem 0; }

        .main-content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        .page-header { margin-bottom: 2rem; }

        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .page-subtitle { color: var(--text-secondary); }

        @media (max-width: 900px) {
            .sidebar { display: none; }
            .main-content { padding: 1rem; }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 900px) {
            .form-grid { grid-template-columns: 1fr; }
        }

        .form-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .form-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-card-title .icon { color: var(--accent-cyan); }

        .form-group { margin-bottom: 1.25rem; }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--border-focus);
        }

        .form-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.25rem;
            padding-right: 2.5rem;
        }

        .form-hint { font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem; }

        .btn-primary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem 1.5rem;
            background: var(--accent-blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            margin-top: 1.5rem;
        }

        .btn-primary:hover { background: var(--accent-blue-hover); }

        .btn-secondary {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: var(--bg-input);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: var(--bg-card-hover);
            color: var(--text-primary);
        }

        .output-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            display: none;
        }

        .output-section.visible { display: block; }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .output-title { font-size: 1.25rem; font-weight: 600; }
        .output-actions { display: flex; gap: 0.5rem; }

        .risk-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 600px) {
            .risk-summary { grid-template-columns: 1fr; }
        }

        .risk-card {
            background: var(--bg-input);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .risk-card.high { border-left: 3px solid var(--accent-red); }
        .risk-card.medium { border-left: 3px solid var(--accent-orange); }
        .risk-card.low { border-left: 3px solid var(--accent-green); }

        .risk-count {
            font-size: 2rem;
            font-weight: 700;
        }

        .risk-card.high .risk-count { color: var(--accent-red); }
        .risk-card.medium .risk-count { color: var(--accent-orange); }
        .risk-card.low .risk-count { color: var(--accent-green); }

        .risk-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .issue-category {
            margin-bottom: 1.5rem;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .category-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .category-icon.tax { background: rgba(239, 68, 68, 0.15); color: var(--accent-red); }
        .category-icon.ip { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }
        .category-icon.labor { background: rgba(245, 158, 11, 0.15); color: var(--accent-orange); }
        .category-icon.compliance { background: rgba(6, 182, 212, 0.15); color: var(--accent-cyan); }

        .category-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .issue-item {
            background: var(--bg-input);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            gap: 1rem;
        }

        .issue-severity {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .issue-severity.high { background: var(--accent-red); }
        .issue-severity.medium { background: var(--accent-orange); }
        .issue-severity.low { background: var(--accent-green); }

        .issue-content { flex: 1; }

        .issue-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .issue-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .issue-action {
            font-size: 0.85rem;
            color: var(--accent-blue);
            font-weight: 500;
        }

        .recommendations {
            background: var(--bg-input);
            border-radius: 8px;
            padding: 1.5rem;
            border-left: 3px solid var(--accent-green);
        }

        .recommendations-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-green);
            margin-bottom: 1rem;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }

        .recommendation-icon {
            width: 20px;
            height: 20px;
            color: var(--accent-green);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .recommendation-text {
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="../../" class="logo">Terms<span>.Law</span></a>
        </div>
    </header>

    <nav class="breadcrumbs">
        <div class="breadcrumbs-content">
            <a href="../../">Home</a> &gt;
            <a href="../">Equity for Services</a> &gt;
            <a href="./">Tools</a> &gt;
            <span>Cross-Border Spotter</span>
        </div>
    </nav>

    <div class="main-layout">
        <aside class="sidebar">
            <h3 class="sidebar-title">Tools</h3>
            <ul class="sidebar-nav">
                <li>
                    <a href="./deal-builder.html">
                        <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Deal Builder
                    </a>
                </li>
                <li>
                    <a href="./vesting-builder.html">
                        <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Vesting Builder
                    </a>
                </li>
                <li>
                    <a href="./buyout-generator.html">
                        <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Buyout Generator
                    </a>
                </li>
                <li>
                    <a href="./document-recommender.html">
                        <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                        </svg>
                        Document Recommender
                    </a>
                </li>
                <li>
                    <a href="./ip-addendum.html">
                        <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                        </svg>
                        IP Addendum
                    </a>
                </li>
                <li>
                    <a href="./cross-border-spotter.html" class="active">
                        <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Cross-Border Spotter
                    </a>
                </li>
            </ul>

            <div class="sidebar-divider"></div>

            <h3 class="sidebar-title">Hub</h3>
            <ul class="sidebar-nav">
                <li>
                    <a href="../">
                        <svg class="icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        Back to Hub
                    </a>
                </li>
            </ul>
        </aside>

        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">Cross-Border Issue Spotter</h1>
                <p class="page-subtitle">Identify potential tax, IP, labor, and compliance issues for international equity arrangements</p>
            </div>

            <div class="form-grid">
                <div class="form-card">
                    <h2 class="form-card-title">
                        <svg class="icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Service Provider Location
                    </h2>

                    <div class="form-group">
                        <label class="form-label">Service Provider Country</label>
                        <select id="providerCountry" class="form-select">
                            <option value="">Select country...</option>
                            <option value="CA">Canada</option>
                            <option value="UK">United Kingdom</option>
                            <option value="DE">Germany</option>
                            <option value="FR">France</option>
                            <option value="NL">Netherlands</option>
                            <option value="AU">Australia</option>
                            <option value="IN">India</option>
                            <option value="PH">Philippines</option>
                            <option value="MX">Mexico</option>
                            <option value="BR">Brazil</option>
                            <option value="IL">Israel</option>
                            <option value="SG">Singapore</option>
                            <option value="JP">Japan</option>
                            <option value="CN">China</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Provider Tax Residency Status</label>
                        <select id="taxResidency" class="form-select">
                            <option value="resident">Tax Resident of Selected Country</option>
                            <option value="non-resident">Non-Resident / Digital Nomad</option>
                            <option value="dual">Dual Tax Residency</option>
                            <option value="unknown">Unknown</option>
                        </select>
                    </div>
                </div>

                <div class="form-card">
                    <h2 class="form-card-title">
                        <svg class="icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        US Entity Details
                    </h2>

                    <div class="form-group">
                        <label class="form-label">US Entity State of Formation</label>
                        <select id="entityState" class="form-select">
                            <option value="">Select state...</option>
                            <option value="DE">Delaware</option>
                            <option value="CA">California</option>
                            <option value="NY">New York</option>
                            <option value="TX">Texas</option>
                            <option value="FL">Florida</option>
                            <option value="WA">Washington</option>
                            <option value="WY">Wyoming</option>
                            <option value="NV">Nevada</option>
                            <option value="other">Other State</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Entity Type</label>
                        <select id="entityType" class="form-select">
                            <option value="c-corp">C Corporation</option>
                            <option value="s-corp">S Corporation</option>
                            <option value="llc">LLC</option>
                        </select>
                    </div>
                </div>

                <div class="form-card">
                    <h2 class="form-card-title">
                        <svg class="icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Equity & Compensation
                    </h2>

                    <div class="form-group">
                        <label class="form-label">Equity Type</label>
                        <select id="equityType" class="form-select">
                            <option value="">Select equity type...</option>
                            <option value="common-stock">Common Stock</option>
                            <option value="restricted-stock">Restricted Stock</option>
                            <option value="stock-options">Stock Options (ISO/NSO)</option>
                            <option value="membership-units">LLC Membership Units</option>
                            <option value="profits-interest">Profits Interest</option>
                            <option value="phantom">Phantom Equity / SARs</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Estimated Equity Value</label>
                        <select id="equityValue" class="form-select">
                            <option value="under10k">Under $10,000</option>
                            <option value="10k-50k">$10,000 - $50,000</option>
                            <option value="50k-100k">$50,000 - $100,000</option>
                            <option value="over100k">Over $100,000</option>
                        </select>
                    </div>
                </div>

                <div class="form-card">
                    <h2 class="form-card-title">
                        <svg class="icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"/>
                        </svg>
                        Payment Method
                    </h2>

                    <div class="form-group">
                        <label class="form-label">How will cash compensation be paid?</label>
                        <select id="paymentMethod" class="form-select">
                            <option value="none">No Cash Compensation (Equity Only)</option>
                            <option value="wire">Wire Transfer (USD)</option>
                            <option value="wire-local">Wire Transfer (Local Currency)</option>
                            <option value="paypal">PayPal / Payment Platform</option>
                            <option value="crypto">Cryptocurrency</option>
                            <option value="payroll">Through Payroll Provider (EOR/PEO)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Relationship Type</label>
                        <select id="relationshipType" class="form-select">
                            <option value="contractor">Independent Contractor</option>
                            <option value="employee-eor">Employee via EOR/PEO</option>
                            <option value="advisor">Advisor</option>
                            <option value="cofounder">Co-Founder</option>
                        </select>
                    </div>
                </div>
            </div>

            <button class="btn-primary" onclick="analyzeIssues()">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
                Analyze Cross-Border Issues
            </button>

            <div id="outputSection" class="output-section">
                <div class="output-header">
                    <h2 class="output-title">Cross-Border Issue Analysis</h2>
                    <div class="output-actions">
                        <button class="btn-secondary" onclick="copyOutput()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                            </svg>
                            Copy
                        </button>
                        <button class="btn-secondary" onclick="downloadOutput()">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                            </svg>
                            Download
                        </button>
                    </div>
                </div>

                <div id="riskSummary" class="risk-summary"></div>

                <div id="taxIssues" class="issue-category"></div>

                <div id="ipIssues" class="issue-category"></div>

                <div id="laborIssues" class="issue-category"></div>

                <div id="complianceIssues" class="issue-category"></div>

                <div id="recommendations" class="recommendations"></div>
            </div>
        </main>
    </div>

    <script>
        const countryData = {
            'CA': {
                name: 'Canada',
                taxTreaty: true,
                withholdingRate: 15,
                ipProtection: 'strong',
                laborRisk: 'medium',
                currency: 'CAD'
            },
            'UK': {
                name: 'United Kingdom',
                taxTreaty: true,
                withholdingRate: 15,
                ipProtection: 'strong',
                laborRisk: 'high',
                currency: 'GBP'
            },
            'DE': {
                name: 'Germany',
                taxTreaty: true,
                withholdingRate: 15,
                ipProtection: 'strong',
                laborRisk: 'high',
                currency: 'EUR'
            },
            'FR': {
                name: 'France',
                taxTreaty: true,
                withholdingRate: 15,
                ipProtection: 'strong',
                laborRisk: 'high',
                currency: 'EUR'
            },
            'NL': {
                name: 'Netherlands',
                taxTreaty: true,
                withholdingRate: 15,
                ipProtection: 'strong',
                laborRisk: 'high',
                currency: 'EUR'
            },
            'AU': {
                name: 'Australia',
                taxTreaty: true,
                withholdingRate: 15,
                ipProtection: 'strong',
                laborRisk: 'medium',
                currency: 'AUD'
            },
            'IN': {
                name: 'India',
                taxTreaty: true,
                withholdingRate: 15,
                ipProtection: 'medium',
                laborRisk: 'low',
                currency: 'INR'
            },
            'PH': {
                name: 'Philippines',
                taxTreaty: true,
                withholdingRate: 25,
                ipProtection: 'medium',
                laborRisk: 'medium',
                currency: 'PHP'
            },
            'MX': {
                name: 'Mexico',
                taxTreaty: true,
                withholdingRate: 10,
                ipProtection: 'medium',
                laborRisk: 'high',
                currency: 'MXN'
            },
            'BR': {
                name: 'Brazil',
                taxTreaty: false,
                withholdingRate: 30,
                ipProtection: 'medium',
                laborRisk: 'high',
                currency: 'BRL'
            },
            'IL': {
                name: 'Israel',
                taxTreaty: true,
                withholdingRate: 25,
                ipProtection: 'strong',
                laborRisk: 'medium',
                currency: 'ILS'
            },
            'SG': {
                name: 'Singapore',
                taxTreaty: true,
                withholdingRate: 15,
                ipProtection: 'strong',
                laborRisk: 'low',
                currency: 'SGD'
            },
            'JP': {
                name: 'Japan',
                taxTreaty: true,
                withholdingRate: 10,
                ipProtection: 'strong',
                laborRisk: 'high',
                currency: 'JPY'
            },
            'CN': {
                name: 'China',
                taxTreaty: true,
                withholdingRate: 10,
                ipProtection: 'low',
                laborRisk: 'high',
                currency: 'CNY'
            },
            'other': {
                name: 'Other Country',
                taxTreaty: false,
                withholdingRate: 30,
                ipProtection: 'unknown',
                laborRisk: 'unknown',
                currency: 'USD'
            }
        };

        function analyzeIssues() {
            const country = document.getElementById('providerCountry').value;
            const taxResidency = document.getElementById('taxResidency').value;
            const entityState = document.getElementById('entityState').value;
            const entityType = document.getElementById('entityType').value;
            const equityType = document.getElementById('equityType').value;
            const equityValue = document.getElementById('equityValue').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const relationshipType = document.getElementById('relationshipType').value;

            if (!country || !equityType) {
                alert('Please select at least the service provider country and equity type');
                return;
            }

            const data = countryData[country] || countryData['other'];

            const issues = {
                tax: [],
                ip: [],
                labor: [],
                compliance: []
            };

            // Tax Issues
            if (!data.taxTreaty) {
                issues.tax.push({
                    severity: 'high',
                    title: 'No US Tax Treaty',
                    desc: `${data.name} does not have a comprehensive tax treaty with the US. This may result in higher withholding rates and double taxation.`,
                    action: 'Consult with international tax counsel. Consider treaty shopping implications.'
                });
            }

            if (equityType === 'stock-options' || equityType === 'restricted-stock') {
                issues.tax.push({
                    severity: 'high',
                    title: 'Equity Compensation Tax Timing',
                    desc: `Tax treatment of ${equityType === 'stock-options' ? 'stock options' : 'restricted stock'} varies significantly between the US and ${data.name}. The service provider may face tax at grant, vesting, or exercise.`,
                    action: 'Obtain tax memo addressing both US and local tax treatment. Consider 83(b) election implications.'
                });
            }

            if (data.withholdingRate > 0 && paymentMethod !== 'none') {
                issues.tax.push({
                    severity: 'medium',
                    title: `Withholding Tax Obligation (${data.withholdingRate}%)`,
                    desc: `The US company may be required to withhold ${data.withholdingRate}% on certain payments to ${data.name}-based service providers.`,
                    action: 'Collect W-8BEN/W-8BEN-E. Determine if withholding applies to equity compensation.'
                });
            }

            if (entityType === 's-corp') {
                issues.tax.push({
                    severity: 'high',
                    title: 'S Corporation Foreign Shareholder Restriction',
                    desc: 'S Corporations cannot have foreign shareholders. Granting equity to a non-US person would terminate S election.',
                    action: 'Convert to C Corporation or use phantom equity/SARs instead of actual equity.'
                });
            }

            if (taxResidency === 'dual' || taxResidency === 'non-resident') {
                issues.tax.push({
                    severity: 'medium',
                    title: 'Complex Tax Residency Status',
                    desc: 'Non-resident or dual tax residency status creates additional complexity for tax reporting and withholding.',
                    action: 'Obtain written confirmation of tax residency. Consider tax equalization provisions.'
                });
            }

            // IP Issues
            if (data.ipProtection === 'low') {
                issues.ip.push({
                    severity: 'high',
                    title: 'Weak IP Protection Jurisdiction',
                    desc: `${data.name} has weaker intellectual property protections and enforcement mechanisms. Trade secrets and copyrights may be difficult to enforce.`,
                    action: 'Use strong contractual IP provisions. Consider keeping sensitive IP work onshore.'
                });
            } else if (data.ipProtection === 'medium') {
                issues.ip.push({
                    severity: 'medium',
                    title: 'Moderate IP Protection Concerns',
                    desc: `${data.name} has moderate IP protections. Enforcement may be challenging in some cases.`,
                    action: 'Ensure robust IP assignment language. Consider registering key IP locally.'
                });
            }

            issues.ip.push({
                severity: 'medium',
                title: 'Cross-Border IP Assignment Formalities',
                desc: 'IP assignments across borders may require specific language, notarization, or registration to be effective.',
                action: 'Include present-tense assignment language. Check local requirements for IP perfection.'
            });

            if (equityType !== 'phantom') {
                issues.ip.push({
                    severity: 'low',
                    title: 'Work-for-Hire Doctrine Variance',
                    desc: 'The "work made for hire" doctrine does not exist in all jurisdictions. Express assignment is required.',
                    action: 'Do not rely on work-for-hire. Include explicit assignment of all IP rights.'
                });
            }

            // Labor Issues
            if (data.laborRisk === 'high') {
                issues.labor.push({
                    severity: 'high',
                    title: 'Strict Labor Classification Laws',
                    desc: `${data.name} has strict labor laws that may recharacterize independent contractors as employees, triggering benefits, severance, and social contributions.`,
                    action: 'Consider using an Employer of Record (EOR). Ensure contractor relationship is genuine.'
                });
            }

            if (relationshipType === 'contractor' && (data.laborRisk === 'high' || data.laborRisk === 'medium')) {
                issues.labor.push({
                    severity: 'medium',
                    title: 'Misclassification Risk',
                    desc: 'Long-term, exclusive contractor relationships may be recharacterized as employment in many jurisdictions.',
                    action: 'Limit exclusivity. Ensure contractor has other clients. Document independent nature of relationship.'
                });
            }

            if (relationshipType === 'contractor') {
                issues.labor.push({
                    severity: 'low',
                    title: 'Local Benefit Requirements',
                    desc: 'Some jurisdictions require minimum benefits even for contractors, including vacation, insurance, or pension contributions.',
                    action: 'Research local requirements. Build compliance costs into engagement budget.'
                });
            }

            // Compliance Issues
            issues.compliance.push({
                severity: 'medium',
                title: 'Data Privacy Compliance (GDPR/Local Laws)',
                desc: `Processing personal data of ${data.name}-based individuals may trigger local data protection requirements.`,
                action: 'Include data processing provisions. Consider Standard Contractual Clauses if in EU.'
            });

            if (country === 'CN') {
                issues.compliance.push({
                    severity: 'high',
                    title: 'China-Specific Restrictions',
                    desc: 'China has strict foreign exchange controls, data localization requirements, and restrictions on equity arrangements.',
                    action: 'Engage China legal counsel. Consider VIE structure or phantom equity.'
                });
            }

            if (paymentMethod === 'crypto') {
                issues.compliance.push({
                    severity: 'high',
                    title: 'Cryptocurrency Payment Risks',
                    desc: 'Cryptocurrency payments may violate tax reporting requirements, securities laws, or local regulations.',
                    action: 'Consult with counsel on legality. Ensure proper tax reporting for both parties.'
                });
            }

            if (equityValue === 'over100k') {
                issues.compliance.push({
                    severity: 'medium',
                    title: 'Securities Law Considerations',
                    desc: 'Large equity grants may trigger securities registration requirements or disclosure obligations.',
                    action: 'Confirm exemption from registration. Consider local securities law implications.'
                });
            }

            // Calculate risk counts
            let highCount = 0, mediumCount = 0, lowCount = 0;
            Object.values(issues).forEach(category => {
                category.forEach(issue => {
                    if (issue.severity === 'high') highCount++;
                    else if (issue.severity === 'medium') mediumCount++;
                    else lowCount++;
                });
            });

            // Render output
            document.getElementById('riskSummary').innerHTML = `
                <div class="risk-card high">
                    <div class="risk-count">${highCount}</div>
                    <div class="risk-label">High Priority Issues</div>
                </div>
                <div class="risk-card medium">
                    <div class="risk-count">${mediumCount}</div>
                    <div class="risk-label">Medium Priority Issues</div>
                </div>
                <div class="risk-card low">
                    <div class="risk-count">${lowCount}</div>
                    <div class="risk-label">Lower Priority Issues</div>
                </div>
            `;

            // Render issue categories
            const renderCategory = (id, title, iconClass, categoryIssues) => {
                if (categoryIssues.length === 0) {
                    document.getElementById(id).innerHTML = '';
                    return;
                }

                const icons = {
                    tax: '<path d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2zM10 8.5a.5.5 0 11-1 0 .5.5 0 011 0zm5 5a.5.5 0 11-1 0 .5.5 0 011 0z"/>',
                    ip: '<path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>',
                    labor: '<path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>',
                    compliance: '<path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>'
                };

                document.getElementById(id).innerHTML = `
                    <div class="category-header">
                        <div class="category-icon ${iconClass}">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                ${icons[iconClass]}
                            </svg>
                        </div>
                        <h3 class="category-title">${title}</h3>
                    </div>
                    ${categoryIssues.map(issue => `
                        <div class="issue-item">
                            <div class="issue-severity ${issue.severity}">
                                <svg width="12" height="12" fill="white" viewBox="0 0 24 24">
                                    ${issue.severity === 'high'
                                        ? '<path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>'
                                        : '<path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>'}
                                </svg>
                            </div>
                            <div class="issue-content">
                                <div class="issue-title">${issue.title}</div>
                                <div class="issue-desc">${issue.desc}</div>
                                <div class="issue-action">Action: ${issue.action}</div>
                            </div>
                        </div>
                    `).join('')}
                `;
            };

            renderCategory('taxIssues', 'Tax & Withholding Issues', 'tax', issues.tax);
            renderCategory('ipIssues', 'IP Enforceability Concerns', 'ip', issues.ip);
            renderCategory('laborIssues', 'Labor Law Considerations', 'labor', issues.labor);
            renderCategory('complianceIssues', 'Compliance & Regulatory', 'compliance', issues.compliance);

            // Render recommendations
            const recommendations = [
                'Engage local counsel in the service provider\'s jurisdiction before finalizing the arrangement',
                'Obtain W-8BEN or W-8BEN-E form from the service provider for US tax reporting',
                'Consider using an Employer of Record (EOR) if the relationship resembles employment',
                'Include choice of law and dispute resolution provisions favoring US jurisdiction',
                'Ensure IP assignment language is effective under both US and local law',
                'Document the independent contractor relationship thoroughly',
                'Obtain tax advice for the service provider on local tax implications of equity compensation'
            ];

            document.getElementById('recommendations').innerHTML = `
                <h3 class="recommendations-title">General Recommendations</h3>
                ${recommendations.map(rec => `
                    <div class="recommendation-item">
                        <svg class="recommendation-icon" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span class="recommendation-text">${rec}</span>
                    </div>
                `).join('')}
            `;

            document.getElementById('outputSection').classList.add('visible');
            document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth' });
        }

        function copyOutput() {
            const summary = document.getElementById('riskSummary').innerText;
            const tax = document.getElementById('taxIssues').innerText;
            const ip = document.getElementById('ipIssues').innerText;
            const labor = document.getElementById('laborIssues').innerText;
            const compliance = document.getElementById('complianceIssues').innerText;
            const recs = document.getElementById('recommendations').innerText;

            const fullText = `CROSS-BORDER ISSUE ANALYSIS\n\n${summary}\n\n${tax}\n\n${ip}\n\n${labor}\n\n${compliance}\n\n${recs}`;

            navigator.clipboard.writeText(fullText).then(() => {
                alert('Output copied to clipboard!');
            });
        }

        function downloadOutput() {
            const summary = document.getElementById('riskSummary').innerText;
            const tax = document.getElementById('taxIssues').innerText;
            const ip = document.getElementById('ipIssues').innerText;
            const labor = document.getElementById('laborIssues').innerText;
            const compliance = document.getElementById('complianceIssues').innerText;
            const recs = document.getElementById('recommendations').innerText;

            const fullText = `CROSS-BORDER ISSUE ANALYSIS\n\n${summary}\n\n${tax}\n\n${ip}\n\n${labor}\n\n${compliance}\n\n${recs}`;

            const blob = new Blob([fullText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cross-border-issue-analysis.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
