<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NDA Generator | Non-Disclosure Agreement Builder | Terms.Law</title>
  <meta name="description" content="Free NDA generator with mutual or one-way options. Build a customized non-disclosure agreement in minutes. Attorney-drafted with clause explanations.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Calendly Widget -->
  <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
  <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>

  <style>
    /* ============================================
       CSS VARIABLES - Professional Theme
       ============================================ */
    :root {
      --color-primary: #1e40af;
      --color-primary-dark: #1e3a8a;
      --color-primary-light: #3b82f6;
      --color-accent: #0d9488;
      --color-accent-light: #14b8a6;
      --color-success: #059669;
      --color-warning: #d97706;
      --color-danger: #dc2626;

      --color-bg: #f8fafc;
      --color-surface: #ffffff;
      --color-border: #e2e8f0;
      --color-border-light: #f1f5f9;
      --color-text: #0f172a;
      --color-text-secondary: #334155;
      --color-text-muted: #64748b;
      --color-text-light: #94a3b8;

      --color-dark: #0f172a;
      --color-dark-surface: #1e293b;

      /* Document preview colors - professional, not neon */
      --doc-bg: #fefefe;
      --doc-border: #d1d5db;
      --doc-highlight: #fef3c7;
      --doc-highlight-border: #fcd34d;
      --doc-text: #1f2937;
      --doc-clause-title: #1e40af;
      --doc-section-num: #6366f1;

      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);

      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      --radius-xl: 20px;
      --radius-full: 9999px;

      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;

      --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
      --font-serif: Georgia, 'Times New Roman', serif;
      --max-width: 1280px;

      --transition-fast: 150ms ease;
      --transition-base: 200ms ease;
    }

    /* ============================================
       RESET & BASE
       ============================================ */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
    }

    body {
      font-family: var(--font-sans);
      font-size: 16px;
      line-height: 1.6;
      color: var(--color-text);
      background: var(--color-bg);
    }

    a {
      color: var(--color-primary);
      text-decoration: none;
      transition: color var(--transition-fast);
    }

    a:hover {
      color: var(--color-primary-dark);
    }

    .container {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 0 var(--space-lg);
    }

    /* ============================================
       HEADER
       ============================================ */
    .site-header {
      background: var(--color-dark);
      padding: var(--space-md) 0;
      position: sticky;
      top: 0;
      z-index: 100;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-lg);
    }

    .header-brand {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      text-decoration: none;
    }

    .header-logo {
      width: 42px;
      height: 42px;
      background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: #fff;
      font-size: 1.1rem;
    }

    .header-text {
      display: flex;
      flex-direction: column;
    }

    .header-name {
      color: #fff;
      font-size: 1.15rem;
      font-weight: 700;
    }

    .header-tagline {
      color: #64748b;
      font-size: 0.8rem;
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .nav-link {
      color: #94a3b8;
      font-size: 0.9rem;
      font-weight: 500;
      padding: 8px 14px;
      border-radius: var(--radius-sm);
      transition: all var(--transition-fast);
    }

    .nav-link:hover {
      color: #fff;
      background: rgba(255,255,255,0.05);
    }

    .header-email-cta {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: rgba(59, 130, 246, 0.15);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: var(--radius-full);
      color: #93c5fd;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all var(--transition-fast);
    }

    .header-email-cta:hover {
      background: rgba(59, 130, 246, 0.25);
      color: #fff;
    }

    /* ============================================
       HERO
       ============================================ */
    .hero {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
      padding: var(--space-2xl) 0;
      position: relative;
      overflow: hidden;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 50%;
      height: 100%;
      background: radial-gradient(ellipse at 70% 30%, rgba(59, 130, 246, 0.12) 0%, transparent 60%);
      pointer-events: none;
    }

    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 800px;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 14px 6px 6px;
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      color: #93c5fd;
      margin-bottom: var(--space-lg);
    }

    .hero-badge-icon {
      width: 22px;
      height: 22px;
      background: var(--color-primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: #fff;
    }

    .hero h1 {
      font-size: 2.25rem;
      font-weight: 800;
      color: #fff;
      line-height: 1.15;
      letter-spacing: -0.025em;
      margin-bottom: var(--space-md);
    }

    .hero h1 .highlight {
      background: linear-gradient(135deg, #60a5fa, #34d399);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-subtitle {
      font-size: 1.1rem;
      color: #94a3b8;
      line-height: 1.7;
      margin-bottom: var(--space-lg);
      max-width: 650px;
    }

    .hero-subtitle strong {
      color: #e2e8f0;
    }

    .hero-features {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-lg);
    }

    .hero-feature {
      display: flex;
      align-items: center;
      gap: 8px;
      color: #94a3b8;
      font-size: 0.9rem;
    }

    .hero-feature-icon {
      color: var(--color-accent-light);
    }

    /* ============================================
       MAIN LAYOUT - Split View
       ============================================ */
    .builder-layout {
      display: grid;
      grid-template-columns: 420px 1fr;
      gap: 0;
      min-height: calc(100vh - 200px);
    }

    @media (max-width: 1024px) {
      .builder-layout {
        grid-template-columns: 1fr;
      }
    }

    /* ============================================
       BUILDER SIDEBAR (Left Panel)
       ============================================ */
    .builder-sidebar {
      background: var(--color-surface);
      border-right: 1px solid var(--color-border);
      padding: var(--space-xl);
      overflow-y: auto;
      max-height: calc(100vh - 150px);
      position: sticky;
      top: 70px;
    }

    @media (max-width: 1024px) {
      .builder-sidebar {
        max-height: none;
        position: static;
      }
    }

    .builder-section {
      margin-bottom: var(--space-xl);
      padding-bottom: var(--space-xl);
      border-bottom: 1px solid var(--color-border-light);
    }

    .builder-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .builder-section-title {
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-text-muted);
      margin-bottom: var(--space-md);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .builder-section-title .icon {
      font-size: 1rem;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: var(--space-lg);
    }

    .form-label {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--color-text);
      margin-bottom: var(--space-sm);
    }

    .form-label .help-trigger {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      background: var(--color-border);
      color: var(--color-text-muted);
      border-radius: 50%;
      font-size: 10px;
      font-weight: 700;
      cursor: help;
      position: relative;
    }

    .form-label .help-trigger:hover .help-tooltip {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .help-tooltip {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%) translateY(5px);
      width: 280px;
      background: var(--color-dark);
      color: #fff;
      padding: 12px 14px;
      border-radius: var(--radius-md);
      font-size: 0.8rem;
      font-weight: 400;
      line-height: 1.5;
      box-shadow: var(--shadow-xl);
      opacity: 0;
      visibility: hidden;
      transition: all var(--transition-base);
      z-index: 100;
      text-align: left;
    }

    .help-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: var(--color-dark);
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      font-size: 0.95rem;
      font-family: inherit;
      transition: all var(--transition-fast);
      background: var(--color-surface);
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
    }

    .form-textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-hint {
      font-size: 0.8rem;
      color: var(--color-text-muted);
      margin-top: 6px;
    }

    /* Info Boxes - Contextual Help */
    .info-box {
      margin-top: 12px;
      padding: 12px 14px;
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(13, 148, 136, 0.05));
      border-left: 3px solid var(--color-primary-light);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      font-size: 0.85rem;
      line-height: 1.5;
      color: var(--color-text-secondary);
    }

    .info-box-title {
      font-weight: 600;
      color: var(--color-primary);
      margin-bottom: 4px;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .info-box p {
      margin: 0;
    }

    .info-box-muted {
      background: var(--color-bg);
      border-left-color: var(--color-border);
    }

    .info-box-muted .info-box-title {
      color: var(--color-text-muted);
    }

    /* Section Description */
    .section-description {
      font-size: 0.85rem;
      color: var(--color-text-muted);
      margin-bottom: var(--space-md);
      line-height: 1.5;
    }

    /* Clause Toggle Switches */
    .clause-toggle {
      margin-bottom: 12px;
    }

    .clause-toggle-label {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .clause-toggle-label:hover {
      border-color: var(--color-primary-light);
      background: rgba(59, 130, 246, 0.03);
    }

    .clause-toggle-label input[type="checkbox"] {
      display: none;
    }

    .clause-toggle-switch {
      width: 40px;
      height: 22px;
      background: var(--color-border);
      border-radius: 11px;
      position: relative;
      flex-shrink: 0;
      transition: all var(--transition-fast);
    }

    .clause-toggle-switch::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all var(--transition-fast);
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    }

    .clause-toggle-label input:checked + .clause-toggle-switch {
      background: var(--color-primary);
    }

    .clause-toggle-label input:checked + .clause-toggle-switch::after {
      left: 20px;
    }

    .clause-toggle-text {
      flex: 1;
      line-height: 1.4;
    }

    .clause-toggle-text strong {
      display: block;
      font-size: 0.9rem;
      color: var(--color-text);
      margin-bottom: 2px;
    }

    .clause-toggle-text small {
      font-size: 0.8rem;
      color: var(--color-text-muted);
    }

    /* Protection Level Slider */
    .protection-slider-container {
      margin-bottom: 8px;
    }

    .protection-slider {
      width: 100%;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: linear-gradient(to right, var(--color-accent), var(--color-primary-light), var(--color-primary));
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }

    .protection-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #fff;
      border: 2px solid var(--color-primary);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .protection-slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #fff;
      border: 2px solid var(--color-primary);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .protection-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 4px;
    }

    .protection-label {
      font-size: 0.75rem;
      color: var(--color-text-muted);
    }

    .protection-explanation {
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      padding: 10px 12px;
      margin-top: 8px;
    }

    .protection-who {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--color-primary);
      text-transform: uppercase;
      letter-spacing: 0.02em;
      margin-bottom: 4px;
    }

    .protection-explanation p {
      font-size: 0.8rem;
      color: var(--color-text-secondary);
      margin: 0;
      line-height: 1.4;
    }

    /* Balance Indicator */
    .balance-indicator {
      margin-top: 16px;
      padding: 12px;
      background: var(--color-bg);
      border-radius: var(--radius-md);
    }

    .balance-bar {
      height: 8px;
      background: linear-gradient(to right, var(--color-accent), #e2e8f0 45%, #e2e8f0 55%, var(--color-primary));
      border-radius: 4px;
      position: relative;
      overflow: hidden;
    }

    .balance-fill {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      background: var(--color-dark);
      border-radius: 4px;
      transition: width 0.3s ease;
      opacity: 0.15;
    }

    .balance-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 0.75rem;
      color: var(--color-text-muted);
    }

    .balance-labels small {
      font-size: 0.7rem;
      opacity: 0.8;
    }

    /* Toggle Switch */
    .toggle-group {
      display: flex;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-md);
      padding: 4px;
      gap: 4px;
    }

    .toggle-option {
      flex: 1;
      padding: 10px 16px;
      border: none;
      background: transparent;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all var(--transition-fast);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .toggle-option:hover {
      color: var(--color-text);
    }

    .toggle-option.active {
      background: var(--color-primary);
      color: #fff;
      box-shadow: var(--shadow-sm);
    }

    .toggle-option .toggle-icon {
      font-size: 1rem;
    }

    /* Checkbox/Radio Pills */
    .pill-group {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
    }

    .pill-option {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      color: var(--color-text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .pill-option:hover {
      border-color: var(--color-primary-light);
      background: rgba(30, 64, 175, 0.05);
    }

    .pill-option.selected {
      background: rgba(30, 64, 175, 0.1);
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    .pill-option input {
      display: none;
    }

    /* Number Input with Stepper */
    .number-input-group {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .number-input-group .form-input {
      width: 80px;
      text-align: center;
    }

    .number-suffix {
      font-size: 0.9rem;
      color: var(--color-text-muted);
    }

    /* Quick Select Buttons */
    .quick-select {
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-sm);
    }

    .quick-select-btn {
      padding: 6px 12px;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: 0.8rem;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .quick-select-btn:hover {
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    /* ============================================
       SIGNATURE COMPONENTS
       ============================================ */
    .signature-type-toggle {
      display: flex;
      gap: 4px;
      margin-bottom: 12px;
    }

    .sig-toggle-btn {
      flex: 1;
      padding: 8px 12px;
      background: var(--color-bg);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .sig-toggle-btn:hover {
      border-color: var(--color-primary-light);
      color: var(--color-text);
    }

    .sig-toggle-btn.active {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: #fff;
    }

    .signature-draw-container {
      position: relative;
    }

    .signature-canvas {
      width: 100%;
      height: 100px;
      border: 2px dashed var(--color-border);
      border-radius: var(--radius-md);
      background: #fff;
      cursor: crosshair;
      touch-action: none;
    }

    .signature-canvas:hover {
      border-color: var(--color-primary-light);
    }

    .sig-clear-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 4px 10px;
      background: rgba(0,0,0,0.05);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      color: var(--color-text-muted);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .sig-clear-btn:hover {
      background: rgba(220, 38, 38, 0.1);
      color: var(--color-danger);
    }

    .signature-type-container {
      margin-top: 8px;
    }

    .signature-typed-input {
      margin-bottom: 8px;
    }

    .signature-typed-preview {
      min-height: 60px;
      padding: 12px 16px;
      background: #fff;
      border: 2px dashed var(--color-border);
      border-radius: var(--radius-md);
      font-family: 'Dancing Script', 'Brush Script MT', cursive;
      font-size: 28px;
      color: #1a365d;
      display: flex;
      align-items: center;
    }

    .signature-typed-preview:empty::before {
      content: 'Your signature will appear here';
      color: var(--color-text-light);
      font-family: var(--font-sans);
      font-size: 0.85rem;
      font-style: italic;
    }

    /* Document signature display */
    .doc-signature-image {
      max-width: 200px;
      max-height: 60px;
      margin: 8px 0;
    }

    .doc-signature-typed {
      font-family: 'Dancing Script', 'Brush Script MT', cursive;
      font-size: 24px;
      color: #1a365d;
      margin: 8px 0;
      display: block;
    }

    /* ============================================
       DOCUMENT PREVIEW (Right Panel)
       ============================================ */
    .preview-panel {
      background: var(--color-bg);
      padding: var(--space-xl);
      overflow-y: auto;
    }

    .preview-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-md);
      border-bottom: 1px solid var(--color-border);
      flex-wrap: wrap;
    }

    .preview-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--color-text);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .preview-title .icon {
      font-size: 1.25rem;
    }

    .preview-actions {
      display: flex;
      gap: var(--space-sm);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 18px;
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      font-weight: 600;
      text-decoration: none;
      transition: all var(--transition-base);
      border: none;
      cursor: pointer;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--color-primary), #2563eb);
      color: #fff;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }

    .btn-secondary {
      background: var(--color-surface);
      color: var(--color-text);
      border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
      background: var(--color-bg);
      border-color: var(--color-primary-light);
    }

    .btn-sm {
      padding: 8px 14px;
      font-size: 0.85rem;
    }

    /* Document Container */
    .document-container {
      background: var(--doc-bg);
      border: 1px solid var(--doc-border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      max-width: 850px;
      margin: 0 auto;
    }

    .document-header {
      padding: var(--space-lg);
      border-bottom: 1px solid var(--color-border-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .document-title {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--color-text-muted);
    }

    .document-status {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--color-success);
    }

    .document-status::before {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--color-success);
      border-radius: 50%;
    }

    .document-body {
      padding: var(--space-2xl);
      font-family: var(--font-serif);
      font-size: 14px;
      line-height: 1.8;
      color: var(--doc-text);
      max-height: calc(100vh - 350px);
      overflow-y: auto;
    }

    @media (max-width: 1024px) {
      .document-body {
        max-height: none;
      }
    }

    /* Document Typography */
    .doc-title {
      text-align: center;
      font-size: 18px;
      font-weight: 700;
      color: var(--doc-clause-title);
      margin-bottom: 24px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .doc-parties {
      margin-bottom: 24px;
    }

    .doc-clause-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--doc-clause-title);
      margin-top: 28px;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.02em;
    }

    .doc-section-num {
      font-weight: 700;
      color: var(--doc-section-num);
    }

    .doc-emphasis {
      font-style: italic;
    }

    .doc-defined-term {
      font-weight: 600;
    }

    /* Highlighted user inputs - editable inline */
    .doc-highlight {
      background: var(--doc-highlight);
      border-bottom: 2px solid var(--doc-highlight-border);
      padding: 1px 4px;
      border-radius: 3px;
      transition: all var(--transition-fast);
      cursor: text;
      outline: none;
      min-width: 20px;
      display: inline-block;
    }

    .doc-highlight:hover {
      background: #fde68a;
    }

    .doc-highlight:focus {
      background: #fef3c7;
      border-bottom-color: var(--color-primary);
      box-shadow: 0 0 0 2px rgba(30, 64, 175, 0.2);
    }

    .doc-highlight.empty {
      color: var(--color-text-muted);
      font-style: italic;
    }

    .doc-highlight.flash {
      animation: flashHighlight 1.5s ease;
    }

    /* Tooltip hint on hover */
    .doc-highlight[data-field]::after {
      content: 'Click to edit';
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: var(--color-dark);
      color: #fff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-family: var(--font-sans);
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      pointer-events: none;
      margin-bottom: 4px;
    }

    .doc-highlight[data-field] {
      position: relative;
    }

    .doc-highlight[data-field]:hover:not(:focus)::after {
      opacity: 1;
      visibility: visible;
    }

    @keyframes flashHighlight {
      0%, 100% { background: var(--doc-highlight); }
      25% { background: #fbbf24; box-shadow: 0 0 12px rgba(251, 191, 36, 0.5); }
      50% { background: #fde68a; }
      75% { background: #fbbf24; box-shadow: 0 0 8px rgba(251, 191, 36, 0.3); }
    }

    .doc-paragraph {
      margin-bottom: 16px;
      text-align: justify;
    }

    .doc-indent {
      margin-left: 28px;
    }

    .doc-signature-block {
      margin-top: 40px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
    }

    .doc-signature-party {
      border-top: 1px solid var(--doc-border);
      padding-top: 20px;
    }

    .doc-signature-line {
      margin-top: 40px;
      border-top: 1px solid var(--doc-text);
      padding-top: 4px;
      font-size: 12px;
      color: var(--color-text-muted);
    }

    /* ============================================
       ATTORNEY CTA SECTION
       ============================================ */
    .attorney-cta {
      background: linear-gradient(135deg, var(--color-dark) 0%, #1e293b 100%);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      margin-top: var(--space-xl);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-xl);
      flex-wrap: wrap;
    }

    .attorney-cta-content h3 {
      font-size: 1.15rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: var(--space-sm);
    }

    .attorney-cta-content p {
      color: #94a3b8;
      font-size: 0.9rem;
      max-width: 450px;
    }

    .attorney-cta-price {
      text-align: right;
    }

    .attorney-cta-price .price {
      font-size: 1.5rem;
      font-weight: 800;
      color: #fff;
    }

    .attorney-cta-price .price-label {
      font-size: 0.8rem;
      color: #64748b;
    }

    /* ============================================
       EXPLANATION PANEL
       ============================================ */
    .explanation-panel {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      margin-top: var(--space-xl);
    }

    .explanation-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--color-text);
      margin-bottom: var(--space-lg);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      padding-bottom: var(--space-md);
      border-bottom: 1px solid var(--color-border-light);
    }

    .explanation-content {
      font-size: 0.9rem;
      color: var(--color-text-secondary);
      line-height: 1.7;
    }

    .explanation-content p {
      margin-bottom: var(--space-md);
    }

    .explanation-content p:last-child {
      margin-bottom: 0;
    }

    .explanation-divider {
      height: 1px;
      background: var(--color-border-light);
      margin: var(--space-lg) 0;
    }

    .explanation-subtitle {
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--color-primary);
      text-transform: uppercase;
      letter-spacing: 0.03em;
      margin-bottom: var(--space-md);
    }

    .explanation-content strong {
      color: var(--color-text);
    }

    /* ============================================
       FOOTER
       ============================================ */
    .site-footer {
      background: var(--color-dark);
      padding: var(--space-xl) 0;
      color: #64748b;
      font-size: 0.9rem;
      margin-top: var(--space-3xl);
    }

    .footer-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: var(--space-lg);
    }

    .footer-brand strong {
      color: #fff;
    }

    .footer-links {
      display: flex;
      gap: var(--space-lg);
    }

    .footer-links a {
      color: #94a3b8;
    }

    .footer-links a:hover {
      color: #fff;
    }

    /* ============================================
       RESPONSIVE
       ============================================ */
    @media (max-width: 768px) {
      .hero h1 {
        font-size: 1.75rem;
      }

      .builder-sidebar {
        padding: var(--space-lg);
      }

      .document-body {
        padding: var(--space-lg);
      }

      .doc-signature-block {
        grid-template-columns: 1fr;
      }

      .preview-toolbar {
        flex-direction: column;
        align-items: flex-start;
      }

      .attorney-cta {
        flex-direction: column;
        text-align: center;
      }

      .attorney-cta-price {
        text-align: center;
      }

      .header-nav {
        display: none;
      }
    }

    /* ============================================
       SCROLL TO PREVIEW INDICATOR
       ============================================ */
    .scroll-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      background: var(--color-primary);
      color: #fff;
      border-radius: var(--radius-full);
      font-size: 0.85rem;
      font-weight: 600;
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      display: none;
      z-index: 50;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @media (max-width: 1024px) {
      .scroll-indicator {
        display: flex;
        align-items: center;
        gap: 6px;
      }
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--color-dark);
      color: #fff;
      padding: 14px 24px;
      border-radius: var(--radius-md);
      font-size: 0.9rem;
      box-shadow: var(--shadow-xl);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="container">
      <div class="header-content">
        <a href="../frontpage/index.html" class="header-brand">
          <div class="header-logo">ST</div>
          <div class="header-text">
            <span class="header-name">SERGEI TOKMAKOV, ESQ.</span>
            <span class="header-tagline">California Business & Contract Attorney</span>
          </div>
        </a>
        <nav class="header-nav">
          <a href="../frontpage/index.html" class="nav-link">Services</a>
          <a href="contract-library-landing.html" class="nav-link active">Document Builder</a>
          <a href="../Demand-Letters/demand-letters-landing.html" class="nav-link">Demand Letters</a>
          <a href="../INC/formation-landing.html" class="nav-link">Formation</a>
          <a href="https://terms.law/blog/" class="nav-link">Blog</a>
        </nav>
        <a href="mailto:owner@terms.law" class="header-email-cta">Email</a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <div class="hero-badge">
          <span class="hero-badge-icon">‚ö°</span>
          Interactive Document Builder
        </div>
        <h1>NDA <span class="highlight">Generator</span></h1>
        <p class="hero-subtitle">
          <strong>Build a customized Non-Disclosure Agreement in minutes.</strong> Choose mutual or one-way protection, select your purpose, and fill in your details. Your document updates in real-time.
        </p>
        <div class="hero-features">
          <div class="hero-feature">
            <span class="hero-feature-icon">‚úì</span>
            Attorney-drafted language
          </div>
          <div class="hero-feature">
            <span class="hero-feature-icon">‚úì</span>
            Mutual or one-way options
          </div>
          <div class="hero-feature">
            <span class="hero-feature-icon">‚úì</span>
            Instant preview & download
          </div>
          <div class="hero-feature">
            <span class="hero-feature-icon">‚úì</span>
            All 50 states
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN BUILDER -->
  <main class="builder-layout">

    <!-- LEFT: Form Controls -->
    <aside class="builder-sidebar">

      <!-- NDA Type -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">üîí</span>
          Agreement Type
        </div>
        <div class="form-group">
          <div class="toggle-group">
            <button type="button" class="toggle-option active" data-value="mutual" onclick="setNdaType('mutual')">
              <span class="toggle-icon">‚ÜîÔ∏è</span>
              Mutual (Two-Way)
            </button>
            <button type="button" class="toggle-option" data-value="one-way" onclick="setNdaType('one-way')">
              <span class="toggle-icon">‚Üí</span>
              One-Way
            </button>
          </div>
          <div class="info-box" id="ndaTypeInfo">
            <div class="info-box-title">Mutual NDA</div>
            <p>Both sides share secrets and both must keep them confidential. Best for partnerships, joint ventures, or when both parties will be sharing sensitive information.</p>
          </div>
        </div>
      </div>

      <!-- Protection Level -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">‚öñÔ∏è</span>
          Protection Level
        </div>
        <p class="section-description">Adjust how protective your NDA is. Stricter terms favor the party sharing secrets; looser terms favor the party receiving them.</p>

        <div class="form-group">
          <label class="form-label">Confidential Information Definition</label>
          <div class="protection-slider-container">
            <input type="range" class="protection-slider" id="protectionBreadth" min="1" max="3" value="2" oninput="updateProtectionLevel()">
            <div class="protection-labels">
              <span class="protection-label">Narrow</span>
              <span class="protection-label">Standard</span>
              <span class="protection-label">Broad</span>
            </div>
          </div>
          <div class="protection-explanation" id="protectionBreadthExplanation">
            <div class="protection-who">Standard Definition</div>
            <p>Covers all non-public information shared, whether or not marked. Balanced approach for most deals.</p>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Disclosure Restrictions</label>
          <div class="protection-slider-container">
            <input type="range" class="protection-slider" id="protectionStrictness" min="1" max="3" value="2" oninput="updateProtectionLevel()">
            <div class="protection-labels">
              <span class="protection-label">Flexible</span>
              <span class="protection-label">Standard</span>
              <span class="protection-label">Strict</span>
            </div>
          </div>
          <div class="protection-explanation" id="protectionStrictnessExplanation">
            <div class="protection-who">Standard Restrictions</div>
            <p>Need-to-know basis with reasonable care standard. Works for most business relationships.</p>
          </div>
        </div>

        <div class="balance-indicator">
          <div class="balance-bar">
            <div class="balance-fill" id="balanceFill" style="width: 50%;"></div>
          </div>
          <div class="balance-labels">
            <span><strong>‚Üê Receiving Party</strong><br><small>Easier to comply</small></span>
            <span style="text-align: right;"><strong>Disclosing Party ‚Üí</strong><br><small>More protection</small></span>
          </div>
        </div>
      </div>

      <!-- Purpose -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">üéØ</span>
          Purpose of Disclosure
        </div>
        <div class="form-group">
          <label class="form-label">
            Select Purpose
            <span class="help-trigger">?
              <span class="help-tooltip">The purpose clause limits how the receiving party can use your confidential information. Be specific enough to be meaningful but broad enough to cover your actual discussions.</span>
            </span>
          </label>
          <div class="pill-group" id="purposePills">
            <label class="pill-option selected" onclick="selectPurpose(this, 'business')">
              <input type="radio" name="purpose" value="business" checked>
              üíº Business Partnership
            </label>
            <label class="pill-option" onclick="selectPurpose(this, 'investment')">
              <input type="radio" name="purpose" value="investment">
              üí∞ Investment Discussions
            </label>
            <label class="pill-option" onclick="selectPurpose(this, 'acquisition')">
              <input type="radio" name="purpose" value="acquisition">
              üè¢ M&A / Acquisition
            </label>
            <label class="pill-option" onclick="selectPurpose(this, 'licensing')">
              <input type="radio" name="purpose" value="licensing">
              üìú Technology Licensing
            </label>
            <label class="pill-option" onclick="selectPurpose(this, 'vendor')">
              <input type="radio" name="purpose" value="vendor">
              ü§ù Vendor Evaluation
            </label>
            <label class="pill-option" onclick="selectPurpose(this, 'employment')">
              <input type="radio" name="purpose" value="employment">
              üëî Employment Discussions
            </label>
            <label class="pill-option" onclick="selectPurpose(this, 'custom')">
              <input type="radio" name="purpose" value="custom">
              ‚úèÔ∏è Custom Purpose
            </label>
          </div>
          <div id="customPurposeField" style="display: none; margin-top: var(--space-md);">
            <input type="text" class="form-input" id="customPurpose" placeholder="e.g., evaluating a potential joint venture in renewable energy" oninput="updatePreview()">
          </div>
        </div>
      </div>

      <!-- Party A -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">üë§</span>
          <span id="partyALabel">Party A (Your Company)</span>
        </div>
        <div class="form-group">
          <label class="form-label">Legal Name</label>
          <input type="text" class="form-input" id="partyAName" placeholder="Acme Technologies Inc." oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label class="form-label">Entity Type</label>
          <select class="form-select" id="partyAEntity" onchange="updatePreview()">
            <option value="corporation">Corporation</option>
            <option value="llc">Limited Liability Company</option>
            <option value="partnership">Partnership</option>
            <option value="individual">Individual</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">State of Formation</label>
          <select class="form-select" id="partyAState" onchange="updatePreview()">
            <option value="">Select state...</option>
            <option value="California">California</option>
            <option value="Delaware">Delaware</option>
            <option value="New York">New York</option>
            <option value="Texas">Texas</option>
            <option value="Florida">Florida</option>
            <option value="Nevada">Nevada</option>
            <option value="Wyoming">Wyoming</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Principal Address</label>
          <input type="text" class="form-input" id="partyAAddress" placeholder="123 Tech Drive, San Francisco, CA 94102" oninput="updatePreview()">
        </div>
      </div>

      <!-- Party B -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">üë•</span>
          <span id="partyBLabel">Party B (Other Party)</span>
        </div>
        <div class="form-group">
          <label class="form-label">Legal Name</label>
          <input type="text" class="form-input" id="partyBName" placeholder="XYZ Ventures LLC" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label class="form-label">Entity Type</label>
          <select class="form-select" id="partyBEntity" onchange="updatePreview()">
            <option value="corporation">Corporation</option>
            <option value="llc">Limited Liability Company</option>
            <option value="partnership">Partnership</option>
            <option value="individual">Individual</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">State of Formation</label>
          <select class="form-select" id="partyBState" onchange="updatePreview()">
            <option value="">Select state...</option>
            <option value="California">California</option>
            <option value="Delaware">Delaware</option>
            <option value="New York">New York</option>
            <option value="Texas">Texas</option>
            <option value="Florida">Florida</option>
            <option value="Nevada">Nevada</option>
            <option value="Wyoming">Wyoming</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Principal Address</label>
          <input type="text" class="form-input" id="partyBAddress" placeholder="456 Business Ave, New York, NY 10001" oninput="updatePreview()">
        </div>
      </div>

      <!-- Terms -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">‚è±Ô∏è</span>
          Agreement Terms
        </div>
        <div class="form-group">
          <label class="form-label">
            Agreement Duration
            <span class="help-trigger">?
              <span class="help-tooltip">How long the parties can share confidential information under this agreement. Typically 1-3 years. The confidentiality obligations usually survive longer.</span>
            </span>
          </label>
          <div class="number-input-group">
            <input type="number" class="form-input" id="termYears" value="2" min="1" max="10" oninput="updatePreview()">
            <span class="number-suffix">years</span>
          </div>
          <div class="quick-select">
            <button type="button" class="quick-select-btn" onclick="setTerm(1)">1 yr</button>
            <button type="button" class="quick-select-btn" onclick="setTerm(2)">2 yrs</button>
            <button type="button" class="quick-select-btn" onclick="setTerm(3)">3 yrs</button>
            <button type="button" class="quick-select-btn" onclick="setTerm(5)">5 yrs</button>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">
            Confidentiality Survival Period
            <span class="help-trigger">?
              <span class="help-tooltip">How long the receiving party must keep information confidential after the agreement ends. Usually 2-5 years. Trade secrets remain protected indefinitely.</span>
            </span>
          </label>
          <div class="number-input-group">
            <input type="number" class="form-input" id="survivalYears" value="3" min="1" max="10" oninput="updatePreview()">
            <span class="number-suffix">years after termination</span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">
            Governing Law State
            <span class="help-trigger">?
              <span class="help-tooltip">The state whose laws will apply to this agreement. Usually your home state or Delaware.</span>
            </span>
          </label>
          <select class="form-select" id="governingState" onchange="updatePreview()">
            <option value="California">California</option>
            <option value="Delaware">Delaware</option>
            <option value="New York">New York</option>
            <option value="Texas">Texas</option>
            <option value="Florida">Florida</option>
            <option value="Illinois">Illinois</option>
            <option value="Massachusetts">Massachusetts</option>
            <option value="Washington">Washington</option>
            <option value="Colorado">Colorado</option>
            <option value="Georgia">Georgia</option>
            <option value="North Carolina">North Carolina</option>
            <option value="New Jersey">New Jersey</option>
            <option value="Pennsylvania">Pennsylvania</option>
            <option value="Arizona">Arizona</option>
            <option value="Nevada">Nevada</option>
            <option value="Ohio">Ohio</option>
            <option value="Michigan">Michigan</option>
            <option value="Virginia">Virginia</option>
            <option value="Maryland">Maryland</option>
            <option value="Oregon">Oregon</option>
            <option value="Utah">Utah</option>
            <option value="Connecticut">Connecticut</option>
            <option value="Minnesota">Minnesota</option>
            <option value="Tennessee">Tennessee</option>
            <option value="Indiana">Indiana</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Jurisdiction (County, State)</label>
          <input type="text" class="form-input" id="jurisdiction" placeholder="San Francisco, California" oninput="updatePreview()">
        </div>
        <div class="info-box info-box-muted">
          <div class="info-box-title">Quick Guide</div>
          <p><strong>Duration:</strong> How long you'll share info (1-2 yrs is typical).<br>
          <strong>Survival:</strong> How long they must stay quiet after (3+ yrs is safe).<br>
          <strong>Governing Law:</strong> Pick your state‚Äîmakes suing easier if needed.</p>
        </div>
      </div>

      <!-- Effective Date -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">üìÖ</span>
          Effective Date
        </div>
        <div class="form-group">
          <input type="date" class="form-input" id="effectiveDate" onchange="updatePreview()">
          <div class="quick-select">
            <button type="button" class="quick-select-btn" onclick="setDateToday()">Today</button>
          </div>
        </div>
      </div>

      <!-- Optional Clauses -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">‚öôÔ∏è</span>
          Optional Clauses
        </div>
        <p class="section-description">Customize your NDA with additional protections. Toggle on the clauses you need.</p>

        <!-- Marking Requirement -->
        <div class="clause-toggle">
          <label class="clause-toggle-label">
            <input type="checkbox" id="clauseMarking" onchange="updatePreview()">
            <span class="clause-toggle-switch"></span>
            <span class="clause-toggle-text">
              <strong>Require Marking</strong>
              <small>Information must be labeled "Confidential" to be protected</small>
            </span>
          </label>
        </div>

        <!-- Non-Solicitation -->
        <div class="clause-toggle">
          <label class="clause-toggle-label">
            <input type="checkbox" id="clauseNonSolicitation" onchange="updatePreview()">
            <span class="clause-toggle-switch"></span>
            <span class="clause-toggle-text">
              <strong>Non-Solicitation</strong>
              <small>Prohibit hiring each other's employees during the term</small>
            </span>
          </label>
        </div>

        <!-- Non-Circumvention -->
        <div class="clause-toggle">
          <label class="clause-toggle-label">
            <input type="checkbox" id="clauseNonCircumvention" onchange="updatePreview()">
            <span class="clause-toggle-switch"></span>
            <span class="clause-toggle-text">
              <strong>Non-Circumvention</strong>
              <small>Prevent going around each other to contacts/opportunities shared</small>
            </span>
          </label>
        </div>

        <!-- Residuals -->
        <div class="clause-toggle">
          <label class="clause-toggle-label">
            <input type="checkbox" id="clauseResiduals" onchange="updatePreview()">
            <span class="clause-toggle-switch"></span>
            <span class="clause-toggle-text">
              <strong>Residuals Clause</strong>
              <small>Allow use of general knowledge retained in unaided memory</small>
            </span>
          </label>
        </div>

        <!-- Return of Materials -->
        <div class="clause-toggle">
          <label class="clause-toggle-label">
            <input type="checkbox" id="clauseReturnMaterials" checked onchange="updatePreview()">
            <span class="clause-toggle-switch"></span>
            <span class="clause-toggle-text">
              <strong>Return of Materials</strong>
              <small>Require return or destruction of confidential materials upon request</small>
            </span>
          </label>
        </div>

        <!-- No License -->
        <div class="clause-toggle">
          <label class="clause-toggle-label">
            <input type="checkbox" id="clauseNoLicense" checked onchange="updatePreview()">
            <span class="clause-toggle-switch"></span>
            <span class="clause-toggle-text">
              <strong>No License Granted</strong>
              <small>Clarify that sharing info doesn't grant IP rights</small>
            </span>
          </label>
        </div>

        <!-- Standstill (for M&A) -->
        <div class="clause-toggle" id="standstillToggle" style="display: none;">
          <label class="clause-toggle-label">
            <input type="checkbox" id="clauseStandstill" onchange="updatePreview()">
            <span class="clause-toggle-switch"></span>
            <span class="clause-toggle-text">
              <strong>Standstill Provision</strong>
              <small>Prevent unsolicited acquisition attempts during evaluation</small>
            </span>
          </label>
        </div>

        <div class="info-box info-box-muted" style="margin-top: 16px;">
          <div class="info-box-title">About These Clauses</div>
          <p><strong>Marking:</strong> Stricter‚Äîrequires labeling. Without it, ALL shared info is protected.<br>
          <strong>Non-Solicitation:</strong> Protects your team from poaching.<br>
          <strong>Non-Circumvention:</strong> Prevents end-runs around business introductions.<br>
          <strong>Residuals:</strong> Tech-friendly clause letting people use general learning.</p>
        </div>
      </div>

      <!-- Signatures -->
      <div class="builder-section">
        <div class="builder-section-title">
          <span class="icon">‚úçÔ∏è</span>
          Signatures (Optional)
        </div>

        <!-- Party A Signature -->
        <div class="form-group">
          <label class="form-label">Party A Signature</label>
          <div class="signature-type-toggle">
            <button type="button" class="sig-toggle-btn active" data-party="A" data-type="draw" onclick="setSignatureType('A', 'draw')">Draw</button>
            <button type="button" class="sig-toggle-btn" data-party="A" data-type="type" onclick="setSignatureType('A', 'type')">Type</button>
          </div>
          <div class="signature-draw-container" id="sigDrawContainerA">
            <canvas id="signatureCanvasA" class="signature-canvas" width="340" height="100"></canvas>
            <button type="button" class="sig-clear-btn" onclick="clearSignature('A')">Clear</button>
          </div>
          <div class="signature-type-container" id="sigTypeContainerA" style="display: none;">
            <input type="text" class="form-input signature-typed-input" id="signatureTypedA" placeholder="Type your name" oninput="updateTypedSignature('A')">
            <div class="signature-typed-preview" id="signatureTypedPreviewA"></div>
          </div>
          <div class="form-group" style="margin-top: 12px;">
            <label class="form-label">Signer Name</label>
            <input type="text" class="form-input" id="signerNameA" placeholder="John Smith" oninput="updatePreview()">
          </div>
          <div class="form-group">
            <label class="form-label">Title</label>
            <input type="text" class="form-input" id="signerTitleA" placeholder="CEO" oninput="updatePreview()">
          </div>
        </div>

        <!-- Party B Signature -->
        <div class="form-group" style="margin-top: 24px;">
          <label class="form-label">Party B Signature</label>
          <div class="signature-type-toggle">
            <button type="button" class="sig-toggle-btn active" data-party="B" data-type="draw" onclick="setSignatureType('B', 'draw')">Draw</button>
            <button type="button" class="sig-toggle-btn" data-party="B" data-type="type" onclick="setSignatureType('B', 'type')">Type</button>
          </div>
          <div class="signature-draw-container" id="sigDrawContainerB">
            <canvas id="signatureCanvasB" class="signature-canvas" width="340" height="100"></canvas>
            <button type="button" class="sig-clear-btn" onclick="clearSignature('B')">Clear</button>
          </div>
          <div class="signature-type-container" id="sigTypeContainerB" style="display: none;">
            <input type="text" class="form-input signature-typed-input" id="signatureTypedB" placeholder="Type your name" oninput="updateTypedSignature('B')">
            <div class="signature-typed-preview" id="signatureTypedPreviewB"></div>
          </div>
          <div class="form-group" style="margin-top: 12px;">
            <label class="form-label">Signer Name</label>
            <input type="text" class="form-input" id="signerNameB" placeholder="Jane Doe" oninput="updatePreview()">
          </div>
          <div class="form-group">
            <label class="form-label">Title</label>
            <input type="text" class="form-input" id="signerTitleB" placeholder="Managing Director" oninput="updatePreview()">
          </div>
        </div>
      </div>

    </aside>

    <!-- RIGHT: Document Preview -->
    <div class="preview-panel">
      <div class="preview-toolbar">
        <div class="preview-title">
          <span class="icon">üìÑ</span>
          Live Document Preview
        </div>
        <div class="preview-actions">
          <button class="btn btn-secondary btn-sm" onclick="copyDocument()">
            üìã Copy
          </button>
          <button class="btn btn-secondary btn-sm" onclick="downloadWord()">
            üìù .docx
          </button>
          <button class="btn btn-primary btn-sm" onclick="downloadPDF()">
            ‚¨áÔ∏è Download PDF
          </button>
        </div>
      </div>

      <div class="document-container">
        <div class="document-header">
          <div class="document-title">Non-Disclosure Agreement</div>
          <div class="document-status">Ready to download</div>
        </div>
        <div class="document-body" id="documentPreview">
          <!-- Document content will be generated here -->
        </div>
      </div>

      <!-- Attorney CTA -->
      <div class="attorney-cta">
        <div class="attorney-cta-content">
          <h3>Need something more customized?</h3>
          <p>Complex deal structures, unusual provisions, or just want a lawyer to review it before you sign? Email me your situation‚ÄîI'll tell you what I'd change.</p>
        </div>
        <div class="attorney-cta-price">
          <a href="mailto:owner@terms.law?subject=NDA%20Review%20Request" class="btn btn-primary">
            Email Me for Review ‚Üí
          </a>
          <div class="price-label" style="margin-top: 8px;">Usually $150-300 for review</div>
        </div>
      </div>

      <!-- Explanation Panel -->
      <div class="explanation-panel">
        <div class="explanation-title">
          üí° Understanding Your NDA
        </div>
        <div class="explanation-content">
          <p><strong>What an NDA does:</strong> Creates a legal obligation to keep shared information secret. If the other party leaks your information, you can sue for damages and get a court order to stop further disclosure.</p>

          <p><strong>When you need one:</strong> Before sharing business plans, financials, customer lists, product designs, software code, pricing strategies, or any information that gives you a competitive advantage.</p>

          <div class="explanation-divider"></div>

          <div class="explanation-subtitle">Key Terms Explained</div>

          <p><strong>Confidential Information</strong> ‚Äî Anything you share that isn't publicly known. This NDA uses a broad definition, meaning information doesn't need to be marked "confidential" to be protected.</p>

          <p><strong>Standard Exclusions</strong> ‚Äî Information that's NOT protected: things already public, information the other party already knew, information they develop independently, or information they get from someone else legally.</p>

          <p><strong>Term vs. Survival</strong> ‚Äî The "term" is how long you'll be sharing information. "Survival" is how long they must keep it secret after the agreement ends. Trade secrets stay protected forever.</p>

          <p><strong>Reasonable Care</strong> ‚Äî The receiving party must protect your information at least as carefully as they protect their own secrets.</p>

          <p><strong>Injunctive Relief</strong> ‚Äî If they breach, you can ask a court to immediately stop them from sharing more, without having to prove exact dollar damages first.</p>

          <div class="explanation-divider"></div>

          <div class="explanation-subtitle">Common Questions</div>

          <p><strong>Is this enforceable?</strong> Yes. NDAs are standard business agreements enforced by courts nationwide. The key is having clear terms and proper signatures.</p>

          <p><strong>What if they're in another state?</strong> Choose a governing law state (usually yours). The agreement will still be enforceable, though you may need to sue in their state.</p>

          <p><strong>Can I use this for employees?</strong> Yes, but employee NDAs often include additional provisions like non-compete or non-solicitation clauses. Consider a dedicated employment agreement.</p>
        </div>
      </div>
    </div>
  </main>

  <!-- Scroll to Preview Indicator (Mobile) -->
  <button class="scroll-indicator" onclick="scrollToPreview()">
    üìÑ View Document ‚Üì
  </button>

  <!-- Toast Notification -->
  <div class="toast" id="toast">Copied to clipboard!</div>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-brand">
          <strong>Sergei Tokmakov, Esq.</strong> ¬∑ California Bar #279869 ¬∑ Licensed since 2011
        </div>
        <div class="footer-links">
          <a href="mailto:owner@terms.law">Email</a>
          <a href="https://www.upwork.com/freelancers/sergeitokmakov" target="_blank">Upwork</a>
          <a href="#" onclick="Calendly.initPopupWidget({url: 'https://calendly.com/sergei-tokmakov/30-minute-zoom-meeting'});return false;">Book a Call</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // ============================================
    // STATE
    // ============================================
    let ndaType = 'mutual';
    let selectedPurpose = 'business';

    const purposeTexts = {
      'business': 'exploring a potential business partnership or collaboration',
      'investment': 'evaluating a potential investment opportunity',
      'acquisition': 'evaluating a potential acquisition or merger transaction',
      'licensing': 'evaluating the licensing of certain technology or intellectual property',
      'vendor': 'evaluating potential vendor or service provider relationships',
      'employment': 'discussing potential employment or consulting arrangements',
      'custom': ''
    };

    // ============================================
    // INITIALIZATION
    // ============================================
    document.addEventListener('DOMContentLoaded', function() {
      // Set today's date as default
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('effectiveDate').value = today;

      updatePreview();
    });

    // ============================================
    // PROTECTION LEVEL CONTROLS
    // ============================================
    let protectionBreadth = 2; // 1=narrow, 2=standard, 3=broad
    let protectionStrictness = 2; // 1=flexible, 2=standard, 3=strict

    const breadthExplanations = {
      1: {
        title: 'Narrow Definition',
        who: 'Favors: Receiving Party',
        text: 'Only information explicitly marked "Confidential" is protected. Easier for the receiving party to track obligations, but requires the disclosing party to be diligent about marking everything.'
      },
      2: {
        title: 'Standard Definition',
        who: 'Balanced',
        text: 'Covers all non-public information shared, whether or not marked. This is the most common approach and works well for most business relationships.'
      },
      3: {
        title: 'Broad Definition',
        who: 'Favors: Disclosing Party',
        text: 'Protects any information that a reasonable person would consider confidential, plus all derived materials, analyses, and notes. Maximum protection for the party sharing secrets.'
      }
    };

    const strictnessExplanations = {
      1: {
        title: 'Flexible Restrictions',
        who: 'Favors: Receiving Party',
        text: 'Can share with affiliates and contractors without prior approval. Allows use in internal training. Lower compliance burden for larger organizations.'
      },
      2: {
        title: 'Standard Restrictions',
        who: 'Balanced',
        text: 'Need-to-know basis with reasonable care standard. Must have confidentiality agreements with anyone who sees the information. Works for most business deals.'
      },
      3: {
        title: 'Strict Restrictions',
        who: 'Favors: Disclosing Party',
        text: 'Must get written approval before any disclosure. Higher standard of care required. Access limited to specific named individuals. Maximum control for the party sharing secrets.'
      }
    };

    function updateProtectionLevel() {
      protectionBreadth = parseInt(document.getElementById('protectionBreadth').value);
      protectionStrictness = parseInt(document.getElementById('protectionStrictness').value);

      // Update breadth explanation
      const breadthExp = breadthExplanations[protectionBreadth];
      document.getElementById('protectionBreadthExplanation').innerHTML = `
        <div class="protection-who">${breadthExp.who}</div>
        <p><strong>${breadthExp.title}:</strong> ${breadthExp.text}</p>
      `;

      // Update strictness explanation
      const strictExp = strictnessExplanations[protectionStrictness];
      document.getElementById('protectionStrictnessExplanation').innerHTML = `
        <div class="protection-who">${strictExp.who}</div>
        <p><strong>${strictExp.title}:</strong> ${strictExp.text}</p>
      `;

      // Update balance indicator (0-100, where 50 is balanced)
      // Lower values = favors receiving party, higher = favors disclosing
      const balance = ((protectionBreadth - 1) + (protectionStrictness - 1)) / 4 * 100;
      document.getElementById('balanceFill').style.width = balance + '%';

      updatePreview();
    }

    // ============================================
    // NDA TYPE TOGGLE
    // ============================================
    function setNdaType(type) {
      ndaType = type;

      // Update toggle buttons
      document.querySelectorAll('.toggle-option').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.value === type);
      });

      // Update info box and labels
      const infoBox = document.getElementById('ndaTypeInfo');
      if (type === 'mutual') {
        infoBox.innerHTML = `
          <div class="info-box-title">Mutual NDA</div>
          <p>Both sides share secrets and both must keep them confidential. Best for partnerships, joint ventures, or when both parties will be sharing sensitive information.</p>
        `;
        document.getElementById('partyALabel').textContent = 'Party A (Your Company)';
        document.getElementById('partyBLabel').textContent = 'Party B (Other Party)';
      } else {
        infoBox.innerHTML = `
          <div class="info-box-title">One-Way NDA</div>
          <p>Only one party shares confidential information. The other party receives it and must keep it secret. Use when you're sharing your secrets with someone who won't share theirs (e.g., pitching to investors, hiring contractors).</p>
        `;
        document.getElementById('partyALabel').textContent = 'Disclosing Party (Sharing Info)';
        document.getElementById('partyBLabel').textContent = 'Receiving Party (Receiving Info)';
      }

      updatePreview();

      // Scroll to top of document preview
      setTimeout(() => {
        const docBody = document.querySelector('.document-body');
        if (docBody) {
          docBody.scrollTo({ top: 0, behavior: 'smooth' });
        }
      }, 100);
    }

    // ============================================
    // PURPOSE SELECTION
    // ============================================
    function selectPurpose(element, purpose) {
      selectedPurpose = purpose;

      // Update pill selection
      document.querySelectorAll('.pill-option').forEach(pill => {
        pill.classList.remove('selected');
      });
      element.classList.add('selected');

      // Show/hide custom field
      const customField = document.getElementById('customPurposeField');
      customField.style.display = purpose === 'custom' ? 'block' : 'none';

      updatePreview();

      // Scroll to purpose in preview
      scrollToPurposeInPreview();
    }

    // ============================================
    // QUICK ACTIONS
    // ============================================
    function setTerm(years) {
      document.getElementById('termYears').value = years;
      updatePreview();
    }

    function setDateToday() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('effectiveDate').value = today;
      updatePreview();
    }

    // ============================================
    // PREVIEW UPDATE
    // ============================================
    function updatePreview() {
      const getValue = (id, fallback = '') => {
        const el = document.getElementById(id);
        return el ? (el.value || fallback) : fallback;
      };

      // highlight function with data-field attribute for scroll-to-view and inline editing
      const highlight = (value, placeholder, fieldId = '') => {
        const dataAttr = fieldId ? `data-field="${fieldId}"` : '';
        const editable = fieldId ? 'contenteditable="true"' : '';
        if (!value || value === '') {
          return `<span class="doc-highlight empty" ${dataAttr} ${editable}>[${placeholder}]</span>`;
        }
        return `<span class="doc-highlight" ${dataAttr} ${editable}>${escapeHtml(value)}</span>`;
      };

      // Get values
      const effectiveDate = formatDate(getValue('effectiveDate'));
      const partyAName = getValue('partyAName');
      const partyAState = getValue('partyAState');
      const partyAEntity = formatEntityType(getValue('partyAEntity', 'corporation'));
      const partyAAddress = getValue('partyAAddress');
      const partyBName = getValue('partyBName');
      const partyBState = getValue('partyBState');
      const partyBEntity = formatEntityType(getValue('partyBEntity', 'corporation'));
      const partyBAddress = getValue('partyBAddress');
      const termYears = getValue('termYears', '2');
      const survivalYears = getValue('survivalYears', '3');
      const governingState = getValue('governingState', 'California');
      const jurisdiction = getValue('jurisdiction');

      // Get purpose text
      let purposeText = purposeTexts[selectedPurpose];
      if (selectedPurpose === 'custom') {
        purposeText = getValue('customPurpose') || 'a potential business relationship';
      }

      // Get signer info
      const signerNameA = getValue('signerNameA');
      const signerTitleA = getValue('signerTitleA');
      const signerNameB = getValue('signerNameB');
      const signerTitleB = getValue('signerTitleB');

      // Get optional clause settings
      const clauses = {
        marking: document.getElementById('clauseMarking')?.checked || false,
        nonSolicitation: document.getElementById('clauseNonSolicitation')?.checked || false,
        nonCircumvention: document.getElementById('clauseNonCircumvention')?.checked || false,
        residuals: document.getElementById('clauseResiduals')?.checked || false,
        returnMaterials: document.getElementById('clauseReturnMaterials')?.checked || true,
        noLicense: document.getElementById('clauseNoLicense')?.checked || true,
        standstill: document.getElementById('clauseStandstill')?.checked || false
      };

      // Get protection level settings
      const protection = {
        breadth: protectionBreadth || 2,
        strictness: protectionStrictness || 2
      };

      // Build document HTML - pass highlight function that includes field IDs
      let html = '';

      // Create field-specific highlight wrappers
      const h = {
        effectiveDate: (v, p) => highlight(v, p, 'effectiveDate'),
        partyAName: (v, p) => highlight(v, p, 'partyAName'),
        partyAState: (v, p) => highlight(v, p, 'partyAState'),
        partyAEntity: (v, p) => highlight(v, p, 'partyAEntity'),
        partyAAddress: (v, p) => highlight(v, p, 'partyAAddress'),
        partyBName: (v, p) => highlight(v, p, 'partyBName'),
        partyBState: (v, p) => highlight(v, p, 'partyBState'),
        partyBEntity: (v, p) => highlight(v, p, 'partyBEntity'),
        partyBAddress: (v, p) => highlight(v, p, 'partyBAddress'),
        purposeText: (v, p) => highlight(v, p, 'purpose'),
        termYears: (v, p) => highlight(v, p, 'termYears'),
        survivalYears: (v, p) => highlight(v, p, 'survivalYears'),
        governingState: (v, p) => highlight(v, p, 'governingState'),
        jurisdiction: (v, p) => highlight(v, p, 'jurisdiction'),
      };

      if (ndaType === 'mutual') {
        html = buildMutualNDA({
          effectiveDate, partyAName, partyAState, partyAEntity, partyAAddress,
          partyBName, partyBState, partyBEntity, partyBAddress,
          purposeText, termYears, survivalYears, governingState, jurisdiction,
          signerNameA, signerTitleA, signerNameB, signerTitleB,
          clauses, protection, h
        });
      } else {
        html = buildOneWayNDA({
          effectiveDate, partyAName, partyAState, partyAEntity, partyAAddress,
          partyBName, partyBState, partyBEntity, partyBAddress,
          purposeText, termYears, survivalYears, governingState, jurisdiction,
          signerNameA, signerTitleA, signerNameB, signerTitleB,
          clauses, protection, h
        });
      }

      document.getElementById('documentPreview').innerHTML = html;
    }

    // ============================================
    // SCROLL-TO-VIEW FUNCTIONALITY
    // ============================================

    // Add input listeners to track field changes and scroll to corresponding preview element
    function setupScrollToView() {
      const textFields = [
        'partyAName', 'partyAAddress',
        'partyBName', 'partyBAddress',
        'termYears', 'survivalYears', 'jurisdiction',
        'effectiveDate', 'customPurpose'
      ];

      const selectFields = [
        'partyAState', 'partyAEntity',
        'partyBState', 'partyBEntity',
        'governingState'
      ];

      // Text inputs - listen for input events
      textFields.forEach(fieldId => {
        const el = document.getElementById(fieldId);
        if (el) {
          el.addEventListener('input', () => scrollToFieldInPreview(fieldId));
          el.addEventListener('focus', () => scrollToFieldInPreview(fieldId));
        }
      });

      // Select dropdowns - listen for change events
      selectFields.forEach(fieldId => {
        const el = document.getElementById(fieldId);
        if (el) {
          el.addEventListener('change', () => scrollToFieldInPreview(fieldId));
          el.addEventListener('focus', () => scrollToFieldInPreview(fieldId));
        }
      });
    }

    // Scroll to a field's corresponding highlight in the preview
    function scrollToFieldInPreview(fieldId) {
      // Wait for preview to update
      setTimeout(() => {
        const docPreview = document.getElementById('documentPreview');
        const docBody = document.querySelector('.document-body');
        if (!docPreview || !docBody) return;

        // Find the highlight element using data-field attribute
        let targetElement = docPreview.querySelector(`.doc-highlight[data-field="${fieldId}"]`);

        // If not found by data-field, try first occurrence for certain fields
        if (!targetElement) {
          const highlights = docPreview.querySelectorAll('.doc-highlight');
          targetElement = findHighlightForField(fieldId, highlights);
        }

        if (targetElement) {
          scrollToAndFlash(targetElement, docBody);
        }
      }, 100);
    }

    // Scroll to purpose section when purpose is changed
    function scrollToPurposeInPreview() {
      setTimeout(() => {
        const docPreview = document.getElementById('documentPreview');
        const docBody = document.querySelector('.document-body');
        if (!docPreview || !docBody) return;

        // Find the highlight with data-field="purpose"
        let targetElement = docPreview.querySelector('.doc-highlight[data-field="purpose"]');

        if (targetElement) {
          scrollToAndFlash(targetElement, docBody);
        }
      }, 100);
    }

    // Find highlight element for a given field ID
    function findHighlightForField(fieldId, highlights) {
      const inputValue = document.getElementById(fieldId)?.value;

      for (const h of highlights) {
        // Check if the highlight's data-field matches
        if (h.dataset.field === fieldId) {
          return h;
        }

        // Fallback: check by content matching
        if (inputValue && h.textContent.trim() === inputValue) {
          return h;
        }
      }

      return null;
    }

    // Scroll to element and apply flash animation
    function scrollToAndFlash(targetElement, docBody) {
      // Remove flash from all highlights first
      docBody.querySelectorAll('.doc-highlight').forEach(h => h.classList.remove('flash'));

      // Calculate scroll position to center the element
      const docBodyRect = docBody.getBoundingClientRect();
      const targetRect = targetElement.getBoundingClientRect();
      const scrollTop = docBody.scrollTop + (targetRect.top - docBodyRect.top) - (docBodyRect.height / 3);

      docBody.scrollTo({
        top: Math.max(0, scrollTop),
        behavior: 'smooth'
      });

      // Add flash animation after scroll
      setTimeout(() => {
        targetElement.classList.add('flash');
      }, 300);
    }

    // Initialize scroll-to-view after DOM is ready
    document.addEventListener('DOMContentLoaded', setupScrollToView);

    // ============================================
    // INLINE EDITING IN PREVIEW
    // ============================================

    // Map data-field values to form input IDs and their type
    const fieldInputMap = {
      'effectiveDate': { inputId: 'effectiveDate', type: 'date' },
      'partyAName': { inputId: 'partyAName', type: 'text' },
      'partyAState': { inputId: 'partyAState', type: 'select' },
      'partyAEntity': { inputId: 'partyAEntity', type: 'select' },
      'partyAAddress': { inputId: 'partyAAddress', type: 'text' },
      'partyBName': { inputId: 'partyBName', type: 'text' },
      'partyBState': { inputId: 'partyBState', type: 'select' },
      'partyBEntity': { inputId: 'partyBEntity', type: 'select' },
      'partyBAddress': { inputId: 'partyBAddress', type: 'text' },
      'termYears': { inputId: 'termYears', type: 'number' },
      'survivalYears': { inputId: 'survivalYears', type: 'number' },
      'governingState': { inputId: 'governingState', type: 'select' },
      'jurisdiction': { inputId: 'jurisdiction', type: 'text' },
      'purpose': { inputId: null, type: 'purpose' } // Special handling for purpose
    };

    // Setup inline editing
    function setupInlineEditing() {
      const docPreview = document.getElementById('documentPreview');

      // Event delegation for blur events on contenteditable spans
      docPreview.addEventListener('blur', function(e) {
        if (e.target.classList.contains('doc-highlight') && e.target.dataset.field) {
          handleInlineEdit(e.target);
        }
      }, true);

      // Handle Enter key to blur (submit)
      docPreview.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && e.target.classList.contains('doc-highlight')) {
          e.preventDefault();
          e.target.blur();
        }
      });

      // Clear placeholder text on focus
      docPreview.addEventListener('focus', function(e) {
        if (e.target.classList.contains('doc-highlight') && e.target.classList.contains('empty')) {
          // Clear placeholder text when user starts editing
          const text = e.target.textContent;
          if (text.startsWith('[') && text.endsWith(']')) {
            e.target.textContent = '';
            e.target.classList.remove('empty');
          }
        }
      }, true);
    }

    // Handle inline edit - sync back to form inputs
    function handleInlineEdit(element) {
      const fieldId = element.dataset.field;
      const newValue = element.textContent.trim();
      const mapping = fieldInputMap[fieldId];

      if (!mapping) return;

      // Special handling for purpose (read-only for now, as it's complex)
      if (mapping.type === 'purpose') {
        // Purpose requires selecting from predefined options, show toast
        showToast('Use the Purpose buttons in the sidebar to change this');
        updatePreview(); // Reset to current value
        return;
      }

      const inputEl = document.getElementById(mapping.inputId);
      if (!inputEl) return;

      // Handle different input types
      if (mapping.type === 'date') {
        // Parse the formatted date back to YYYY-MM-DD
        const parsedDate = parseDateString(newValue);
        if (parsedDate) {
          inputEl.value = parsedDate;
        } else {
          showToast('Invalid date format');
        }
      } else if (mapping.type === 'select') {
        // For selects, try to match the value or show toast
        const options = Array.from(inputEl.options);
        const matchedOption = options.find(opt =>
          opt.text.toLowerCase() === newValue.toLowerCase() ||
          opt.value.toLowerCase() === newValue.toLowerCase()
        );
        if (matchedOption) {
          inputEl.value = matchedOption.value;
        } else {
          showToast('Please select from the dropdown in the sidebar');
        }
      } else if (mapping.type === 'number') {
        const numValue = parseInt(newValue, 10);
        if (!isNaN(numValue) && numValue > 0) {
          inputEl.value = numValue;
        } else {
          showToast('Please enter a valid number');
        }
      } else {
        // Text input - direct sync
        inputEl.value = newValue;
      }

      // Update preview to reflect changes and ensure consistency
      updatePreview();
    }

    // Parse date string like "December 8, 2025" back to "2025-12-08"
    function parseDateString(dateStr) {
      try {
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return null;
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      } catch {
        return null;
      }
    }

    // Initialize inline editing after DOM is ready
    document.addEventListener('DOMContentLoaded', setupInlineEditing);

    function buildMutualNDA(d) {
      const h = d.h;
      return `
        <div class="doc-title">MUTUAL NON-DISCLOSURE AGREEMENT</div>

        <div class="doc-paragraph">
          This Mutual Non-Disclosure Agreement (this "<span class="doc-defined-term">Agreement</span>") is entered into as of ${h.effectiveDate(d.effectiveDate, 'DATE')} (the "<span class="doc-defined-term">Effective Date</span>") by and between:
        </div>

        <div class="doc-paragraph">
          <strong>PARTY A:</strong> ${h.partyAName(d.partyAName, 'PARTY A NAME')}, a ${h.partyAState(d.partyAState, 'STATE')} ${h.partyAEntity(d.partyAEntity, 'ENTITY TYPE')}, with its principal place of business at ${h.partyAAddress(d.partyAAddress, 'ADDRESS')} ("<span class="doc-defined-term">Party A</span>"); and
        </div>

        <div class="doc-paragraph">
          <strong>PARTY B:</strong> ${h.partyBName(d.partyBName, 'PARTY B NAME')}, a ${h.partyBState(d.partyBState, 'STATE')} ${h.partyBEntity(d.partyBEntity, 'ENTITY TYPE')}, with its principal place of business at ${h.partyBAddress(d.partyBAddress, 'ADDRESS')} ("<span class="doc-defined-term">Party B</span>").
        </div>

        <div class="doc-paragraph">
          Party A and Party B are each referred to herein as a "<span class="doc-defined-term">Party</span>" and collectively as the "<span class="doc-defined-term">Parties</span>."
        </div>

        <div class="doc-clause-title">RECITALS</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">WHEREAS</span>, the Parties wish to explore and evaluate ${h.purposeText(d.purposeText, 'PURPOSE')} (the "<span class="doc-defined-term">Purpose</span>"); and
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">WHEREAS</span>, in connection with the Purpose, each Party may disclose to the other Party certain confidential and proprietary information; and
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">WHEREAS</span>, the Parties desire to set forth the terms and conditions under which such confidential information will be disclosed and protected;
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">NOW, THEREFORE</span>, in consideration of the mutual covenants and agreements set forth herein, and for other good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the Parties agree as follows:
        </div>

        <div class="doc-clause-title">ARTICLE 1. DEFINITIONS</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">1.1</span> "<span class="doc-defined-term">Confidential Information</span>" means any and all non-public, confidential, or proprietary information disclosed by either Party (the "<span class="doc-defined-term">Disclosing Party</span>") to the other Party (the "<span class="doc-defined-term">Receiving Party</span>"), whether disclosed orally, in writing, electronically, or by any other means, and whether or not marked as "confidential" or "proprietary," including but not limited to:
        </div>

        <div class="doc-paragraph doc-indent">
          (a) Trade secrets, inventions, ideas, processes, formulas, algorithms, software (including source code and object code), data, programs, and other works of authorship;
        </div>

        <div class="doc-paragraph doc-indent">
          (b) Technical information, including research, development, procedures, designs, drawings, engineering, hardware configuration, and know-how;
        </div>

        <div class="doc-paragraph doc-indent">
          (c) Business information, including financial information, costs, pricing, business and marketing plans, strategies, forecasts, customer and supplier lists, and contract terms;
        </div>

        <div class="doc-paragraph doc-indent">
          (d) Information regarding the existence, terms, or status of discussions or negotiations between the Parties; and
        </div>

        <div class="doc-paragraph doc-indent">
          (e) Any notes, analyses, compilations, studies, summaries, and other materials prepared by the Receiving Party that contain or are based upon, in whole or in part, the information described above.
        </div>

        <div class="doc-clause-title">ARTICLE 2. EXCLUSIONS FROM CONFIDENTIAL INFORMATION</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">2.1</span> Confidential Information does not include information that:
        </div>

        <div class="doc-paragraph doc-indent">
          (a) Is or becomes generally available to the public other than as a result of disclosure by the Receiving Party;
        </div>

        <div class="doc-paragraph doc-indent">
          (b) Was in the Receiving Party's possession prior to disclosure by the Disclosing Party, as evidenced by written records;
        </div>

        <div class="doc-paragraph doc-indent">
          (c) Is independently developed by the Receiving Party without use of or reference to the Disclosing Party's Confidential Information; or
        </div>

        <div class="doc-paragraph doc-indent">
          (d) Is obtained by the Receiving Party from a third party who is lawfully in possession of such information.
        </div>

        <div class="doc-clause-title">ARTICLE 3. OBLIGATIONS OF RECEIVING PARTY</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">3.1</span> The Receiving Party agrees to hold and maintain the Confidential Information in strict confidence using at least the same degree of care that it uses to protect its own confidential information, but in no event less than reasonable care.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">3.2</span> The Receiving Party shall not disclose any Confidential Information to any person or entity, except to those of its directors, officers, employees, agents, and advisors who have a need to know such information in connection with the Purpose and who are bound by confidentiality obligations at least as protective as the terms of this Agreement.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">3.3</span> The Receiving Party shall not use any Confidential Information for any purpose other than the Purpose without the prior written consent of the Disclosing Party.
        </div>

        <div class="doc-clause-title">ARTICLE 4. COMPELLED DISCLOSURE</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">4.1</span> If the Receiving Party becomes legally compelled to disclose any Confidential Information, the Receiving Party shall provide the Disclosing Party with prompt prior written notice so that the Disclosing Party may seek a protective order or other appropriate remedy.
        </div>

        <div class="doc-clause-title">ARTICLE 5. RETURN OF CONFIDENTIAL INFORMATION</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">5.1</span> Upon the written request of the Disclosing Party or upon termination of this Agreement, the Receiving Party shall promptly return or destroy all tangible materials containing Confidential Information and provide written certification of such destruction if requested.
        </div>

        <div class="doc-clause-title">ARTICLE 6. TERM AND SURVIVAL</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">6.1</span> <span class="doc-defined-term">Term</span>. This Agreement shall commence on the Effective Date and shall continue for a period of ${h.termYears(d.termYears, 'NUMBER')} year(s) from the Effective Date, unless earlier terminated by either Party upon thirty (30) days' prior written notice.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">6.2</span> <span class="doc-defined-term">Survival</span>. The obligations of confidentiality and non-use shall survive the expiration or termination of this Agreement for a period of ${h.survivalYears(d.survivalYears, 'NUMBER')} year(s) following such expiration or termination.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">6.3</span> <span class="doc-defined-term">Trade Secrets</span>. Notwithstanding the foregoing, with respect to any Confidential Information that constitutes a trade secret under applicable law, the obligations of confidentiality and non-use shall continue for as long as such information remains a trade secret.
        </div>

        ${buildOptionalClauses(d.clauses, 7).html}

        <div class="doc-clause-title">ARTICLE ${7 + countOptionalClauses(d.clauses)}. REMEDIES</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">${7 + countOptionalClauses(d.clauses)}.1</span> Each Party acknowledges that any breach or threatened breach of this Agreement may cause irreparable harm to the other Party for which monetary damages may be inadequate. Accordingly, either Party shall be entitled to seek equitable relief, including injunction and specific performance, in addition to all other remedies available at law or in equity, without the necessity of proving actual damages or posting any bond.
        </div>

        <div class="doc-clause-title">ARTICLE ${8 + countOptionalClauses(d.clauses)}. MISCELLANEOUS</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">${8 + countOptionalClauses(d.clauses)}.1</span> <span class="doc-defined-term">Governing Law</span>. This Agreement shall be governed by and construed in accordance with the laws of the State of ${h.governingState(d.governingState, 'STATE')}, without regard to its conflict of laws principles.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">${8 + countOptionalClauses(d.clauses)}.2</span> <span class="doc-defined-term">Jurisdiction</span>. Any action arising out of or relating to this Agreement shall be brought exclusively in the state or federal courts located in ${h.jurisdiction(d.jurisdiction, 'COUNTY, STATE')}.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">${8 + countOptionalClauses(d.clauses)}.3</span> <span class="doc-defined-term">Entire Agreement</span>. This Agreement constitutes the entire agreement between the Parties with respect to the subject matter hereof and supersedes all prior agreements and understandings.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">${8 + countOptionalClauses(d.clauses)}.4</span> <span class="doc-defined-term">Amendment</span>. This Agreement may not be amended except by a written instrument signed by both Parties.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">${8 + countOptionalClauses(d.clauses)}.5</span> <span class="doc-defined-term">Counterparts</span>. This Agreement may be executed in counterparts, including by electronic signature, each of which shall be deemed an original.
        </div>

        <div class="doc-paragraph" style="margin-top: 32px;">
          <strong>IN WITNESS WHEREOF</strong>, the Parties have executed this Mutual Non-Disclosure Agreement as of the Effective Date first written above.
        </div>

        <div class="doc-signature-block">
          <div class="doc-signature-party">
            <strong>PARTY A:</strong><br>
            ${h.partyAName(d.partyAName, 'PARTY A NAME')}
            <div class="doc-signature-line">Signature: ${getSignatureHtml('A') || '_____________________'}</div>
            <div class="doc-signature-line">Name: ${d.signerNameA || '_____________________'}</div>
            <div class="doc-signature-line">Title: ${d.signerTitleA || '_____________________'}</div>
            <div class="doc-signature-line">Date: _____________________</div>
          </div>
          <div class="doc-signature-party">
            <strong>PARTY B:</strong><br>
            ${h.partyBName(d.partyBName, 'PARTY B NAME')}
            <div class="doc-signature-line">Signature: ${getSignatureHtml('B') || '_____________________'}</div>
            <div class="doc-signature-line">Name: ${d.signerNameB || '_____________________'}</div>
            <div class="doc-signature-line">Title: ${d.signerTitleB || '_____________________'}</div>
            <div class="doc-signature-line">Date: _____________________</div>
          </div>
        </div>
      `;
    }

    function buildOneWayNDA(d) {
      const h = d.h;
      return `
        <div class="doc-title">NON-DISCLOSURE AGREEMENT</div>

        <div class="doc-paragraph">
          This Non-Disclosure Agreement (this "<span class="doc-defined-term">Agreement</span>") is entered into as of ${h.effectiveDate(d.effectiveDate, 'DATE')} (the "<span class="doc-defined-term">Effective Date</span>") by and between:
        </div>

        <div class="doc-paragraph">
          <strong>DISCLOSING PARTY:</strong> ${h.partyAName(d.partyAName, 'DISCLOSING PARTY NAME')}, a ${h.partyAState(d.partyAState, 'STATE')} ${h.partyAEntity(d.partyAEntity, 'ENTITY TYPE')}, with its principal place of business at ${h.partyAAddress(d.partyAAddress, 'ADDRESS')} (the "<span class="doc-defined-term">Disclosing Party</span>"); and
        </div>

        <div class="doc-paragraph">
          <strong>RECEIVING PARTY:</strong> ${h.partyBName(d.partyBName, 'RECEIVING PARTY NAME')}, a ${h.partyBState(d.partyBState, 'STATE')} ${h.partyBEntity(d.partyBEntity, 'ENTITY TYPE')}, with its principal place of business at ${h.partyBAddress(d.partyBAddress, 'ADDRESS')} (the "<span class="doc-defined-term">Receiving Party</span>").
        </div>

        <div class="doc-clause-title">RECITALS</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">WHEREAS</span>, the Disclosing Party possesses certain confidential and proprietary information relating to ${h.purposeText(d.purposeText, 'PURPOSE')} (the "<span class="doc-defined-term">Purpose</span>"); and
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">WHEREAS</span>, the Disclosing Party desires to disclose such confidential information to the Receiving Party for the Purpose, and the Receiving Party desires to receive such information subject to the terms and conditions of this Agreement;
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">NOW, THEREFORE</span>, in consideration of the mutual covenants and agreements set forth herein, and for other good and valuable consideration, the receipt and sufficiency of which are hereby acknowledged, the parties agree as follows:
        </div>

        <div class="doc-clause-title">ARTICLE 1. CONFIDENTIAL INFORMATION</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">1.1</span> "<span class="doc-defined-term">Confidential Information</span>" means any and all non-public, confidential, or proprietary information disclosed by the Disclosing Party to the Receiving Party, whether disclosed orally, in writing, electronically, or by any other means, including but not limited to trade secrets, technical data, know-how, research, business information, customer lists, financial information, and any other information designated as confidential.
        </div>

        <div class="doc-clause-title">ARTICLE 2. RECEIVING PARTY'S OBLIGATIONS</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">2.1</span> The Receiving Party agrees to:
        </div>

        <div class="doc-paragraph doc-indent">
          (a) Hold and maintain the Confidential Information in strict confidence using at least the same degree of care that it uses to protect its own confidential information, but in no event less than reasonable care;
        </div>

        <div class="doc-paragraph doc-indent">
          (b) Not disclose any Confidential Information to any third party without the prior written consent of the Disclosing Party;
        </div>

        <div class="doc-paragraph doc-indent">
          (c) Not use any Confidential Information for any purpose other than the Purpose; and
        </div>

        <div class="doc-paragraph doc-indent">
          (d) Limit disclosure of Confidential Information to those of its employees and agents who have a need to know and who are bound by confidentiality obligations at least as protective as this Agreement.
        </div>

        <div class="doc-clause-title">ARTICLE 3. EXCLUSIONS</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">3.1</span> The obligations of confidentiality shall not apply to information that: (a) is or becomes publicly available through no fault of the Receiving Party; (b) was rightfully in the Receiving Party's possession prior to disclosure; (c) is independently developed by the Receiving Party; or (d) is rightfully obtained from a third party without restriction.
        </div>

        <div class="doc-clause-title">ARTICLE 4. TERM AND SURVIVAL</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">4.1</span> This Agreement shall continue for ${h.termYears(d.termYears, 'NUMBER')} year(s) from the Effective Date unless earlier terminated. The confidentiality obligations shall survive for ${h.survivalYears(d.survivalYears, 'NUMBER')} year(s) following termination, except that trade secrets shall be protected indefinitely.
        </div>

        <div class="doc-clause-title">ARTICLE 5. RETURN OF INFORMATION</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">5.1</span> Upon request or termination, the Receiving Party shall promptly return or destroy all Confidential Information and certify such destruction in writing.
        </div>

        <div class="doc-clause-title">ARTICLE 6. REMEDIES</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">6.1</span> The Receiving Party acknowledges that unauthorized disclosure may cause irreparable harm. The Disclosing Party shall be entitled to seek injunctive relief in addition to any other remedies available at law or equity.
        </div>

        <div class="doc-clause-title">ARTICLE 7. MISCELLANEOUS</div>

        <div class="doc-paragraph">
          <span class="doc-section-num">7.1</span> <span class="doc-defined-term">Governing Law</span>. This Agreement shall be governed by the laws of the State of ${h.governingState(d.governingState, 'STATE')}.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">7.2</span> <span class="doc-defined-term">Jurisdiction</span>. Any disputes shall be resolved in the courts of ${h.jurisdiction(d.jurisdiction, 'COUNTY, STATE')}.
        </div>

        <div class="doc-paragraph">
          <span class="doc-section-num">7.3</span> <span class="doc-defined-term">Entire Agreement</span>. This Agreement constitutes the entire understanding between the parties and may only be amended in writing signed by both parties.
        </div>

        <div class="doc-paragraph" style="margin-top: 32px;">
          <strong>IN WITNESS WHEREOF</strong>, the parties have executed this Non-Disclosure Agreement as of the Effective Date.
        </div>

        <div class="doc-signature-block">
          <div class="doc-signature-party">
            <strong>DISCLOSING PARTY:</strong><br>
            ${h.partyAName(d.partyAName, 'DISCLOSING PARTY NAME')}
            <div class="doc-signature-line">Signature: ${getSignatureHtml('A') || '_____________________'}</div>
            <div class="doc-signature-line">Name: ${d.signerNameA || '_____________________'}</div>
            <div class="doc-signature-line">Title: ${d.signerTitleA || '_____________________'}</div>
            <div class="doc-signature-line">Date: _____________________</div>
          </div>
          <div class="doc-signature-party">
            <strong>RECEIVING PARTY:</strong><br>
            ${h.partyBName(d.partyBName, 'RECEIVING PARTY NAME')}
            <div class="doc-signature-line">Signature: ${getSignatureHtml('B') || '_____________________'}</div>
            <div class="doc-signature-line">Name: ${d.signerNameB || '_____________________'}</div>
            <div class="doc-signature-line">Title: ${d.signerTitleB || '_____________________'}</div>
            <div class="doc-signature-line">Date: _____________________</div>
          </div>
        </div>
      `;
    }

    // ============================================
    // OPTIONAL CLAUSE BUILDERS
    // ============================================

    function countOptionalClauses(clauses) {
      let count = 0;
      if (clauses.nonSolicitation) count++;
      if (clauses.nonCircumvention) count++;
      if (clauses.residuals) count++;
      if (clauses.noLicense) count++;
      return count;
    }

    function buildOptionalClauses(clauses, articleNum) {
      let html = '';
      let num = articleNum;

      // Marking Requirement (modifies the definition, not a separate clause)
      // Handled in the main definition section

      // Non-Solicitation Clause
      if (clauses.nonSolicitation) {
        html += `
        <div class="doc-clause-title">ARTICLE ${num}. NON-SOLICITATION</div>
        <div class="doc-paragraph">
          <span class="doc-section-num">${num}.1</span> During the term of this Agreement and for a period of one (1) year following its termination, neither Party shall, directly or indirectly, solicit, recruit, or hire any employee of the other Party with whom such Party had contact or about whom such Party received Confidential Information in connection with the Purpose.
        </div>
        <div class="doc-paragraph">
          <span class="doc-section-num">${num}.2</span> This provision shall not restrict general advertising or recruitment efforts not specifically targeted at employees of the other Party.
        </div>
        `;
        num++;
      }

      // Non-Circumvention Clause
      if (clauses.nonCircumvention) {
        html += `
        <div class="doc-clause-title">ARTICLE ${num}. NON-CIRCUMVENTION</div>
        <div class="doc-paragraph">
          <span class="doc-section-num">${num}.1</span> During the term of this Agreement and for a period of two (2) years following its termination, neither Party shall directly or indirectly contact, negotiate with, or enter into any agreement with any third party introduced by the other Party in connection with the Purpose, without the prior written consent of the introducing Party.
        </div>
        <div class="doc-paragraph">
          <span class="doc-section-num">${num}.2</span> Neither Party shall attempt to circumvent the other Party to avoid payment of fees, commissions, or other compensation that may be owed under any related agreement.
        </div>
        `;
        num++;
      }

      // Residuals Clause
      if (clauses.residuals) {
        html += `
        <div class="doc-clause-title">ARTICLE ${num}. RESIDUAL KNOWLEDGE</div>
        <div class="doc-paragraph">
          <span class="doc-section-num">${num}.1</span> Notwithstanding any other provision of this Agreement, either Party may use <span class="doc-defined-term">Residual Information</span> for any purpose. "Residual Information" means ideas, concepts, know-how, or techniques contained in the Confidential Information that are retained in the unaided memories of the Receiving Party's employees who have had access to the Confidential Information.
        </div>
        <div class="doc-paragraph">
          <span class="doc-section-num">${num}.2</span> An employee's memory is unaided if the employee has not intentionally memorized the Confidential Information for the purpose of retaining and subsequently using or disclosing it. This provision does not grant any license under any intellectual property rights.
        </div>
        `;
        num++;
      }

      // No License Clause
      if (clauses.noLicense) {
        html += `
        <div class="doc-clause-title">ARTICLE ${num}. NO LICENSE OR OWNERSHIP</div>
        <div class="doc-paragraph">
          <span class="doc-section-num">${num}.1</span> Nothing in this Agreement shall be construed as granting any rights, by license or otherwise, to any Confidential Information, or to any patent, copyright, trademark, trade secret, or other intellectual property right of the Disclosing Party.
        </div>
        <div class="doc-paragraph">
          <span class="doc-section-num">${num}.2</span> All Confidential Information shall remain the exclusive property of the Disclosing Party, and the Receiving Party shall have no rights therein except the limited right to use such information solely for the Purpose.
        </div>
        `;
        num++;
      }

      return { html, nextArticle: num };
    }

    // ============================================
    // UTILITY FUNCTIONS
    // ============================================
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString + 'T00:00:00');
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('en-US', options);
    }

    function formatEntityType(type) {
      const types = {
        'corporation': 'corporation',
        'llc': 'limited liability company',
        'partnership': 'partnership',
        'individual': 'individual'
      };
      return types[type] || type;
    }

    // ============================================
    // DOCUMENT ACTIONS
    // ============================================
    function copyDocument() {
      const docBody = document.getElementById('documentPreview');
      const text = docBody.innerText;

      navigator.clipboard.writeText(text).then(() => {
        showToast('Copied to clipboard!');
      }).catch(() => {
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showToast('Copied to clipboard!');
      });
    }

    function downloadWord() {
      const docBody = document.getElementById('documentPreview');
      const content = docBody.innerHTML;

      const html = `
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <style>
            body { font-family: Georgia, serif; font-size: 12pt; line-height: 1.6; max-width: 8.5in; margin: 1in; }
            .doc-title { text-align: center; font-size: 14pt; font-weight: bold; margin-bottom: 24px; }
            .doc-clause-title { font-weight: bold; margin-top: 18px; margin-bottom: 12px; }
            .doc-section-num { font-weight: bold; }
            .doc-defined-term { font-weight: 600; }
            .doc-highlight { background: #fff3cd; padding: 2px 4px; }
            .doc-indent { margin-left: 0.5in; }
            .doc-signature-block { margin-top: 40px; }
            .doc-signature-party { margin-bottom: 20px; }
            .doc-signature-line { margin-top: 30px; border-top: 1px solid black; padding-top: 4px; }
          </style>
        </head>
        <body>${content}</body>
        </html>
      `;

      const blob = new Blob([html], { type: 'application/msword' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'NDA-Agreement.doc';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('Downloaded as Word document');
    }

    function downloadPDF() {
      showToast('Opening print dialog for PDF...');
      window.print();
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    function scrollToPreview() {
      document.querySelector('.preview-panel').scrollIntoView({ behavior: 'smooth' });
    }

    // Print styles
    const printStyles = document.createElement('style');
    printStyles.textContent = `
      @media print {
        .site-header, .hero, .builder-sidebar, .preview-toolbar, .attorney-cta,
        .explanation-panel, .site-footer, .scroll-indicator, .toast { display: none !important; }
        .builder-layout { display: block !important; }
        .preview-panel { padding: 0 !important; background: white !important; }
        .document-container { box-shadow: none !important; border: none !important; }
        .document-body { max-height: none !important; }
        .doc-highlight { background: transparent !important; border: none !important; }
      }
    `;
    document.head.appendChild(printStyles);

    // ============================================
    // SIGNATURE FUNCTIONALITY
    // ============================================

    // Signature state
    const signatures = {
      A: { type: 'draw', dataUrl: null, typedText: '' },
      B: { type: 'draw', dataUrl: null, typedText: '' }
    };

    // Canvas contexts
    let canvasContexts = {};
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    // Initialize signature canvases
    function initSignatureCanvases() {
      ['A', 'B'].forEach(party => {
        const canvas = document.getElementById(`signatureCanvas${party}`);
        if (!canvas) return;

        const ctx = canvas.getContext('2d');
        canvasContexts[party] = ctx;

        // Set canvas resolution for retina displays
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * 2;
        canvas.height = rect.height * 2;
        ctx.scale(2, 2);

        // Style settings
        ctx.strokeStyle = '#1a365d';
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        // Mouse events
        canvas.addEventListener('mousedown', (e) => startDrawing(e, party));
        canvas.addEventListener('mousemove', (e) => draw(e, party));
        canvas.addEventListener('mouseup', () => stopDrawing(party));
        canvas.addEventListener('mouseout', () => stopDrawing(party));

        // Touch events for mobile
        canvas.addEventListener('touchstart', (e) => {
          e.preventDefault();
          const touch = e.touches[0];
          startDrawing(touch, party);
        });
        canvas.addEventListener('touchmove', (e) => {
          e.preventDefault();
          const touch = e.touches[0];
          draw(touch, party);
        });
        canvas.addEventListener('touchend', () => stopDrawing(party));
      });
    }

    function startDrawing(e, party) {
      isDrawing = true;
      const canvas = document.getElementById(`signatureCanvas${party}`);
      const rect = canvas.getBoundingClientRect();
      lastX = e.clientX - rect.left;
      lastY = e.clientY - rect.top;
    }

    function draw(e, party) {
      if (!isDrawing) return;

      const canvas = document.getElementById(`signatureCanvas${party}`);
      const ctx = canvasContexts[party];
      const rect = canvas.getBoundingClientRect();

      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.stroke();

      lastX = x;
      lastY = y;
    }

    function stopDrawing(party) {
      if (isDrawing) {
        isDrawing = false;
        saveSignature(party);
      }
    }

    function saveSignature(party) {
      const canvas = document.getElementById(`signatureCanvas${party}`);
      signatures[party].dataUrl = canvas.toDataURL('image/png');
      updatePreview();
    }

    function clearSignature(party) {
      const canvas = document.getElementById(`signatureCanvas${party}`);
      const ctx = canvasContexts[party];
      const rect = canvas.getBoundingClientRect();
      ctx.clearRect(0, 0, rect.width, rect.height);
      signatures[party].dataUrl = null;
      updatePreview();
    }

    function setSignatureType(party, type) {
      signatures[party].type = type;

      // Update toggle buttons
      document.querySelectorAll(`.sig-toggle-btn[data-party="${party}"]`).forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === type);
      });

      // Show/hide containers
      document.getElementById(`sigDrawContainer${party}`).style.display = type === 'draw' ? 'block' : 'none';
      document.getElementById(`sigTypeContainer${party}`).style.display = type === 'type' ? 'block' : 'none';

      updatePreview();
    }

    function updateTypedSignature(party) {
      const input = document.getElementById(`signatureTyped${party}`);
      const preview = document.getElementById(`signatureTypedPreview${party}`);
      signatures[party].typedText = input.value;
      preview.textContent = input.value;
      updatePreview();
    }

    // Get signature HTML for document
    function getSignatureHtml(party) {
      const sig = signatures[party];

      if (sig.type === 'draw' && sig.dataUrl) {
        return `<img src="${sig.dataUrl}" class="doc-signature-image" alt="Signature">`;
      } else if (sig.type === 'type' && sig.typedText) {
        return `<span class="doc-signature-typed">${escapeHtml(sig.typedText)}</span>`;
      }

      return ''; // No signature yet
    }

    // Get signer info
    function getSignerInfo(party) {
      const name = document.getElementById(`signerName${party}`)?.value || '';
      const title = document.getElementById(`signerTitle${party}`)?.value || '';
      return { name, title };
    }

    // Initialize canvases after DOM is ready
    document.addEventListener('DOMContentLoaded', initSignatureCanvases);
  </script>

</body>
</html>
