<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulting Agreement Generator | Independent Consultant Contract | Terms.Law</title>
  <meta name="description" content="Free Consulting Agreement generator. Create professional consultant contracts with scope, fees, IP ownership, and confidentiality terms. Attorney-drafted.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --color-primary: #1e40af;
      --color-primary-dark: #1e3a8a;
      --color-primary-light: #3b82f6;
      --color-accent: #0891b2;
      --color-accent-light: #22d3ee;
      --color-success: #059669;
      --color-warning: #d97706;
      --color-danger: #dc2626;
      --color-bg: #f8fafc;
      --color-surface: #ffffff;
      --color-border: #e2e8f0;
      --color-border-light: #f1f5f9;
      --color-text: #0f172a;
      --color-text-secondary: #334155;
      --color-text-muted: #64748b;
      --color-text-light: #94a3b8;
      --color-dark: #0f172a;
      --color-dark-surface: #1e293b;
      --doc-bg: #fefefe;
      --doc-text: #1f2937;
      --doc-clause-title: #1e40af;
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 14px;
      --radius-full: 9999px;
      --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
      --font-serif: Georgia, 'Times New Roman', serif;
      --transition-fast: 150ms ease;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; -webkit-font-smoothing: antialiased; }
    body { font-family: var(--font-sans); font-size: 16px; line-height: 1.6; color: var(--color-text); background: var(--color-bg); }

    /* Header */
    .site-header { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); padding: 0; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); }
    .header-content { display: flex; align-items: center; justify-content: center; height: 52px; }
    .header-nav { display: flex; align-items: center; gap: 0; height: 100%; }
    .nav-link { color: #94a3b8; font-size: 0.85rem; font-weight: 600; padding: 16px 24px; transition: all 150ms ease; text-decoration: none; height: 100%; display: flex; align-items: center; text-transform: uppercase; letter-spacing: 0.05em; border-bottom: 2px solid transparent; }
    .nav-link:hover { color: #ffffff; background: rgba(255, 255, 255, 0.05); }
    .nav-link.active { color: #ffffff; background: rgba(255, 255, 255, 0.08); border-bottom-color: #3b82f6; }
    .nav-link.home-logo { padding: 12px 20px; font-size: 1.1rem; font-weight: 800; letter-spacing: -0.02em; text-transform: none; }
    .nav-link.home-logo .logo-text { background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

    /* Hero */
    .hero { background: linear-gradient(135deg, #0f172a 0%, #164e63 50%, #0e7490 100%); padding: 2rem 2rem; position: relative; }
    .hero-content { max-width: 800px; }
    .hero-badge { display: inline-flex; align-items: center; gap: 8px; padding: 6px 14px; background: rgba(8, 145, 178, 0.15); border: 1px solid rgba(8, 145, 178, 0.3); border-radius: var(--radius-full); font-size: 0.8rem; color: #67e8f9; margin-bottom: 1rem; }
    .hero h1 { font-size: 2rem; font-weight: 800; color: #fff; line-height: 1.2; margin-bottom: 0.75rem; }
    .hero h1 .highlight { background: linear-gradient(135deg, #67e8f9, #60a5fa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .hero-subtitle { font-size: 1rem; color: #94a3b8; line-height: 1.6; }

    /* Builder Layout */
    .builder-layout { display: grid; grid-template-columns: 420px 1fr; gap: 0; min-height: calc(100vh - 200px); }
    @media (max-width: 1024px) { .builder-layout { grid-template-columns: 1fr; } }

    .builder-sidebar { background: var(--color-surface); border-right: 1px solid var(--color-border); padding: 1.5rem; overflow-y: auto; max-height: calc(100vh - 150px); position: sticky; top: 52px; }
    .builder-section { margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--color-border-light); }
    .builder-section:last-child { border-bottom: none; margin-bottom: 0; }
    .builder-section-title { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-text-muted); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; }

    /* Form Elements */
    .form-group { margin-bottom: 1rem; }
    .form-label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--color-text); margin-bottom: 0.35rem; }
    .form-input, .form-textarea, .form-select { width: 100%; padding: 10px 12px; border: 1px solid var(--color-border); border-radius: var(--radius-md); font-size: 0.9rem; font-family: inherit; transition: all var(--transition-fast); background: var(--color-surface); }
    .form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1); }
    .form-textarea { min-height: 80px; resize: vertical; }
    .form-hint { font-size: 0.75rem; color: var(--color-text-muted); margin-top: 4px; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

    /* Checkbox */
    .checkbox-group { display: flex; flex-direction: column; gap: 0.5rem; }
    .checkbox-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; }
    .checkbox-item input[type="checkbox"] { width: 16px; height: 16px; }

    /* Preview Panel */
    .preview-panel { background: var(--color-bg); padding: 1.5rem; overflow-y: auto; }
    .preview-toolbar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem; }
    .preview-title { font-size: 0.8rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
    .preview-actions { display: flex; gap: 0.5rem; flex-wrap: wrap; }

    /* Buttons */
    .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; border-radius: var(--radius-md); font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all var(--transition-fast); border: none; }
    .btn-primary { background: var(--color-primary); color: #fff; }
    .btn-primary:hover { background: var(--color-primary-dark); }
    .btn-secondary { background: var(--color-surface); color: var(--color-text); border: 1px solid var(--color-border); }
    .btn-secondary:hover { border-color: var(--color-primary); color: var(--color-primary); }

    /* Document */
    .document-container { background: var(--color-surface); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); overflow: hidden; }
    .document-header { background: linear-gradient(135deg, var(--color-dark) 0%, var(--color-dark-surface) 100%); padding: 0.75rem 1.5rem; display: flex; align-items: center; justify-content: space-between; }
    .document-title { color: #fff; font-size: 0.85rem; font-weight: 600; }
    .document-status { font-size: 0.7rem; color: var(--color-accent-light); }
    .document-body { padding: 50px 60px; background: var(--doc-bg); font-family: var(--font-serif); font-size: 13px; line-height: 1.8; color: var(--doc-text); }
    .document-body.full-edit-mode { outline: 3px solid var(--color-primary); background: #fffef8; }

    /* Document Formatting */
    .doc-title { text-align: center; font-size: 18px; font-weight: bold; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 6px; }
    .doc-subtitle { text-align: center; font-size: 11px; color: var(--color-text-muted); margin-bottom: 30px; font-family: var(--font-sans); }
    .doc-section-header { font-size: 13px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; margin-top: 25px; margin-bottom: 12px; color: var(--doc-clause-title); border-bottom: 1px solid var(--color-border); padding-bottom: 5px; }
    .doc-paragraph { margin-bottom: 14px; text-align: justify; }
    .doc-list { margin: 12px 0 12px 25px; padding-left: 15px; }
    .doc-list li { margin-bottom: 8px; text-align: justify; }

    /* Highlighted Fields - CRITICAL */
    .doc-highlight { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 1px 5px; border-radius: 3px; border-bottom: 2px solid #f59e0b; font-weight: 600; cursor: text; }
    .doc-highlight:hover { background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%); }
    .doc-highlight:focus { outline: none; box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.3); }
    .doc-highlight.empty { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-bottom-color: #ef4444; color: #dc2626; }

    /* CRITICAL: Field highlight animation */
    @keyframes highlightPulse {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
      50% { transform: scale(1.02); box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
    }
    .field-highlight-animation { animation: highlightPulse 0.6s ease-out; background: linear-gradient(135deg, #fde047 0%, #facc15 100%) !important; }

    @keyframes flashContainer {
      0%, 100% { background: transparent; }
      25% { background: rgba(251, 191, 36, 0.2); box-shadow: 0 0 12px rgba(251, 191, 36, 0.3); }
      50% { background: rgba(253, 230, 138, 0.3); }
      75% { background: rgba(251, 191, 36, 0.15); }
    }
    ul.field-highlight-animation, ol.field-highlight-animation, div.field-highlight-animation { animation: flashContainer 1.5s ease; border-radius: 8px; }

    /* Signatures */
    .doc-signature-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 40px; margin-top: 50px; }
    .doc-signature-party-title { font-weight: bold; font-size: 11px; text-transform: uppercase; margin-bottom: 20px; color: var(--color-text-muted); }
    .doc-signature-line { display: flex; align-items: flex-end; margin-bottom: 10px; min-height: 35px; }
    .signature-label { width: 70px; font-size: 10px; color: var(--color-text-muted); }
    .signature-value { flex: 1; border-bottom: 1px solid #333; min-height: 30px; display: flex; align-items: flex-end; padding-bottom: 3px; }
    .typed-sig { font-family: 'Dancing Script', cursive; font-size: 24px; }

    /* Toast */
    .toast { position: fixed; bottom: 20px; right: 20px; background: var(--color-dark); color: #fff; padding: 12px 18px; border-radius: var(--radius-md); font-size: 0.85rem; box-shadow: var(--shadow-xl); transform: translateY(100px); opacity: 0; transition: all 0.3s ease; z-index: 1000; }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast.success { background: var(--color-success); }

    /* Footer */
    .site-footer { background: var(--color-dark); color: #94a3b8; padding: 2rem; text-align: center; }
    .footer-brand { font-size: 1.1rem; font-weight: 800; margin-bottom: 0.5rem; }
    .footer-brand .logo-text { background: linear-gradient(135deg, #60a5fa 0%, #a78bfa 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    @media print {
      .site-header, .hero, .builder-sidebar, .preview-toolbar, .document-header, .site-footer, .toast { display: none !important; }
      .builder-layout { display: block; }
      .preview-panel { padding: 0; }
      .document-container { box-shadow: none; }
      .document-body { padding: 0.5in; }
      .doc-highlight { background: none !important; border: none !important; padding: 0 !important; }
    }

    @media (max-width: 768px) {
      .document-body { padding: 25px 20px; }
      .doc-signature-row { grid-template-columns: 1fr; }
      .form-row { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="header-content">
      <nav class="header-nav">
        <a href="/" class="nav-link home-logo"><span class="logo-text">Terms.Law</span></a>
        <a href="/Demand-Letters/demand-letters-landing.html" class="nav-link">Demands</a>
        <a href="contract-library-landing.html" class="nav-link active">Contracts</a>
        <a href="/INC/formation-landing.html" class="nav-link">Incorporation</a>
        <a href="/Blog/" class="nav-link">Blog</a>
      </nav>
    </div>
  </header>

  <section class="hero">
    <div class="hero-content">
      <div class="hero-badge">üíº Professional Services</div>
      <h1><span class="highlight">Consulting</span> Agreement Generator</h1>
      <p class="hero-subtitle">Create professional consulting contracts with clear scope, compensation, IP ownership, and confidentiality terms. Perfect for independent consultants and freelancers.</p>
    </div>
  </section>

  <main class="builder-layout">
    <aside class="builder-sidebar">

      <!-- CONSULTANT INFO -->
      <div class="builder-section">
        <h3 class="builder-section-title">üë§ Consultant</h3>
        <div class="form-group">
          <label class="form-label">Consultant Name</label>
          <input type="text" id="consultantName" class="form-input" placeholder="John Smith" oninput="trackFieldEdit('consultantName')">
        </div>
        <div class="form-group">
          <label class="form-label">Business Name (if applicable)</label>
          <input type="text" id="consultantBusiness" class="form-input" placeholder="Smith Consulting, LLC" oninput="trackFieldEdit('consultantBusiness')">
        </div>
        <div class="form-group">
          <label class="form-label">Consultant Address</label>
          <input type="text" id="consultantAddress" class="form-input" placeholder="123 Main St, City, State ZIP" oninput="trackFieldEdit('consultantAddress')">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" id="consultantEmail" class="form-input" placeholder="john@consulting.com" oninput="trackFieldEdit('consultantEmail')">
        </div>
      </div>

      <!-- CLIENT INFO -->
      <div class="builder-section">
        <h3 class="builder-section-title">üè¢ Client</h3>
        <div class="form-group">
          <label class="form-label">Client Company Name</label>
          <input type="text" id="clientName" class="form-input" placeholder="Client Corp." oninput="trackFieldEdit('clientName')">
        </div>
        <div class="form-group">
          <label class="form-label">Client State</label>
          <select id="clientState" class="form-select" onchange="trackFieldEdit('clientState')">
            <option value="">Select state...</option>
            <option value="Delaware">Delaware</option>
            <option value="California">California</option>
            <option value="New York">New York</option>
            <option value="Texas">Texas</option>
            <option value="Florida">Florida</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Client Address</label>
          <input type="text" id="clientAddress" class="form-input" placeholder="456 Business Ave, City, State ZIP" oninput="trackFieldEdit('clientAddress')">
        </div>
      </div>

      <!-- ENGAGEMENT DETAILS -->
      <div class="builder-section">
        <h3 class="builder-section-title">üìã Engagement Details</h3>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Start Date</label>
            <input type="date" id="startDate" class="form-input" oninput="trackFieldEdit('startDate')">
          </div>
          <div class="form-group">
            <label class="form-label">End Date</label>
            <input type="date" id="endDate" class="form-input" oninput="trackFieldEdit('endDate')">
            <span class="form-hint">Leave blank for ongoing</span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Services Description</label>
          <textarea id="servicesDescription" class="form-textarea" placeholder="Describe the consulting services to be provided..." oninput="trackFieldEdit('servicesDescription')"></textarea>
        </div>
      </div>

      <!-- COMPENSATION -->
      <div class="builder-section">
        <h3 class="builder-section-title">üí∞ Compensation</h3>
        <div class="form-group">
          <label class="form-label">Compensation Type</label>
          <select id="compType" class="form-select" onchange="updateCompFields(); trackFieldEdit('compType')">
            <option value="hourly">Hourly Rate</option>
            <option value="fixed">Fixed Fee</option>
            <option value="retainer">Monthly Retainer</option>
            <option value="project">Per-Project</option>
          </select>
        </div>
        <div class="form-group" id="hourlyGroup">
          <label class="form-label">Hourly Rate ($)</label>
          <input type="number" id="hourlyRate" class="form-input" placeholder="150" oninput="trackFieldEdit('hourlyRate')">
        </div>
        <div class="form-group" id="fixedGroup" style="display:none;">
          <label class="form-label">Fixed Fee ($)</label>
          <input type="number" id="fixedFee" class="form-input" placeholder="10000" oninput="trackFieldEdit('fixedFee')">
        </div>
        <div class="form-group" id="retainerGroup" style="display:none;">
          <label class="form-label">Monthly Retainer ($)</label>
          <input type="number" id="retainerFee" class="form-input" placeholder="5000" oninput="trackFieldEdit('retainerFee')">
        </div>
        <div class="form-group" id="hoursGroup">
          <label class="form-label">Estimated Hours / Month</label>
          <input type="number" id="estimatedHours" class="form-input" placeholder="40" oninput="trackFieldEdit('estimatedHours')">
        </div>
        <div class="form-group">
          <label class="form-label">Payment Terms</label>
          <select id="paymentTerms" class="form-select" onchange="trackFieldEdit('paymentTerms')">
            <option value="net30">Net 30</option>
            <option value="net15">Net 15</option>
            <option value="biweekly">Bi-weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>
        <div class="form-group">
          <label class="checkbox-item">
            <input type="checkbox" id="expenseReimbursement" onchange="trackFieldEdit('expenseReimbursement')">
            <span>Include expense reimbursement</span>
          </label>
        </div>
      </div>

      <!-- IP & CONFIDENTIALITY -->
      <div class="builder-section">
        <h3 class="builder-section-title">üîí IP & Confidentiality</h3>
        <div class="form-group">
          <label class="form-label">Work Product Ownership</label>
          <select id="ipOwnership" class="form-select" onchange="trackFieldEdit('ipOwnership')">
            <option value="client">Client owns all work product</option>
            <option value="consultant">Consultant retains ownership</option>
            <option value="license">Consultant grants license to Client</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Confidentiality Duration</label>
          <select id="confidentialityDuration" class="form-select" onchange="trackFieldEdit('confidentialityDuration')">
            <option value="2">2 years after termination</option>
            <option value="3">3 years after termination</option>
            <option value="5">5 years after termination</option>
            <option value="perpetual">Perpetual</option>
          </select>
        </div>
        <div class="form-group">
          <label class="checkbox-item">
            <input type="checkbox" id="nonCompete" onchange="trackFieldEdit('nonCompete')">
            <span>Include non-compete clause</span>
          </label>
        </div>
        <div class="form-group" id="nonCompeteDetails" style="display:none;">
          <label class="form-label">Non-Compete Duration (months)</label>
          <input type="number" id="nonCompeteDuration" class="form-input" placeholder="12" oninput="trackFieldEdit('nonCompeteDuration')">
        </div>
      </div>

      <!-- TERMINATION -->
      <div class="builder-section">
        <h3 class="builder-section-title">üö™ Termination</h3>
        <div class="form-group">
          <label class="form-label">Termination Notice Period</label>
          <select id="noticePeriod" class="form-select" onchange="trackFieldEdit('noticePeriod')">
            <option value="14">14 days</option>
            <option value="30">30 days</option>
            <option value="60">60 days</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Governing Law State</label>
          <select id="governingLaw" class="form-select" onchange="trackFieldEdit('governingLaw')">
            <option value="">Same as Client State</option>
            <option value="Delaware">Delaware</option>
            <option value="California">California</option>
            <option value="New York">New York</option>
            <option value="Texas">Texas</option>
          </select>
        </div>
      </div>

    </aside>

    <section class="preview-panel">
      <div class="preview-toolbar">
        <span class="preview-title">üìÑ Live Document Preview</span>
        <div class="preview-actions">
          <button class="btn btn-secondary" onclick="toggleFullEditMode()" id="editModeBtn">‚úèÔ∏è Edit Mode</button>
          <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Print</button>
          <button class="btn btn-primary" onclick="downloadWord()">üì• Download Word</button>
        </div>
      </div>

      <div class="document-container">
        <div class="document-header">
          <span class="document-title">Consulting Agreement</span>
          <span class="document-status">‚óè Live Preview</span>
        </div>
        <div class="document-body" id="documentPreview">
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="footer-brand"><span class="logo-text">Terms.Law</span></div>
    <p>Attorney-drafted legal documents for businesses</p>
  </footer>

  <div class="toast" id="toast"></div>

  <script>
    let lastEditedField = null;
    let isFullEditMode = false;
    let savedDocumentHTML = '';
    let hasCustomEdits = false;

    const fieldInputMap = {
      'consultantName': 'consultantName',
      'consultantBusiness': 'consultantBusiness',
      'clientName': 'clientName',
      'clientState': 'clientState',
      'startDate': 'startDate',
      'endDate': 'endDate',
      'hourlyRate': 'hourlyRate',
      'governingLaw': 'governingLaw'
    };

    function updateCompFields() {
      const type = document.getElementById('compType').value;
      document.getElementById('hourlyGroup').style.display = type === 'hourly' ? 'block' : 'none';
      document.getElementById('fixedGroup').style.display = type === 'fixed' || type === 'project' ? 'block' : 'none';
      document.getElementById('retainerGroup').style.display = type === 'retainer' ? 'block' : 'none';
      document.getElementById('hoursGroup').style.display = type === 'hourly' || type === 'retainer' ? 'block' : 'none';
    }

    document.getElementById('nonCompete').addEventListener('change', function() {
      document.getElementById('nonCompeteDetails').style.display = this.checked ? 'block' : 'none';
    });

    function trackFieldEdit(fieldId) {
      if (hasCustomEdits) {
        const proceed = confirm('You have custom edits. Changing inputs will regenerate the document. Continue?');
        if (!proceed) return;
        hasCustomEdits = false;
      }
      lastEditedField = fieldId;
      updatePreview();
    }

    function updatePreview() {
      if (isFullEditMode) return;

      const h = (value, placeholder, fieldId) => {
        const isEmpty = !value || value.startsWith('[');
        const displayValue = isEmpty ? `[${placeholder}]` : value;
        const emptyClass = isEmpty ? ' empty' : '';
        return `<span class="doc-highlight${emptyClass}" data-field="${fieldId}" contenteditable="true">${displayValue}</span>`;
      };

      // Get values
      const consultantName = document.getElementById('consultantName').value || '';
      const consultantBusiness = document.getElementById('consultantBusiness').value || '';
      const consultantAddress = document.getElementById('consultantAddress').value || '';
      const consultantEmail = document.getElementById('consultantEmail').value || '';
      const clientName = document.getElementById('clientName').value || '';
      const clientState = document.getElementById('clientState').value || '';
      const clientAddress = document.getElementById('clientAddress').value || '';
      const startDate = document.getElementById('startDate').value || '';
      const endDate = document.getElementById('endDate').value || '';
      const servicesDescription = document.getElementById('servicesDescription').value || '';
      const compType = document.getElementById('compType').value || 'hourly';
      const hourlyRate = document.getElementById('hourlyRate').value || '';
      const fixedFee = document.getElementById('fixedFee').value || '';
      const retainerFee = document.getElementById('retainerFee').value || '';
      const estimatedHours = document.getElementById('estimatedHours').value || '';
      const paymentTerms = document.getElementById('paymentTerms').value || 'net30';
      const expenseReimbursement = document.getElementById('expenseReimbursement').checked;
      const ipOwnership = document.getElementById('ipOwnership').value || 'client';
      const confidentialityDuration = document.getElementById('confidentialityDuration').value || '3';
      const nonCompete = document.getElementById('nonCompete').checked;
      const nonCompeteDuration = document.getElementById('nonCompeteDuration').value || '12';
      const noticePeriod = document.getElementById('noticePeriod').value || '30';
      const governingLaw = document.getElementById('governingLaw').value || clientState;

      const formatDate = (d) => d ? new Date(d + 'T00:00:00').toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : '';
      const formattedStart = formatDate(startDate);
      const formattedEnd = formatDate(endDate);

      // Consultant entity name
      const consultantEntity = consultantBusiness || consultantName;

      // Compensation text
      let compText = '';
      if (compType === 'hourly') {
        compText = `Client shall pay Consultant at the rate of ${h('$' + (hourlyRate || '0'), 'Hourly Rate', 'hourlyRate')} per hour for Services performed. Consultant shall submit detailed time records with each invoice.`;
      } else if (compType === 'fixed') {
        compText = `Client shall pay Consultant a fixed fee of ${h('$' + (fixedFee || '0'), 'Fixed Fee', 'fixedFee')} for the Services described herein.`;
      } else if (compType === 'retainer') {
        compText = `Client shall pay Consultant a monthly retainer of ${h('$' + (retainerFee || '0'), 'Retainer', 'retainerFee')} for up to ${h(estimatedHours || 'TBD', 'Hours', 'estimatedHours')} hours of Services per month. Additional hours beyond the retainer shall be billed at Consultant's standard hourly rate.`;
      } else {
        compText = `Client shall pay Consultant ${h('$' + (fixedFee || '0'), 'Project Fee', 'fixedFee')} per project as mutually agreed in writing prior to commencement of work.`;
      }

      // Payment terms text
      const paymentTermsText = {
        'net30': 'within thirty (30) days of receipt of invoice',
        'net15': 'within fifteen (15) days of receipt of invoice',
        'biweekly': 'bi-weekly',
        'monthly': 'on the first business day of each month for the prior month\'s services'
      }[paymentTerms];

      // IP ownership text
      let ipText = '';
      if (ipOwnership === 'client') {
        ipText = `All work product, deliverables, and materials created by Consultant in connection with the Services (the "<strong>Work Product</strong>") shall be the sole and exclusive property of Client. Consultant hereby assigns to Client all right, title, and interest in and to the Work Product, including all intellectual property rights therein. Consultant agrees to execute any documents necessary to perfect Client's ownership of the Work Product.`;
      } else if (ipOwnership === 'consultant') {
        ipText = `Consultant shall retain all right, title, and interest in and to all work product created in connection with the Services. Client shall have no ownership rights in such work product unless otherwise agreed in writing.`;
      } else {
        ipText = `Consultant shall retain all right, title, and interest in and to all work product created in connection with the Services. Consultant hereby grants to Client a non-exclusive, perpetual, royalty-free, worldwide license to use, reproduce, modify, and distribute the work product for Client's internal business purposes.`;
      }

      // Term text
      let termText = endDate
        ? `This Agreement shall commence on ${h(formattedStart, 'Start Date', 'startDate')} and shall continue until ${h(formattedEnd, 'End Date', 'endDate')}, unless earlier terminated in accordance with Section 6.`
        : `This Agreement shall commence on ${h(formattedStart, 'Start Date', 'startDate')} and shall continue until terminated by either party in accordance with Section 6.`;

      // Non-compete clause
      let nonCompeteText = '';
      if (nonCompete) {
        nonCompeteText = `
          <div class="doc-section-header">8. Non-Competition</div>
          <p class="doc-paragraph">
            During the term of this Agreement and for a period of ${h(nonCompeteDuration, 'Months', 'nonCompeteDuration')} months following its termination, Consultant agrees not to directly or indirectly engage in any business that competes with Client's business within the geographic areas in which Client conducts business, unless Client provides prior written consent.
          </p>
        `;
      }

      let html = `
        <div class="doc-title">CONSULTING AGREEMENT</div>
        <p class="doc-subtitle">Effective as of ${h(formattedStart, 'Start Date', 'startDate')}</p>

        <p class="doc-paragraph">
          This Consulting Agreement (this "<strong>Agreement</strong>") is entered into as of the date set forth above,
          by and between ${h(clientName, 'Client Name', 'clientName')}, a ${h(clientState, 'State', 'clientState')} corporation
          with its principal place of business at ${h(clientAddress, 'Client Address', 'clientAddress')} ("<strong>Client</strong>"),
          and ${h(consultantEntity, 'Consultant Name', 'consultantName')}, an independent contractor
          with an address at ${h(consultantAddress, 'Consultant Address', 'consultantAddress')} ("<strong>Consultant</strong>").
        </p>

        <div class="doc-section-header">1. Engagement of Services</div>
        <p class="doc-paragraph">
          Client hereby engages Consultant, and Consultant hereby agrees, to perform the consulting services described in this Agreement (the "<strong>Services</strong>").
        </p>
        <p class="doc-paragraph" data-field="servicesDescription">
          <strong>Scope of Services:</strong> ${servicesDescription || '[Description of consulting services to be provided]'}
        </p>

        <div class="doc-section-header">2. Term</div>
        <p class="doc-paragraph">${termText}</p>

        <div class="doc-section-header">3. Compensation</div>
        <p class="doc-paragraph" data-field="hourlyRate">${compText}</p>
        <p class="doc-paragraph">
          <strong>3.2 Payment.</strong> Client shall pay Consultant ${paymentTermsText}. All amounts due hereunder are exclusive of any applicable taxes, which shall be the responsibility of Consultant.
        </p>
        ${expenseReimbursement ? `
        <p class="doc-paragraph">
          <strong>3.3 Expenses.</strong> Client shall reimburse Consultant for reasonable, pre-approved business expenses incurred in connection with the Services, provided that Consultant submits receipts and documentation for such expenses.
        </p>
        ` : ''}

        <div class="doc-section-header">4. Independent Contractor Status</div>
        <p class="doc-paragraph">
          Consultant is an independent contractor and not an employee of Client. Consultant shall be solely responsible for all taxes, withholdings, and other statutory or contractual obligations, including workers' compensation insurance. Consultant shall not be entitled to any benefits provided by Client to its employees, including health insurance, retirement benefits, or paid time off.
        </p>
        <p class="doc-paragraph">
          Consultant shall have the right to control the manner and means by which the Services are performed, subject to Client's direction regarding the desired results. Consultant may provide services to other clients during the term of this Agreement, provided such services do not conflict with Consultant's obligations hereunder.
        </p>

        <div class="doc-section-header">5. Intellectual Property</div>
        <p class="doc-paragraph" data-field="ipOwnership">${ipText}</p>
        <p class="doc-paragraph">
          <strong>5.2 Pre-Existing Materials.</strong> Consultant retains all right, title, and interest in and to any materials, tools, methodologies, or intellectual property that Consultant owned or developed prior to or independent of this Agreement ("<strong>Pre-Existing Materials</strong>"). To the extent Consultant incorporates any Pre-Existing Materials into the Work Product, Consultant hereby grants to Client a non-exclusive, perpetual, royalty-free license to use such Pre-Existing Materials solely as part of the Work Product.
        </p>

        <div class="doc-section-header">6. Confidentiality</div>
        <p class="doc-paragraph">
          <strong>6.1 Confidential Information.</strong> Consultant acknowledges that in the course of performing the Services, Consultant may have access to confidential and proprietary information of Client, including business plans, customer lists, financial information, trade secrets, and other non-public information ("<strong>Confidential Information</strong>").
        </p>
        <p class="doc-paragraph" data-field="confidentialityDuration">
          <strong>6.2 Non-Disclosure.</strong> Consultant agrees to hold all Confidential Information in strict confidence and not to disclose any Confidential Information to any third party. This obligation shall survive the termination of this Agreement for a period of ${h(confidentialityDuration, 'Duration', 'confidentialityDuration')} years${confidentialityDuration === 'perpetual' ? '' : ', except that trade secrets shall be protected for as long as they remain trade secrets under applicable law'}.
        </p>
        <p class="doc-paragraph">
          <strong>6.3 Return of Materials.</strong> Upon termination of this Agreement or upon Client's request, Consultant shall promptly return or destroy all Confidential Information and any copies thereof.
        </p>

        <div class="doc-section-header">7. Termination</div>
        <p class="doc-paragraph" data-field="noticePeriod">
          <strong>7.1 Termination for Convenience.</strong> Either party may terminate this Agreement at any time upon ${h(noticePeriod, 'Notice Period', 'noticePeriod')} days' prior written notice to the other party.
        </p>
        <p class="doc-paragraph">
          <strong>7.2 Termination for Cause.</strong> Either party may terminate this Agreement immediately upon written notice if the other party materially breaches this Agreement and fails to cure such breach within fifteen (15) days after receipt of written notice of such breach.
        </p>
        <p class="doc-paragraph">
          <strong>7.3 Effect of Termination.</strong> Upon termination: (a) Client shall pay Consultant for all Services performed through the effective date of termination; (b) Consultant shall deliver to Client all completed and in-progress Work Product; and (c) the provisions of Sections 5, 6, and 9 shall survive termination.
        </p>

        ${nonCompeteText}

        <div class="doc-section-header">${nonCompete ? '9' : '8'}. Representations and Warranties</div>
        <p class="doc-paragraph">
          Consultant represents and warrants that: (a) Consultant has the right and authority to enter into this Agreement and perform the Services; (b) the Services will be performed in a professional and workmanlike manner; (c) the Work Product will not infringe any third-party intellectual property rights; and (d) Consultant is not bound by any agreement that would prevent Consultant from performing the Services.
        </p>

        <div class="doc-section-header">${nonCompete ? '10' : '9'}. General Provisions</div>
        <p class="doc-paragraph" data-field="governingLaw">
          <strong>Governing Law.</strong> This Agreement shall be governed by and construed in accordance with the laws of the State of ${h(governingLaw || clientState || 'Delaware', 'State', 'governingLaw')}, without regard to its conflicts of laws principles.
        </p>
        <p class="doc-paragraph">
          <strong>Entire Agreement.</strong> This Agreement constitutes the entire agreement between the parties with respect to the subject matter hereof and supersedes all prior agreements and understandings, whether written or oral.
        </p>
        <p class="doc-paragraph">
          <strong>Amendment.</strong> This Agreement may not be amended except by a written instrument signed by both parties.
        </p>
        <p class="doc-paragraph">
          <strong>Severability.</strong> If any provision of this Agreement is held to be invalid or unenforceable, the remaining provisions shall continue in full force and effect.
        </p>
        <p class="doc-paragraph">
          <strong>Notices.</strong> All notices under this Agreement shall be in writing and shall be deemed given when delivered personally, sent by email with confirmation, or sent by certified mail to the addresses set forth above.
        </p>
        <p class="doc-paragraph">
          <strong>Counterparts.</strong> This Agreement may be executed in counterparts, each of which shall be deemed an original.
        </p>

        <p class="doc-paragraph" style="margin-top: 40px;">
          <strong>IN WITNESS WHEREOF</strong>, the parties have executed this Agreement as of the date first written above.
        </p>

        <div class="doc-signature-row">
          <div class="doc-signature-party">
            <div class="doc-signature-party-title">CLIENT</div>
            <div style="font-weight: bold; margin-bottom: 15px;">${clientName || '[Client Name]'}</div>
            <div class="doc-signature-line">
              <span class="signature-label">Signature:</span>
              <span class="signature-value"></span>
            </div>
            <div class="doc-signature-line">
              <span class="signature-label">Name:</span>
              <span class="signature-value">______________________</span>
            </div>
            <div class="doc-signature-line">
              <span class="signature-label">Title:</span>
              <span class="signature-value">______________________</span>
            </div>
            <div class="doc-signature-line">
              <span class="signature-label">Date:</span>
              <span class="signature-value">______________________</span>
            </div>
          </div>

          <div class="doc-signature-party">
            <div class="doc-signature-party-title">CONSULTANT</div>
            <div style="font-weight: bold; margin-bottom: 15px;">${consultantEntity || '[Consultant Name]'}</div>
            <div class="doc-signature-line">
              <span class="signature-label">Signature:</span>
              <span class="signature-value"></span>
            </div>
            <div class="doc-signature-line">
              <span class="signature-label">Name:</span>
              <span class="signature-value">${consultantName || '______________________'}</span>
            </div>
            <div class="doc-signature-line">
              <span class="signature-label">Email:</span>
              <span class="signature-value">${consultantEmail || '______________________'}</span>
            </div>
            <div class="doc-signature-line">
              <span class="signature-label">Date:</span>
              <span class="signature-value">______________________</span>
            </div>
          </div>
        </div>
      `;

      document.getElementById('documentPreview').innerHTML = html;
      setupInlineEditing();

      // CRITICAL: Scroll to and highlight
      if (lastEditedField) {
        setTimeout(() => {
          const highlight = document.querySelector(`[data-field="${lastEditedField}"]`);
          if (highlight) {
            highlight.scrollIntoView({ behavior: 'smooth', block: 'center' });
            highlight.classList.add('field-highlight-animation');
            setTimeout(() => highlight.classList.remove('field-highlight-animation'), 1500);
          }
          lastEditedField = null;
        }, 50);
      }
    }

    function setupInlineEditing() {
      document.querySelectorAll('.doc-highlight[contenteditable="true"]').forEach(el => {
        el.addEventListener('blur', function() { handleInlineEdit(this); });
        el.addEventListener('keydown', function(e) { if (e.key === 'Enter') { e.preventDefault(); this.blur(); } });
        el.addEventListener('focus', function() {
          const selection = window.getSelection();
          const range = document.createRange();
          range.selectNodeContents(this);
          selection.removeAllRanges();
          selection.addRange(range);
        });
      });
    }

    function handleInlineEdit(element) {
      const fieldId = element.dataset.field;
      const newValue = element.textContent.trim();
      const inputId = fieldInputMap[fieldId];
      if (inputId) {
        const input = document.getElementById(inputId);
        if (input && !newValue.startsWith('[') && !newValue.endsWith(']')) {
          input.value = newValue;
        }
      }
    }

    function toggleFullEditMode() {
      const docBody = document.getElementById('documentPreview');
      const toggleBtn = document.getElementById('editModeBtn');

      if (!isFullEditMode) {
        isFullEditMode = true;
        savedDocumentHTML = docBody.innerHTML;
        docBody.contentEditable = 'true';
        docBody.classList.add('full-edit-mode');
        toggleBtn.innerHTML = 'üíæ Save Edits';
        toggleBtn.classList.add('active');
        showToast('Edit mode enabled. Make any changes you need.');
      } else {
        isFullEditMode = false;
        hasCustomEdits = true;
        docBody.contentEditable = 'false';
        docBody.classList.remove('full-edit-mode');
        toggleBtn.innerHTML = '‚úèÔ∏è Edit Mode';
        toggleBtn.classList.remove('active');
        showToast('Edits saved!');
      }
    }

    function downloadWord() {
      const content = document.getElementById('documentPreview').innerHTML;
      const consultantName = document.getElementById('consultantName').value || 'Consultant';
      const clientName = document.getElementById('clientName').value || 'Client';

      const html = `
        <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
        <head><meta charset='utf-8'><title>Consulting Agreement</title></head>
        <body style="font-family: Georgia, serif; font-size: 12pt; line-height: 1.6;">
        ${content}
        </body></html>
      `;

      const blob = new Blob([html], { type: 'application/msword' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `Consulting Agreement - ${consultantName} - ${clientName}.doc`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast('Document downloaded!', 'success');
    }

    function showToast(message, type = '') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      setTimeout(() => { toast.className = 'toast'; }, 3000);
    }

    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('startDate').value = today;
      updatePreview();
    });
  </script>
</body>
</html>
