<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tax Implications of Business Sale Calculator | Terms.Law</title>
  <meta name="description" content="The Business Sale Tax Calculator helps estimate tax implications when selling a business, focusing on sale structure and asset allocation. It outlines factors a">
  <link rel="canonical" href="https://terms.law/2025/03/01/tax-implications-of-business-sale-calculator/">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/shared/styles.css">
</head>
<body>
  <div id="site-header"></div>
  <script src="/shared/header-loader.js"></script>

  <main>
    <article>
      <h1>Tax Implications of Business Sale Calculator</h1>
      <div class="meta">Published: March 1, 2025 â€¢ Document Generators, M&amp;A, Tax Law</div>
      <div class="content">
<!-- Business Sale Tax Calculator - Terms.Law -->
<div id="business-sale-calculator" class="terms-law-tool">
  <div class="tool-container">
    <div class="tool-header">
      <h2>Business Sale Tax Calculator</h2>
      <p class="tool-intro">Estimate the tax implications of selling your business based on your specific situation, sale structure, and asset allocation. Compare different scenarios to optimize your after-tax proceeds.</p>
    </div>
    
    <!-- Progress Bar -->
    <div class="tool-progress-container">
      <div class="tool-progress-bar">
        <div id="progress-bar"></div>
      </div>
      <div class="tool-progress-text"><span id="current-step">1</span>/<span id="total-steps">4</span></div>
    </div>
    
    <!-- Question Container -->
    <div id="question-container">
      <!-- Questions will be inserted here by JavaScript -->
    </div>
    
    <!-- Results Container -->
    <div id="results-container" style="display: none;">
      <div class="results-header">
        <h3>Your Business Sale Tax Analysis</h3>
        <p>Based on the information provided, here&#8217;s a breakdown of the estimated tax implications for your business sale:</p>
      </div>
      
      <!-- Summary Cards -->
      <div class="tax-results-summary">
        <div class="summary-row">
          <div class="summary-label">Sale Type:</div>
          <div id="summary-sale-type" class="summary-value">Asset Sale</div>
        </div>
        <div class="summary-row">
          <div class="summary-label">Business Structure:</div>
          <div id="summary-business-structure" class="summary-value">LLC</div>
        </div>
        <div class="summary-row">
          <div class="summary-label">Total Sale Price:</div>
          <div id="summary-sale-price" class="summary-value">$0</div>
        </div>
        <div class="summary-row">
          <div class="summary-label">Adjusted Basis:</div>
          <div id="summary-basis" class="summary-value">$0</div>
        </div>
        <div class="summary-row">
          <div class="summary-label">Net Gain:</div>
          <div id="summary-gain" class="summary-value">$0</div>
        </div>
      </div>
      
      <!-- Tax Result -->
      <div class="tax-result">
        <div class="result-columns">
          <div class="result-column">
            <div class="result-header">Estimated Total Tax</div>
            <div class="result-amount" id="total-tax">$0</div>
          </div>
          <div class="result-column">
            <div class="result-header">Effective Tax Rate</div>
            <div class="result-amount" id="effective-rate">0%</div>
          </div>
          <div class="result-column">
            <div class="result-header">After-Tax Proceeds</div>
            <div class="result-amount" id="after-tax">$0</div>
          </div>
        </div>
      </div>
      
      <!-- Tax Breakdown -->
      <div class="tax-breakdown">
        <h4>Tax Breakdown By Category</h4>
        <div class="breakdown-container">
          <table class="breakdown-table">
            <thead>
              <tr>
                <th>Category</th>
                <th>Allocation</th>
                <th>Adjusted Basis</th>
                <th>Gain</th>
                <th>Tax Type</th>
                <th>Tax Rate</th>
                <th>Tax Amount</th>
              </tr>
            </thead>
            <tbody id="tax-breakdown-body">
              <!-- Will be filled by JavaScript -->
            </tbody>
            <tfoot>
              <tr>
                <td colspan="3"><strong>Total</strong></td>
                <td id="total-gain">$0</td>
                <td></td>
                <td></td>
                <td id="total-tax-amount">$0</td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
      
      <!-- Visualization -->
      <div class="tax-visualization">
        <h4>Visualization of Tax Impact</h4>
        <div class="chart-container">
          <div class="bar-chart">
            <div class="bar-container">
              <div class="bar-label">Sale Price</div>
              <div class="bar full-bar">
                <div class="bar-value" id="chart-sale-price">$0</div>
              </div>
            </div>
            <div class="bar-container">
              <div class="bar-label">Total Tax</div>
              <div class="bar tax-bar" id="tax-bar">
                <div class="bar-value" id="chart-tax-amount">$0</div>
              </div>
            </div>
            <div class="bar-container">
              <div class="bar-label">After-Tax Proceeds</div>
              <div class="bar proceeds-bar" id="proceeds-bar">
                <div class="bar-value" id="chart-after-tax">$0</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tax Breakdown By Type -->
      <div class="tax-by-type">
        <h4>Tax Breakdown By Type</h4>
        <div class="type-breakdown-container">
          <div class="type-breakdown-item">
            <div class="type-breakdown-header">
              <div class="type-name">Ordinary Income Tax</div>
              <div class="type-amount" id="ordinary-income-tax">$0</div>
            </div>
            <div class="type-details" id="ordinary-income-details">
              <!-- Will be filled by JavaScript -->
            </div>
          </div>
          <div class="type-breakdown-item">
            <div class="type-breakdown-header">
              <div class="type-name">Capital Gains Tax</div>
              <div class="type-amount" id="capital-gains-tax">$0</div>
            </div>
            <div class="type-details" id="capital-gains-details">
              <!-- Will be filled by JavaScript -->
            </div>
          </div>
          <div class="type-breakdown-item" id="depreciation-recapture-container">
            <div class="type-breakdown-header">
              <div class="type-name">Depreciation Recapture</div>
              <div class="type-amount" id="depreciation-recapture-tax">$0</div>
            </div>
            <div class="type-details" id="depreciation-recapture-details">
              <!-- Will be filled by JavaScript -->
            </div>
          </div>
          <div class="type-breakdown-item" id="state-tax-container">
            <div class="type-breakdown-header">
              <div class="type-name">State Tax</div>
              <div class="type-amount" id="state-tax">$0</div>
            </div>
            <div class="type-details" id="state-tax-details">
              <!-- Will be filled by JavaScript -->
            </div>
          </div>
        </div>
      </div>
      
      <!-- Comparison (if applicable) -->
      <div id="comparison-container" style="display: none;">
        <h4>Comparison of Sale Structures</h4>
        <div class="comparison-chart">
          <div class="comparison-bar-container">
            <div class="comparison-bar-label">Asset Sale</div>
            <div class="comparison-bar-stack">
              <div class="comparison-bar-segment tax" id="asset-tax-segment"></div>
              <div class="comparison-bar-segment after-tax" id="asset-aftertax-segment"></div>
            </div>
            <div class="comparison-bar-values">
              <div class="comparison-value tax" id="asset-tax-value">$0</div>
              <div class="comparison-value after-tax" id="asset-aftertax-value">$0</div>
            </div>
          </div>
          <div class="comparison-bar-container">
            <div class="comparison-bar-label">Stock/Equity Sale</div>
            <div class="comparison-bar-stack">
              <div class="comparison-bar-segment tax" id="stock-tax-segment"></div>
              <div class="comparison-bar-segment after-tax" id="stock-aftertax-segment"></div>
            </div>
            <div class="comparison-bar-values">
              <div class="comparison-value tax" id="stock-tax-value">$0</div>
              <div class="comparison-value after-tax" id="stock-aftertax-value">$0</div>
            </div>
          </div>
        </div>
        <div class="comparison-summary" id="comparison-summary">
          <!-- Will be filled by JavaScript -->
        </div>
      </div>
      
      <!-- Tax Planning Considerations -->
      <div class="tax-planning">
        <h4>Tax Planning Considerations</h4>
        <div id="planning-strategies">
          <!-- Will be filled by JavaScript -->
        </div>
      </div>
      
      <!-- Important Notes -->
      <div class="tax-notes">
        <h4>Important Notes</h4>
        <p>This calculator provides general estimates based on the information provided and is not a substitute for professional tax advice. The actual tax implications can vary based on:</p>
        <ul>
          <li>Specific details of your business and the sale transaction</li>
          <li>Your complete tax situation including other income and deductions</li>
          <li>Special tax provisions that may apply to your specific situation</li>
          <li>Changes in tax laws and regulations</li>
        </ul>
        <p>Consult with a tax attorney or CPA before making decisions related to your business sale.</p>
      </div>
      
      <!-- CTA Buttons -->
      <div class="results-cta">
        <button id="recalculate-btn" class="tool-btn tool-btn-secondary">Recalculate</button>
        <a href="#" class="tool-btn tool-btn-cta" onclick="Calendly.initPopupWidget({url: 'https://calendly.com/sergei-tokmakov/30-minute-zoom-meeting'});return false;">Schedule Tax Consultation</a>
      </div>
    </div>
  </div>
</div>

<style>
/* Tool Styles */
.terms-law-tool {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
  max-width: 800px;
  margin: 0 auto;
  color: #333;
}

.tool-container {
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  padding: 25px;
  margin-bottom: 30px;
}

.tool-header {
  text-align: center;
  margin-bottom: 20px;
}

.tool-header h2 {
  color: #2c3e50;
  font-size: 24px;
  margin-bottom: 10px;
}

.tool-intro {
  color: #555;
  font-size: 16px;
  line-height: 1.5;
}

/* Progress Bar */
.tool-progress-container {
  margin: 20px 0;
  position: relative;
}

.tool-progress-bar {
  height: 8px;
  background-color: #e0e0e0;
  border-radius: 4px;
  overflow: hidden;
}

#progress-bar {
  height: 100%;
  background-color: #3498db;
  width: 25%;
  transition: width 0.3s ease;
}

.tool-progress-text {
  text-align: right;
  font-size: 14px;
  color: #777;
  margin-top: 5px;
}

/* Question Step Styles */
.question-step {
  margin-bottom: 20px;
}

.question-step h3 {
  font-size: 18px;
  margin-bottom: 15px;
  color: #2c3e50;
}

.question-description {
  color: #555;
  font-size: 14px;
  margin-bottom: 15px;
  line-height: 1.5;
}

/* Input Styles */
.input-group {
  margin-bottom: 20px;
}

.input-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  font-size: 16px;
}

.input-prefix {
  display: flex;
  align-items: center;
  width: 100%;
  max-width: 300px;
}

.input-prefix span {
  background-color: #f0f0f0;
  border: 1px solid #ddd;
  border-right: none;
  border-radius: 4px 0 0 4px;
  padding: 10px 12px;
  color: #555;
  font-size: 16px;
}

.input-prefix input {
  flex: 1;
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 0 4px 4px 0;
  font-size: 16px;
}

.input-suffix {
  display: flex;
  align-items: center;
  width: 100%;
  max-width: 300px;
}

.input-suffix input {
  flex: 1;
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 4px 0 0 4px;
  font-size: 16px;
}

.input-suffix span {
  background-color: #f0f0f0;
  border: 1px solid #ddd;
  border-left: none;
  border-radius: 0 4px 4px 0;
  padding: 10px 12px;
  color: #555;
  font-size: 16px;
}

.regular-input, .tool-select {
  width: 100%;
  max-width: 300px;
  padding: 10px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
}

.tool-select {
  background-color: #fff;
  height: 42px;
}

.input-helper {
  font-size: 13px;
  color: #666;
  margin-top: 5px;
}

/* Radio Options */
.radio-options {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-top: 10px;
}

.radio-option {
  flex: 1;
  min-width: 200px;
  background-color: #f8f9fa;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.radio-option:hover {
  background-color: #f1f3f5;
  border-color: #d0d0d0;
}

.radio-option.selected {
  background-color: #e3f2fd;
  border-color: #90caf9;
}

.radio-option input[type="radio"] {
  margin-right: 10px;
}

.radio-label-title {
  font-weight: 600;
  display: block;
  margin-bottom: 3px;
}

.radio-label-desc {
  font-size: 13px;
  color: #666;
}

/* Allocation Table */
.allocation-table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

.allocation-table th,
.allocation-table td {
  padding: 10px;
  border: 1px solid #ddd;
  text-align: left;
}

.allocation-table th {
  background-color: #f8f9fa;
  font-weight: 600;
}

.allocation-table input {
  width: 100%;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.allocation-total {
  font-weight: 600;
  color: #2c3e50;
}

.allocation-warning {
  color: #e74c3c;
  font-size: 13px;
  margin-top: 5px;
  display: none;
}

/* Navigation Buttons */
.tool-navigation {
  margin-top: 25px;
  display: flex;
  justify-content: space-between;
}

.tool-btn {
  padding: 12px 20px;
  border-radius: 6px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  border: none;
  font-size: 16px;
  text-decoration: none;
}

.tool-btn-primary {
  background-color: #3498db;
  color: white;
}

.tool-btn-primary:hover {
  background-color: #2980b9;
}

.tool-btn-secondary {
  background-color: #ecf0f1;
  color: #34495e;
}

.tool-btn-secondary:hover {
  background-color: #dde4e6;
}

.tool-btn-secondary:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.tool-btn-cta {
  background-color: #2c3e50;
  color: white !important;
  display: inline-block;
  text-align: center;
}

.tool-btn-cta:hover {
  background-color: #1a252f;
}

/* Results Styles */
#results-container {
  opacity: 0;
  transition: opacity 0.5s ease;
}

#results-container.visible {
  opacity: 1;
}

.results-header {
  text-align: center;
  margin-bottom: 25px;
}

.results-header h3 {
  color: #2c3e50;
  font-size: 24px;
  margin-bottom: 10px;
}

.tax-results-summary {
  background-color: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 25px;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
}

.summary-row:last-child {
  margin-bottom: 0;
}

.summary-label {
  font-weight: 600;
  color: #555;
}

.summary-value {
  color: #2c3e50;
  font-weight: 500;
}

/* Tax Result Display */
.tax-result {
  background-color: #e3f2fd;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 25px;
}

.result-columns {
  display: flex;
  justify-content: space-between;
  text-align: center;
}

.result-column {
  flex: 1;
  padding: 0 15px;
}

.result-header {
  font-size: 16px;
  color: #555;
  margin-bottom: 10px;
}

.result-amount {
  font-size: 24px;
  font-weight: 700;
  color: #2980b9;
}

/* Tax Breakdown */
.tax-breakdown {
  margin-bottom: 25px;
}

.tax-breakdown h4 {
  color: #2c3e50;
  font-size: 18px;
  margin-bottom: 15px;
}

.breakdown-container {
  overflow-x: auto;
}

.breakdown-table {
  width: 100%;
  border-collapse: collapse;
}

.breakdown-table th,
.breakdown-table td {
  padding: 10px;
  border: 1px solid #ddd;
  text-align: left;
}

.breakdown-table th {
  background-color: #f8f9fa;
  font-weight: 600;
}

.breakdown-table tfoot tr {
  background-color: #f8f9fa;
  font-weight: 600;
}

/* Visualization */
.tax-visualization {
  margin-bottom: 25px;
}

.tax-visualization h4 {
  color: #2c3e50;
  font-size: 18px;
  margin-bottom: 15px;
}

.chart-container {
  padding: 20px;
  background-color: #f8f9fa;
  border-radius: 8px;
}

.bar-chart {
  margin-top: 20px;
}

.bar-container {
  display: flex;
  align-items: center;
  margin-bottom: 15px;
}

.bar-label {
  width: 150px;
  font-weight: 600;
  padding-right: 15px;
}

.bar {
  flex-grow: 1;
  height: 36px;
  border-radius: 4px;
  position: relative;
  background-color: #e0e0e0;
}

.full-bar {
  background-color: #3498db;
}

.tax-bar {
  background-color: #e74c3c;
  width: 0;
  transition: width 0.5s ease;
}

.proceeds-bar {
  background-color: #2ecc71;
  width: 0;
  transition: width 0.5s ease;
}

.bar-value {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  color: #fff;
  font-weight: 600;
  text-shadow: 0 0 2px rgba(0, 0, 0, 0.3);
}

/* Tax By Type */
.tax-by-type {
  margin-bottom: 25px;
}

.tax-by-type h4 {
  color: #2c3e50;
  font-size: 18px;
  margin-bottom: 15px;
}

.type-breakdown-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 20px;
}

.type-breakdown-item {
  background-color: #f8f9fa;
  border-radius: 8px;
  overflow: hidden;
}

.type-breakdown-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px;
  background-color: #e3f2fd;
  border-bottom: 1px solid #d0d0d0;
}

.type-name {
  font-weight: 600;
  color: #2c3e50;
}

.type-amount {
  font-weight: 700;
  color: #2980b9;
}

.type-details {
  padding: 15px;
  font-size: 14px;
  color: #555;
  line-height: 1.5;
}

/* Comparison Chart */
.comparison-chart {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}

.comparison-bar-container {
  flex: 1;
  max-width: 45%;
  padding: 15px;
}

.comparison-bar-label {
  font-weight: 600;
  margin-bottom: 10px;
  text-align: center;
}

.comparison-bar-stack {
  height: 36px;
  background-color: #f0f0f0;
  border-radius: 4px;
  position: relative;
  overflow: hidden;
}

.comparison-bar-segment {
  height: 100%;
  position: absolute;
  transition: width 0.5s ease;
}

.comparison-bar-segment.tax {
  background-color: #e74c3c;
  left: 0;
}

.comparison-bar-segment.after-tax {
  background-color: #2ecc71;
  left: 0;
}

.comparison-bar-values {
  display: flex;
  justify-content: space-between;
  margin-top: 8px;
  font-size: 14px;
}

.comparison-value.tax {
  color: #e74c3c;
}

.comparison-value.after-tax {
  color: #2ecc71;
}

.comparison-summary {
  padding: 15px;
  background-color: #f8f9fa;
  border-radius: 8px;
  margin-bottom: 20px;
}

/* Tax Planning */
.tax-planning {
  margin-bottom: 25px;
  padding: 20px;
  background-color: #f9f9f9;
  border-radius: 8px;
  border-left: 4px solid #3498db;
}

.tax-planning h4 {
  color: #2c3e50;
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 15px;
}

#planning-strategies {
  font-size: 14px;
  line-height: 1.6;
  color: #555;
}

#planning-strategies h5 {
  font-size: 16px;
  margin-top: 15px;
  margin-bottom: 10px;
  color: #2c3e50;
}

#planning-strategies ul {
  margin-top: 10px;
  padding-left: 20px;
}

#planning-strategies li {
  margin-bottom: 8px;
}

/* Notes */
.tax-notes {
  margin-bottom: 25px;
  padding: 20px;
  background-color: #fff8e1;
  border-radius: 8px;
}

.tax-notes h4 {
  color: #2c3e50;
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 15px;
}

.tax-notes p,
.tax-notes li {
  font-size: 14px;
  line-height: 1.5;
}

.tax-notes ul {
  padding-left: 20px;
  margin-bottom: 15px;
}

.tax-notes li {
  margin-bottom: 5px;
}

/* Call to Action */
.results-cta {
  margin-top: 30px;
  display: flex;
  justify-content: center;
  gap: 15px;
}

/* Responsive Design */
@media (max-width: 768px) {
  .tool-container {
    padding: 15px;
  }
  
  .radio-options {
    flex-direction: column;
  }
  
  .radio-option {
    min-width: auto;
  }
  
  .type-breakdown-container {
    grid-template-columns: 1fr;
  }
  
  .comparison-chart {
    flex-direction: column;
  }
  
  .comparison-bar-container {
    max-width: 100%;
    margin-bottom: 20px;
  }
  
  .results-cta {
    flex-direction: column;
  }
  
  .tool-btn {
    width: 100%;
  }
  
  .bar-container {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .bar-label {
    width: 100%;
    margin-bottom: 5px;
  }
}
</style>

<!-- Load Calendly Widget -->
<link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
<script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Tax Rate Constants (2024 figures)
  const TaxRates = {
    incomeTax: {
      single: [
        { max: 11600, rate: 0.10 },
        { max: 47150, rate: 0.12 },
        { max: 100525, rate: 0.22 },
        { max: 191950, rate: 0.24 },
        { max: 243725, rate: 0.32 },
        { max: 609350, rate: 0.35 },
        { max: Infinity, rate: 0.37 }
      ],
      joint: [
        { max: 23200, rate: 0.10 },
        { max: 94300, rate: 0.12 },
        { max: 201050, rate: 0.22 },
        { max: 383900, rate: 0.24 },
        { max: 487450, rate: 0.32 },
        { max: 731200, rate: 0.35 },
        { max: Infinity, rate: 0.37 }
      ],
      head: [
        { max: 16550, rate: 0.10 },
        { max: 63100, rate: 0.12 },
        { max: 100500, rate: 0.22 },
        { max: 191950, rate: 0.24 },
        { max: 243700, rate: 0.32 },
        { max: 609350, rate: 0.35 },
        { max: Infinity, rate: 0.37 }
      ]
    },
    longTermCapitalGains: {
      single: [
        { max: 47025, rate: 0.00 },
        { max: 518900, rate: 0.15 },
        { max: Infinity, rate: 0.20 }
      ],
      joint: [
        { max: 94050, rate: 0.00 },
        { max: 583750, rate: 0.15 },
        { max: Infinity, rate: 0.20 }
      ],
      head: [
        { max: 63000, rate: 0.00 },
        { max: 551350, rate: 0.15 },
        { max: Infinity, rate: 0.20 }
      ]
    },
    deprecRecapture: 0.25, // 25% for unrecaptured section 1250 gain
    selfEmployment: 0.153, // 15.3% self-employment tax

    // ADDED: Provide thresholds so we don't get errors on "TaxRates.netInvestmentIncome.threshold"
    netInvestmentIncome: {
      rate: 0.038, // 3.8% NIIT
      threshold: {               // ADDED
        single: 200000,          // ADDED
        joint: 250000            // ADDED
      }                          // ADDED
    },                           // ADDED

    stateTaxRates: {
      'AL': 0.050,
      'AK': 0.000,
      'AZ': 0.045,
      'AR': 0.055,
      'CA': 0.093,
      'CO': 0.044,
      'CT': 0.065,
      'DE': 0.066,
      'FL': 0.000,
      'GA': 0.054,
      'HI': 0.075,
      'ID': 0.060,
      'IL': 0.049,
      'IN': 0.032,
      'IA': 0.060,
      'KS': 0.057,
      'KY': 0.045,
      'LA': 0.042,
      'ME': 0.075,
      'MD': 0.057,
      'MA': 0.050,
      'MI': 0.043,
      'MN': 0.074,
      'MS': 0.050,
      'MO': 0.053,
      'MT': 0.068,
      'NE': 0.064,
      'NV': 0.000,
      'NH': 0.050,
      'NJ': 0.089,
      'NM': 0.047,
      'NY': 0.068,
      'NC': 0.049,
      'ND': 0.029,
      'OH': 0.039,
      'OK': 0.047,
      'OR': 0.099,
      'PA': 0.030,
      'RI': 0.059,
      'SC': 0.053,
      'SD': 0.000,
      'TN': 0.000,
      'TX': 0.000,
      'UT': 0.049,
      'VT': 0.066,
      'VA': 0.055,
      'WA': 0.000,
      'WV': 0.049,
      'WI': 0.053,
      'WY': 0.000
    },
    corporateTax: 0.21 // 21% flat corporate tax rate
  };
  
  // Asset Categories
  const AssetCategories = [
    { id: 'inventory', name: 'Inventory', taxType: 'ordinary_income', description: 'Goods held for sale' },
    { id: 'receivables', name: 'Accounts Receivable', taxType: 'ordinary_income', description: 'Amounts owed to the business' },
    { id: 'equipment', name: 'Equipment & Machinery', taxType: 'recapture_1245', description: 'Tangible business equipment' },
    { id: 'furniture', name: 'Furniture & Fixtures', taxType: 'recapture_1245', description: 'Office furniture and fixtures' },
    { id: 'vehicles', name: 'Vehicles', taxType: 'recapture_1245', description: 'Business vehicles' },
    { id: 'real_property', name: 'Real Property', taxType: 'recapture_1250', description: 'Buildings and land improvements' },
    { id: 'land', name: 'Land', taxType: 'capital_gains', description: 'Land owned by the business' },
    { id: 'goodwill', name: 'Goodwill', taxType: 'capital_gains', description: 'Business reputation and customer relationships' },
    { id: 'covenants', name: 'Covenants Not to Compete', taxType: 'ordinary_income', description: 'Agreements restricting competition' },
    { id: 'intellectual', name: 'Intellectual Property', taxType: 'capital_gains', description: 'Patents, trademarks, copyrights' }
  ];
  
  // Questions Data
  const questions = [
    {
      id: 'sale-basics',
      title: 'Business Sale Basics',
      description: 'Provide basic information about your business and the proposed sale.',
      fields: [
        {
          id: 'business-structure',
          label: 'Business Legal Structure',
          type: 'select',
          options: [
            { value: 'sole_prop', label: 'Sole Proprietorship' },
            { value: 'partnership', label: 'Partnership' },
            { value: 'llc_disregarded', label: 'Single-Member LLC (Disregarded Entity)' },
            { value: 'llc_partnership', label: 'Multi-Member LLC (Partnership)' },
            { value: 'llc_scorp', label: 'LLC taxed as S Corporation', selected: true },
            { value: 'scorp', label: 'S Corporation' },
            { value: 'ccorp', label: 'C Corporation' }
          ],
          helper: 'Your business entity type affects how the sale is taxed'
        },
        {
          id: 'sale-type',
          label: 'Sale Structure',
          type: 'radio',
          options: [
            {
              value: 'asset',
              title: 'Asset Sale',
              description: 'Selling business assets individually; buyer doesn\'t assume entity',
              selected: true
            },
            {
              value: 'stock',
              title: 'Stock/Equity Sale',
              description: 'Selling ownership interests in the business entity'
            }
          ],
          helper: 'Asset sales and stock/equity sales have different tax implications'
        },
        {
          id: 'total-price',
          label: 'Total Sale Price',
          type: 'currency',
          value: 1000000,
          helper: 'The total amount the buyer is paying for the business'
        },
        {
          id: 'basis',
          label: 'Total Adjusted Basis',
          type: 'currency',
          value: 400000,
          helper: 'Your tax basis in the business (original cost minus depreciation)'
        }
      ]
    },
    {
      id: 'asset-allocation',
      title: 'Asset Allocation',
      description: 'Specify how the purchase price is allocated among different asset categories. This affects tax treatment, as different asset classes are taxed differently.',
      fields: [
        {
          id: 'allocation-table',
          type: 'allocation-table',
          categories: AssetCategories,
          helper: 'Allocations should total 100% of the sale price'
        }
      ]
    },
    {
      id: 'seller-info',
      title: 'Seller Information',
      description: 'Provide information about your tax situation as the seller.',
      fields: [
        {
          id: 'filing-status',
          label: 'Tax Filing Status',
          type: 'select',
          options: [
            { value: 'single', label: 'Single', selected: true },
            { value: 'joint', label: 'Married Filing Jointly' },
            { value: 'head', label: 'Head of Household' }
          ],
          helper: 'Your filing status affects your tax rates'
        },
        {
          id: 'state',
          label: 'State of Residence',
          type: 'select',
          options: [
            { value: 'AL', label: 'Alabama' },
            { value: 'AK', label: 'Alaska' },
            { value: 'AZ', label: 'Arizona' },
            { value: 'AR', label: 'Arkansas' },
            { value: 'CA', label: 'California', selected: true },
            { value: 'CO', label: 'Colorado' },
            { value: 'CT', label: 'Connecticut' },
            { value: 'DE', label: 'Delaware' },
            { value: 'FL', label: 'Florida' },
            { value: 'GA', label: 'Georgia' },
            { value: 'HI', label: 'Hawaii' },
            { value: 'ID', label: 'Idaho' },
            { value: 'IL', label: 'Illinois' },
            { value: 'IN', label: 'Indiana' },
            { value: 'IA', label: 'Iowa' },
            { value: 'KS', label: 'Kansas' },
            { value: 'KY', label: 'Kentucky' },
            { value: 'LA', label: 'Louisiana' },
            { value: 'ME', label: 'Maine' },
            { value: 'MD', label: 'Maryland' },
            { value: 'MA', label: 'Massachusetts' },
            { value: 'MI', label: 'Michigan' },
            { value: 'MN', label: 'Minnesota' },
            { value: 'MS', label: 'Mississippi' },
            { value: 'MO', label: 'Missouri' },
            { value: 'MT', label: 'Montana' },
            { value: 'NE', label: 'Nebraska' },
            { value: 'NV', label: 'Nevada' },
            { value: 'NH', label: 'New Hampshire' },
            { value: 'NJ', label: 'New Jersey' },
            { value: 'NM', label: 'New Mexico' },
            { value: 'NY', label: 'New York' },
            { value: 'NC', label: 'North Carolina' },
            { value: 'ND', label: 'North Dakota' },
            { value: 'OH', label: 'Ohio' },
            { value: 'OK', label: 'Oklahoma' },
            { value: 'OR', label: 'Oregon' },
            { value: 'PA', label: 'Pennsylvania' },
            { value: 'RI', label: 'Rhode Island' },
            { value: 'SC', label: 'South Carolina' },
            { value: 'SD', label: 'South Dakota' },
            { value: 'TN', label: 'Tennessee' },
            { value: 'TX', label: 'Texas' },
            { value: 'UT', label: 'Utah' },
            { value: 'VT', label: 'Vermont' },
            { value: 'VA', label: 'Virginia' },
            { value: 'WA', label: 'Washington' },
            { value: 'WV', label: 'West Virginia' },
            { value: 'WI', label: 'Wisconsin' },
            { value: 'WY', label: 'Wyoming' }
          ],
          helper: 'State tax will be estimated based on your state of residence'
        },
        {
          id: 'other-income',
          label: 'Other Annual Income',
          type: 'currency',
          value: 150000,
          helper: 'Income from other sources affects your marginal tax rates'
        }
      ]
    },
    {
      id: 'advanced-options',
      title: 'Advanced Options',
      description: 'Specify additional details about the business sale that may affect tax treatment.',
      fields: [
        {
          id: 'depreciation-recapture',
          label: 'Total Accumulated Depreciation',
          type: 'currency',
          value: 250000,
          helper: 'Total depreciation taken on sold assets (affects recapture)'
        },
        {
          id: 'holding-period',
          label: 'Business Ownership Period',
          type: 'select',
          options: [
            { value: 'less-than-1', label: 'Less than 1 year' },
            { value: '1-5-years', label: '1-5 years' },
            { value: 'more-than-5', label: 'More than 5 years', selected: true }
          ],
          helper: 'How long you\'ve owned the business affects capital gains rates'
        },
        {
          id: 'installment-sale',
          label: 'Installment Sale',
          type: 'radio',
          options: [
            {
              value: 'no',
              title: 'No',
              description: 'Full payment received in year of sale',
              selected: true
            },
            {
              value: 'yes',
              title: 'Yes',
              description: 'Payment received over multiple years'
            }
          ],
          helper: 'Installment sales can spread tax liability over multiple years'
        },
        {
          id: 'qsbs-eligible',
          label: 'Qualified Small Business Stock (QSBS)',
          type: 'radio',
          options: [
            {
              value: 'no',
              title: 'No',
              description: 'Not eligible for Section 1202 exclusion',
              selected: true
            },
            {
              value: 'yes',
              title: 'Yes',
              description: 'Potentially eligible for Section 1202 exclusion'
            }
          ],
          helper: 'QSBS may qualify for partial or full exclusion from capital gains tax'
        }
      ]
    }
  ];
  
  // DOM Elements
  const questionContainer = document.getElementById('question-container');
  const resultsContainer = document.getElementById('results-container');
  const progressBar = document.getElementById('progress-bar');
  const currentStepEl = document.getElementById('current-step');
  const totalStepsEl = document.getElementById('total-steps');
  const recalculateBtn = document.getElementById('recalculate-btn');
  
  // Set up variables
  let currentStep = 0;
  const userAnswers = {};
  const totalSteps = questions.length;
  let assetAllocations = {}; // Store asset allocations
  
  // Initialize the tool
  function initTool() {
    // Set total steps
    totalStepsEl.textContent = totalSteps;
    
    // Initialize with default values
    questions.forEach(question => {
      question.fields.forEach(field => {
        if (field.type === 'select') {
          const selectedOption = field.options.find(option => option.selected);
          if (selectedOption) {
            userAnswers[field.id] = selectedOption.value;
          } else if (field.options.length > 0) {
            userAnswers[field.id] = field.options[0].value;
          }
        } else if (field.type === 'radio') {
          const selectedOption = field.options.find(option => option.selected);
          if (selectedOption) {
            userAnswers[field.id] = selectedOption.value;
          } else if (field.options.length > 0) {
            userAnswers[field.id] = field.options[0].value;
          }
        } else if (field.type === 'currency') {
          userAnswers[field.id] = field.value || 0;
        } else if (field.type === 'allocation-table') {
          // Initialize with default allocation
          initializeAllocations();
        }
      });
    });
    
    // Show first question
    showQuestion(0);
    
    // Add event listener to recalculate button
    recalculateBtn.addEventListener('click', function() {
      resultsContainer.style.display = 'none';
      resultsContainer.classList.remove('visible');
      questionContainer.style.display = 'block';
      showQuestion(0);
      
      // Scroll to the top of the tool
      document.getElementById('business-sale-calculator').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start'
      });
    });
  }
  
  // Initialize asset allocations with reasonable defaults
  function initializeAllocations() {
    const defaultAllocations = {
      'inventory': 5,
      'receivables': 5,
      'equipment': 15,
      'furniture': 5,
      'vehicles': 5,
      'real_property': 20,
      'land': 5,
      'goodwill': 30,
      'covenants': 5,
      'intellectual': 5
    };
    
    AssetCategories.forEach(category => {
      assetAllocations[category.id] = defaultAllocations[category.id] || 0;
    });
  }
  
  // Show a specific question
  function showQuestion(index) {
    currentStep = index;
    currentStepEl.textContent = index + 1;
    
    // Update progress bar
    progressBar.style.width = `${((index + 1) / totalSteps) * 100}%`;
    
    // Get the current question
    const question = questions[index];
    
    // Create the question HTML
    let html = `
      <div class="question-step" id="step-${question.id}">
        <h3>${question.title}</h3>
        <p class="question-description">${question.description}</p>
    `;
    
    // Add fields
    question.fields.forEach(field => {
      if (field.type === 'select') {
        html += `
          <div class="input-group">
            <label for="${field.id}">${field.label}</label>
            <select id="${field.id}" class="tool-select">
        `;
        field.options.forEach(option => {
          const isSelected = userAnswers[field.id] === option.value;
          html += `<option value="${option.value}" ${isSelected ? 'selected' : ''}>${option.label}</option>`;
        });
        html += `
            </select>
            ${field.helper ? `<div class="input-helper">${field.helper}</div>` : ''}
          </div>
        `;
      } else if (field.type === 'radio') {
        html += `
          <div class="input-group">
            <label>${field.label}</label>
            <div class="radio-options">
        `;
        field.options.forEach(option => {
          const isSelected = userAnswers[field.id] === option.value;
          html += `
            <div class="radio-option ${isSelected ? 'selected' : ''}" data-value="${option.value}">
              <input type="radio" name="${field.id}" id="${field.id}-${option.value}" value="${option.value}" ${isSelected ? 'checked' : ''}>
              <label for="${field.id}-${option.value}">
                <span class="radio-label-title">${option.title}</span>
                <span class="radio-label-desc">${option.description}</span>
              </label>
            </div>
          `;
        });
        html += `
            </div>
            ${field.helper ? `<div class="input-helper">${field.helper}</div>` : ''}
          </div>
        `;
      } else if (field.type === 'currency') {
        // ADDED: Determine step based on default value
        let stepVal = 1000; // default
        if (field.value === 1000000) {
          stepVal = 100000;
        } else if (field.value === 400000) {
          stepVal = 50000;
        } else if (field.value >= 100000 && field.value <= 390000) {
          stepVal = 10000;
        }

        // ADDED: Display with commas in the input
        const displayVal = (userAnswers[field.id] || 0).toLocaleString();

        html += `
          <div class="input-group">
            <label for="${field.id}">${field.label}</label>
            <div class="input-prefix">
              <span>$</span>
              <input type="number" id="${field.id}" value="${displayVal}" min="0" step="${stepVal}">
            </div>
            ${field.helper ? `<div class="input-helper">${field.helper}</div>` : ''}
          </div>
        `;
      } else if (field.type === 'allocation-table') {
        html += `
          <div class="input-group">
            <label>Asset Allocation</label>
            <table class="allocation-table">
              <thead>
                <tr>
                  <th>Asset Category</th>
                  <th>Description</th>
                  <th>Tax Treatment</th>
                  <th>Allocation (%)</th>
                </tr>
              </thead>
              <tbody>
        `;
        
        field.categories.forEach(category => {
          html += `
            <tr>
              <td>${category.name}</td>
              <td>${category.description}</td>
              <td>${getTaxTypeLabel(category.taxType)}</td>
              <td>
                <input type="number" id="allocation-${category.id}" data-category="${category.id}" 
                  value="${assetAllocations[category.id] || 0}" min="0" max="100" step="1" 
                  class="allocation-input">
              </td>
            </tr>
          `;
        });
        
        html += `
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="3" class="allocation-total">Total</td>
                  <td><span id="allocation-total">100</span>%</td>
                </tr>
              </tfoot>
            </table>
            <div id="allocation-warning" class="allocation-warning">
              Total allocation must equal 100%
            </div>
            ${field.helper ? `<div class="input-helper">${field.helper}</div>` : ''}
          </div>
        `;
      }
    });
    
    html += `</div>`;
    
    // Add navigation buttons
    html += `
      <div class="tool-navigation">
        <button id="back-btn" class="tool-btn tool-btn-secondary" ${index === 0 ? 'disabled' : ''}>Back</button>
        <button id="continue-btn" class="tool-btn tool-btn-primary">${index === totalSteps - 1 ? 'Calculate' : 'Continue'}</button>
      </div>
    `;
    
    // Set the HTML
    questionContainer.innerHTML = html;
    
    // Add event listeners to radio options
    const radioOptions = document.querySelectorAll('.radio-option');
    radioOptions.forEach(option => {
      option.addEventListener('click', function() {
        const fieldId = this.querySelector('input').name;
        const value = this.getAttribute('data-value');
        
        // Update selection visually
        radioOptions.forEach(opt => {
          if (opt.querySelector('input').name === fieldId) {
            opt.classList.remove('selected');
          }
        });
        this.classList.add('selected');
        
        // Update the radio button
        this.querySelector('input').checked = true;
        
        // Store the answer
        userAnswers[fieldId] = value;
      });
    });
    
    // Add event listener for allocation table inputs
    const allocationInputs = document.querySelectorAll('.allocation-input');
    if (allocationInputs.length > 0) {
      allocationInputs.forEach(input => {
        input.addEventListener('input', updateAllocationTotal);
      });
      
      // Initialize allocation total
      updateAllocationTotal();
    }
    
    // Add event listeners to the Back and Continue buttons
    document.getElementById('back-btn').addEventListener('click', function() {
      if (currentStep > 0) {
        // Save current answers
        saveCurrentAnswers();
        // Go to previous question
        showQuestion(currentStep - 1);
      }
    });
    
    document.getElementById('continue-btn').addEventListener('click', function() {
      // Save current answers
      saveCurrentAnswers();
      
      // Check if it's the allocation step and validate total is 100%
      if (question.id === 'asset-allocation') {
        const allocationTotal = calculateAllocationTotal();
        if (Math.abs(allocationTotal - 100) > 0.1) {
          document.getElementById('allocation-warning').style.display = 'block';
          return; 
        }
      }
      
      if (currentStep < totalSteps - 1) {
        showQuestion(currentStep + 1);

        // ADDED: if we just finished screen 2, scroll to screen 3
        if (currentStep === 2) { 
          setTimeout(() => {
            document.getElementById('step-seller-info').scrollIntoView({ behavior: 'smooth' });
          }, 200);
        }

      } else {
        // Show results
        calculateResults();
      }
    });
  }
  
  // Update allocation total when inputs change
  function updateAllocationTotal() {
    const allocationTotal = calculateAllocationTotal();
    document.getElementById('allocation-total').textContent = allocationTotal.toFixed(1);
    
    // Show warning if total is not 100%
    const warningEl = document.getElementById('allocation-warning');
    if (Math.abs(allocationTotal - 100) > 0.1) {
      warningEl.style.display = 'block';
    } else {
      warningEl.style.display = 'none';
    }
  }
  
  // Calculate total allocation percentage
  function calculateAllocationTotal() {
    let total = 0;
    const allocationInputs = document.querySelectorAll('.allocation-input');
    allocationInputs.forEach(input => {
      const value = parseFloat(input.value) || 0;
      total += value;
    });
    return total;
  }
  
  // Save the current answers from the form
  function saveCurrentAnswers() {
    const question = questions[currentStep];
    
    question.fields.forEach(field => {
      if (field.type === 'currency') {
        const inputEl = document.getElementById(field.id);
        if (inputEl) {
          // ADDED: remove commas before parse
          let rawVal = inputEl.value.replace(/,/g, '');
          userAnswers[field.id] = parseFloat(rawVal) || 0;
        }
      } else if (field.type === 'select') {
        const selectEl = document.getElementById(field.id);
        if (selectEl) {
          userAnswers[field.id] = selectEl.value;
        }
      } else if (field.type === 'radio') {
        const checkedOption = document.querySelector(`input[name="${field.id}"]:checked`);
        if (checkedOption) {
          userAnswers[field.id] = checkedOption.value;
        }
      } else if (field.type === 'allocation-table') {
        // Save asset allocations
        const allocationInputs = document.querySelectorAll('.allocation-input');
        allocationInputs.forEach(input => {
          const categoryId = input.getAttribute('data-category');
          assetAllocations[categoryId] = parseFloat(input.value) || 0;
        });
      }
    });
  }
  
  // Calculate and display results
  function calculateResults() {
    // Get user inputs
    const businessStructure = userAnswers['business-structure'] || 'llc_scorp';
    const saleType = userAnswers['sale-type'] || 'asset';
    const totalPrice = parseFloat(userAnswers['total-price']) || 0;
    const totalBasis = parseFloat(userAnswers['basis']) || 0;
    const filingStatus = userAnswers['filing-status'] || 'single';
    const state = userAnswers['state'] || 'CA';
    const otherIncome = parseFloat(userAnswers['other-income']) || 0;
    const depreciation = parseFloat(userAnswers['depreciation-recapture']) || 0;
    const holdingPeriod = userAnswers['holding-period'] || 'more-than-5';
    const installmentSale = userAnswers['installment-sale'] === 'yes';
    const qsbsEligible = userAnswers['qsbs-eligible'] === 'yes';
    
    // Calculate tax implications
    const result = calculateTaxImplications(
      businessStructure, saleType, totalPrice, totalBasis, filingStatus, 
      state, otherIncome, depreciation, holdingPeriod, installmentSale, 
      qsbsEligible, assetAllocations
    );
    
    // Update summary info
    document.getElementById('summary-sale-type').textContent = saleType === 'asset' ? 'Asset Sale' : 'Stock/Equity Sale';
    document.getElementById('summary-business-structure').textContent = getBusinessStructureName(businessStructure);
    document.getElementById('summary-sale-price').textContent = formatCurrency(totalPrice);
    document.getElementById('summary-basis').textContent = formatCurrency(totalBasis);
    document.getElementById('summary-gain').textContent = formatCurrency(result.totalGain);
    
    // Update main tax result
    document.getElementById('total-tax').textContent = formatCurrency(result.totalTaxLiability);
    document.getElementById('effective-rate').textContent = formatPercentage(result.effectiveTaxRate);
    document.getElementById('after-tax').textContent = formatCurrency(result.afterTaxProceeds);
    
    // Update tax breakdown table
    updateTaxBreakdown(result);
    
    // Update visualization
    updateVisualization(result, totalPrice);
    
    // Update tax by type breakdown
    updateTaxByTypeBreakdown(result);
    
    // Show/update comparison if applicable
    if (result.comparison) {
      updateComparison(result.comparison, totalPrice);
      document.getElementById('comparison-container').style.display = 'block';
    } else {
      document.getElementById('comparison-container').style.display = 'none';
    }
    
    // Generate tax planning strategies
    generateTaxPlanningStrategies(result, businessStructure, saleType, installmentSale, qsbsEligible);
    
    // Hide question container and show results
    questionContainer.style.display = 'none';
    resultsContainer.style.display = 'block';
    
    // Add visible class after a slight delay for animation
    setTimeout(() => {
      resultsContainer.classList.add('visible');
    }, 50);
    
    // Scroll to the top of the results
    document.querySelector('.results-header').scrollIntoView({ behavior: 'smooth' });
  }
  
  // Calculate tax implications of business sale
  function calculateTaxImplications(
    businessStructure, saleType, totalPrice, totalBasis, filingStatus, 
    state, otherIncome, depreciation, holdingPeriod, installmentSale, 
    qsbsEligible, assetAllocations
  ) {
    // Initialize result object
    const result = {
      businessStructure,
      saleType,
      totalPrice,
      totalBasis,
      filingStatus,
      state,
      otherIncome,
      depreciation,
      holdingPeriod,
      installmentSale,
      qsbsEligible,
      totalGain: totalPrice - totalBasis,
      stateTaxRate: TaxRates.stateTaxRates[state] || 0,
      assetBreakdown: [],
      ordinaryIncome: 0,
      capitalGains: 0,
      depreciationRecapture: 0,
      federalTax: 0,
      stateTax: 0,
      totalTaxLiability: 0,
      effectiveTaxRate: 0,
      afterTaxProceeds: 0
    };
    
    // Calculate estimated tax rates based on filing status and income
    const ordinaryTaxRate = estimateIncomeTaxRate(otherIncome, filingStatus);
    const longTermCapGainsRate = estimateLongTermCapGainsRate(otherIncome, filingStatus);
    result.ordinaryTaxRate = ordinaryTaxRate;
    result.longTermCapGainsRate = longTermCapGainsRate;
    
    // Different calculation methods based on sale type
    if (saleType === 'asset') {
      calculateAssetSaleTax(result, assetAllocations, holdingPeriod === 'less-than-1');
    } else {
      calculateStockSaleTax(result, holdingPeriod === 'less-than-1', qsbsEligible);
    }
    
    // State tax calculation
    result.stateTax = result.totalGain * result.stateTaxRate;
    
    // Total tax liability
    result.totalTaxLiability = result.federalTax + result.stateTax;
    
    // Effective tax rate
    result.effectiveTaxRate = result.totalGain > 0 ? result.totalTaxLiability / result.totalGain : 0;
    
    // After-tax proceeds
    result.afterTaxProceeds = totalPrice - result.totalTaxLiability;
    
    // For comparison purposes, calculate the alternative sale type
    if (saleType === 'asset') {
      result.comparison = {
        asset: {
          tax: result.totalTaxLiability,
          afterTax: result.afterTaxProceeds
        },
        stock: calculateAlternativeSaleType(
          'stock', businessStructure, totalPrice, totalBasis, filingStatus,
          state, otherIncome, depreciation, holdingPeriod, installmentSale,
          qsbsEligible
        )
      };
    } else {
      result.comparison = {
        stock: {
          tax: result.totalTaxLiability,
          afterTax: result.afterTaxProceeds
        },
        asset: calculateAlternativeSaleType(
          'asset', businessStructure, totalPrice, totalBasis, filingStatus,
          state, otherIncome, depreciation, holdingPeriod, installmentSale,
          qsbsEligible, assetAllocations
        )
      };
    }
    
    return result;
  }
  
  // Calculate tax for asset sale
  function calculateAssetSaleTax(result, assetAllocations, isShortTerm) {
    // Process each asset category and its allocation
    AssetCategories.forEach(category => {
      // Amount allocated to this asset category
      const allocationPercent = assetAllocations[category.id] || 0;
      const allocationAmount = result.totalPrice * (allocationPercent / 100);
      
      // Estimate basis allocation proportionally (simplification)
      const basisAllocation = result.totalBasis * (allocationPercent / 100);
      
      // Calculate gain for this category
      const gain = allocationAmount - basisAllocation;
      
      // Determine tax treatment based on asset type
      let taxType = category.taxType;
      let federalTaxRate = result.ordinaryTaxRate; // Default
      let taxCategory = 'Ordinary Income';
      
      if (taxType === 'ordinary_income') {
        result.ordinaryIncome += gain;
        taxCategory = 'Ordinary Income';
      } else if (taxType === 'capital_gains') {
        if (isShortTerm) {
          result.ordinaryIncome += gain;
          taxCategory = 'Short-Term Capital Gains';
        } else {
          result.capitalGains += gain;
          federalTaxRate = result.longTermCapGainsRate;
          taxCategory = 'Long-Term Capital Gains';
        }
      } else if (taxType === 'recapture_1245') {
        // Section 1245 property - recapture ordinary income to extent of depreciation
        const estimatedDepreciation = Math.min(gain, result.depreciation * (allocationPercent / 100));
        result.depreciationRecapture += estimatedDepreciation;
        
        if (gain > estimatedDepreciation) {
          if (isShortTerm) {
            result.ordinaryIncome += (gain - estimatedDepreciation);
            taxCategory = 'Depreciation Recapture + Short-Term Gains';
          } else {
            result.capitalGains += (gain - estimatedDepreciation);
            taxCategory = 'Depreciation Recapture + Long-Term Gains';
          }
        } else {
          taxCategory = 'Depreciation Recapture';
        }
        
        // Weighted average tax rate
        if (gain > 0) {
          federalTaxRate = (estimatedDepreciation * result.ordinaryTaxRate + 
                           (gain - estimatedDepreciation) * (isShortTerm ? result.ordinaryTaxRate : result.longTermCapGainsRate)) / gain;
        }
      } else if (taxType === 'recapture_1250') {
        // Section 1250 property - special 25% rate on unrecaptured gain (simplified)
        const estimatedDepreciation = Math.min(gain, result.depreciation * (allocationPercent / 100));
        result.depreciationRecapture += estimatedDepreciation;
        
        if (gain > estimatedDepreciation) {
          result.capitalGains += (gain - estimatedDepreciation);
          taxCategory = 'Unrecaptured Â§1250 Gain + Long-Term Gains';
        } else {
          taxCategory = 'Unrecaptured Â§1250 Gain';
        }
        
        // Weighted average tax rate
        if (gain > 0) {
          federalTaxRate = (estimatedDepreciation * TaxRates.deprecRecapture + 
                           (gain - estimatedDepreciation) * result.longTermCapGainsRate) / gain;
        }
      }
      
      // Calculate federal tax for this asset
      const federalTax = gain * federalTaxRate;
      
      // Add to result breakdown
      result.assetBreakdown.push({
        category: category.name,
        allocation: allocationAmount,
        allocationPercent: allocationPercent,
        basis: basisAllocation,
        gain: gain,
        taxType: taxCategory,
        federalTaxRate: federalTaxRate,
        federalTax: federalTax
      });
    });
    
    // Calculate total federal tax
    result.federalTax = result.assetBreakdown.reduce((total, item) => total + item.federalTax, 0);
    
    // Special case for pass-through entities with self-employment tax
    if (['sole_prop', 'partnership', 'llc_disregarded', 'llc_partnership'].includes(result.businessStructure)) {
      // Apply self-employment tax to ordinary income portion
      const selfEmploymentTaxableIncome = result.ordinaryIncome;
      const selfEmploymentTax = selfEmploymentTaxableIncome * TaxRates.selfEmployment;
      
      result.selfEmploymentTax = selfEmploymentTax;
      result.federalTax += selfEmploymentTax;
      
      // Add SE tax as a separate line item
      result.seBreakdown = {
        category: 'Self-Employment Tax',
        allocation: 0,
        basis: 0,
        gain: selfEmploymentTaxableIncome,
        taxType: 'Self-Employment Tax',
        federalTaxRate: TaxRates.selfEmployment,
        federalTax: selfEmploymentTax
      };
    }
    
    // Installment sale note
    if (result.installmentSale) {
      result.installmentSaleImpact = true;
    }
    
    return result;
  }
  
  // Calculate tax for stock/equity sale
  function calculateStockSaleTax(result, isShortTerm, qsbsEligible) {
    let federalTaxRate;
    let taxCategory;
    
    if (['ccorp', 'scorp'].includes(result.businessStructure) || 
        ['llc_scorp'].includes(result.businessStructure)) {
      // Corporate stock
      if (isShortTerm) {
        result.ordinaryIncome += result.totalGain;
        federalTaxRate = result.ordinaryTaxRate;
        taxCategory = 'Short-Term Capital Gains';
      } else {
        result.capitalGains += result.totalGain;
        federalTaxRate = result.longTermCapGainsRate;
        taxCategory = 'Long-Term Capital Gains';
        
        // QSBS check
        if (qsbsEligible && result.businessStructure === 'ccorp') {
          if (result.holdingPeriod === 'more-than-5') {
            const exclusionAmount = Math.min(result.totalGain, 10000000);
            result.capitalGains -= exclusionAmount;
            result.qsbsExclusionAmount = exclusionAmount;
            taxCategory = 'Long-Term Capital Gains (with QSBS exclusion)';
          }
        }
      }
    } else {
      // Pass-through interest sale
      const ordinaryPortion = result.totalGain * 0.3;
      const capitalPortion = result.totalGain * 0.7;
      
      result.ordinaryIncome += ordinaryPortion;
      
      if (isShortTerm) {
        result.ordinaryIncome += capitalPortion;
        taxCategory = 'Mixed: Ordinary + Short-Term Gains';
      } else {
        result.capitalGains += capitalPortion;
        taxCategory = 'Mixed: Ordinary + Long-Term Gains';
      }
      
      federalTaxRate = (ordinaryPortion * result.ordinaryTaxRate + 
                       capitalPortion * (isShortTerm ? result.ordinaryTaxRate : result.longTermCapGainsRate)) / 
                       result.totalGain;
    }
    
    const federalTax = result.totalGain * federalTaxRate;
    result.federalTax = federalTax;
    
    result.assetBreakdown.push({
      category: 'Equity Interest',
      allocation: result.totalPrice,
      allocationPercent: 100,
      basis: result.totalBasis,
      gain: result.totalGain,
      taxType: taxCategory,
      federalTaxRate: federalTaxRate,
      federalTax: federalTax
    });
    
    return result;
  }
  
  // Calculate alternative sale type for comparison
  function calculateAlternativeSaleType(
    saleType, businessStructure, totalPrice, totalBasis, filingStatus,
    state, otherIncome, depreciation, holdingPeriod, installmentSale,
    qsbsEligible, assetAllocations
  ) {
    const result = {
      businessStructure,
      saleType,
      totalPrice,
      totalBasis,
      filingStatus,
      state,
      totalGain: totalPrice - totalBasis,
      stateTaxRate: TaxRates.stateTaxRates[state] || 0
    };
    
    const ordinaryTaxRate = estimateIncomeTaxRate(otherIncome, filingStatus);
    const longTermCapGainsRate = estimateLongTermCapGainsRate(otherIncome, filingStatus);
    result.ordinaryTaxRate = ordinaryTaxRate;
    result.longTermCapGainsRate = longTermCapGainsRate;
    
    if (saleType === 'asset') {
      const allocations = assetAllocations || {
        'inventory': 5,
        'receivables': 5,
        'equipment': 15,
        'furniture': 5,
        'vehicles': 5,
        'real_property': 20,
        'land': 5,
        'goodwill': 30,
        'covenants': 5,
        'intellectual': 5
      };
      
      let ordinaryIncome = 0;
      let capitalGains = 0;
      
      AssetCategories.forEach(category => {
        const allocationPercent = allocations[category.id] || 0;
        const gain = result.totalGain * (allocationPercent / 100);
        
        if (category.taxType === 'ordinary_income' || 
            (category.taxType === 'recapture_1245' || category.taxType === 'recapture_1250')) {
          ordinaryIncome += gain;
        } else {
          capitalGains += gain;
        }
      });
      
      const federalTax = (ordinaryIncome * ordinaryTaxRate) + 
                         (capitalGains * (holdingPeriod === 'less-than-1' ? ordinaryTaxRate : longTermCapGainsRate));
      const stateTax = result.totalGain * result.stateTaxRate;
      
      return {
        tax: federalTax + stateTax,
        afterTax: totalPrice - (federalTax + stateTax)
      };
    } else {
      let federalTaxRate = holdingPeriod === 'less-than-1' ? ordinaryTaxRate : longTermCapGainsRate;
      
      if (qsbsEligible && businessStructure === 'ccorp' && holdingPeriod === 'more-than-5') {
        const exclusionAmount = Math.min(result.totalGain, 10000000);
        const taxableGain = result.totalGain - exclusionAmount;
        const federalTax = taxableGain * federalTaxRate;
        const stateTax = result.totalGain * result.stateTaxRate;
        
        return {
          tax: federalTax + stateTax,
          afterTax: totalPrice - (federalTax + stateTax)
        };
      }
      
      const federalTax = result.totalGain * federalTaxRate;
      const stateTax = result.totalGain * result.stateTaxRate;
      
      return {
        tax: federalTax + stateTax,
        afterTax: totalPrice - (federalTax + stateTax)
      };
    }
  }
  
  // Update tax breakdown table
  function updateTaxBreakdown(result) {
    const tableBody = document.getElementById('tax-breakdown-body');
    let html = '';
    
    result.assetBreakdown.forEach(item => {
      html += `
        <tr>
          <td>${item.category}</td>
          <td>${formatCurrency(item.allocation)} (${item.allocationPercent.toFixed(1)}%)</td>
          <td>${formatCurrency(item.basis)}</td>
          <td>${formatCurrency(item.gain)}</td>
          <td>${item.taxType}</td>
          <td>${formatPercentage(item.federalTaxRate)}</td>
          <td>${formatCurrency(item.federalTax)}</td>
        </tr>
      `;
    });
    
    if (result.selfEmploymentTax) {
      html += `
        <tr>
          <td>Self-Employment Tax</td>
          <td>N/A</td>
          <td>N/A</td>
          <td>${formatCurrency(result.seBreakdown.gain)}</td>
          <td>${result.seBreakdown.taxType}</td>
          <td>${formatPercentage(result.seBreakdown.federalTaxRate)}</td>
          <td>${formatCurrency(result.seBreakdown.federalTax)}</td>
        </tr>
      `;
    }
    
    html += `
      <tr>
        <td>State Tax (${result.state})</td>
        <td>N/A</td>
        <td>N/A</td>
        <td>${formatCurrency(result.totalGain)}</td>
        <td>State Income Tax</td>
        <td>${formatPercentage(result.stateTaxRate)}</td>
        <td>${formatCurrency(result.stateTax)}</td>
      </tr>
    `;
    
    tableBody.innerHTML = html;
    
    document.getElementById('total-gain').textContent = formatCurrency(result.totalGain);
    document.getElementById('total-tax-amount').textContent = formatCurrency(result.totalTaxLiability);
  }
  
  // Update visualization
  function updateVisualization(result, totalPrice) {
    document.getElementById('chart-sale-price').textContent = formatCurrency(totalPrice);
    document.getElementById('chart-tax-amount').textContent = formatCurrency(result.totalTaxLiability);
    document.getElementById('chart-after-tax').textContent = formatCurrency(result.afterTaxProceeds);
    
    setTimeout(() => {
      const taxBarPercent = (result.totalTaxLiability / totalPrice) * 100;
      const proceedsBarPercent = (result.afterTaxProceeds / totalPrice) * 100;
      
      document.getElementById('tax-bar').style.width = `${taxBarPercent}%`;
      document.getElementById('proceeds-bar').style.width = `${proceedsBarPercent}%`;
    }, 100);
  }
  
  // Update tax by type breakdown
  function updateTaxByTypeBreakdown(result) {
    const ordinaryTax = result.ordinaryIncome * result.ordinaryTaxRate;
    document.getElementById('ordinary-income-tax').textContent = formatCurrency(ordinaryTax);
    document.getElementById('ordinary-income-details').innerHTML = `
      <p>${formatCurrency(result.ordinaryIncome)} taxed at ${formatPercentage(result.ordinaryTaxRate)} (Federal)</p>
      <p>Ordinary income may include sale of inventory, receivables, depreciation recapture, and certain intangibles like covenants not to compete.</p>
    `;
    
    const capitalGainsTax = result.capitalGains * result.longTermCapGainsRate;
    document.getElementById('capital-gains-tax').textContent = formatCurrency(capitalGainsTax);
    document.getElementById('capital-gains-details').innerHTML = `
      <p>${formatCurrency(result.capitalGains)} taxed at ${formatPercentage(result.longTermCapGainsRate)} (Federal)</p>
      <p>Capital gains typically include goodwill, business interest, land, and appreciation of other assets above their basis.</p>
    `;
    
    const depreciationRecaptureTax = result.depreciationRecapture * result.ordinaryTaxRate;
    document.getElementById('depreciation-recapture-tax').textContent = formatCurrency(depreciationRecaptureTax);
    document.getElementById('depreciation-recapture-details').innerHTML = `
      <p>${formatCurrency(result.depreciationRecapture)} taxed at ${formatPercentage(result.ordinaryTaxRate)} (Federal)</p>
      <p>Depreciation recapture occurs when depreciable assets are sold for more than their adjusted basis, but not more than their original cost.</p>
    `;
    
    document.getElementById('state-tax').textContent = formatCurrency(result.stateTax);
    document.getElementById('state-tax-details').innerHTML = `
      <p>${formatCurrency(result.totalGain)} taxed at ${formatPercentage(result.stateTaxRate)} (${getStateName(result.state)})</p>
      <p>State tax is typically applied to the entire gain regardless of federal tax characterization. Some states have reduced rates for capital gains.</p>
    `;
    
    if (result.depreciationRecapture > 0) {
      document.getElementById('depreciation-recapture-container').style.display = 'block';
    } else {
      document.getElementById('depreciation-recapture-container').style.display = 'none';
    }
    
    if (result.stateTax > 0) {
      document.getElementById('state-tax-container').style.display = 'block';
    } else {
      document.getElementById('state-tax-container').style.display = 'none';
    }
  }
  
  // Update comparison section
  function updateComparison(comparison, totalPrice) {
    document.getElementById('asset-tax-value').textContent = formatCurrency(comparison.asset.tax);
    document.getElementById('asset-aftertax-value').textContent = formatCurrency(comparison.asset.afterTax);
    document.getElementById('stock-tax-value').textContent = formatCurrency(comparison.stock.tax);
    document.getElementById('stock-aftertax-value').textContent = formatCurrency(comparison.stock.afterTax);
    
    setTimeout(() => {
      const assetTaxPercent = (comparison.asset.tax / totalPrice) * 100;
      const assetAfterTaxPercent = (comparison.asset.afterTax / totalPrice) * 100;
      const stockTaxPercent = (comparison.stock.tax / totalPrice) * 100;
      const stockAfterTaxPercent = (comparison.stock.afterTax / totalPrice) * 100;
      
      document.getElementById('asset-tax-segment').style.width = `${assetTaxPercent}%`;
      document.getElementById('asset-aftertax-segment').style.width = `${assetAfterTaxPercent}%`;
      document.getElementById('stock-tax-segment').style.width = `${stockTaxPercent}%`;
      document.getElementById('stock-aftertax-segment').style.width = `${stockAfterTaxPercent}%`;
    }, 100);
    
    const taxDifference = Math.abs(comparison.asset.tax - comparison.stock.tax);
    const betterOption = comparison.asset.afterTax > comparison.stock.afterTax ? 'Asset Sale' : 'Stock/Equity Sale';
    const worseTaxOption = comparison.asset.tax > comparison.stock.tax ? 'Asset Sale' : 'Stock/Equity Sale';
    
    document.getElementById('comparison-summary').innerHTML = `
      <p>Based on your inputs, a <strong>${betterOption}</strong> could result in approximately <strong>${formatCurrency(taxDifference)}</strong> less in taxes compared to a ${worseTaxOption}.</p>
      <p>Note: This is a simplified comparison. The actual tax difference may vary based on specific details of your business and how the purchase price is allocated among different assets.</p>
    `;
  }
  
  // Generate tax planning strategies
  function generateTaxPlanningStrategies(result, businessStructure, saleType, installmentSale, qsbsEligible) {
    const planningDiv = document.getElementById('planning-strategies');
    
    let strategies = `<p>Based on your specific situation, consider these potential tax planning opportunities:</p>`;
    
    if (result.comparison && Math.abs(result.comparison.asset.tax - result.comparison.stock.tax) > 1000) {
      const betterOption = result.comparison.asset.afterTax > result.comparison.stock.afterTax ? 'asset' : 'stock';
      strategies += `
        <h5>Sale Structure Optimization</h5>
        <p>Based on your inputs, a ${betterOption === 'asset' ? 'asset' : 'stock/equity'} sale structure may be more tax-efficient. Consider negotiating with the buyer for this structure, potentially adjusting the price to share some of the tax benefits.</p>
      `;
    }
    
    if (!installmentSale && result.totalTaxLiability > 100000) {
      strategies += `
        <h5>Installment Sale Consideration</h5>
        <p>An installment sale could spread the tax liability over multiple years, potentially keeping you in lower tax brackets. This strategy works best when:</p>
        <ul>
          <li>You don't need all the proceeds immediately</li>
          <li>You expect lower income in future years</li>
          <li>The buyer is willing to make payments over time</li>
        </ul>
      `;
    }
    
    if (businessStructure === 'ccorp') {
      strategies += `
        <h5>C Corporation Considerations</h5>
        <p>For C Corporation sales:</p>
        <ul>
          <li>${qsbsEligible ? 'Continue to maintain QSBS eligibility until sale' : 'Consider if you might qualify for QSBS (Qualified Small Business Stock) treatment, which could exclude up to 100% of eligible gains'}</li>
          <li>If selling assets, consider distributing the proceeds through qualified dividends rather than as compensation</li>
          <li>Review accumulated earnings and profits to understand potential dividend tax implications</li>
        </ul>
      `;
    } else if (['scorp', 'llc_scorp'].includes(businessStructure)) {
      strategies += `
        <h5>S Corporation Strategies</h5>
        <p>For S Corporation sales:</p>
        <ul>
          <li>Consider the timing of the sale relative to the tax year to optimize income recognition</li>
          <li>Review your basis in the S corporation to ensure it's maximized before sale</li>
          <li>If selling assets, carefully plan the allocation to maximize capital gains treatment</li>
        </ul>
      `;
    } else if (['sole_prop', 'partnership', 'llc_disregarded', 'llc_partnership'].includes(businessStructure)) {
      strategies += `
        <h5>Pass-Through Entity Strategies</h5>
        <p>For pass-through entity sales:</p>
        <ul>
          <li>Consider if converting to an S Corporation before sale might provide self-employment tax savings</li>
          <li>Review Section 1202 eligibility if considering conversion to a C Corporation</li>
          <li>If selling assets, carefully plan the allocation to maximize capital gains treatment</li>
        </ul>
      `;
    }
    
    if (saleType === 'asset') {
      strategies += `
        <h5>Asset Allocation Optimization</h5>
        <p>In an asset sale, the allocation of the purchase price among different assets significantly affects your tax liability:</p>
        <ul>
          <li>Buyers typically prefer allocating more to assets they can depreciate quickly</li>
          <li>Sellers typically prefer allocating more to goodwill and other capital assets</li>
          <li>Negotiate a mutually agreeable allocation that's defensible to tax authorities</li>
        </ul>
      `;
    }
    
    if (result.stateTax > 50000) {
      strategies += `
        <h5>State Tax Planning</h5>
        <p>With substantial state taxes at stake:</p>
        <ul>
          <li>Consider timing of the sale if you're planning to move to a lower-tax state</li>
          <li>Explore whether your state offers any exclusions or reduced rates for business sales</li>
          <li>Investigate installment sale treatment for state tax purposes</li>
        </ul>
      `;
    }
    
    strategies += `
      <h5>General Tax Planning</h5>
      <p>Additional strategies to consider:</p>
      <ul>
        <li>Offset gains with losses from other investments or business activities</li>
        <li>Maximize retirement plan contributions in the year of sale</li>
        <li>Consider charitable donations of appreciated assets</li>
        <li>Work with a tax professional to model different scenarios before finalizing the sale</li>
      </ul>
    `;
    
    planningDiv.innerHTML = strategies;
  }
  
  // Helper functions
  function formatCurrency(amount) {
    return '$' + Math.round(amount).toLocaleString();
  }
  
  function formatPercentage(rate) {
    return (rate * 100).toFixed(1) + '%';
  }
  
  function getBusinessStructureName(structure) {
    const structures = {
      'sole_prop': 'Sole Proprietorship',
      'partnership': 'Partnership',
      'llc_disregarded': 'Single-Member LLC',
      'llc_partnership': 'Multi-Member LLC',
      'llc_scorp': 'LLC (S Corp Election)',
      'scorp': 'S Corporation',
      'ccorp': 'C Corporation'
    };
    return structures[structure] || structure;
  }
  
  function getStateName(stateCode) {
    const states = {
      'AL': 'Alabama',
      'AK': 'Alaska',
      'AZ': 'Arizona',
      'AR': 'Arkansas',
      'CA': 'California',
      'CO': 'Colorado',
      'CT': 'Connecticut',
      'DE': 'Delaware',
      'FL': 'Florida',
      'GA': 'Georgia',
      'HI': 'Hawaii',
      'ID': 'Idaho',
      'IL': 'Illinois',
      'IN': 'Indiana',
      'IA': 'Iowa',
      'KS': 'Kansas',
      'KY': 'Kentucky',
      'LA': 'Louisiana',
      'ME': 'Maine',
      'MD': 'Maryland',
      'MA': 'Massachusetts',
      'MI': 'Michigan',
      'MN': 'Minnesota',
      'MS': 'Mississippi',
      'MO': 'Missouri',
      'MT': 'Montana',
      'NE': 'Nebraska',
      'NV': 'Nevada',
      'NH': 'New Hampshire',
      'NJ': 'New Jersey',
      'NM': 'New Mexico',
      'NY': 'New York',
      'NC': 'North Carolina',
      'ND': 'North Dakota',
      'OH': 'Ohio',
      'OK': 'Oklahoma',
      'OR': 'Oregon',
      'PA': 'Pennsylvania',
      'RI': 'Rhode Island',
      'SC': 'South Carolina',
      'SD': 'South Dakota',
      'TN': 'Tennessee',
      'TX': 'Texas',
      'UT': 'Utah',
      'VT': 'Vermont',
      'VA': 'Virginia',
      'WA': 'Washington',
      'WV': 'West Virginia',
      'WI': 'Wisconsin',
      'WY': 'Wyoming'
    };
    return states[stateCode] || stateCode;
  }
  
  function getTaxTypeLabel(taxType) {
    const types = {
      'ordinary_income': 'Ordinary Income',
      'capital_gains': 'Capital Gains',
      'recapture_1245': 'Depreciation Recapture (Sec. 1245)',
      'recapture_1250': 'Depreciation Recapture (Sec. 1250)'
    };
    return types[taxType] || taxType;
  }
  
  // Estimate income tax rate based on income level and filing status
  function estimateIncomeTaxRate(income, filingStatus) {
    const brackets = TaxRates.incomeTax[filingStatus] || TaxRates.incomeTax.single;
    let rate = 0;
    
    for (let i = 0; i < brackets.length; i++) {
      if (income <= brackets[i].max) {
        rate = brackets[i].rate;
        break;
      }
    }
    
    return rate;
  }
  
  // Estimate long-term capital gains rate based on income level and filing status
  function estimateLongTermCapGainsRate(income, filingStatus) {
    const brackets = TaxRates.longTermCapitalGains[filingStatus] || TaxRates.longTermCapitalGains.single;
    let rate = 0;
    
    for (let i = 0; i < brackets.length; i++) {
      if (income <= brackets[i].max) {
        rate = brackets[i].rate;
        break;
      }
    }
    
    // ADDED: Use the threshold we defined to avoid errors
    const niitThreshold = TaxRates.netInvestmentIncome.threshold[filingStatus === 'joint' ? 'joint' : 'single'];
    if (income > niitThreshold) {
      rate += TaxRates.netInvestmentIncome.rate;
    }
    
    return rate;
  }
  
  // Initialize the tool
  initTool();
});
</script>




<h1 class="wp-block-heading">Understanding the Tax Implications When Selling Your Business: A Comprehensive Guide</h1>



<p>When you decide to sell your business, understanding the tax implications is crucial to maximizing your after-tax proceeds. The difference between a well-planned and poorly-planned business sale can easily result in hundreds of thousands of dollars in additional tax liability. My Business Sale Tax Calculator is designed to help you navigate these complex waters and make more informed decisions about structuring your sale.</p>



<h2 class="wp-block-heading">How the Business Sale Tax Calculator Works</h2>



<p>The Business Sale Tax Calculator provides a detailed analysis of the potential tax consequences of your business sale based on your specific situation. By inputting information about your business structure, sale type, purchase price allocation, and personal tax situation, you&#8217;ll receive a comprehensive breakdown of expected taxes and after-tax proceeds.</p>



<p>The calculator examines various factors including:</p>



<ul class="wp-block-list">
<li>Federal income tax on different asset classes</li>



<li>Capital gains tax considerations</li>



<li>Depreciation recapture</li>



<li>State income tax implications</li>



<li>Alternative Minimum Tax concerns</li>



<li>Comparative analysis between asset and stock sales</li>
</ul>



<p>Let&#8217;s explore how to use the calculator and understand the key factors that influence your business sale&#8217;s tax outcome.</p>



<h2 class="wp-block-heading">Business Sale Basics: Asset vs. Stock Sales</h2>



<p>One of the first and most consequential decisions you&#8217;ll make when selling your business is whether to structure the transaction as an asset sale or a stock/equity sale.</p>



<h3 class="wp-block-heading">Asset Sales</h3>



<p>In an asset sale, the buyer purchases individual assets of the business rather than ownership interests in the company itself. The assets might include equipment, inventory, real estate, customer lists, goodwill, and other tangible and intangible items. The business entity itself remains with the seller, though often as an empty shell after the sale.</p>



<p>From a tax perspective, asset sales typically result in:</p>



<ol class="wp-block-list">
<li>Different tax rates applied to different asset categories</li>



<li>Potential depreciation recapture taxed at ordinary income rates</li>



<li>Some assets receiving favorable capital gains treatment</li>



<li>The buyer receiving a stepped-up basis in the acquired assets</li>
</ol>



<p>Asset sales are generally preferred by buyers because they can:</p>



<ul class="wp-block-list">
<li>Avoid inheriting unknown liabilities</li>



<li>Reset depreciation schedules for tangible assets</li>



<li>Amortize goodwill and other intangibles over 15 years</li>



<li>Select which assets to purchase and which to exclude</li>
</ul>



<h3 class="wp-block-heading">Stock/Equity Sales</h3>



<p>In a stock sale (or equity sale for LLCs and partnerships), the buyer purchases the ownership interests directly from the owners. The business entity continues to own all its assets and liabilities, just under new ownership.</p>



<p>Stock sales typically result in:</p>



<ol class="wp-block-list">
<li>The entire gain being treated as capital gain</li>



<li>Potentially qualifying for lower long-term capital gains rates</li>



<li>Possible qualification for the Qualified Small Business Stock (QSBS) exclusion</li>



<li>Simpler transaction structure with fewer tax complications</li>
</ol>



<p>Stock sales are generally preferred by sellers because they:</p>



<ul class="wp-block-list">
<li>Often result in lower overall tax liability</li>



<li>Involve simpler tax compliance</li>



<li>Allow for clean break from business liabilities</li>



<li>May qualify for special tax treatments like QSBS exclusion</li>
</ul>



<p>The calculator helps you compare both approaches so you can see which structure might be more advantageous in your specific situation.</p>



<h2 class="wp-block-heading">Business Structure and Its Impact on Sale Taxation</h2>



<p>The legal structure of your business significantly impacts how a sale will be taxed. The calculator accounts for these differences to provide accurate estimates.</p>



<h3 class="wp-block-heading">Sole Proprietorships and Disregarded LLCs</h3>



<p>When selling a sole proprietorship or single-member LLC, you&#8217;re essentially selling a collection of assets since these entities aren&#8217;t separate from their owners for tax purposes. Key considerations include:</p>



<ul class="wp-block-list">
<li>The entire sale will be reported on your personal tax return</li>



<li>Self-employment tax may apply to portions of the gain</li>



<li>Assets held longer than one year may qualify for long-term capital gains rates</li>



<li>No separate entity-level taxation exists</li>
</ul>



<h3 class="wp-block-heading">Partnerships and Multi-Member LLCs</h3>



<p>For partnerships and multi-member LLCs taxed as partnerships, the tax treatment depends on whether you&#8217;re selling assets or partnership interests:</p>



<ul class="wp-block-list">
<li>Asset sales flow through to partners based on their ownership percentages</li>



<li>Partnership interest sales may result in a mix of ordinary income and capital gains under IRC Section 751 (related to &#8220;hot assets&#8221; like inventory and unrealized receivables)</li>



<li>Special allocations in the partnership agreement might impact how sale proceeds are distributed</li>
</ul>



<h3 class="wp-block-heading">S Corporations</h3>



<p>S corporations offer some unique advantages when it comes to business sales:</p>



<ul class="wp-block-list">
<li>Stock sales generally receive favorable capital gains treatment</li>



<li>No self-employment tax applies to the gain</li>



<li>Asset sales flow through to shareholders based on their pro rata share</li>



<li>Potential for reduced overall tax compared to partnership structures due to the absence of self-employment tax</li>
</ul>



<h3 class="wp-block-heading">C Corporations</h3>



<p>C corporations present the most complex tax situation due to potential double taxation:</p>



<ul class="wp-block-list">
<li>Asset sales result in corporate-level tax first, then potential additional tax when proceeds are distributed to shareholders</li>



<li>Stock sales are taxed only once at the shareholder level, typically at capital gains rates</li>



<li>Qualified Small Business Stock (QSBS) exclusion may apply to eligible C corporation stock held over 5 years</li>



<li>Various tax planning strategies exist to mitigate the impact of double taxation</li>
</ul>



<p>The calculator accounts for these structural differences to help you understand which entity type might be most tax-efficient for your sale.</p>



<h2 class="wp-block-heading">Asset Allocation: A Critical Tax Planning Tool</h2>



<p>In an asset sale, how the purchase price is allocated among different asset categories has enormous tax implications. The calculator allows you to experiment with different allocations to see their impact on your bottom line.</p>



<h3 class="wp-block-heading">Why Asset Allocation Matters</h3>



<p>Different asset classes are taxed differently:</p>



<ol class="wp-block-list">
<li><strong>Ordinary Income Assets</strong>: Items like inventory and accounts receivable are taxed at ordinary income rates (up to 37% federal).</li>



<li><strong>Depreciation Recapture Assets</strong>: Equipment, vehicles, and certain improvements may be subject to depreciation recapture, with gains taxed as ordinary income to the extent of prior depreciation.</li>



<li><strong>Capital Assets</strong>: Goodwill, going concern value, and certain other intangibles are typically taxed at more favorable capital gains rates (0%, 15%, or 20% depending on your income level).</li>



<li><strong>Real Property</strong>: Buildings and land may have complex tax treatment including potential unrecaptured Section 1250 gain taxed at 25%.</li>
</ol>



<p>The IRS requires both buyer and seller to file Form 8594 (Asset Acquisition Statement) reporting how the purchase price is allocated. This allocation must be economically reasonable and consistent between buyer and seller.</p>



<h3 class="wp-block-heading">Strategic Allocation Considerations</h3>



<p>Sellers typically prefer allocating more of the purchase price to goodwill and other capital assets, while buyers generally prefer allocations to assets they can depreciate or amortize quickly. This inherent tension creates room for negotiation.</p>



<p>For instance, allocating $500,000 to goodwill rather than to fully depreciated equipment could save a seller over $100,000 in taxes if they&#8217;re in the highest tax brackets. The calculator helps you visualize these differences and understand their impact on your after-tax proceeds.</p>



<h2 class="wp-block-heading">Personal Tax Situation and Its Impact on Business Sale Taxation</h2>



<p>Your personal tax situation, including your tax filing status, other income, and state of residence, significantly impacts the overall tax liability from selling your business.</p>



<h3 class="wp-block-heading">Federal Tax Considerations</h3>



<p>Your federal income tax brackets determine how much you&#8217;ll pay on ordinary income from the sale, while your capital gains brackets (which depend on your overall income) determine the rate applied to long-term capital gains.</p>



<p>For 2024, long-term capital gains rates are:</p>



<ul class="wp-block-list">
<li>0% for incomes up to $47,025 for single filers or $94,050 for married filing jointly</li>



<li>15% for incomes up to $518,900 for single filers or $583,750 for married filing jointly</li>



<li>20% for incomes above those thresholds</li>
</ul>



<p>High-income taxpayers may also face the additional 3.8% Net Investment Income Tax on investment income, including income from business sales.</p>



<h3 class="wp-block-heading">State Tax Implications</h3>



<p>State taxes can significantly impact your overall tax liability. Some states tax all income at the same rate, while others have preferential rates for capital gains. Some states, like Florida, Texas, and Nevada, have no state income tax at all.</p>



<p>The calculator incorporates state tax estimates based on your state of residence to provide a more complete picture of your total tax liability.</p>



<h2 class="wp-block-heading">Advanced Tax Planning Strategies</h2>



<p>The calculator helps you evaluate several advanced tax planning strategies that could reduce your tax liability when selling your business.</p>



<h3 class="wp-block-heading">Installment Sales</h3>



<p>An installment sale involves receiving the purchase price over multiple tax years rather than all at once. This approach can:</p>



<ul class="wp-block-list">
<li>Spread income over multiple tax years, potentially keeping you in lower tax brackets</li>



<li>Defer tax liability to future years</li>



<li>Match cash flow with tax payments</li>
</ul>



<p>The calculator can help estimate the potential benefits of an installment sale compared to receiving the full amount in the year of sale.</p>



<h3 class="wp-block-heading">Qualified Small Business Stock (QSBS) Exclusion</h3>



<p>For eligible C corporation stock held for more than five years, the Section 1202 QSBS exclusion can potentially exclude up to 100% of the gain from federal taxation (up to the greater of $10 million or 10 times your basis).</p>



<p>The calculator helps determine if your situation might qualify for this valuable exclusion and estimates the potential tax savings.</p>



<h3 class="wp-block-heading">Like-Kind Exchanges</h3>



<p>While Section 1031 like-kind exchanges no longer apply to personal property, they remain available for real estate. If your business sale includes significant real estate assets, a like-kind exchange might allow you to defer taxes on those specific assets.</p>



<h2 class="wp-block-heading">Using the Business Sale Tax Calculator: Step-by-Step Guide</h2>



<p>Now that we&#8217;ve covered the key concepts, let&#8217;s walk through how to use the calculator effectively:</p>



<h3 class="wp-block-heading">Step 1: Enter Business Sale Basics</h3>



<p>Start by selecting your business&#8217;s legal structure from the dropdown menu:</p>



<ul class="wp-block-list">
<li>Sole Proprietorship</li>



<li>Partnership</li>



<li>Single-Member LLC</li>



<li>Multi-Member LLC</li>



<li>LLC taxed as S Corporation</li>



<li>S Corporation</li>



<li>C Corporation</li>
</ul>



<p>Next, choose whether you&#8217;re considering an asset sale or a stock/equity sale.</p>



<p>Enter the total sale price and your adjusted basis in the business. The adjusted basis is generally your original investment plus additional capital contributions and reinvested profits, minus any depreciation taken.</p>



<h3 class="wp-block-heading">Step 2: Asset Allocation</h3>



<p>For asset sales, you&#8217;ll need to allocate the purchase price among different asset categories. The calculator provides default allocations, but you should adjust these to match your specific situation.</p>



<p>Typical allocations include:</p>



<ul class="wp-block-list">
<li>Inventory</li>



<li>Accounts Receivable</li>



<li>Equipment &amp; Machinery</li>



<li>Furniture &amp; Fixtures</li>



<li>Vehicles</li>



<li>Real Property</li>



<li>Land</li>



<li>Goodwill</li>



<li>Covenants Not to Compete</li>



<li>Intellectual Property</li>
</ul>



<p>The allocation percentages must total 100% before proceeding.</p>



<h3 class="wp-block-heading">Step 3: Personal Tax Information</h3>



<p>Enter your tax filing status (single, married filing jointly, or head of household), state of residence, and other annual income. These factors affect your tax brackets and overall tax liability.</p>



<h3 class="wp-block-heading">Step 4: Advanced Options</h3>



<p>Enter additional details that might impact your tax situation:</p>



<ul class="wp-block-list">
<li>Total accumulated depreciation on assets being sold</li>



<li>How long you&#8217;ve owned the business</li>



<li>Whether you&#8217;re considering an installment sale</li>



<li>Whether your business might qualify for the QSBS exclusion</li>
</ul>



<h3 class="wp-block-heading">Step 5: Review Results</h3>



<p>After entering all information, the calculator will provide a comprehensive analysis including:</p>



<ul class="wp-block-list">
<li>Total tax liability</li>



<li>Effective tax rate</li>



<li>After-tax proceeds</li>



<li>Detailed breakdown by asset category</li>



<li>Comparison between asset sale and stock sale</li>



<li>Visualization of tax impact</li>



<li>Tax planning considerations</li>
</ul>



<p>Take time to review each section to fully understand the tax implications of your potential sale.</p>



<h2 class="wp-block-heading">Tax Planning Considerations When Selling Your Business</h2>



<p>Selling a business is often a once-in-a-lifetime event, so proper tax planning is essential. Here are key considerations to maximize your after-tax proceeds:</p>



<h3 class="wp-block-heading">Timing the Sale</h3>



<p>The timing of your business sale can significantly impact your tax liability:</p>



<ul class="wp-block-list">
<li>Consider whether closing in December versus January might put the income in a more favorable tax year</li>



<li>If you&#8217;re planning to move to a lower-tax state, establishing residency before the sale could yield substantial savings</li>



<li>Business performance timing might affect valuation and corresponding tax liability</li>
</ul>



<h3 class="wp-block-heading">Entity Conversion Before Sale</h3>



<p>In some cases, converting your business entity before sale can yield tax benefits:</p>



<ul class="wp-block-list">
<li>Converting from a C corporation to an S corporation (requires 5-year waiting period for full benefits)</li>



<li>Converting a sole proprietorship to an S corporation before sale to reduce self-employment tax</li>



<li>Converting to a C corporation to potentially qualify for the QSBS exclusion (requires 5-year holding period)</li>
</ul>



<h3 class="wp-block-heading">Working with the Buyer on Structure</h3>



<p>Negotiating with the buyer on sale structure can sometimes result in mutually beneficial outcomes:</p>



<ul class="wp-block-list">
<li>If a stock sale saves you $200,000 in taxes but the buyer prefers an asset sale, offering a price reduction of $100,000 could make both parties better off</li>



<li>Negotiating which specific assets are included in the sale</li>



<li>Structuring the deal to include consulting agreements, employment contracts, or earnouts to achieve better tax treatment</li>
</ul>



<h3 class="wp-block-heading">Seeking Professional Guidance</h3>



<p>While the calculator provides valuable insights, complex business sales warrant professional guidance:</p>



<ul class="wp-block-list">
<li>Work with a tax attorney or CPA experienced in business transactions</li>



<li>Consider having a business valuation performed to support your allocation approach</li>



<li>Have professional representation during negotiations to ensure tax considerations are properly addressed</li>
</ul>



<h2 class="wp-block-heading">Frequently Asked Questions About Business Sale Taxation</h2>



<h3 class="wp-block-heading">How much difference in tax liability is there typically between an asset sale and a stock sale?</h3>



<p>The difference can be substantial, often ranging from 10% to 25% of the total sale price. Asset sales typically result in higher tax liability for sellers because portions of the gain are taxed as ordinary income rather than capital gains. For a $1 million business sale, this difference could easily be $100,000 to $250,000 in additional taxes.</p>



<p>The exact difference depends on several factors including business structure, asset composition, amount of depreciation taken, and the specific allocation of the purchase price. The calculator helps quantify this difference for your specific situation.</p>



<h3 class="wp-block-heading">What is depreciation recapture and why does it increase my tax bill?</h3>



<p>Depreciation recapture is a tax provision that prevents sellers from claiming depreciation deductions (which offset ordinary income) during ownership and then paying only capital gains rates when selling the asset. When you sell depreciated property for more than its adjusted basis, the IRS &#8220;recaptures&#8221; the tax benefit you received from depreciation by taxing that portion of the gain at ordinary income rates (up to 37%) rather than the lower capital gains rates.</p>



<p>For example, if you purchased equipment for $100,000, claimed $80,000 in depreciation deductions, and then sell it for $90,000, you have a $70,000 gain. That entire gain is subject to depreciation recapture and taxed as ordinary income. This is one reason why asset sales often result in higher tax liability than stock sales.</p>



<h3 class="wp-block-heading">Can I avoid taxes completely by reinvesting in another business?</h3>



<p>Unlike real estate exchanges under Section 1031, there is generally no tax-deferred exchange provision for business sales. You&#8217;ll typically need to recognize gain and pay taxes on the sale even if you immediately reinvest the proceeds in another business.</p>



<p>However, there are some strategies that can help defer or minimize taxation:</p>



<ul class="wp-block-list">
<li>If the business sale includes real estate, that specific component might qualify for a 1031 exchange</li>



<li>Utilizing an installment sale to spread income over multiple tax years</li>



<li>For qualifying C corporations, reinvesting QSBS proceeds in other QSBS stock within 60 days can defer (but not eliminate) the tax under Section 1045</li>



<li>Contributing the business to an Opportunity Zone Fund might defer some taxation under specific circumstances</li>
</ul>



<h3 class="wp-block-heading">How does the state I live in affect my business sale taxes?</h3>



<p>Your state of residence can significantly impact your overall tax burden when selling a business. State income tax rates vary widely, from 0% in states like Florida, Texas, and Nevada to over 13% in California.</p>



<p>Some states tax all income at the same rate, while others offer preferential treatment for capital gains. Some states also have special provisions for business sales or retirement-related transactions.</p>



<p>The calculator incorporates state tax estimates, but you should consult with a tax professional familiar with your specific state&#8217;s laws for more detailed analysis.</p>



<h3 class="wp-block-heading">What&#8217;s the difference between goodwill and a covenant not to compete for tax purposes?</h3>



<p>While both are intangible assets commonly included in business sales, they have different tax treatments:</p>



<p>Goodwill is generally taxed at favorable capital gains rates for the seller (0%, 15%, or 20% depending on income level) and is amortizable by the buyer over 15 years.</p>



<p>Covenants not to compete (non-compete agreements) are taxed as ordinary income to the seller (up to 37%) and are amortizable by the buyer over the term of the agreement, typically 3-5 years.</p>



<p>Buyers often prefer allocating more to covenants not to compete for faster tax write-offs, while sellers prefer allocation to goodwill for lower tax rates. This tension creates a negotiation point in many business sales.</p>



<h3 class="wp-block-heading">How does an installment sale affect my taxes when selling a business?</h3>



<p>An installment sale allows you to spread the recognition of gain over multiple tax years as you receive payments, rather than paying tax on the entire gain in the year of sale. This approach offers several potential benefits:</p>



<ul class="wp-block-list">
<li>Keeping income in lower tax brackets each year</li>



<li>Matching tax payments with cash actually received</li>



<li>Potential tax planning opportunities in future years</li>
</ul>



<p>However, there are limitations. Depreciation recapture must be reported in the year of sale regardless of payment timing, and installment sales may not be ideal if tax rates are expected to rise in future years.</p>



<p>The calculator can help you compare a lump sum sale versus an installment sale to determine which approach might be more beneficial in your situation.</p>



<h3 class="wp-block-heading">What documentation do I need to support my business sale tax filing?</h3>



<p>Proper documentation is essential for supporting your tax treatment of a business sale. Key documents include:</p>



<ul class="wp-block-list">
<li>The purchase and sale agreement with detailed terms</li>



<li>Asset allocation schedule (IRS Form 8594)</li>



<li>Business valuation reports or appraisals supporting the allocation</li>



<li>Documentation of your tax basis in the business and its assets</li>



<li>Depreciation schedules showing accumulated depreciation</li>



<li>Records of capital improvements and additional investments</li>



<li>Corporate minutes or resolutions approving the sale (for corporations)</li>
</ul>



<p>For installment sales, you&#8217;ll also need to maintain records of each payment received over the installment period.</p>



<h3 class="wp-block-heading">How does selling to a family member or employee affect taxation?</h3>



<p>Selling to related parties can trigger additional tax scrutiny and special rules:</p>



<ul class="wp-block-list">
<li>The IRS will look closely at whether the sale price represents fair market value</li>



<li>Below-market sales may be recharacterized partly as gifts, with potential gift tax implications</li>



<li>Special rules apply to installment sales to related parties, potentially accelerating gain recognition</li>



<li>Family attribution rules may affect stock redemptions and how they&#8217;re taxed</li>
</ul>



<p>While these transactions aren&#8217;t necessarily problematic, they require careful planning and documentation. Consider obtaining an independent business valuation to support the sale price and working with a tax professional experienced in related-party transactions.</p>



<h3 class="wp-block-heading">What if the buyer wants a different allocation than I do?</h3>



<p>This is a common tension in business sale negotiations. The buyer and seller must file consistent allocations with the IRS on Form 8594, so you&#8217;ll need to reach agreement.</p>



<p>Key points to consider:</p>



<ul class="wp-block-list">
<li>Allocation typically becomes a negotiation point affecting the overall purchase price</li>



<li>Quantify the tax impact of different allocations using the calculator to understand what&#8217;s at stake</li>



<li>Consider what&#8217;s commercially reasonable and defensible to the IRS</li>



<li>Sometimes a higher purchase price with a less favorable allocation might still leave you better off</li>
</ul>



<p>This negotiation highlights why it&#8217;s important to have experienced advisors representing your interests during business sale discussions.</p>



<h3 class="wp-block-heading">How can I estimate the value of goodwill in my business?</h3>



<p>Goodwill represents the intangible value of your business beyond its identifiable assets &#8211; essentially the premium a buyer is willing to pay for your established business versus starting from scratch.</p>



<p>Common approaches to estimating goodwill include:</p>



<ol class="wp-block-list">
<li>Residual method: Subtract the fair market value of all tangible and identifiable intangible assets from the total purchase price. The remainder represents goodwill.</li>



<li>Excess earnings method: Calculate the expected return on tangible assets, and then attribute additional profit beyond that to goodwill.</li>



<li>Market comparable approach: Examine similar business sales in your industry to determine typical goodwill allocation percentages.</li>
</ol>



<p>For tax purposes, having a professional business valuation can help support your allocation of the purchase price to goodwill. This becomes particularly important if the IRS questions your allocation methodology.</p>



<h2 class="wp-block-heading">Conclusion</h2>



<p>Selling a business represents a significant financial and tax event that requires careful planning to maximize your after-tax proceeds. The Business Sale Tax Calculator provides a valuable tool for understanding the potential tax implications of different sale structures and strategies.</p>



<p>By considering the factors discussed in this guide and using the calculator to model different scenarios, you can make more informed decisions about your business sale. Remember that while the calculator provides useful estimates, complex business sales warrant professional guidance from experienced tax attorneys and accountants.</p>



<p>Take time to plan your business sale well in advance of the actual transaction. With proper planning, you may identify strategies that can save substantial amounts in taxes and significantly increase your after-tax proceeds.</p>
</div>
    </article>
  </main>

  <footer><p>Â© 2025 Terms.Law. All rights reserved.</p></footer>
</body>
</html>