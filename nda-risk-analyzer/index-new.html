<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NDA Risk Analyzer - Professional Legal Intelligence</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #1e40af, #3730a3);
            color: white;
            padding: 40px 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(30, 64, 175, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .upload-section {
            background: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .upload-area {
            border: 3px dashed #cbd5e1;
            border-radius: 12px;
            padding: 60px 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area.dragover {
            border-color: #1e40af;
            background: #f0f7ff;
        }

        .upload-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #64748b;
        }

        .upload-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #64748b;
            font-size: 1rem;
        }

        .file-input {
            display: none;
        }

        .summary-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .party-selection {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .party-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .party-btn {
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .party-btn:hover {
            border-color: #1e40af;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 64, 175, 0.15);
        }

        .party-btn.selected {
            border-color: #1e40af;
            background: #f0f7ff;
        }

        .party-btn-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .party-btn-desc {
            color: #64748b;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .analysis-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .matrix-table th {
            background: #1e40af;
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .matrix-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.85rem;
            line-height: 1.4;
            vertical-align: top;
        }

        .matrix-table tr:hover {
            background: #f8fafc;
        }

        .clause-present {
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .present-yes {
            color: #059669;
        }

        .present-no {
            color: #dc2626;
        }

        .risk-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .risk-high {
            background: #fee2e2;
            color: #991b1b;
        }

        .risk-medium {
            background: #fef3c7;
            color: #92400e;
        }

        .risk-low {
            background: #dcfce7;
            color: #166534;
        }

        .favors-disclosing {
            background: #fef2f2;
            color: #dc2626;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .favors-receiving {
            background: #eff6ff;
            color: #2563eb;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .favors-neutral {
            background: #f0fdf4;
            color: #16a34a;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .section-subtitle {
            color: #64748b;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #1e40af;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-primary {
            background: #1e40af;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1e40af, #3730a3);
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 30px;
            gap: 20px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e5e7eb;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .step-number.active {
            background: #1e40af;
            color: white;
        }

        .step-number.completed {
            background: #059669;
            color: white;
        }

        .step-text {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .step-text.active {
            color: #1e293b;
            font-weight: 600;
        }

        .ai-toggle {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            font-size: 14px;
        }

        .ai-toggle label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: white;
        }

        @media (max-width: 768px) {
            .party-buttons {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            Loading NDA Risk Analyzer...
        </div>
    </div>

    <script type="text/babel">
        const { useState, useRef, useCallback } = React;

        // Comprehensive NDA Clause Matrix
        const NDA_CLAUSE_MATRIX = [
            {
                category: "Core Confidentiality Provisions",
                clauses: [
                    {
                        name: "Definition of Confidential Information",
                        keywords: ["confidential information", "confidential", "proprietary", "non-public"],
                        industryStandard: "Ranges from narrow (marked only) to broad (all disclosed info)",
                        missingImplication: "Creates ambiguity about what constitutes confidential information",
                        missingFavors: "receiving",
                        riskLevel: "high"
                    },
                    {
                        name: "Exclusions from Confidential Information", 
                        keywords: ["exclusions", "except", "not include", "public domain", "independently developed"],
                        industryStandard: "Standard exclusions: public domain, prior knowledge, independently developed",
                        missingImplication: "Everything becomes potentially confidential with no safe harbors",
                        missingFavors: "disclosing",
                        riskLevel: "high"
                    },
                    {
                        name: "Purpose/Use Limitation",
                        keywords: ["purpose", "solely for", "limited to", "evaluation", "business relationship"],
                        industryStandard: "Specific purpose tied to transaction type",
                        missingImplication: "May allow broader internal use; reduces enforceability",
                        missingFavors: "receiving",
                        riskLevel: "medium"
                    }
                ]
            },
            {
                category: "Term and Duration",
                clauses: [
                    {
                        name: "Term of Agreement",
                        keywords: ["term", "duration", "period", "years", "months", "effective"],
                        industryStandard: "1-3 years for evaluation period",
                        missingImplication: "Creates uncertainty about when obligations end",
                        missingFavors: "neutral",
                        riskLevel: "medium"
                    },
                    {
                        name: "Term of Confidentiality Obligations",
                        keywords: ["confidentiality obligations", "survive", "termination", "continue"],
                        industryStandard: "2-5 years post-disclosure standard",
                        missingImplication: "Confidentiality duties may expire with agreement term",
                        missingFavors: "receiving",
                        riskLevel: "high"
                    },
                    {
                        name: "Survival of Obligations",
                        keywords: ["survival", "survive termination", "remain in effect"],
                        industryStandard: "Confidentiality and remedy provisions typically survive",
                        missingImplication: "Key obligations may terminate with agreement",
                        missingFavors: "receiving",
                        riskLevel: "medium"
                    }
                ]
            },
            {
                category: "Information Handling",
                clauses: [
                    {
                        name: "Return/Destruction of Information",
                        keywords: ["return", "destroy", "destruction", "materials", "documents"],
                        industryStandard: "Prompt return/destruction on termination with certification",
                        missingImplication: "Receiving party may retain information indefinitely",
                        missingFavors: "receiving",
                        riskLevel: "medium"
                    },
                    {
                        name: "Permitted Disclosures (Legal Compulsion)",
                        keywords: ["required by law", "court order", "subpoena", "government", "legal"],
                        industryStandard: "Allows disclosure required by law with advance notice",
                        missingImplication: "No mechanism for lawful disclosure",
                        missingFavors: "neutral",
                        riskLevel: "low"
                    }
                ]
            },
            {
                category: "Enforcement and Remedies",
                clauses: [
                    {
                        name: "Injunctive Relief Right",
                        keywords: ["injunctive relief", "equitable relief", "irreparable harm", "immediate"],
                        industryStandard: "Standard provision acknowledging right to immediate relief",
                        missingImplication: "May need to prove irreparable harm for injunctions",
                        missingFavors: "receiving",
                        riskLevel: "high"
                    },
                    {
                        name: "Monetary Damages/Liquidated Damages",
                        keywords: ["damages", "liquidated damages", "monetary", "compensation"],
                        industryStandard: "Either actual damages or reasonable liquidated damages",
                        missingImplication: "May limit remedy options to proving actual harm",
                        missingFavors: "receiving",
                        riskLevel: "medium"
                    }
                ]
            }
        ];

        const NDAAnalyzer = () => {
            const [currentStep, setCurrentStep] = useState(1);
            const [uploadedFile, setUploadedFile] = useState(null);
            const [ndaContent, setNdaContent] = useState('');
            const [extractedParties, setExtractedParties] = useState([]);
            const [selectedParty, setSelectedParty] = useState('');
            const [analysis, setAnalysis] = useState(null);
            const [isProcessing, setIsProcessing] = useState(false);
            const [useClaudeAI, setUseClaudeAI] = useState(false); // Default to Llama
            const fileInputRef = useRef();

            // Step 1: File Upload
            const handleFileUpload = useCallback(async (file) => {
                if (!file || !file.name.match(/\.(docx|doc)$/i)) {
                    alert('Please upload a Microsoft Word document (.doc or .docx)');
                    return;
                }

                setIsProcessing(true);
                setUploadedFile(file);

                try {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    const content = result.value;
                    
                    setNdaContent(content);
                    
                    // Extract party names
                    const parties = extractPartyNames(content);
                    setExtractedParties(parties);
                    
                    setCurrentStep(2);
                } catch (error) {
                    alert('Error processing Word document. Please try again.');
                    console.error(error);
                } finally {
                    setIsProcessing(false);
                }
            }, []);

            const extractPartyNames = (content) => {
                const parties = [];
                
                // More comprehensive patterns for party identification
                const patterns = [
                    // Pattern 1: "between PARTY NAME, a [state] [entity type]"
                    /between\s+([A-Z][A-Za-z\s&.,]+?),\s+a\s+/gi,
                    
                    // Pattern 2: "and PARTY NAME, a [state] [entity type]"  
                    /\sand\s+([A-Z][A-Za-z\s&.,]+?),\s+a\s+/gi,
                    
                    // Pattern 3: Company names in quotes with closing parenthesis
                    /"([A-Za-z\s&.,]+)"\s*\)/g,
                    
                    // Pattern 4: Parenthetical company names
                    /\("([A-Za-z\s&.,]+)"\)/g,
                    
                    // Pattern 5: UPPERCASE company names before commas
                    /([A-Z][A-Z\s&.,]{2,25}),?\s+(?:a\s+|an\s+)?(?:Delaware|California|New York|corporation|company|LLC|Inc|Ltd)/gi,
                    
                    // Pattern 6: Company names with Inc, LLC, Corp etc.
                    /([A-Za-z\s&.]{3,30}(?:Inc|LLC|Corp|Corporation|Company|Ltd)\.?)/gi
                ];

                patterns.forEach(pattern => {
                    let match;
                    // Reset regex to avoid issues with global flag
                    pattern.lastIndex = 0;
                    while ((match = pattern.exec(content)) !== null) {
                        let party = match[1].trim();
                        
                        // Clean up the party name
                        party = party.replace(/[,.]$/, ''); // Remove trailing comma/period
                        party = party.replace(/\s+/g, ' '); // Normalize whitespace
                        
                        // Filter out invalid parties
                        if (party.length > 2 && 
                            party.length < 50 && 
                            !parties.includes(party) &&
                            !party.match(/^(the|this|agreement|between|and|party|parties)$/i) &&
                            !party.match(/^\d/) &&
                            party.match(/[A-Za-z]/)) {
                            parties.push(party);
                        }
                    }
                });

                // Remove duplicates and sort by length (longer names usually more specific)
                const uniqueParties = [...new Set(parties)].sort((a, b) => b.length - a.length);

                // If still no parties found, try simpler pattern
                if (uniqueParties.length === 0) {
                    const simplePattern = /([A-Z][A-Za-z\s]{2,20})(?:\s+(?:Inc|LLC|Corp|Corporation|Company|Ltd))/gi;
                    let match;
                    while ((match = simplePattern.exec(content)) !== null) {
                        const party = match[1].trim();
                        if (!uniqueParties.includes(party)) {
                            uniqueParties.push(party);
                        }
                    }
                }

                // Last resort: provide generic options
                if (uniqueParties.length === 0) {
                    return ["Disclosing Party", "Receiving Party"];
                }

                return uniqueParties.slice(0, 6); // Limit to 6 parties max
            };

            // Step 2: Party Selection
            const handlePartySelection = (party) => {
                setSelectedParty(party);
                setCurrentStep(3);
                performAnalysis(party);
            };

            // Step 3: Analysis
            const performAnalysis = (selectedParty) => {
                setIsProcessing(true);
                
                // Simulate analysis processing
                setTimeout(() => {
                    const analysisResult = analyzeNDA(ndaContent, selectedParty);
                    setAnalysis(analysisResult);
                    setIsProcessing(false);
                }, 2000);
            };

            const analyzeNDA = (content, party) => {
                const result = {
                    overallRisk: 'medium',
                    overallBias: 0,
                    biasBreakdown: [],
                    clauseAnalysis: [],
                    missingClauses: [],
                    recommendations: [],
                    aiModel: useClaudeAI ? 'Claude 3.5 Sonnet' : 'Llama 3.3 70B'
                };

                let totalClauses = 0;
                let favorDisclosingScore = 0;
                let riskScores = { high: 0, medium: 0, low: 0 };

                // Analyze each clause category
                NDA_CLAUSE_MATRIX.forEach(category => {
                    category.clauses.forEach(clause => {
                        totalClauses++;
                        const analysisResult = analyzeClause(content, clause, party);
                        
                        if (analysisResult.present) {
                            result.clauseAnalysis.push(analysisResult);
                        } else {
                            result.missingClauses.push(analysisResult);
                        }

                        // Accumulate scores for overall metrics
                        favorDisclosingScore += analysisResult.favorDisclosingScore;
                        riskScores[analysisResult.riskToUser]++;
                        
                        // Add to bias breakdown
                        result.biasBreakdown.push({
                            clause: clause.name,
                            present: analysisResult.present,
                            favorDisclosingScore: analysisResult.favorDisclosingScore,
                            explanation: analysisResult.biasExplanation
                        });
                    });
                });

                // Calculate overall bias percentage
                result.overallBias = Math.round((favorDisclosingScore / totalClauses));
                
                // Determine overall risk
                if (riskScores.high > totalClauses * 0.3) {
                    result.overallRisk = 'high';
                } else if (riskScores.low > totalClauses * 0.5) {
                    result.overallRisk = 'low';
                } else {
                    result.overallRisk = 'medium';
                }

                return result;
            };

            const analyzeClause = (content, clause, party) => {
                const contentLower = content.toLowerCase();
                
                // Find section number and specific text
                const sectionInfo = findClauseSection(content, clause);
                
                // Determine if clause is present
                const isPresent = clause.keywords.some(keyword => 
                    contentLower.includes(keyword.toLowerCase())
                );

                // Assess how it tilts (neutral, favoring disclosing, or favoring receiving)
                let clauseTilt = assessClauseTilt(content, clause, isPresent);
                let favorDisclosingScore = clauseTilt.score;
                
                // Determine risk level specific to this user's position
                const isUserDisclosing = determineUserRole(party, content);
                const riskToUser = calculateRiskToUser(clause, isPresent, clauseTilt, isUserDisclosing);
                
                // Generate specific recommendation
                const recommendation = generateDetailedRecommendation(clause, isPresent, sectionInfo, clauseTilt, isUserDisclosing);

                return {
                    ...clause,
                    present: isPresent,
                    sectionNumber: sectionInfo.section,
                    sectionText: sectionInfo.text,
                    clauseTilt: clauseTilt.description,
                    favorDisclosingScore: favorDisclosingScore,
                    biasExplanation: clauseTilt.explanation,
                    riskToUser: riskToUser,
                    riskExplanation: generateRiskExplanation(riskToUser, isUserDisclosing, clause),
                    recommendation: recommendation
                };
            };

            const findClauseSection = (content, clause) => {
                const lines = content.split('\n');
                let sectionNumber = 'Not found';
                let relevantText = 'Clause text not identified';
                
                // Look for numbered sections
                const sectionRegex = /^(\d+\.?\d*)\s/;
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    const match = line.match(sectionRegex);
                    
                    if (match && clause.keywords.some(keyword => 
                        lines.slice(i, i + 3).join(' ').toLowerCase().includes(keyword.toLowerCase())
                    )) {
                        sectionNumber = `Section ${match[1]}`;
                        relevantText = lines.slice(i, i + 2).join(' ').substring(0, 150) + '...';
                        break;
                    }
                }

                return { section: sectionNumber, text: relevantText };
            };

            const assessClauseTilt = (content, clause, isPresent) => {
                if (!isPresent) {
                    // If clause is missing, determine who benefits from the absence
                    if (clause.missingFavors === 'disclosing') {
                        return {
                            score: 80,
                            description: 'Strongly favors Disclosing Party (absent)',
                            explanation: `Missing this clause benefits the disclosing party: ${clause.missingImplication}`
                        };
                    } else if (clause.missingFavors === 'receiving') {
                        return {
                            score: 20,
                            description: 'Strongly favors Receiving Party (absent)',
                            explanation: `Missing this clause benefits the receiving party: ${clause.missingImplication}`
                        };
                    } else {
                        return {
                            score: 50,
                            description: 'Neutral impact (absent)',
                            explanation: `Missing this clause has neutral impact: ${clause.missingImplication}`
                        };
                    }
                } else {
                    // If clause is present, analyze the specific language (simplified for demo)
                    const contentLower = content.toLowerCase();
                    
                    // Look for language that typically favors disclosing party
                    const disclosingFavoringTerms = [
                        'all information', 'any information', 'broadly defined',
                        'indefinite', 'perpetual', 'strict confidence', 'immediate return',
                        'liquidated damages', 'irreparable harm'
                    ];
                    
                    // Look for language that typically favors receiving party
                    const receivingFavoringTerms = [
                        'marked confidential', 'specifically designated', 'limited purpose',
                        'reasonable care', 'written consent', 'actual damages only'
                    ];
                    
                    let disclosingCount = disclosingFavoringTerms.filter(term => 
                        contentLower.includes(term)).length;
                    let receivingCount = receivingFavoringTerms.filter(term => 
                        contentLower.includes(term)).length;
                    
                    if (disclosingCount > receivingCount) {
                        return {
                            score: 70,
                            description: 'Favors Disclosing Party',
                            explanation: 'Language includes terms that typically benefit the disclosing party'
                        };
                    } else if (receivingCount > disclosingCount) {
                        return {
                            score: 30,
                            description: 'Favors Receiving Party', 
                            explanation: 'Language includes terms that typically benefit the receiving party'
                        };
                    } else {
                        return {
                            score: 50,
                            description: 'Industry Standard/Neutral',
                            explanation: 'Language appears balanced and follows industry standards'
                        };
                    }
                }
            };

            const determineUserRole = (selectedParty, content) => {
                // Simple heuristic: if party name appears first in the document, likely disclosing
                const contentUpper = content.toUpperCase();
                const partyUpper = selectedParty.toUpperCase();
                
                const firstMention = contentUpper.indexOf(partyUpper);
                const betweenIndex = contentUpper.indexOf('BETWEEN');
                
                // If party is mentioned before "and" in the "between X and Y" structure
                return firstMention < contentUpper.indexOf(' AND ', betweenIndex);
            };

            const calculateRiskToUser = (clause, isPresent, clauseTilt, isUserDisclosing) => {
                // Base risk from clause matrix
                let riskLevel = clause.riskLevel;
                
                // Adjust based on clause tilt and user position
                if (clauseTilt.score > 60 && !isUserDisclosing) {
                    // Clause favors disclosing party, but user is receiving party
                    riskLevel = increaseRisk(riskLevel);
                } else if (clauseTilt.score < 40 && isUserDisclosing) {
                    // Clause favors receiving party, but user is disclosing party
                    riskLevel = increaseRisk(riskLevel);
                }
                
                return riskLevel;
            };

            const increaseRisk = (currentRisk) => {
                if (currentRisk === 'low') return 'medium';
                if (currentRisk === 'medium') return 'high';
                return 'high';
            };

            const generateRiskExplanation = (riskLevel, isUserDisclosing, clause) => {
                const role = isUserDisclosing ? 'disclosing party' : 'receiving party';
                
                switch (riskLevel) {
                    case 'high':
                        return `High risk for ${role}: This provision could significantly impact your interests or create substantial obligations.`;
                    case 'medium':
                        return `Medium risk for ${role}: This provision requires attention but poses manageable risk with proper handling.`;
                    case 'low':
                        return `Low risk for ${role}: This provision is generally favorable or standard for your position.`;
                    default:
                        return 'Risk level assessment unavailable.';
                }
            };

            const generateDetailedRecommendation = (clause, isPresent, sectionInfo, clauseTilt, isUserDisclosing) => {
                const role = isUserDisclosing ? 'disclosing party' : 'receiving party';
                
                if (isPresent) {
                    return `✅ PRESENT in ${sectionInfo.section}: "${sectionInfo.text}" - This clause ${clauseTilt.description.toLowerCase()}. As the ${role}, ${clauseTilt.explanation.toLowerCase()} Consider negotiating specific terms if this clause creates unfavorable obligations for your position.`;
                } else {
                    const impact = clause.missingFavors === (isUserDisclosing ? 'disclosing' : 'receiving') ? 'benefits' : 'disadvantages';
                    return `❌ MISSING: Absence of this clause ${impact} you as the ${role}. ${clause.missingImplication} Recommendation: ${impact === 'benefits' ? 'Consider keeping this clause out of the agreement' : 'Strongly recommend adding this provision to protect your interests'}.`;
                }
            };


            // UI Components
            const renderStepIndicator = () => (
                <div className="step-indicator">
                    <div className="step">
                        <div className={`step-number ${currentStep >= 1 ? 'active' : ''} ${currentStep > 1 ? 'completed' : ''}`}>
                            1
                        </div>
                        <div className={`step-text ${currentStep === 1 ? 'active' : ''}`}>
                            Upload NDA
                        </div>
                    </div>
                    <div className="step">
                        <div className={`step-number ${currentStep >= 2 ? 'active' : ''} ${currentStep > 2 ? 'completed' : ''}`}>
                            2
                        </div>
                        <div className={`step-text ${currentStep === 2 ? 'active' : ''}`}>
                            Select Your Role
                        </div>
                    </div>
                    <div className="step">
                        <div className={`step-number ${currentStep >= 3 ? 'active' : ''}`}>
                            3
                        </div>
                        <div className={`step-text ${currentStep === 3 ? 'active' : ''}`}>
                            Risk Analysis
                        </div>
                    </div>
                </div>
            );

            const renderUploadSection = () => (
                <div className="upload-section">
                    <div className="section-title">Upload Your NDA</div>
                    <div className="section-subtitle">
                        Upload a Microsoft Word document (.doc or .docx) for professional analysis
                    </div>
                    
                    <div 
                        className="upload-area"
                        onClick={() => fileInputRef.current?.click()}
                        onDrop={(e) => {
                            e.preventDefault();
                            const file = e.dataTransfer.files[0];
                            if (file) handleFileUpload(file);
                        }}
                        onDragOver={(e) => {
                            e.preventDefault();
                            e.currentTarget.classList.add('dragover');
                        }}
                        onDragLeave={(e) => {
                            e.currentTarget.classList.remove('dragover');
                        }}
                    >
                        <div className="upload-icon">📄</div>
                        <div className="upload-text">
                            Drop your NDA here or click to browse
                        </div>
                        <div className="upload-subtext">
                            Supports .doc and .docx files up to 10MB
                        </div>
                    </div>
                    
                    <input
                        ref={fileInputRef}
                        type="file"
                        accept=".doc,.docx"
                        className="file-input"
                        onChange={(e) => {
                            const file = e.target.files[0];
                            if (file) handleFileUpload(file);
                        }}
                    />

                    {isProcessing && (
                        <div className="loading">
                            <div className="spinner"></div>
                            Processing your NDA document...
                        </div>
                    )}
                </div>
            );

            const renderPartySelection = () => (
                <div className="party-selection">
                    <div className="section-title">Which party are you?</div>
                    <div className="section-subtitle">
                        Select your role to get tailored risk analysis from your perspective
                    </div>
                    
                    <div className="party-buttons">
                        {extractedParties.map((party, index) => (
                            <div
                                key={index}
                                className="party-btn"
                                onClick={() => handlePartySelection(party)}
                            >
                                <div className="party-btn-title">
                                    {party}
                                </div>
                                <div className="party-btn-desc">
                                    Click if you represent this party
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );

            const renderAnalysis = () => (
                <div className="analysis-section">
                    <div className="section-title">Risk Analysis Results</div>
                    <div className="section-subtitle">
                        Professional analysis tailored for {selectedParty}
                    </div>
                    
                    {isProcessing ? (
                        <div className="loading">
                            <div className="spinner"></div>
                            Analyzing your NDA with legal intelligence...
                        </div>
                    ) : analysis && (
                        <>
                            <div style={{ marginBottom: '30px', padding: '20px', background: '#f8fafc', borderRadius: '8px' }}>
                                <h3 style={{ marginBottom: '15px', color: '#1e293b' }}>Overall Assessment</h3>
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '20px' }}>
                                    <div style={{ textAlign: 'center' }}>
                                        <div style={{ fontSize: '2rem', marginBottom: '5px' }}>
                                            <span className={`risk-indicator risk-${analysis.overallRisk}`}>
                                                {analysis.overallRisk.toUpperCase()} RISK
                                            </span>
                                        </div>
                                        <div style={{ fontSize: '0.9rem', color: '#64748b' }}>Overall Risk Level</div>
                                    </div>
                                    <div style={{ textAlign: 'center' }}>
                                        <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#1e40af', marginBottom: '5px' }}>
                                            {analysis.overallBias}%
                                        </div>
                                        <div style={{ fontSize: '0.9rem', color: '#64748b' }}>Favors Disclosing Party</div>
                                    </div>
                                    <div style={{ textAlign: 'center' }}>
                                        <div style={{ fontSize: '2rem', fontWeight: 'bold', color: '#dc2626', marginBottom: '5px' }}>
                                            {analysis.missingClauses.length}
                                        </div>
                                        <div style={{ fontSize: '0.9rem', color: '#64748b' }}>Missing Clauses</div>
                                    </div>
                                </div>
                            </div>

                            <table className="matrix-table">
                                <thead>
                                    <tr>
                                        <th style={{ width: '18%' }}>Clause</th>
                                        <th style={{ width: '8%' }}>Present</th>
                                        <th style={{ width: '12%' }}>Location</th>
                                        <th style={{ width: '15%' }}>Bias Analysis</th>
                                        <th style={{ width: '12%' }}>Risk to You</th>
                                        <th style={{ width: '35%' }}>Detailed Analysis & Recommendation</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {[...analysis.clauseAnalysis, ...analysis.missingClauses].map((clause, index) => (
                                        <tr key={index}>
                                            <td style={{ fontWeight: '600', color: '#1e293b', fontSize: '0.85rem' }}>
                                                {clause.name}
                                            </td>
                                            <td className="clause-present">
                                                <span className={clause.present ? 'present-yes' : 'present-no'}>
                                                    {clause.present ? '✓' : '✗'}
                                                </span>
                                            </td>
                                            <td style={{ fontSize: '0.75rem', color: '#475569' }}>
                                                {clause.sectionNumber}
                                            </td>
                                            <td style={{ fontSize: '0.75rem' }}>
                                                <div style={{ marginBottom: '4px' }}>
                                                    <span className={clause.favorDisclosingScore > 60 ? 'favors-disclosing' : 
                                                                   clause.favorDisclosingScore < 40 ? 'favors-receiving' : 'favors-neutral'}>
                                                        {clause.clauseTilt}
                                                    </span>
                                                </div>
                                                <div style={{ fontSize: '0.7rem', color: '#6b7280' }}>
                                                    Score: {clause.favorDisclosingScore}/100
                                                </div>
                                            </td>
                                            <td>
                                                <div style={{ marginBottom: '4px' }}>
                                                    <span className={`risk-indicator risk-${clause.riskToUser}`}>
                                                        {clause.riskToUser.toUpperCase()}
                                                    </span>
                                                </div>
                                                <div style={{ fontSize: '0.7rem', color: '#6b7280', lineHeight: '1.2' }}>
                                                    {clause.riskExplanation}
                                                </div>
                                            </td>
                                            <td style={{ fontSize: '0.8rem', lineHeight: '1.4' }}>
                                                {clause.recommendation}
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>

                            {/* Bias Breakdown Section */}
                            <div style={{ marginTop: '30px', padding: '20px', background: '#f8fafc', borderRadius: '8px' }}>
                                <h3 style={{ marginBottom: '15px', color: '#1e293b' }}>
                                    📊 Bias Calculation Methodology
                                </h3>
                                <p style={{ fontSize: '0.9rem', color: '#475569', marginBottom: '15px' }}>
                                    The {analysis.overallBias}% "Favors Disclosing Party" score is calculated by analyzing each clause's 
                                    bias score (0-100, where 100 = strongly favors disclosing party, 0 = strongly favors receiving party) 
                                    and averaging across all {analysis.biasBreakdown.length} analyzed provisions.
                                </p>
                                <div style={{ fontSize: '0.8rem', color: '#6b7280' }}>
                                    <strong>Analysis powered by:</strong> {analysis.aiModel}
                                </div>
                                
                                <details style={{ marginTop: '15px' }}>
                                    <summary style={{ cursor: 'pointer', fontWeight: '600', color: '#1e40af' }}>
                                        View Detailed Bias Breakdown
                                    </summary>
                                    <div style={{ marginTop: '10px', maxHeight: '200px', overflowY: 'auto' }}>
                                        {analysis.biasBreakdown.map((item, index) => (
                                            <div key={index} style={{ 
                                                padding: '8px', 
                                                margin: '4px 0', 
                                                background: 'white', 
                                                borderRadius: '4px',
                                                fontSize: '0.75rem'
                                            }}>
                                                <strong>{item.clause}</strong>: {item.favorDisclosingScore}/100 
                                                {item.present ? ' (Present)' : ' (Missing)'} - {item.explanation}
                                            </div>
                                        ))}
                                    </div>
                                </details>
                            </div>

                            <div style={{ marginTop: '30px', textAlign: 'center' }}>
                                <button 
                                    className="btn-primary"
                                    onClick={() => {
                                        setCurrentStep(1);
                                        setUploadedFile(null);
                                        setNdaContent('');
                                        setAnalysis(null);
                                        setSelectedParty('');
                                    }}
                                >
                                    Analyze Another NDA
                                </button>
                            </div>
                        </>
                    )}
                </div>
            );

            return (
                <div className="container">
                    <div className="header">
                        <h1>⚖️ NDA Risk Analyzer</h1>
                        <p>
                            Professional legal intelligence for non-disclosure agreements. 
                            Get sophisticated analysis that goes beyond basic AI chatbots.
                        </p>
                        
                        {/* AI Model Toggle */}
                        <div className="ai-toggle">
                            <label>
                                <input
                                    type="radio"
                                    name="aiModel"
                                    checked={!useClaudeAI}
                                    onChange={() => setUseClaudeAI(false)}
                                />
                                <span>🦙 Llama 3.3 70B (Default)</span>
                            </label>
                            <label>
                                <input
                                    type="radio"
                                    name="aiModel"
                                    checked={useClaudeAI}
                                    onChange={() => setUseClaudeAI(true)}
                                />
                                <span>🧠 Claude 3.5 Sonnet</span>
                            </label>
                        </div>
                    </div>

                    {renderStepIndicator()}
                    
                    {currentStep === 1 && renderUploadSection()}
                    {currentStep === 2 && renderPartySelection()}
                    {currentStep === 3 && renderAnalysis()}
                </div>
            );
        };

        // Initialize the app
        const { createRoot } = ReactDOM;
        const root = createRoot(document.getElementById('root'));
        root.render(<NDAAnalyzer />);
    </script>
</body>
</html>