<!DOCTYPE html>
<html lang="en">
<head>
    <!-- NOINDEX - Confidential client portal -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terms.Law - Collaborative Document Workspace</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }
        .header {
            background: #1a1a2e;
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 20px; font-weight: 600; }
        .logo span { color: #6366f1; }
        .header-actions { display: flex; gap: 12px; align-items: center; }
        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #fbbf24;
        }
        .status-dot.connected { background: #22c55e; }
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background: #6366f1; color: white; }
        .btn-secondary { background: rgba(255,255,255,0.15); color: white; }
        .btn-outline { background: transparent; border: 1px solid #e5e7eb; color: #374151; }
        .btn-outline:hover { background: #f3f4f6; }
        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .btn-success { background: #22c55e; color: white; }
        .btn-success:hover { background: #16a34a; }

        .main-container {
            display: flex;
            max-width: 1600px;
            margin: 0 auto;
            padding: 24px;
            gap: 24px;
        }

        /* Form Panel */
        .form-panel {
            width: 380px;
            flex-shrink: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 20px;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            position: sticky;
            top: 100px;
        }

        /* Document Selector */
        .doc-selector {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
        }
        .doc-selector label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .doc-selector select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            background: white;
            cursor: pointer;
        }
        .doc-selector select:focus {
            outline: none;
            border-color: #6366f1;
        }

        /* Upload Section */
        .upload-section {
            margin-bottom: 20px;
            padding: 16px;
            border: 2px dashed #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .upload-section:hover {
            border-color: #6366f1;
            background: #f8f7ff;
        }
        .upload-section.dragover {
            border-color: #6366f1;
            background: #ede9fe;
        }
        .upload-section input[type="file"] {
            display: none;
        }
        .upload-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }
        .upload-text {
            font-size: 13px;
            color: #6b7280;
        }
        .upload-text strong {
            color: #6366f1;
        }

        /* Form Styles */
        .gen-form-header {
            margin-bottom: 20px;
        }
        .gen-form-header h2 {
            font-size: 18px;
            color: #1a1a2e;
            margin-bottom: 4px;
        }
        .gen-form-header p {
            font-size: 13px;
            color: #6b7280;
        }
        .gen-form-section {
            margin-bottom: 20px;
        }
        .gen-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .gen-section-title::before {
            content: '';
            width: 3px;
            height: 14px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 2px;
        }
        .gen-form-group {
            margin-bottom: 12px;
        }
        .gen-form-group label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #475569;
            margin-bottom: 4px;
        }
        .gen-form-group input,
        .gen-form-group select,
        .gen-form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1.5px solid #e5e7eb;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        .gen-form-group input:focus,
        .gen-form-group select:focus,
        .gen-form-group textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
        }
        .gen-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .gen-checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .gen-checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #475569;
            padding: 6px 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .gen-checkbox-label:hover {
            background: #f8f9fa;
        }
        .gen-checkbox-label input {
            width: 14px;
            height: 14px;
        }
        .gen-checkbox-label input:checked + span {
            color: #6366f1;
            font-weight: 500;
        }
        .gen-info-box {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 12px;
            color: #1e40af;
            margin-bottom: 16px;
        }
        .gen-warning-box {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 12px;
            color: #92400e;
            margin-bottom: 16px;
        }
        .gen-tip-box {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 12px;
            color: #166534;
            margin-bottom: 16px;
        }
        /* Tooltips */
        .tooltip-trigger {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            cursor: help;
        }
        .tooltip-icon {
            width: 14px;
            height: 14px;
            background: #9ca3af;
            color: white;
            border-radius: 50%;
            font-size: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        .tooltip-trigger:hover .tooltip-icon {
            background: #6366f1;
        }
        .field-help {
            font-size: 11px;
            color: #6b7280;
            margin-top: 4px;
            line-height: 1.4;
        }
        .field-help a {
            color: #6366f1;
        }
        /* Expandable sections */
        .gen-expandable {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        .gen-expandable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: #f9fafb;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: #374151;
        }
        .gen-expandable-header:hover {
            background: #f3f4f6;
        }
        .gen-expandable-content {
            padding: 12px;
            display: none;
            border-top: 1px solid #e5e7eb;
        }
        .gen-expandable.open .gen-expandable-content {
            display: block;
        }
        .gen-expandable-arrow {
            transition: transform 0.2s;
        }
        .gen-expandable.open .gen-expandable-arrow {
            transform: rotate(180deg);
        }
        .blank-doc-message {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        .blank-doc-message h3 {
            font-size: 16px;
            margin-bottom: 8px;
            color: #374151;
        }

        /* Preview Panel */
        .preview-panel {
            flex: 1;
            min-width: 0;
        }
        .preview-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .preview-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
            flex-wrap: wrap;
            gap: 8px;
        }
        .preview-toolbar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .preview-toolbar-title {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        .session-name-input {
            padding: 6px 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 13px;
            width: 200px;
        }
        .session-name-input:focus {
            outline: none;
            border-color: #6366f1;
        }

        /* Formatting Toolbar */
        .format-toolbar {
            display: flex;
            gap: 4px;
            padding: 8px 16px;
            border-bottom: 1px solid #e5e7eb;
            background: #fafafa;
            flex-wrap: wrap;
        }
        .format-btn {
            padding: 6px 10px;
            border: 1px solid #e5e7eb;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
        }
        .format-btn:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }
        .format-btn.active {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }
        .format-divider {
            width: 1px;
            background: #e5e7eb;
            margin: 0 4px;
        }

        .preview-toolbar-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .save-status {
            font-size: 12px;
            color: #6b7280;
        }
        .save-status.saving { color: #f59e0b; }
        .save-status.saved { color: #22c55e; }
        .preview-content {
            padding: 24px;
            max-height: calc(100vh - 280px);
            overflow-y: auto;
        }

        /* Users Panel */
        .users-inline {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .users-inline .user-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            font-weight: 600;
            cursor: default;
            position: relative;
        }
        .users-inline .user-dot:hover::after {
            content: attr(data-name);
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a2e;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            z-index: 10;
        }

        /* Document Preview Styles */
        .doc-preview {
            max-width: 850px;
            margin: 0 auto;
            background: white;
            padding: 48px;
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
            line-height: 1.6;
            color: #000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e5e7eb;
            min-height: 800px;
        }
        .doc-preview:focus {
            outline: 2px solid #6366f1;
            outline-offset: 2px;
        }
        .doc-preview h1 {
            text-align: center;
            font-size: 16pt;
            margin-bottom: 20px;
            text-transform: uppercase;
        }
        .doc-preview h2 {
            font-size: 12pt;
            margin-top: 20px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .doc-preview p {
            margin-bottom: 12px;
            text-align: justify;
        }
        .doc-preview .center {
            text-align: center;
        }
        .doc-preview .parties {
            margin: 20px 0;
        }
        .doc-preview .clause {
            margin-bottom: 14px;
        }
        .doc-preview .sub-clause {
            margin-left: 24px;
            margin-bottom: 8px;
        }
        .doc-preview .signature-block {
            margin-top: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        .doc-preview .signature-party h3 {
            font-size: 11pt;
            margin-bottom: 24px;
            text-transform: uppercase;
        }
        .doc-preview .signature-line {
            border-top: 1px solid #000;
            margin-top: 30px;
            padding-top: 4px;
            font-size: 10pt;
        }

        /* Highlight Styles */
        .doc-highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 0 3px;
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        .doc-highlight:hover {
            background: linear-gradient(135deg, #fde68a 0%, #fcd34d 100%);
        }
        @keyframes highlightPulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(245,158,11,0.7); }
            50% { transform: scale(1.02); box-shadow: 0 0 0 8px rgba(245,158,11,0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(245,158,11,0); }
        }
        .field-highlight-active {
            animation: highlightPulse 0.6s ease-out;
            background: linear-gradient(135deg, #fde047 0%, #facc15 100%) !important;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal {
            background: white;
            padding: 32px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .modal h2 { margin-bottom: 8px; color: #1a1a2e; }
        .modal p { color: #6b7280; margin-bottom: 24px; }
        .modal input[type="text"] {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 16px;
            outline: none;
        }
        .modal input:focus { border-color: #6366f1; }
        .modal .btn { width: 100%; padding: 14px; }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #1a1a2e;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1001;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .hidden { display: none !important; }

        @media (max-width: 1100px) {
            .main-container {
                flex-direction: column;
            }
            .form-panel {
                width: 100%;
                max-height: none;
                position: relative;
                top: 0;
            }
        }

        @media print {
            body * { visibility: hidden; }
            .doc-preview, .doc-preview * { visibility: visible; }
            .doc-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: none;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">Terms.<span>Law</span> Docs</div>
        <div class="header-actions">
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Connecting...</span>
            </div>
            <button class="btn btn-secondary" id="copyBtn">Copy Link</button>
            <button class="btn btn-primary" id="newBtn">New Session</button>
        </div>
    </header>

    <div class="main-container">
        <!-- Form Panel -->
        <div class="form-panel">
            <!-- Document Selector -->
            <div class="doc-selector">
                <label>Document Type</label>
                <select id="docTypeSelector" onchange="loadDocumentGenerator()">
                    <option value="blank">Blank Document</option>
                    <option value="non-solicitation">Non-Solicitation Agreement</option>
                    <option value="commission">Commission Agreement</option>
                    <option value="nda">Non-Disclosure Agreement (NDA)</option>
                    <option value="piia">PIIA (Inventions Assignment)</option>
                    <option value="sublease">Sublease Agreement</option>
                </select>
            </div>

            <!-- Upload Section -->
            <div class="upload-section" id="uploadSection" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" accept=".txt,.doc,.docx,.rtf,.html" onchange="handleFileUpload(event)">
                <div class="upload-icon">ðŸ“„</div>
                <div class="upload-text">
                    <strong>Upload a document</strong><br>
                    or drag and drop here
                </div>
            </div>

            <!-- Dynamic Form Container -->
            <div id="generatorFormContainer">
                <div class="blank-doc-message">
                    <h3>Blank Document</h3>
                    <p>Start typing in the editor, or select a document template above to auto-generate.</p>
                </div>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="preview-panel">
            <div class="preview-container">
                <div class="preview-toolbar">
                    <div class="preview-toolbar-left">
                        <input type="text" class="session-name-input" id="sessionName" placeholder="Untitled Document">
                        <div class="users-inline" id="userList"></div>
                    </div>
                    <div class="preview-toolbar-actions">
                        <span class="save-status" id="saveStatus">All changes saved</span>
                        <button class="btn btn-outline btn-sm" onclick="printDocument()">Print</button>
                        <button class="btn btn-outline btn-sm" onclick="downloadDocument()">Download</button>
                    </div>
                </div>
                <div class="format-toolbar">
                    <button class="format-btn" onclick="formatDoc('bold')" title="Bold"><b>B</b></button>
                    <button class="format-btn" onclick="formatDoc('italic')" title="Italic"><i>I</i></button>
                    <button class="format-btn" onclick="formatDoc('underline')" title="Underline"><u>U</u></button>
                    <div class="format-divider"></div>
                    <button class="format-btn" onclick="formatDoc('justifyLeft')" title="Align Left">â¬…</button>
                    <button class="format-btn" onclick="formatDoc('justifyCenter')" title="Center">â¬Œ</button>
                    <button class="format-btn" onclick="formatDoc('justifyRight')" title="Align Right">âž¡</button>
                    <button class="format-btn" onclick="formatDoc('justifyFull')" title="Justify">â˜°</button>
                    <div class="format-divider"></div>
                    <button class="format-btn" onclick="formatDoc('insertUnorderedList')" title="Bullet List">â€¢</button>
                    <button class="format-btn" onclick="formatDoc('insertOrderedList')" title="Numbered List">1.</button>
                    <div class="format-divider"></div>
                    <select onchange="formatDoc('formatBlock', this.value); this.value='';" style="padding: 4px 8px; border-radius: 4px; border: 1px solid #e5e7eb;">
                        <option value="">Heading</option>
                        <option value="h1">Heading 1</option>
                        <option value="h2">Heading 2</option>
                        <option value="h3">Heading 3</option>
                        <option value="p">Paragraph</option>
                    </select>
                </div>
                <div class="preview-content">
                    <div class="doc-preview" id="docPreview" contenteditable="true" oninput="handleDocumentEdit()">
                        <p>Start typing your document here, or select a template from the left panel...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="joinModal">
        <div class="modal">
            <h2>Join Session</h2>
            <p>Enter your name to collaborate</p>
            <input type="text" id="userName" placeholder="Your name" autofocus>
            <button class="btn btn-primary" id="joinBtn">Join Session</button>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // ========== DOCUMENT GENERATORS ==========
        const documentGenerators = {
            'blank': {
                title: 'Blank Document',
                description: 'Start with a blank document',
                form: generateBlankForm,
                preview: generateBlankPreview
            },
            'non-solicitation': {
                title: 'Non-Solicitation Agreement',
                description: 'Protect your customers and employees from poaching',
                form: generateNonSolicitationForm,
                preview: generateNonSolicitationPreview
            },
            'commission': {
                title: 'Commission Agreement',
                description: 'Sales commission structure and payment terms',
                form: generateCommissionForm,
                preview: generateCommissionPreview
            },
            'nda': {
                title: 'Non-Disclosure Agreement',
                description: 'Protect confidential information in business relationships',
                form: generateNDAForm,
                preview: generateNDAPreview
            },
            'piia': {
                title: 'PIIA (Inventions Assignment)',
                description: 'Assign intellectual property and inventions to employer',
                form: generatePIIAForm,
                preview: generatePIIAPreview
            },
            'sublease': {
                title: 'Sublease Agreement',
                description: 'Sublease residential or commercial property',
                form: generateSubleaseForm,
                preview: generateSubleasePreview
            }
        };

        let lastChangedField = null;

        function loadDocumentGenerator() {
            const docType = document.getElementById('docTypeSelector').value;
            const formContainer = document.getElementById('generatorFormContainer');
            const preview = document.getElementById('docPreview');

            if (!docType || !documentGenerators[docType]) {
                formContainer.innerHTML = `
                    <div class="blank-doc-message">
                        <h3>Select a Document</h3>
                        <p>Choose a document template to get started.</p>
                    </div>
                `;
                return;
            }

            const generator = documentGenerators[docType];
            formContainer.innerHTML = generator.form();

            if (docType !== 'blank') {
                preview.innerHTML = generator.preview();
            }

            syncToFirebase();
        }

        function updateGeneratorPreview(fieldId) {
            const docType = document.getElementById('docTypeSelector').value;
            if (!docType || !documentGenerators[docType] || docType === 'blank') return;

            lastChangedField = fieldId;
            const generator = documentGenerators[docType];
            document.getElementById('docPreview').innerHTML = generator.preview();

            // Scroll to and highlight changed field
            if (fieldId) {
                setTimeout(() => {
                    const highlights = document.querySelectorAll('.doc-highlight');
                    highlights.forEach(el => {
                        if (el.dataset.field === fieldId) {
                            el.classList.add('field-highlight-active');
                            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            setTimeout(() => el.classList.remove('field-highlight-active'), 600);
                        }
                    });
                }, 50);
            }

            syncToFirebase();
        }

        function getGenValue(id, defaultVal = '') {
            const el = document.getElementById(id);
            if (!el) return defaultVal;
            if (el.type === 'checkbox') return el.checked;
            return el.value || defaultVal;
        }

        function formatGenDate(dateStr) {
            if (!dateStr) return '[DATE]';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        function hl(value, defaultVal, fieldId = '') {
            const display = value || defaultVal;
            return `<span class="doc-highlight" data-field="${fieldId}">${display}</span>`;
        }

        // ========== BLANK DOCUMENT ==========
        function generateBlankForm() {
            return `
                <div class="blank-doc-message">
                    <h3>Blank Document</h3>
                    <p>Type directly in the editor on the right. Use the formatting toolbar to style your text.</p>
                    <p style="margin-top: 12px; font-size: 12px; color: #9ca3af;">All changes sync in real-time with collaborators.</p>
                </div>
            `;
        }

        function generateBlankPreview() {
            return `<p>Start typing your document here...</p>`;
        }

        // ========== NON-SOLICITATION GENERATOR ==========
        function generateNonSolicitationForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>Non-Solicitation Agreement</h2>
                    <p>Protect your business relationships and workforce</p>
                </div>

                <div class="gen-info-box">
                    <strong>Why Non-Solicitation Agreements Matter</strong><br>
                    Unlike non-competes (banned in CA, restricted elsewhere), non-solicitation agreements are enforceable in most states because they don't prevent employmentâ€”they protect specific business relationships.
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Company Information</div>
                    <div class="gen-form-group">
                        <label class="tooltip-trigger">Company Legal Name <span class="tooltip-icon">?</span></label>
                        <input type="text" id="gen_companyName" placeholder="Acme Corporation, Inc." oninput="updateGeneratorPreview('companyName')">
                        <div class="field-help">Use your exact legal entity name as registered with the state (e.g., "Inc.", "LLC", "Corp.")</div>
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label class="tooltip-trigger">Governing State <span class="tooltip-icon">?</span></label>
                            <select id="gen_companyState" onchange="updateGeneratorPreview('companyState')">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="Illinois">Illinois</option>
                                <option value="Massachusetts">Massachusetts</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                                <option value="Washington">Washington</option>
                            </select>
                            <div class="field-help">State law governs enforceability. CA has strict limits; most others allow reasonable restrictions.</div>
                        </div>
                        <div class="gen-form-group">
                            <label>Effective Date</label>
                            <input type="date" id="gen_effectiveDate" value="${today}" onchange="updateGeneratorPreview('effectiveDate')">
                        </div>
                    </div>
                    <div class="gen-form-group">
                        <label>Company Address</label>
                        <input type="text" id="gen_companyAddress" placeholder="123 Business Ave, Suite 100, City, State ZIP" oninput="updateGeneratorPreview('companyAddress')">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Individual Information</div>
                    <div class="gen-form-group">
                        <label>Individual's Full Legal Name</label>
                        <input type="text" id="gen_individualName" placeholder="John Michael Smith" oninput="updateGeneratorPreview('individualName')">
                    </div>
                    <div class="gen-form-group">
                        <label class="tooltip-trigger">Relationship Type <span class="tooltip-icon">?</span></label>
                        <select id="gen_individualType" onchange="updateGeneratorPreview('individualType')">
                            <option value="employee">Employee</option>
                            <option value="contractor">Independent Contractor</option>
                            <option value="consultant">Consultant</option>
                            <option value="officer">Officer/Director</option>
                            <option value="partner">Business Partner</option>
                        </select>
                        <div class="field-help">The agreement terms adjust based on relationship type. Officers/partners typically have broader restrictions.</div>
                    </div>
                    <div class="gen-form-group">
                        <label>Position/Title</label>
                        <input type="text" id="gen_jobTitle" placeholder="Regional Sales Director" oninput="updateGeneratorPreview('jobTitle')">
                    </div>
                    <div class="gen-form-group">
                        <label>Individual's Address</label>
                        <input type="text" id="gen_individualAddress" placeholder="456 Home Street, City, State ZIP" oninput="updateGeneratorPreview('individualAddress')">
                    </div>
                </div>

                <div class="gen-warning-box">
                    <strong>California Notice:</strong> Non-solicitation of <em>employees</em> is generally unenforceable in CA per Business & Professions Code Â§ 16600. Customer non-solicits may be enforceable if tied to trade secrets.
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Customer Non-Solicitation</div>
                    <div class="gen-form-group">
                        <label class="tooltip-trigger">Restriction Period <span class="tooltip-icon">?</span></label>
                        <select id="gen_customerPeriod" onchange="updateGeneratorPreview('customerPeriod')">
                            <option value="6 months">6 Months</option>
                            <option value="12 months" selected>12 Months</option>
                            <option value="18 months">18 Months</option>
                            <option value="24 months">24 Months</option>
                        </select>
                        <div class="field-help">Courts favor 12-18 months. Longer periods require strong justification (trade secrets, key accounts).</div>
                    </div>
                    <div class="gen-form-group">
                        <label class="tooltip-trigger">Protected Customers <span class="tooltip-icon">?</span></label>
                        <select id="gen_customerScope" onchange="updateGeneratorPreview('customerScope')">
                            <option value="worked-with">Customers individual worked with directly</option>
                            <option value="had-contact">Customers individual had material contact with</option>
                            <option value="confidential-info">Customers about whom individual received confidential information</option>
                            <option value="all-customers">All company customers (broader - may be harder to enforce)</option>
                        </select>
                        <div class="field-help">Narrower scope = more enforceable. "Worked with directly" is strongest in court.</div>
                    </div>
                    <div class="gen-form-group">
                        <label class="tooltip-trigger">Lookback Period <span class="tooltip-icon">?</span></label>
                        <select id="gen_lookbackPeriod" onchange="updateGeneratorPreview('lookbackPeriod')">
                            <option value="12 months">Last 12 months of employment</option>
                            <option value="18 months">Last 18 months of employment</option>
                            <option value="24 months" selected>Last 24 months of employment</option>
                        </select>
                        <div class="field-help">Defines which customers are "protected" based on when the relationship existed.</div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Employee Non-Solicitation</div>
                    <div class="gen-form-group">
                        <label>Restriction Period</label>
                        <select id="gen_employeePeriod" onchange="updateGeneratorPreview('employeePeriod')">
                            <option value="6 months">6 Months</option>
                            <option value="12 months" selected>12 Months</option>
                            <option value="18 months">18 Months</option>
                            <option value="24 months">24 Months</option>
                        </select>
                    </div>
                    <div class="gen-form-group">
                        <label class="tooltip-trigger">Protected Personnel <span class="tooltip-icon">?</span></label>
                        <select id="gen_employeeScope" onchange="updateGeneratorPreview('employeeScope')">
                            <option value="worked-with">Employees individual worked with directly</option>
                            <option value="supervised">Employees individual supervised or managed</option>
                            <option value="department">Employees in individual's department</option>
                            <option value="all-employees">All company employees (broadest)</option>
                        </select>
                    </div>
                    <div class="gen-form-group">
                        <div class="gen-checkbox-group">
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeContractors" onchange="updateGeneratorPreview('includeContractors')" checked>
                                <span>Include contractors</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeConsultants" onchange="updateGeneratorPreview('includeConsultants')" checked>
                                <span>Include consultants</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Additional Provisions</div>
                    <div class="gen-form-group">
                        <div class="gen-checkbox-group">
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeConfidentiality" onchange="updateGeneratorPreview('includeConfidentiality')" checked>
                                <span>Confidentiality clause</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeNonDisparagement" onchange="updateGeneratorPreview('includeNonDisparagement')" checked>
                                <span>Non-disparagement</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeInjunctiveRelief" onchange="updateGeneratorPreview('includeInjunctiveRelief')" checked>
                                <span>Injunctive relief</span>
                            </label>
                        </div>
                        <div class="field-help" style="margin-top: 8px;">Injunctive relief allows seeking court orders to stop violations without proving monetary damages first.</div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Consideration (What Employee Receives)</div>
                    <div class="gen-form-group">
                        <label class="tooltip-trigger">Consideration Type <span class="tooltip-icon">?</span></label>
                        <select id="gen_considerationType" onchange="updateGeneratorPreview('considerationType')">
                            <option value="employment">Initial employment (new hire)</option>
                            <option value="continued-employment">Continued employment (existing employee)</option>
                            <option value="promotion">Promotion or new position</option>
                            <option value="bonus">Signing bonus or special compensation</option>
                            <option value="equity">Stock options or equity grant</option>
                        </select>
                        <div class="field-help"><strong>Critical for enforceability:</strong> Some states (IL, NC, WA) require consideration beyond just continued employment. A bonus or raise strengthens the agreement.</div>
                    </div>
                    <div class="gen-form-group" id="considerationAmountGroup" style="display:none;">
                        <label>Consideration Amount ($)</label>
                        <input type="text" id="gen_considerationAmount" placeholder="5,000" oninput="updateGeneratorPreview('considerationAmount')">
                    </div>
                </div>

                <div class="gen-tip-box">
                    <strong>Enforceability Tips:</strong><br>
                    â€¢ Have employee sign at hire (not after starting)<br>
                    â€¢ Keep restrictions reasonable in time and scope<br>
                    â€¢ Provide real consideration (bonus, raise, promotion)<br>
                    â€¢ Review state-specific requirements annually
                </div>
            `;
        }

        function generateNonSolicitationPreview() {
            const companyName = getGenValue('gen_companyName', '[COMPANY NAME]');
            const companyState = getGenValue('gen_companyState', '[STATE]');
            const companyAddress = getGenValue('gen_companyAddress', '[ADDRESS]');
            const effectiveDate = formatGenDate(getGenValue('gen_effectiveDate'));
            const individualName = getGenValue('gen_individualName', '[INDIVIDUAL NAME]');
            const individualType = getGenValue('gen_individualType', 'employee');
            const jobTitle = getGenValue('gen_jobTitle', '[TITLE]');
            const customerPeriod = getGenValue('gen_customerPeriod', '1 year');
            const employeePeriod = getGenValue('gen_employeePeriod', '1 year');

            const typeLabel = { 'employee': 'Employee', 'contractor': 'Contractor', 'consultant': 'Consultant' }[individualType] || 'Employee';

            return `
                <h1>Non-Solicitation Agreement</h1>
                <p class="center" style="font-style: italic;">Effective Date: ${hl(effectiveDate, '[DATE]', 'effectiveDate')}</p>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>Company:</strong> ${hl(companyName, '[COMPANY NAME]', 'companyName')}, located at ${hl(companyAddress, '[ADDRESS]', 'companyAddress')}</p>
                    <p><strong>${typeLabel}:</strong> ${hl(individualName, '[INDIVIDUAL NAME]', 'individualName')}, serving as ${hl(jobTitle, '[TITLE]', 'jobTitle')}</p>
                </div>

                <p><strong>WHEREAS,</strong> Company has valuable customer relationships and employee resources;</p>
                <p><strong>NOW, THEREFORE,</strong> the parties agree as follows:</p>

                <h2>1. NON-SOLICITATION OF CUSTOMERS</h2>
                <p class="clause">1.1 For a period of ${hl(customerPeriod, '1 year', 'customerPeriod')} following termination, ${typeLabel} agrees not to directly or indirectly solicit any Customer for competitive purposes.</p>

                <h2>2. NON-SOLICITATION OF EMPLOYEES</h2>
                <p class="clause">2.1 For a period of ${hl(employeePeriod, '1 year', 'employeePeriod')} following termination, ${typeLabel} agrees not to solicit, recruit, or hire any employee or contractor of Company.</p>

                <h2>3. GENERAL PROVISIONS</h2>
                <p class="clause">3.1 <strong>Governing Law.</strong> This Agreement shall be governed by the laws of ${hl(companyState, '[STATE]', 'companyState')}.</p>
                <p class="clause">3.2 <strong>Severability.</strong> If any provision is unenforceable, it shall be modified to the minimum extent necessary.</p>

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>Company</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">Name & Title</div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>${typeLabel}</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">${hl(individualName, '[NAME]', 'individualName')}</div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== COMMISSION AGREEMENT GENERATOR ==========
        function generateCommissionForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>Commission Agreement</h2>
                    <p>Sales commission structure and payment terms</p>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Company Information</div>
                    <div class="gen-form-group">
                        <label>Company Name</label>
                        <input type="text" id="gen_companyName" placeholder="Sales Corp, Inc." oninput="updateGeneratorPreview('companyName')">
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>State</label>
                            <select id="gen_companyState" onchange="updateGeneratorPreview('companyState')">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Effective Date</label>
                            <input type="date" id="gen_effectiveDate" value="${today}" onchange="updateGeneratorPreview('effectiveDate')">
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Salesperson Information</div>
                    <div class="gen-form-group">
                        <label>Salesperson Name</label>
                        <input type="text" id="gen_salespersonName" placeholder="Jane Sales" oninput="updateGeneratorPreview('salespersonName')">
                    </div>
                    <div class="gen-form-group">
                        <label>Title/Role</label>
                        <input type="text" id="gen_jobTitle" placeholder="Regional Sales Manager" oninput="updateGeneratorPreview('jobTitle')">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Commission Structure</div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Commission Rate (%)</label>
                            <input type="number" id="gen_commissionRate" placeholder="10" min="0" max="100" step="0.5" oninput="updateGeneratorPreview('commissionRate')">
                        </div>
                        <div class="gen-form-group">
                            <label>Based On</label>
                            <select id="gen_commissionBasis" onchange="updateGeneratorPreview('commissionBasis')">
                                <option value="gross sales">Gross Sales</option>
                                <option value="net sales">Net Sales</option>
                                <option value="collected revenue">Collected Revenue</option>
                            </select>
                        </div>
                    </div>
                    <div class="gen-form-group">
                        <label>Payment Frequency</label>
                        <select id="gen_paymentFrequency" onchange="updateGeneratorPreview('paymentFrequency')">
                            <option value="monthly">Monthly</option>
                            <option value="bi-weekly">Bi-Weekly</option>
                            <option value="quarterly">Quarterly</option>
                        </select>
                    </div>
                </div>
            `;
        }

        function generateCommissionPreview() {
            const companyName = getGenValue('gen_companyName', '[COMPANY NAME]');
            const companyState = getGenValue('gen_companyState', '[STATE]');
            const effectiveDate = formatGenDate(getGenValue('gen_effectiveDate'));
            const salespersonName = getGenValue('gen_salespersonName', '[SALESPERSON NAME]');
            const jobTitle = getGenValue('gen_jobTitle', '[TITLE]');
            const commissionRate = getGenValue('gen_commissionRate', '[RATE]');
            const commissionBasis = getGenValue('gen_commissionBasis', 'gross sales');
            const paymentFrequency = getGenValue('gen_paymentFrequency', 'monthly');

            return `
                <h1>Sales Commission Agreement</h1>
                <p class="center" style="font-style: italic;">Effective Date: ${hl(effectiveDate, '[DATE]', 'effectiveDate')}</p>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>Company:</strong> ${hl(companyName, '[COMPANY NAME]', 'companyName')}</p>
                    <p><strong>Salesperson:</strong> ${hl(salespersonName, '[SALESPERSON NAME]', 'salespersonName')}, serving as ${hl(jobTitle, '[TITLE]', 'jobTitle')}</p>
                </div>

                <h2>1. COMMISSION STRUCTURE</h2>
                <p class="clause">1.1 <strong>Commission Rate.</strong> Salesperson shall earn a commission of ${hl(commissionRate + '%', '[RATE]%', 'commissionRate')} of ${hl(commissionBasis, 'gross sales', 'commissionBasis')} for all qualifying sales.</p>
                <p class="clause">1.2 <strong>Payment.</strong> Commissions shall be paid ${hl(paymentFrequency, 'monthly', 'paymentFrequency')}, within 15 days after the end of each period.</p>

                <h2>2. GENERAL PROVISIONS</h2>
                <p class="clause">2.1 <strong>Governing Law.</strong> This Agreement is governed by the laws of ${hl(companyState, '[STATE]', 'companyState')}.</p>

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>Company</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">Name & Title</div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>Salesperson</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">${hl(salespersonName, '[NAME]', 'salespersonName')}</div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== NDA GENERATOR ==========
        function generateNDAForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>Non-Disclosure Agreement</h2>
                    <p>Protect confidential information</p>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Agreement Type</div>
                    <div class="gen-form-group">
                        <label>NDA Type</label>
                        <select id="gen_ndaType" onchange="updateGeneratorPreview('ndaType')">
                            <option value="mutual">Mutual (Two-Way)</option>
                            <option value="unilateral">Unilateral (One-Way)</option>
                        </select>
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Governing State</label>
                            <select id="gen_governingState" onchange="updateGeneratorPreview('governingState')">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Effective Date</label>
                            <input type="date" id="gen_effectiveDate" value="${today}" onchange="updateGeneratorPreview('effectiveDate')">
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Disclosing Party</div>
                    <div class="gen-form-group">
                        <label>Party Name</label>
                        <input type="text" id="gen_disclosingParty" placeholder="ABC Corporation" oninput="updateGeneratorPreview('disclosingParty')">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Receiving Party</div>
                    <div class="gen-form-group">
                        <label>Party Name</label>
                        <input type="text" id="gen_receivingParty" placeholder="XYZ Company" oninput="updateGeneratorPreview('receivingParty')">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Terms</div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Term (Years)</label>
                            <select id="gen_termYears" onchange="updateGeneratorPreview('termYears')">
                                <option value="1">1 Year</option>
                                <option value="2" selected>2 Years</option>
                                <option value="3">3 Years</option>
                                <option value="5">5 Years</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Survival Period</label>
                            <select id="gen_survivalYears" onchange="updateGeneratorPreview('survivalYears')">
                                <option value="2">2 Years</option>
                                <option value="3" selected>3 Years</option>
                                <option value="5">5 Years</option>
                            </select>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateNDAPreview() {
            const ndaType = getGenValue('gen_ndaType', 'mutual');
            const governingState = getGenValue('gen_governingState', '[STATE]');
            const effectiveDate = formatGenDate(getGenValue('gen_effectiveDate'));
            const disclosingParty = getGenValue('gen_disclosingParty', '[DISCLOSING PARTY]');
            const receivingParty = getGenValue('gen_receivingParty', '[RECEIVING PARTY]');
            const termYears = getGenValue('gen_termYears', '2');
            const survivalYears = getGenValue('gen_survivalYears', '3');

            const isMutual = ndaType === 'mutual';

            return `
                <h1>${isMutual ? 'Mutual ' : ''}Non-Disclosure Agreement</h1>
                <p class="center" style="font-style: italic;">Effective Date: ${hl(effectiveDate, '[DATE]', 'effectiveDate')}</p>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>${isMutual ? 'Party A' : 'Disclosing Party'}:</strong> ${hl(disclosingParty, '[PARTY A]', 'disclosingParty')}</p>
                    <p><strong>${isMutual ? 'Party B' : 'Receiving Party'}:</strong> ${hl(receivingParty, '[PARTY B]', 'receivingParty')}</p>
                </div>

                <h2>1. CONFIDENTIAL INFORMATION</h2>
                <p class="clause">1.1 "Confidential Information" means any non-public information disclosed by ${isMutual ? 'either party' : 'Disclosing Party'}.</p>

                <h2>2. OBLIGATIONS</h2>
                <p class="clause">2.1 ${isMutual ? 'Each party' : 'Receiving Party'} agrees to hold all Confidential Information in strict confidence.</p>

                <h2>3. TERM</h2>
                <p class="clause">3.1 This Agreement remains in effect for ${hl(termYears + ' year' + (termYears > 1 ? 's' : ''), '2 years', 'termYears')}.</p>
                <p class="clause">3.2 Confidentiality obligations survive for ${hl(survivalYears + ' years', '3 years', 'survivalYears')} after termination.</p>

                <h2>4. GOVERNING LAW</h2>
                <p class="clause">4.1 This Agreement is governed by the laws of ${hl(governingState, '[STATE]', 'governingState')}.</p>

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>${isMutual ? 'Party A' : 'Disclosing Party'}</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">${hl(disclosingParty, '[NAME]', 'disclosingParty')}</div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>${isMutual ? 'Party B' : 'Receiving Party'}</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">${hl(receivingParty, '[NAME]', 'receivingParty')}</div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== PIIA GENERATOR ==========
        function generatePIIAForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>PIIA</h2>
                    <p>Proprietary Information and Inventions Assignment</p>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Company Information</div>
                    <div class="gen-form-group">
                        <label>Company Name</label>
                        <input type="text" id="gen_companyName" placeholder="Tech Corp, Inc." oninput="updateGeneratorPreview('companyName')">
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>State</label>
                            <select id="gen_companyState" onchange="updateGeneratorPreview('companyState')">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Delaware">Delaware</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Effective Date</label>
                            <input type="date" id="gen_effectiveDate" value="${today}" onchange="updateGeneratorPreview('effectiveDate')">
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Employee Information</div>
                    <div class="gen-form-group">
                        <label>Employee Name</label>
                        <input type="text" id="gen_employeeName" placeholder="John Developer" oninput="updateGeneratorPreview('employeeName')">
                    </div>
                    <div class="gen-form-group">
                        <label>Position/Title</label>
                        <input type="text" id="gen_jobTitle" placeholder="Software Engineer" oninput="updateGeneratorPreview('jobTitle')">
                    </div>
                </div>
            `;
        }

        function generatePIIAPreview() {
            const companyName = getGenValue('gen_companyName', '[COMPANY NAME]');
            const companyState = getGenValue('gen_companyState', '[STATE]');
            const effectiveDate = formatGenDate(getGenValue('gen_effectiveDate'));
            const employeeName = getGenValue('gen_employeeName', '[EMPLOYEE NAME]');
            const jobTitle = getGenValue('gen_jobTitle', '[TITLE]');

            return `
                <h1>Proprietary Information and Inventions Assignment Agreement</h1>
                <p class="center" style="font-style: italic;">Effective Date: ${hl(effectiveDate, '[DATE]', 'effectiveDate')}</p>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>Company:</strong> ${hl(companyName, '[COMPANY NAME]', 'companyName')}</p>
                    <p><strong>Employee:</strong> ${hl(employeeName, '[EMPLOYEE NAME]', 'employeeName')}, serving as ${hl(jobTitle, '[TITLE]', 'jobTitle')}</p>
                </div>

                <h2>1. CONFIDENTIAL INFORMATION</h2>
                <p class="clause">1.1 Employee agrees to hold all Confidential Information in strict confidence.</p>

                <h2>2. ASSIGNMENT OF INVENTIONS</h2>
                <p class="clause">2.1 Employee assigns to Company all inventions developed using Company resources or relating to Company's business.</p>

                <h2>3. GOVERNING LAW</h2>
                <p class="clause">3.1 This Agreement is governed by the laws of ${hl(companyState, '[STATE]', 'companyState')}.</p>

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>Company</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">Name & Title</div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>Employee</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">${hl(employeeName, '[NAME]', 'employeeName')}</div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== SUBLEASE GENERATOR ==========
        function generateSubleaseForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>Sublease Agreement</h2>
                    <p>Sublease property to a subtenant</p>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Property Information</div>
                    <div class="gen-form-group">
                        <label>Property Address</label>
                        <input type="text" id="gen_propertyAddress" placeholder="123 Main St, Apt 4B" oninput="updateGeneratorPreview('propertyAddress')">
                    </div>
                    <div class="gen-form-group">
                        <label>Governing State</label>
                        <select id="gen_governingState" onchange="updateGeneratorPreview('governingState')">
                            <option value="">Select...</option>
                            <option value="California">California</option>
                            <option value="Florida">Florida</option>
                            <option value="New York">New York</option>
                            <option value="Texas">Texas</option>
                        </select>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Parties</div>
                    <div class="gen-form-group">
                        <label>Sublessor Name</label>
                        <input type="text" id="gen_sublessorName" placeholder="Original Tenant" oninput="updateGeneratorPreview('sublessorName')">
                    </div>
                    <div class="gen-form-group">
                        <label>Sublessee Name</label>
                        <input type="text" id="gen_sublesseeName" placeholder="New Subtenant" oninput="updateGeneratorPreview('sublesseeName')">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Lease Terms</div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Start Date</label>
                            <input type="date" id="gen_startDate" value="${today}" onchange="updateGeneratorPreview('startDate')">
                        </div>
                        <div class="gen-form-group">
                            <label>End Date</label>
                            <input type="date" id="gen_endDate" onchange="updateGeneratorPreview('endDate')">
                        </div>
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Monthly Rent ($)</label>
                            <input type="number" id="gen_monthlyRent" placeholder="1500" oninput="updateGeneratorPreview('monthlyRent')">
                        </div>
                        <div class="gen-form-group">
                            <label>Security Deposit ($)</label>
                            <input type="number" id="gen_securityDeposit" placeholder="1500" oninput="updateGeneratorPreview('securityDeposit')">
                        </div>
                    </div>
                </div>
            `;
        }

        function generateSubleasePreview() {
            const propertyAddress = getGenValue('gen_propertyAddress', '[PROPERTY ADDRESS]');
            const governingState = getGenValue('gen_governingState', '[STATE]');
            const sublessorName = getGenValue('gen_sublessorName', '[SUBLESSOR NAME]');
            const sublesseeName = getGenValue('gen_sublesseeName', '[SUBLESSEE NAME]');
            const startDate = formatGenDate(getGenValue('gen_startDate'));
            const endDate = formatGenDate(getGenValue('gen_endDate'));
            const monthlyRent = getGenValue('gen_monthlyRent', '[AMOUNT]');
            const securityDeposit = getGenValue('gen_securityDeposit', '[AMOUNT]');

            return `
                <h1>Sublease Agreement</h1>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>Sublessor:</strong> ${hl(sublessorName, '[SUBLESSOR]', 'sublessorName')}</p>
                    <p><strong>Sublessee:</strong> ${hl(sublesseeName, '[SUBLESSEE]', 'sublesseeName')}</p>
                </div>

                <h2>1. PREMISES</h2>
                <p class="clause">1.1 Sublessor agrees to sublease the property at: ${hl(propertyAddress, '[ADDRESS]', 'propertyAddress')}</p>

                <h2>2. TERM</h2>
                <p class="clause">2.1 The sublease begins on ${hl(startDate, '[START DATE]', 'startDate')} and ends on ${hl(endDate, '[END DATE]', 'endDate')}.</p>

                <h2>3. RENT</h2>
                <p class="clause">3.1 Monthly rent: ${hl('$' + monthlyRent, '$[AMOUNT]', 'monthlyRent')}</p>
                <p class="clause">3.2 Security deposit: ${hl('$' + securityDeposit, '$[AMOUNT]', 'securityDeposit')}</p>

                <h2>4. GOVERNING LAW</h2>
                <p class="clause">4.1 This Agreement is governed by the laws of ${hl(governingState, '[STATE]', 'governingState')}.</p>

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>Sublessor</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">${hl(sublessorName, '[NAME]', 'sublessorName')}</div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>Sublessee</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">${hl(sublesseeName, '[NAME]', 'sublesseeName')}</div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== FORMATTING ==========
        function formatDoc(command, value = null) {
            document.execCommand(command, false, value);
            document.getElementById('docPreview').focus();
            syncToFirebase();
        }

        // ========== FILE UPLOAD ==========
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const preview = document.getElementById('docPreview');

                // Handle different file types
                if (file.name.endsWith('.html') || file.name.endsWith('.htm')) {
                    preview.innerHTML = content;
                } else {
                    // Plain text - preserve line breaks
                    preview.innerHTML = content.split('\n').map(line => `<p>${line || '&nbsp;'}</p>`).join('');
                }

                // Switch to blank document mode
                document.getElementById('docTypeSelector').value = 'blank';
                document.getElementById('generatorFormContainer').innerHTML = `
                    <div class="blank-doc-message">
                        <h3>Uploaded: ${file.name}</h3>
                        <p>Edit the document directly in the editor. Changes sync in real-time.</p>
                    </div>
                `;

                syncToFirebase();
                showToast('Document uploaded!');
            };
            reader.readAsText(file);
        }

        // Setup drag and drop
        const uploadSection = document.getElementById('uploadSection');
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });
        uploadSection.addEventListener('dragleave', () => {
            uploadSection.classList.remove('dragover');
        });
        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                document.getElementById('fileInput').files = e.dataTransfer.files;
                handleFileUpload({ target: { files: [file] } });
            }
        });

        // ========== DOCUMENT ACTIONS ==========
        function printDocument() {
            window.print();
        }

        function downloadDocument() {
            const content = document.getElementById('docPreview').innerHTML;
            const docType = document.getElementById('docTypeSelector').value || 'document';
            const sessionName = document.getElementById('sessionName').value || 'document';

            const html = `
                <html>
                <head><meta charset="utf-8"><title>${sessionName}</title>
                <style>
                    body { font-family: 'Times New Roman', serif; font-size: 12pt; line-height: 1.6; padding: 1in; }
                    h1 { text-align: center; font-size: 16pt; text-transform: uppercase; }
                    h2 { font-size: 12pt; text-transform: uppercase; margin-top: 18pt; }
                    p { margin-bottom: 12pt; text-align: justify; }
                    .signature-block { margin-top: 36pt; }
                    .signature-line { border-top: 1px solid black; margin-top: 30pt; padding-top: 4pt; }
                </style></head>
                <body>${content}</body></html>
            `;
            const blob = new Blob([html], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${sessionName.replace(/[^a-z0-9]/gi, '-')}.doc`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function handleDocumentEdit() {
            syncToFirebase();
        }

        // ========== FIREBASE & COLLABORATION ==========
        const firebaseConfig = {
            apiKey: "AIzaSyCeACvK3MVTOOaWY4SWG1yNnrcA9ILkkaM",
            authDomain: "termsdocs.firebaseapp.com",
            databaseURL: "https://termsdocs-default-rtdb.firebaseio.com",
            projectId: "termsdocs",
            storageBucket: "termsdocs.firebasestorage.app",
            messagingSenderId: "62791617178",
            appId: "1:62791617178:web:ff79f24f40cc98e88aed23",
            measurementId: "G-PBGF06LDTM"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let userName = '';
        let userColor = '';
        let roomId = '';
        let myUserId = '';
        let contentRef, usersRef, myUserRef, metaRef;
        let isLocalUpdate = false;
        let saveTimeout = null;
        const userColors = ['#ef4444', '#3b82f6', '#22c55e', '#f59e0b', '#8b5cf6', '#ec4899'];

        // Get or create room ID
        const urlParams = new URLSearchParams(window.location.search);
        roomId = urlParams.get('room');
        if (!roomId) {
            roomId = Math.random().toString(36).substring(2, 14);
            window.history.replaceState({}, '', `?room=${roomId}`);
        }

        myUserId = Math.random().toString(36).substring(2, 10);

        const savedName = localStorage.getItem('terms-law-name');
        if (savedName) document.getElementById('userName').value = savedName;

        // Event listeners
        document.getElementById('userName').addEventListener('keypress', e => {
            if (e.key === 'Enter') joinSession();
        });
        document.getElementById('joinBtn').addEventListener('click', joinSession);
        document.getElementById('copyBtn').addEventListener('click', copyLink);
        document.getElementById('newBtn').addEventListener('click', () => {
            window.location.href = `?room=${Math.random().toString(36).substring(2, 14)}`;
        });

        function joinSession() {
            userName = document.getElementById('userName').value.trim();
            if (!userName) return document.getElementById('userName').focus();

            localStorage.setItem('terms-law-name', userName);
            userColor = userColors[Math.floor(Math.random() * userColors.length)];
            document.getElementById('joinModal').classList.add('hidden');

            initFirebase();
        }

        function initFirebase() {
            contentRef = db.ref(`rooms/${roomId}/content`);
            usersRef = db.ref(`rooms/${roomId}/users`);
            metaRef = db.ref(`rooms/${roomId}/meta`);
            myUserRef = usersRef.child(myUserId);

            const preview = document.getElementById('docPreview');
            const sessionNameInput = document.getElementById('sessionName');

            myUserRef.set({
                name: userName,
                color: userColor,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });

            myUserRef.onDisconnect().remove();

            contentRef.on('value', (snapshot) => {
                if (isLocalUpdate) return;
                const content = snapshot.val();
                if (content !== null && content !== undefined) {
                    preview.innerHTML = content;
                }
            });

            metaRef.child('name').on('value', (snapshot) => {
                const name = snapshot.val();
                if (name && document.activeElement !== sessionNameInput) {
                    sessionNameInput.value = name;
                }
            });

            usersRef.on('value', (snapshot) => {
                updateUsers(snapshot.val() || {});
            });

            db.ref('.info/connected').on('value', (snapshot) => {
                const connected = snapshot.val();
                document.getElementById('statusDot').classList.toggle('connected', connected);
                document.getElementById('statusText').textContent = connected ? 'Connected' : 'Connecting...';
                if (connected) showToast(`Joined as ${userName}`);
            });

            sessionNameInput.addEventListener('input', () => {
                metaRef.child('name').set(sessionNameInput.value);
            });
        }

        function syncToFirebase() {
            const preview = document.getElementById('docPreview');
            const saveStatus = document.getElementById('saveStatus');

            saveStatus.textContent = 'Saving...';
            saveStatus.className = 'save-status saving';

            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                isLocalUpdate = true;
                contentRef.set(preview.innerHTML).then(() => {
                    isLocalUpdate = false;
                    saveStatus.textContent = 'All changes saved';
                    saveStatus.className = 'save-status saved';
                });
            }, 300);
        }

        function updateUsers(users) {
            const userList = document.getElementById('userList');
            userList.innerHTML = '';
            const userEntries = Object.entries(users);

            userEntries.forEach(([id, user]) => {
                const isYou = id === myUserId;
                const dot = document.createElement('div');
                dot.className = 'user-dot';
                dot.style.background = user.color;
                dot.dataset.name = user.name + (isYou ? ' (you)' : '');
                dot.textContent = user.name.charAt(0).toUpperCase();
                userList.appendChild(dot);
            });
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href)
                .then(() => showToast('Link copied!'))
                .catch(() => prompt('Copy:', window.location.href));
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        window.addEventListener('beforeunload', () => {
            if (myUserRef) myUserRef.remove();
        });
    </script>
</body>
</html>
