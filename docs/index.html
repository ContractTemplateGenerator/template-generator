<!DOCTYPE html>
<html lang="en">
<head>
    <!-- NOINDEX - Confidential client portal -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terms.Law - Collaborative Document Editor</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
        }
        .header {
            background: #1a1a2e;
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 20px; font-weight: 600; }
        .logo span { color: #6366f1; }
        .header-actions { display: flex; gap: 12px; align-items: center; }
        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #fbbf24;
        }
        .status-dot.connected { background: #22c55e; }
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background: #6366f1; color: white; }
        .btn-secondary { background: rgba(255,255,255,0.15); color: white; }
        .btn-outline { background: transparent; border: 1px solid #e5e7eb; color: #374151; }
        .btn-outline:hover { background: #f3f4f6; }
        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .btn-success { background: #22c55e; color: white; }
        .btn-success:hover { background: #16a34a; }

        .main-container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            gap: 24px;
        }
        .editor-section {
            flex: 1;
            min-width: 0;
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            background: #e5e7eb;
            border-radius: 8px;
            padding: 4px;
            gap: 4px;
        }
        .mode-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        .mode-btn:hover { color: #374151; }
        .mode-btn.active {
            background: white;
            color: #6366f1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .toolbar {
            background: white;
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }
        .toolbar-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .toolbar-divider {
            width: 1px;
            height: 24px;
            background: #e5e7eb;
        }
        .session-name {
            flex: 1;
            min-width: 200px;
        }
        .session-name input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            outline: none;
        }
        .session-name input:focus { border-color: #6366f1; }
        .save-status {
            font-size: 13px;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .save-status.saving { color: #f59e0b; }
        .save-status.saved { color: #22c55e; }

        .users-panel {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .users-panel h3 {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 12px;
            text-transform: uppercase;
        }
        .user-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .user-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #f3f4f6;
            border-radius: 20px;
            font-size: 14px;
        }
        .user-badge .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .user-badge.you {
            background: #ecfdf5;
            border: 1px solid #22c55e;
        }
        .editor-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        #editor {
            width: 100%;
            min-height: 600px;
            padding: 24px;
            font-size: 16px;
            line-height: 1.7;
            border: none;
            outline: none;
            font-family: inherit;
            resize: vertical;
        }


        /* Generator Mode Styles */
        .generator-container {
            display: none;
        }
        .generator-container.active {
            display: flex;
            gap: 24px;
        }
        .edit-container.hidden {
            display: none;
        }

        .generator-form-panel {
            width: 400px;
            flex-shrink: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 20px;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            position: sticky;
            top: 100px;
        }
        .generator-preview-panel {
            flex: 1;
            min-width: 0;
        }

        /* Document Selector */
        .doc-selector {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
        }
        .doc-selector label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .doc-selector select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            background: white;
            cursor: pointer;
        }
        .doc-selector select:focus {
            outline: none;
            border-color: #6366f1;
        }

        /* Generator Form Styles */
        .gen-form-header {
            margin-bottom: 20px;
        }
        .gen-form-header h2 {
            font-size: 18px;
            color: #1a1a2e;
            margin-bottom: 4px;
        }
        .gen-form-header p {
            font-size: 13px;
            color: #6b7280;
        }
        .gen-form-section {
            margin-bottom: 20px;
        }
        .gen-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .gen-section-title::before {
            content: '';
            width: 3px;
            height: 14px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 2px;
        }
        .gen-form-group {
            margin-bottom: 12px;
        }
        .gen-form-group label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            color: #475569;
            margin-bottom: 4px;
        }
        .gen-form-group input,
        .gen-form-group select,
        .gen-form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1.5px solid #e5e7eb;
            border-radius: 6px;
            font-size: 13px;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        .gen-form-group input:focus,
        .gen-form-group select:focus,
        .gen-form-group textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99,102,241,0.1);
        }
        .gen-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .gen-checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .gen-checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #475569;
            padding: 6px 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .gen-checkbox-label:hover {
            background: #f8f9fa;
        }
        .gen-checkbox-label input {
            width: 14px;
            height: 14px;
        }
        .gen-checkbox-label input:checked + span {
            color: #6366f1;
            font-weight: 500;
        }
        .gen-info-box {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 12px;
            color: #1e40af;
            margin-bottom: 16px;
        }
        .gen-insert-btn {
            width: 100%;
            padding: 14px;
            margin-top: 16px;
            font-size: 15px;
        }

        /* Preview Panel */
        .preview-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .preview-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-bottom: 1px solid #e5e7eb;
        }
        .preview-toolbar-title {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        .preview-toolbar-actions {
            display: flex;
            gap: 8px;
        }
        .preview-content {
            padding: 24px;
            max-height: calc(100vh - 280px);
            overflow-y: auto;
        }

        /* Document Preview Styles */
        .doc-preview {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 48px;
            font-family: 'Times New Roman', Times, serif;
            font-size: 12pt;
            line-height: 1.6;
            color: #000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border: 1px solid #e5e7eb;
        }
        .doc-preview h1 {
            text-align: center;
            font-size: 16pt;
            margin-bottom: 20px;
            text-transform: uppercase;
        }
        .doc-preview h2 {
            font-size: 12pt;
            margin-top: 20px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .doc-preview p {
            margin-bottom: 12px;
            text-align: justify;
        }
        .doc-preview .center {
            text-align: center;
        }
        .doc-preview .parties {
            margin: 20px 0;
        }
        .doc-preview .clause {
            margin-bottom: 14px;
        }
        .doc-preview .sub-clause {
            margin-left: 24px;
            margin-bottom: 8px;
        }
        .doc-preview .signature-block {
            margin-top: 40px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        .doc-preview .signature-party h3 {
            font-size: 11pt;
            margin-bottom: 24px;
            text-transform: uppercase;
        }
        .doc-preview .signature-line {
            border-top: 1px solid #000;
            margin-top: 30px;
            padding-top: 4px;
            font-size: 10pt;
        }
        .doc-highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 0 3px;
            border-radius: 2px;
        }

        /* Template Modal */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 16px;
        }
        .template-card {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }
        .template-card:hover {
            border-color: #6366f1;
            background: #f8f7ff;
        }
        .template-card h4 {
            font-size: 14px;
            color: #1a1a2e;
            margin-bottom: 4px;
        }
        .template-card p {
            font-size: 12px;
            color: #6b7280;
        }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal {
            background: white;
            padding: 32px;
            border-radius: 16px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }
        .modal.wide { max-width: 600px; text-align: left; }
        .modal h2 { margin-bottom: 8px; color: #1a1a2e; }
        .modal p { color: #6b7280; margin-bottom: 24px; }
        .modal input[type="text"] {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 16px;
            outline: none;
        }
        .modal input:focus { border-color: #6366f1; }
        .modal .btn { width: 100%; padding: 14px; }
        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }
        .modal-actions .btn { flex: 1; }

        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #1a1a2e;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1001;
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .hidden { display: none !important; }

        @media (max-width: 1100px) {
            .generator-container.active {
                flex-direction: column;
            }
            .generator-form-panel {
                width: 100%;
                max-height: none;
                position: relative;
                top: 0;
            }
        }

        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
            }
            .comments-section {
                width: 100%;
            }
        }

        @media print {
            body * { visibility: hidden; }
            .doc-preview, .doc-preview * { visibility: visible; }
            .doc-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                box-shadow: none;
                border: none;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">Terms.<span>Law</span> Docs</div>
        <div class="header-actions">
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">Connecting...</span>
            </div>
            <button class="btn btn-secondary" id="copyBtn">Copy Link</button>
            <button class="btn btn-primary" id="newBtn">New Session</button>
        </div>
    </header>

    <div class="main-container">
        <div class="editor-section">
            <div class="toolbar">
                <div class="toolbar-group">
                    <div class="mode-toggle">
                        <button class="mode-btn active" id="editModeBtn" onclick="switchMode('edit')">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            Edit
                        </button>
                        <button class="mode-btn" id="generateModeBtn" onclick="switchMode('generate')">
                            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                            </svg>
                            Generate
                        </button>
                    </div>
                </div>
                <div class="toolbar-divider"></div>
                <div class="toolbar-group" id="editToolbarItems">
                    <button class="btn btn-outline btn-sm" id="templateBtn">+ Template</button>
                </div>
                <div class="toolbar-divider" id="editToolbarDivider"></div>
                <div class="session-name">
                    <input type="text" id="sessionName" placeholder="Untitled Session">
                </div>
                <div class="toolbar-divider"></div>
                <div class="save-status" id="saveStatus">
                    <span>All changes saved</span>
                </div>
            </div>

            <!-- Edit Mode Container -->
            <div class="edit-container" id="editContainer">
                <div class="users-panel">
                    <h3>Connected Users</h3>
                    <div class="user-list" id="userList">
                        <span style="color: #9ca3af;">Waiting...</span>
                    </div>
                </div>

                <div class="editor-container">
                    <textarea id="editor" placeholder="Start typing... Changes sync in real-time."></textarea>
                </div>
            </div>

            <!-- Generator Mode Container -->
            <div class="generator-container" id="generatorContainer">
                <div class="generator-form-panel">
                    <!-- Document Selector -->
                    <div class="doc-selector">
                        <label>Select Document Type</label>
                        <select id="docTypeSelector" onchange="loadDocumentGenerator()">
                            <option value="">Choose a document...</option>
                            <option value="non-solicitation">Non-Solicitation Agreement</option>
                            <option value="commission">Commission Agreement</option>
                            <option value="nda">Non-Disclosure Agreement (NDA)</option>
                            <option value="piia">PIIA (Inventions Assignment)</option>
                            <option value="sublease">Sublease Agreement</option>
                        </select>
                    </div>

                    <!-- Dynamic Form Container -->
                    <div id="generatorFormContainer">
                        <div class="gen-info-box">
                            Select a document type above to start generating.
                        </div>
                    </div>
                </div>

                <div class="generator-preview-panel">
                    <div class="preview-container">
                        <div class="preview-toolbar">
                            <span class="preview-toolbar-title">Live Preview</span>
                            <div class="preview-toolbar-actions">
                                <button class="btn btn-outline btn-sm" onclick="printPreview()">Print</button>
                                <button class="btn btn-outline btn-sm" onclick="downloadPreview()">Download</button>
                            </div>
                        </div>
                        <div class="preview-content">
                            <div class="doc-preview" id="docPreview">
                                <p style="color: #9ca3af; text-align: center; padding: 60px 20px;">
                                    Select a document type and fill in the form to see a live preview.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="modal-overlay" id="joinModal">
        <div class="modal">
            <h2>Join Session</h2>
            <p>Enter your name to join</p>
            <input type="text" id="userName" placeholder="Your name" autofocus>
            <button class="btn btn-primary" id="joinBtn">Join Session</button>
        </div>
    </div>

    <div class="modal-overlay hidden" id="templateModal">
        <div class="modal wide">
            <h2>Choose a Template</h2>
            <p>Start with a pre-built template or blank document</p>
            <div class="template-grid">
                <div class="template-card" data-template="blank">
                    <h4>Blank Document</h4>
                    <p>Start from scratch</p>
                </div>
                <div class="template-card" data-template="stripe">
                    <h4>Stripe Demand Letter</h4>
                    <p>Fund release demand template</p>
                </div>
                <div class="template-card" data-template="nda">
                    <h4>NDA Template</h4>
                    <p>Mutual confidentiality agreement</p>
                </div>
                <div class="template-card" data-template="llc">
                    <h4>LLC Operating Agreement</h4>
                    <p>Single-member LLC template</p>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-outline" id="cancelTemplateBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        // ========== MODE SWITCHING ==========
        let currentMode = 'edit';

        function switchMode(mode) {
            currentMode = mode;

            // Update toggle buttons
            document.getElementById('editModeBtn').classList.toggle('active', mode === 'edit');
            document.getElementById('generateModeBtn').classList.toggle('active', mode === 'generate');

            // Show/hide containers
            document.getElementById('editContainer').classList.toggle('hidden', mode !== 'edit');
            document.getElementById('generatorContainer').classList.toggle('active', mode === 'generate');

            // Show/hide edit-specific toolbar items
            document.getElementById('editToolbarItems').classList.toggle('hidden', mode !== 'edit');
            document.getElementById('editToolbarDivider').classList.toggle('hidden', mode !== 'edit');
        }

        // ========== DOCUMENT GENERATORS ==========
        const documentGenerators = {
            'non-solicitation': {
                title: 'Non-Solicitation Agreement',
                description: 'Protect your customers and employees from poaching',
                form: generateNonSolicitationForm,
                preview: generateNonSolicitationPreview
            },
            'commission': {
                title: 'Commission Agreement',
                description: 'Sales commission structure and payment terms',
                form: generateCommissionForm,
                preview: generateCommissionPreview
            },
            'nda': {
                title: 'Non-Disclosure Agreement',
                description: 'Protect confidential information in business relationships',
                form: generateNDAForm,
                preview: generateNDAPreview
            },
            'piia': {
                title: 'PIIA (Inventions Assignment)',
                description: 'Assign intellectual property and inventions to employer',
                form: generatePIIAForm,
                preview: generatePIIAPreview
            },
            'sublease': {
                title: 'Sublease Agreement',
                description: 'Sublease residential or commercial property',
                form: generateSubleaseForm,
                preview: generateSubleasePreview
            }
        };

        function loadDocumentGenerator() {
            const docType = document.getElementById('docTypeSelector').value;
            const formContainer = document.getElementById('generatorFormContainer');
            const previewContainer = document.getElementById('docPreview');

            if (!docType || !documentGenerators[docType]) {
                formContainer.innerHTML = `
                    <div class="gen-info-box">
                        Select a document type above to start generating.
                    </div>
                `;
                previewContainer.innerHTML = `
                    <p style="color: #9ca3af; text-align: center; padding: 60px 20px;">
                        Select a document type and fill in the form to see a live preview.
                    </p>
                `;
                return;
            }

            const generator = documentGenerators[docType];
            formContainer.innerHTML = generator.form();
            updateGeneratorPreview();
        }

        function updateGeneratorPreview() {
            const docType = document.getElementById('docTypeSelector').value;
            if (!docType || !documentGenerators[docType]) return;

            const generator = documentGenerators[docType];
            document.getElementById('docPreview').innerHTML = generator.preview();
        }

        function getGenValue(id, defaultVal = '') {
            const el = document.getElementById(id);
            if (!el) return defaultVal;
            if (el.type === 'checkbox') return el.checked;
            return el.value || defaultVal;
        }

        function formatGenDate(dateStr) {
            if (!dateStr) return '[DATE]';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }

        function insertToEditor() {
            const previewContent = document.getElementById('docPreview').innerText;
            const editor = document.getElementById('editor');

            // Switch to edit mode
            switchMode('edit');

            // Insert content
            editor.value = previewContent;
            updateContent();

            showToast('Document inserted into editor!');
        }

        function printPreview() {
            window.print();
        }

        function downloadPreview() {
            const content = document.getElementById('docPreview').innerHTML;
            const docType = document.getElementById('docTypeSelector').value || 'document';
            const html = `
                <html>
                <head><meta charset="utf-8"><title>${docType}</title>
                <style>
                    body { font-family: 'Times New Roman', serif; font-size: 12pt; line-height: 1.6; padding: 1in; }
                    h1 { text-align: center; font-size: 16pt; text-transform: uppercase; }
                    h2 { font-size: 12pt; text-transform: uppercase; margin-top: 18pt; }
                    p { margin-bottom: 12pt; text-align: justify; }
                    .sub-clause { margin-left: 36pt; }
                    .signature-block { margin-top: 36pt; }
                    .signature-line { border-top: 1px solid black; margin-top: 30pt; padding-top: 4pt; }
                </style></head>
                <body>${content}</body></html>
            `;
            const blob = new Blob([html], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${docType}-agreement.doc`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ========== NON-SOLICITATION GENERATOR ==========
        function generateNonSolicitationForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>Non-Solicitation Agreement</h2>
                    <p>Protect your customers and employees from poaching</p>
                </div>

                <div class="gen-info-box">
                    <strong>More Enforceable Than Non-Competes</strong><br>
                    Non-solicitation agreements are narrower in scope and generally more enforceable.
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Company Information</div>
                    <div class="gen-form-group">
                        <label>Company Name</label>
                        <input type="text" id="gen_companyName" placeholder="Acme Corporation" oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>State</label>
                            <select id="gen_companyState" onchange="updateGeneratorPreview()">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Effective Date</label>
                            <input type="date" id="gen_effectiveDate" value="${today}" onchange="updateGeneratorPreview()">
                        </div>
                    </div>
                    <div class="gen-form-group">
                        <label>Company Address</label>
                        <input type="text" id="gen_companyAddress" placeholder="123 Business Ave, City, State ZIP" oninput="updateGeneratorPreview()">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Individual Information</div>
                    <div class="gen-form-group">
                        <label>Individual Name</label>
                        <input type="text" id="gen_individualName" placeholder="John Smith" oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-group">
                        <label>Relationship Type</label>
                        <select id="gen_individualType" onchange="updateGeneratorPreview()">
                            <option value="employee">Employee</option>
                            <option value="contractor">Independent Contractor</option>
                            <option value="consultant">Consultant</option>
                        </select>
                    </div>
                    <div class="gen-form-group">
                        <label>Position/Title</label>
                        <input type="text" id="gen_jobTitle" placeholder="Sales Manager" oninput="updateGeneratorPreview()">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Customer Non-Solicitation</div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Restriction Period</label>
                            <select id="gen_customerPeriod" onchange="updateGeneratorPreview()">
                                <option value="6 months">6 Months</option>
                                <option value="1 year" selected>1 Year</option>
                                <option value="2 years">2 Years</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Lookback Period</label>
                            <select id="gen_customerLookback" onchange="updateGeneratorPreview()">
                                <option value="1 year">Last 1 Year</option>
                                <option value="2 years" selected>Last 2 Years</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Employee Non-Solicitation</div>
                    <div class="gen-form-group">
                        <label class="gen-checkbox-label" style="border: none; padding: 0; margin-bottom: 8px;">
                            <input type="checkbox" id="gen_includeEmployeeNonSol" onchange="updateGeneratorPreview()" checked>
                            <span>Include Employee Non-Solicitation</span>
                        </label>
                    </div>
                    <div class="gen-form-group">
                        <label>Employee Restriction Period</label>
                        <select id="gen_employeePeriod" onchange="updateGeneratorPreview()">
                            <option value="6 months">6 Months</option>
                            <option value="1 year" selected>1 Year</option>
                            <option value="2 years">2 Years</option>
                        </select>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Additional Provisions</div>
                    <div class="gen-form-group">
                        <label>Include These Clauses</label>
                        <div class="gen-checkbox-group">
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_confidentiality" onchange="updateGeneratorPreview()" checked>
                                <span>Confidentiality</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_returnProperty" onchange="updateGeneratorPreview()" checked>
                                <span>Return of Property</span>
                            </label>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success gen-insert-btn" onclick="insertToEditor()">
                    Insert into Editor →
                </button>
            `;
        }

        function generateNonSolicitationPreview() {
            const companyName = getGenValue('gen_companyName', '[COMPANY NAME]');
            const companyState = getGenValue('gen_companyState', '[STATE]');
            const companyAddress = getGenValue('gen_companyAddress', '[ADDRESS]');
            const effectiveDate = formatGenDate(getGenValue('gen_effectiveDate'));
            const individualName = getGenValue('gen_individualName', '[INDIVIDUAL NAME]');
            const individualType = getGenValue('gen_individualType', 'employee');
            const jobTitle = getGenValue('gen_jobTitle', '[TITLE]');
            const customerPeriod = getGenValue('gen_customerPeriod', '1 year');
            const customerLookback = getGenValue('gen_customerLookback', '2 years');
            const employeePeriod = getGenValue('gen_employeePeriod', '1 year');
            const includeEmployeeNonSol = getGenValue('gen_includeEmployeeNonSol');
            const includeConfidentiality = getGenValue('gen_confidentiality');
            const includeReturnProperty = getGenValue('gen_returnProperty');

            const typeLabel = { 'employee': 'Employee', 'contractor': 'Contractor', 'consultant': 'Consultant' }[individualType] || 'Employee';
            const relationshipText = individualType === 'employee' ? 'employment' : 'business relationship';

            let sections = '';
            let sectionNum = 1;

            // Customer Non-Solicitation
            sections += `
                <h2>${sectionNum}. NON-SOLICITATION OF CUSTOMERS</h2>
                <p class="clause">${sectionNum}.1 <strong>Restriction.</strong> During the ${relationshipText} and for a period of <span class="doc-highlight">${customerPeriod}</span> following termination, ${typeLabel} agrees not to directly or indirectly:</p>
                <p class="sub-clause">(a) Solicit any Customer for the purpose of providing competitive products or services;</p>
                <p class="sub-clause">(b) Induce any Customer to reduce or terminate its relationship with Company;</p>
                <p class="sub-clause">(c) Accept business from any Customer.</p>
                <p class="clause">${sectionNum}.2 <strong>Customer Definition.</strong> "Customer" means any person or entity that was a customer during the <span class="doc-highlight">${customerLookback}</span> prior to termination.</p>
            `;
            sectionNum++;

            // Employee Non-Solicitation
            if (includeEmployeeNonSol) {
                sections += `
                    <h2>${sectionNum}. NON-SOLICITATION OF EMPLOYEES</h2>
                    <p class="clause">${sectionNum}.1 For a period of <span class="doc-highlight">${employeePeriod}</span> following termination, ${typeLabel} agrees not to solicit, recruit, or hire any employee or contractor of Company.</p>
                `;
                sectionNum++;
            }

            // Confidentiality
            if (includeConfidentiality) {
                sections += `
                    <h2>${sectionNum}. CONFIDENTIALITY</h2>
                    <p class="clause">${sectionNum}.1 ${typeLabel} agrees to hold all Confidential Information in strict confidence and not disclose it to any third party.</p>
                    <p class="clause">${sectionNum}.2 This obligation survives termination indefinitely for trade secrets and five (5) years for other confidential information.</p>
                `;
                sectionNum++;
            }

            // Return of Property
            if (includeReturnProperty) {
                sections += `
                    <h2>${sectionNum}. RETURN OF PROPERTY</h2>
                    <p class="clause">${sectionNum}.1 Upon termination, ${typeLabel} shall immediately return all Company property and delete all Company information from personal devices.</p>
                `;
                sectionNum++;
            }

            // General Provisions
            sections += `
                <h2>${sectionNum}. GENERAL PROVISIONS</h2>
                <p class="clause">${sectionNum}.1 <strong>Governing Law.</strong> This Agreement shall be governed by the laws of <span class="doc-highlight">${companyState}</span>.</p>
                <p class="clause">${sectionNum}.2 <strong>Severability.</strong> If any provision is unenforceable, it shall be modified to the minimum extent necessary.</p>
                <p class="clause">${sectionNum}.3 <strong>Entire Agreement.</strong> This Agreement constitutes the entire agreement between the parties.</p>
            `;

            return `
                <h1>Non-Solicitation Agreement</h1>
                <p class="center" style="font-style: italic;">Effective Date: <span class="doc-highlight">${effectiveDate}</span></p>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>Company:</strong> <span class="doc-highlight">${companyName}</span>, located at <span class="doc-highlight">${companyAddress}</span></p>
                    <p><strong>${typeLabel}:</strong> <span class="doc-highlight">${individualName}</span>, serving as <span class="doc-highlight">${jobTitle}</span></p>
                </div>

                <p><strong>WHEREAS,</strong> Company has valuable customer relationships and employee resources;</p>
                <p><strong>WHEREAS,</strong> ${typeLabel} will have access to confidential information and relationships;</p>
                <p><strong>NOW, THEREFORE,</strong> the parties agree as follows:</p>

                ${sections}

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>Company</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">Name & Title</div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>${typeLabel}</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line"><span class="doc-highlight">${individualName}</span></div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== COMMISSION AGREEMENT GENERATOR ==========
        function generateCommissionForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>Commission Agreement</h2>
                    <p>Define sales commission structure and payment terms</p>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Company Information</div>
                    <div class="gen-form-group">
                        <label>Company Name</label>
                        <input type="text" id="gen_companyName" placeholder="Sales Corp, Inc." oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>State</label>
                            <select id="gen_companyState" onchange="updateGeneratorPreview()">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Effective Date</label>
                            <input type="date" id="gen_effectiveDate" value="${today}" onchange="updateGeneratorPreview()">
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Salesperson Information</div>
                    <div class="gen-form-group">
                        <label>Salesperson Name</label>
                        <input type="text" id="gen_salespersonName" placeholder="Jane Sales" oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-group">
                        <label>Title/Role</label>
                        <input type="text" id="gen_jobTitle" placeholder="Regional Sales Manager" oninput="updateGeneratorPreview()">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Commission Structure</div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Commission Rate (%)</label>
                            <input type="number" id="gen_commissionRate" placeholder="10" min="0" max="100" step="0.5" oninput="updateGeneratorPreview()">
                        </div>
                        <div class="gen-form-group">
                            <label>Based On</label>
                            <select id="gen_commissionBasis" onchange="updateGeneratorPreview()">
                                <option value="gross sales">Gross Sales</option>
                                <option value="net sales">Net Sales</option>
                                <option value="collected revenue">Collected Revenue</option>
                            </select>
                        </div>
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Payment Frequency</label>
                            <select id="gen_paymentFrequency" onchange="updateGeneratorPreview()">
                                <option value="monthly">Monthly</option>
                                <option value="bi-weekly">Bi-Weekly</option>
                                <option value="quarterly">Quarterly</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Commission Earned When</label>
                            <select id="gen_earnedWhen" onchange="updateGeneratorPreview()">
                                <option value="sale is closed">Sale Closed</option>
                                <option value="payment is received">Payment Received</option>
                                <option value="product is delivered">Product Delivered</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Additional Terms</div>
                    <div class="gen-form-group">
                        <label>Include These Provisions</label>
                        <div class="gen-checkbox-group">
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeClawback" onchange="updateGeneratorPreview()" checked>
                                <span>Clawback Clause</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeTerritory" onchange="updateGeneratorPreview()">
                                <span>Territory</span>
                            </label>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success gen-insert-btn" onclick="insertToEditor()">
                    Insert into Editor →
                </button>
            `;
        }

        function generateCommissionPreview() {
            const companyName = getGenValue('gen_companyName', '[COMPANY NAME]');
            const companyState = getGenValue('gen_companyState', '[STATE]');
            const effectiveDate = formatGenDate(getGenValue('gen_effectiveDate'));
            const salespersonName = getGenValue('gen_salespersonName', '[SALESPERSON NAME]');
            const jobTitle = getGenValue('gen_jobTitle', '[TITLE]');
            const commissionRate = getGenValue('gen_commissionRate', '[RATE]');
            const commissionBasis = getGenValue('gen_commissionBasis', 'gross sales');
            const paymentFrequency = getGenValue('gen_paymentFrequency', 'monthly');
            const earnedWhen = getGenValue('gen_earnedWhen', 'sale is closed');
            const includeClawback = getGenValue('gen_includeClawback');
            const includeTerritory = getGenValue('gen_includeTerritory');

            let sections = '';
            let sectionNum = 1;

            // Commission Structure
            sections += `
                <h2>${sectionNum}. COMMISSION STRUCTURE</h2>
                <p class="clause">${sectionNum}.1 <strong>Commission Rate.</strong> Salesperson shall earn a commission of <span class="doc-highlight">${commissionRate}%</span> of <span class="doc-highlight">${commissionBasis}</span> for all qualifying sales.</p>
                <p class="clause">${sectionNum}.2 <strong>When Earned.</strong> Commission is earned when the <span class="doc-highlight">${earnedWhen}</span>.</p>
                <p class="clause">${sectionNum}.3 <strong>Payment.</strong> Commissions shall be paid <span class="doc-highlight">${paymentFrequency}</span>, within 15 days after the end of each period.</p>
            `;
            sectionNum++;

            // Territory
            if (includeTerritory) {
                sections += `
                    <h2>${sectionNum}. TERRITORY</h2>
                    <p class="clause">${sectionNum}.1 Salesperson's territory shall be defined by Company and may be modified with reasonable notice.</p>
                `;
                sectionNum++;
            }

            // Clawback
            if (includeClawback) {
                sections += `
                    <h2>${sectionNum}. CLAWBACK</h2>
                    <p class="clause">${sectionNum}.1 If a customer returns products, cancels, or receives a refund within 90 days, the commission shall be deducted from future payments.</p>
                    <p class="clause">${sectionNum}.2 If a customer fails to pay within 180 days (bad debt), any commission paid shall be recovered.</p>
                `;
                sectionNum++;
            }

            // General Provisions
            sections += `
                <h2>${sectionNum}. TERM AND TERMINATION</h2>
                <p class="clause">${sectionNum}.1 This Agreement continues until terminated by either party with 14 days written notice.</p>
                <p class="clause">${sectionNum}.2 Upon termination, Salesperson is entitled to commissions earned before the termination date.</p>
            `;
            sectionNum++;

            sections += `
                <h2>${sectionNum}. GENERAL PROVISIONS</h2>
                <p class="clause">${sectionNum}.1 <strong>Governing Law.</strong> This Agreement is governed by the laws of <span class="doc-highlight">${companyState}</span>.</p>
                <p class="clause">${sectionNum}.2 <strong>Entire Agreement.</strong> This constitutes the entire agreement regarding commission compensation.</p>
            `;

            return `
                <h1>Sales Commission Agreement</h1>
                <p class="center" style="font-style: italic;">Effective Date: <span class="doc-highlight">${effectiveDate}</span></p>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>Company:</strong> <span class="doc-highlight">${companyName}</span></p>
                    <p><strong>Salesperson:</strong> <span class="doc-highlight">${salespersonName}</span>, serving as <span class="doc-highlight">${jobTitle}</span></p>
                </div>

                <p><strong>WHEREAS,</strong> Company desires to engage Salesperson to sell its products/services;</p>
                <p><strong>NOW, THEREFORE,</strong> the parties agree as follows:</p>

                ${sections}

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>Company</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">Name & Title</div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>Salesperson</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line"><span class="doc-highlight">${salespersonName}</span></div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== NDA GENERATOR ==========
        function generateNDAForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>Non-Disclosure Agreement</h2>
                    <p>Protect confidential information in business relationships</p>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Agreement Type</div>
                    <div class="gen-form-group">
                        <label>NDA Type</label>
                        <select id="gen_ndaType" onchange="updateGeneratorPreview()">
                            <option value="mutual">Mutual (Two-Way)</option>
                            <option value="unilateral">Unilateral (One-Way)</option>
                        </select>
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Governing State</label>
                            <select id="gen_governingState" onchange="updateGeneratorPreview()">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Effective Date</label>
                            <input type="date" id="gen_effectiveDate" value="${today}" onchange="updateGeneratorPreview()">
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Disclosing Party</div>
                    <div class="gen-form-group">
                        <label>Party Name</label>
                        <input type="text" id="gen_disclosingParty" placeholder="ABC Corporation" oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-group">
                        <label>Address</label>
                        <input type="text" id="gen_disclosingAddress" placeholder="123 Main St, City, State ZIP" oninput="updateGeneratorPreview()">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Receiving Party</div>
                    <div class="gen-form-group">
                        <label>Party Name</label>
                        <input type="text" id="gen_receivingParty" placeholder="XYZ Company" oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-group">
                        <label>Address</label>
                        <input type="text" id="gen_receivingAddress" placeholder="456 Oak Ave, City, State ZIP" oninput="updateGeneratorPreview()">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Agreement Terms</div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Purpose of Disclosure</label>
                            <select id="gen_purpose" onchange="updateGeneratorPreview()">
                                <option value="evaluating a potential business relationship">Evaluating Business Relationship</option>
                                <option value="discussing a potential partnership">Potential Partnership</option>
                                <option value="evaluating potential investment">Investment Discussions</option>
                                <option value="evaluating potential acquisition">M&A Discussions</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Term (Years)</label>
                            <select id="gen_termYears" onchange="updateGeneratorPreview()">
                                <option value="1">1 Year</option>
                                <option value="2" selected>2 Years</option>
                                <option value="3">3 Years</option>
                                <option value="5">5 Years</option>
                            </select>
                        </div>
                    </div>
                    <div class="gen-form-group">
                        <label>Survival Period After Termination</label>
                        <select id="gen_survivalYears" onchange="updateGeneratorPreview()">
                            <option value="2">2 Years</option>
                            <option value="3" selected>3 Years</option>
                            <option value="5">5 Years</option>
                        </select>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Additional Provisions</div>
                    <div class="gen-form-group">
                        <div class="gen-checkbox-group">
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeNonSolicitation" onchange="updateGeneratorPreview()">
                                <span>Non-Solicitation</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeNonCircumvent" onchange="updateGeneratorPreview()" checked>
                                <span>Non-Circumvention</span>
                            </label>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success gen-insert-btn" onclick="insertToEditor()">
                    Insert into Editor →
                </button>
            `;
        }

        function generateNDAPreview() {
            const ndaType = getGenValue('gen_ndaType', 'mutual');
            const governingState = getGenValue('gen_governingState', '[STATE]');
            const effectiveDate = formatGenDate(getGenValue('gen_effectiveDate'));
            const disclosingParty = getGenValue('gen_disclosingParty', '[DISCLOSING PARTY]');
            const disclosingAddress = getGenValue('gen_disclosingAddress', '[ADDRESS]');
            const receivingParty = getGenValue('gen_receivingParty', '[RECEIVING PARTY]');
            const receivingAddress = getGenValue('gen_receivingAddress', '[ADDRESS]');
            const purpose = getGenValue('gen_purpose', 'evaluating a potential business relationship');
            const termYears = getGenValue('gen_termYears', '2');
            const survivalYears = getGenValue('gen_survivalYears', '3');
            const includeNonSolicitation = getGenValue('gen_includeNonSolicitation');
            const includeNonCircumvent = getGenValue('gen_includeNonCircumvent');

            const isMutual = ndaType === 'mutual';
            const partyRef = isMutual ? 'Each party' : 'Receiving Party';
            const obligationText = isMutual ? 'The parties agree' : 'Receiving Party agrees';

            let sections = '';
            let sectionNum = 1;

            // Definition
            sections += `
                <h2>${sectionNum}. DEFINITION OF CONFIDENTIAL INFORMATION</h2>
                <p class="clause">${sectionNum}.1 "Confidential Information" means any non-public information disclosed by ${isMutual ? 'either party' : 'Disclosing Party'}, whether orally, in writing, or electronically, that is designated as confidential or should reasonably be understood to be confidential.</p>
                <p class="clause">${sectionNum}.2 Confidential Information includes, but is not limited to: trade secrets, business plans, customer lists, financial data, technical specifications, and proprietary methodologies.</p>
            `;
            sectionNum++;

            // Obligations
            sections += `
                <h2>${sectionNum}. OBLIGATIONS</h2>
                <p class="clause">${sectionNum}.1 ${obligationText} to hold all Confidential Information in strict confidence and not disclose it to any third party without prior written consent.</p>
                <p class="clause">${sectionNum}.2 ${partyRef} shall use Confidential Information solely for the purpose of <span class="doc-highlight">${purpose}</span>.</p>
                <p class="clause">${sectionNum}.3 ${partyRef} shall protect Confidential Information using the same degree of care used to protect its own confidential information, but no less than reasonable care.</p>
            `;
            sectionNum++;

            // Exclusions
            sections += `
                <h2>${sectionNum}. EXCLUSIONS</h2>
                <p class="clause">Confidential Information does not include information that:</p>
                <p class="sub-clause">(a) Is or becomes publicly available through no fault of the receiving party;</p>
                <p class="sub-clause">(b) Was known to the receiving party prior to disclosure;</p>
                <p class="sub-clause">(c) Is independently developed without use of Confidential Information;</p>
                <p class="sub-clause">(d) Is rightfully obtained from a third party without restriction.</p>
            `;
            sectionNum++;

            // Non-Circumvention
            if (includeNonCircumvent) {
                sections += `
                    <h2>${sectionNum}. NON-CIRCUMVENTION</h2>
                    <p class="clause">${sectionNum}.1 ${partyRef} agrees not to circumvent, avoid, or bypass the other party to deal directly with any contacts, sources, or opportunities disclosed under this Agreement.</p>
                `;
                sectionNum++;
            }

            // Non-Solicitation
            if (includeNonSolicitation) {
                sections += `
                    <h2>${sectionNum}. NON-SOLICITATION</h2>
                    <p class="clause">${sectionNum}.1 During the term and for one (1) year thereafter, ${partyRef.toLowerCase()} agrees not to solicit or hire any employees of the other party with whom they had contact during discussions.</p>
                `;
                sectionNum++;
            }

            // Term
            sections += `
                <h2>${sectionNum}. TERM</h2>
                <p class="clause">${sectionNum}.1 This Agreement shall remain in effect for <span class="doc-highlight">${termYears} year${termYears > 1 ? 's' : ''}</span> from the Effective Date.</p>
                <p class="clause">${sectionNum}.2 Confidentiality obligations shall survive termination for <span class="doc-highlight">${survivalYears} years</span>, except for trade secrets which shall be protected indefinitely.</p>
            `;
            sectionNum++;

            // Return of Materials
            sections += `
                <h2>${sectionNum}. RETURN OF MATERIALS</h2>
                <p class="clause">${sectionNum}.1 Upon termination or request, ${partyRef.toLowerCase()} shall promptly return or destroy all Confidential Information and provide written certification of destruction.</p>
            `;
            sectionNum++;

            // General
            sections += `
                <h2>${sectionNum}. GENERAL PROVISIONS</h2>
                <p class="clause">${sectionNum}.1 <strong>Governing Law.</strong> This Agreement shall be governed by the laws of <span class="doc-highlight">${governingState}</span>.</p>
                <p class="clause">${sectionNum}.2 <strong>Injunctive Relief.</strong> The parties acknowledge that breach may cause irreparable harm and agree that injunctive relief shall be available without the need to post bond.</p>
                <p class="clause">${sectionNum}.3 <strong>Entire Agreement.</strong> This Agreement constitutes the entire agreement regarding confidentiality and supersedes all prior discussions.</p>
            `;

            return `
                <h1>${isMutual ? 'Mutual ' : ''}Non-Disclosure Agreement</h1>
                <p class="center" style="font-style: italic;">Effective Date: <span class="doc-highlight">${effectiveDate}</span></p>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>${isMutual ? 'Party A' : 'Disclosing Party'}:</strong> <span class="doc-highlight">${disclosingParty}</span>, located at <span class="doc-highlight">${disclosingAddress}</span></p>
                    <p><strong>${isMutual ? 'Party B' : 'Receiving Party'}:</strong> <span class="doc-highlight">${receivingParty}</span>, located at <span class="doc-highlight">${receivingAddress}</span></p>
                </div>

                <p><strong>WHEREAS,</strong> the parties wish to explore <span class="doc-highlight">${purpose}</span>;</p>
                <p><strong>WHEREAS,</strong> such discussions may require the disclosure of confidential information;</p>
                <p><strong>NOW, THEREFORE,</strong> the parties agree as follows:</p>

                ${sections}

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>${isMutual ? 'Party A' : 'Disclosing Party'}</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line"><span class="doc-highlight">${disclosingParty}</span></div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>${isMutual ? 'Party B' : 'Receiving Party'}</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line"><span class="doc-highlight">${receivingParty}</span></div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== PIIA GENERATOR ==========
        function generatePIIAForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>PIIA (Inventions Assignment)</h2>
                    <p>Proprietary Information and Inventions Assignment Agreement</p>
                </div>

                <div class="gen-info-box">
                    <strong>Standard for Tech Companies</strong><br>
                    This agreement assigns employee inventions and protects company IP.
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Company Information</div>
                    <div class="gen-form-group">
                        <label>Company Name</label>
                        <input type="text" id="gen_companyName" placeholder="Tech Corp, Inc." oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>State</label>
                            <select id="gen_companyState" onchange="updateGeneratorPreview()">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Delaware">Delaware</option>
                                <option value="Florida">Florida</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Effective Date</label>
                            <input type="date" id="gen_effectiveDate" value="${today}" onchange="updateGeneratorPreview()">
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Employee Information</div>
                    <div class="gen-form-group">
                        <label>Employee Name</label>
                        <input type="text" id="gen_employeeName" placeholder="John Developer" oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-group">
                        <label>Position/Title</label>
                        <input type="text" id="gen_jobTitle" placeholder="Software Engineer" oninput="updateGeneratorPreview()">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Assignment Scope</div>
                    <div class="gen-form-group">
                        <label>Include These Provisions</label>
                        <div class="gen-checkbox-group">
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeConfidentiality" onchange="updateGeneratorPreview()" checked>
                                <span>Confidentiality</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeWorkProduct" onchange="updateGeneratorPreview()" checked>
                                <span>Work Product</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_includeNonSolicitation" onchange="updateGeneratorPreview()">
                                <span>Non-Solicitation</span>
                            </label>
                        </div>
                    </div>
                    <div class="gen-form-group">
                        <label>Prior Inventions (if any)</label>
                        <textarea id="gen_priorInventions" rows="2" placeholder="List any prior inventions to exclude..." oninput="updateGeneratorPreview()"></textarea>
                    </div>
                </div>

                <button class="btn btn-success gen-insert-btn" onclick="insertToEditor()">
                    Insert into Editor →
                </button>
            `;
        }

        function generatePIIAPreview() {
            const companyName = getGenValue('gen_companyName', '[COMPANY NAME]');
            const companyState = getGenValue('gen_companyState', '[STATE]');
            const effectiveDate = formatGenDate(getGenValue('gen_effectiveDate'));
            const employeeName = getGenValue('gen_employeeName', '[EMPLOYEE NAME]');
            const jobTitle = getGenValue('gen_jobTitle', '[TITLE]');
            const includeConfidentiality = getGenValue('gen_includeConfidentiality');
            const includeWorkProduct = getGenValue('gen_includeWorkProduct');
            const includeNonSolicitation = getGenValue('gen_includeNonSolicitation');
            const priorInventions = getGenValue('gen_priorInventions', '');

            let sections = '';
            let sectionNum = 1;

            // Confidentiality
            if (includeConfidentiality) {
                sections += `
                    <h2>${sectionNum}. CONFIDENTIAL INFORMATION</h2>
                    <p class="clause">${sectionNum}.1 <strong>Definition.</strong> "Confidential Information" means all non-public information relating to Company's business, including trade secrets, technical data, customer information, business strategies, and financial information.</p>
                    <p class="clause">${sectionNum}.2 <strong>Non-Disclosure.</strong> Employee agrees to hold Confidential Information in strict confidence and not disclose it to any third party during or after employment.</p>
                    <p class="clause">${sectionNum}.3 <strong>Non-Use.</strong> Employee shall use Confidential Information solely for Company's benefit and not for personal gain or for any other entity.</p>
                `;
                sectionNum++;
            }

            // Inventions Assignment
            sections += `
                <h2>${sectionNum}. ASSIGNMENT OF INVENTIONS</h2>
                <p class="clause">${sectionNum}.1 <strong>Work Product Assignment.</strong> Employee hereby assigns to Company all right, title, and interest in any Invention that:</p>
                <p class="sub-clause">(a) Is developed using Company equipment, supplies, or facilities;</p>
                <p class="sub-clause">(b) Results from work performed for Company;</p>
                <p class="sub-clause">(c) Relates to Company's business or actual/anticipated research.</p>
                <p class="clause">${sectionNum}.2 <strong>Definition.</strong> "Invention" includes all inventions, discoveries, improvements, ideas, works of authorship, designs, and trade secrets.</p>
                <p class="clause">${sectionNum}.3 <strong>Disclosure.</strong> Employee shall promptly disclose all Inventions to Company in writing.</p>
                <p class="clause">${sectionNum}.4 <strong>Further Assistance.</strong> Employee agrees to execute any documents and take any actions necessary to perfect Company's ownership of Inventions.</p>
            `;
            sectionNum++;

            // Work Product
            if (includeWorkProduct) {
                sections += `
                    <h2>${sectionNum}. WORK MADE FOR HIRE</h2>
                    <p class="clause">${sectionNum}.1 All copyrightable works created within the scope of employment shall be considered "work made for hire" under the Copyright Act.</p>
                    <p class="clause">${sectionNum}.2 To the extent any work does not qualify as work made for hire, Employee hereby assigns all copyright rights to Company.</p>
                `;
                sectionNum++;
            }

            // Prior Inventions
            sections += `
                <h2>${sectionNum}. PRIOR INVENTIONS</h2>
                <p class="clause">${sectionNum}.1 The following prior inventions are excluded from this Agreement: ${priorInventions ? `<span class="doc-highlight">${priorInventions}</span>` : '<span class="doc-highlight">[None]</span>'}</p>
                <p class="clause">${sectionNum}.2 If no prior inventions are listed, Employee represents that no such prior inventions exist.</p>
            `;
            sectionNum++;

            // Non-Solicitation
            if (includeNonSolicitation) {
                sections += `
                    <h2>${sectionNum}. NON-SOLICITATION</h2>
                    <p class="clause">${sectionNum}.1 For one (1) year following termination, Employee agrees not to solicit or recruit any Company employees or contractors.</p>
                `;
                sectionNum++;
            }

            // Return of Property
            sections += `
                <h2>${sectionNum}. RETURN OF PROPERTY</h2>
                <p class="clause">${sectionNum}.1 Upon termination, Employee shall immediately return all Company property, including documents, files, equipment, and all copies of Confidential Information.</p>
                <p class="clause">${sectionNum}.2 Employee shall delete all Company information from personal devices and accounts.</p>
            `;
            sectionNum++;

            // General
            sections += `
                <h2>${sectionNum}. GENERAL PROVISIONS</h2>
                <p class="clause">${sectionNum}.1 <strong>Governing Law.</strong> This Agreement is governed by the laws of <span class="doc-highlight">${companyState}</span>.</p>
                <p class="clause">${sectionNum}.2 <strong>Injunctive Relief.</strong> Employee acknowledges that breach may cause irreparable harm and agrees that injunctive relief is appropriate.</p>
                <p class="clause">${sectionNum}.3 <strong>Survival.</strong> Confidentiality and assignment obligations survive termination of employment.</p>
            `;

            return `
                <h1>Proprietary Information and Inventions Assignment Agreement</h1>
                <p class="center" style="font-style: italic;">Effective Date: <span class="doc-highlight">${effectiveDate}</span></p>

                <div class="parties">
                    <p>This Agreement is entered into by:</p>
                    <p><strong>Company:</strong> <span class="doc-highlight">${companyName}</span></p>
                    <p><strong>Employee:</strong> <span class="doc-highlight">${employeeName}</span>, serving as <span class="doc-highlight">${jobTitle}</span></p>
                </div>

                <p><strong>WHEREAS,</strong> Company possesses valuable proprietary information and trade secrets;</p>
                <p><strong>WHEREAS,</strong> Employee will have access to and may develop confidential information during employment;</p>
                <p><strong>NOW, THEREFORE,</strong> in consideration of employment and other good and valuable consideration, the parties agree:</p>

                ${sections}

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>Company</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line">Name & Title</div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>Employee</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line"><span class="doc-highlight">${employeeName}</span></div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== SUBLEASE GENERATOR ==========
        function generateSubleaseForm() {
            const today = new Date().toISOString().split('T')[0];
            return `
                <div class="gen-form-header">
                    <h2>Sublease Agreement</h2>
                    <p>Sublease residential or commercial property to a subtenant</p>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Property Information</div>
                    <div class="gen-form-group">
                        <label>Property Address</label>
                        <input type="text" id="gen_propertyAddress" placeholder="123 Main St, Apt 4B, City, State ZIP" oninput="updateGeneratorPreview()">
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Property Type</label>
                            <select id="gen_propertyType" onchange="updateGeneratorPreview()">
                                <option value="residential">Residential</option>
                                <option value="commercial">Commercial</option>
                            </select>
                        </div>
                        <div class="gen-form-group">
                            <label>Governing State</label>
                            <select id="gen_governingState" onchange="updateGeneratorPreview()">
                                <option value="">Select...</option>
                                <option value="California">California</option>
                                <option value="Florida">Florida</option>
                                <option value="New York">New York</option>
                                <option value="Texas">Texas</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Original Tenant (Sublessor)</div>
                    <div class="gen-form-group">
                        <label>Sublessor Name</label>
                        <input type="text" id="gen_sublessorName" placeholder="Current Tenant Name" oninput="updateGeneratorPreview()">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">New Tenant (Sublessee)</div>
                    <div class="gen-form-group">
                        <label>Sublessee Name</label>
                        <input type="text" id="gen_sublesseeName" placeholder="New Subtenant Name" oninput="updateGeneratorPreview()">
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Lease Terms</div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Start Date</label>
                            <input type="date" id="gen_startDate" value="${today}" onchange="updateGeneratorPreview()">
                        </div>
                        <div class="gen-form-group">
                            <label>End Date</label>
                            <input type="date" id="gen_endDate" onchange="updateGeneratorPreview()">
                        </div>
                    </div>
                    <div class="gen-form-row">
                        <div class="gen-form-group">
                            <label>Monthly Rent ($)</label>
                            <input type="number" id="gen_monthlyRent" placeholder="1500" oninput="updateGeneratorPreview()">
                        </div>
                        <div class="gen-form-group">
                            <label>Security Deposit ($)</label>
                            <input type="number" id="gen_securityDeposit" placeholder="1500" oninput="updateGeneratorPreview()">
                        </div>
                    </div>
                    <div class="gen-form-group">
                        <label>Rent Due Day</label>
                        <select id="gen_rentDueDay" onchange="updateGeneratorPreview()">
                            <option value="1st">1st of each month</option>
                            <option value="15th">15th of each month</option>
                        </select>
                    </div>
                </div>

                <div class="gen-form-section">
                    <div class="gen-section-title">Additional Terms</div>
                    <div class="gen-form-group">
                        <div class="gen-checkbox-group">
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_utilitiesIncluded" onchange="updateGeneratorPreview()">
                                <span>Utilities Included</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_petsAllowed" onchange="updateGeneratorPreview()">
                                <span>Pets Allowed</span>
                            </label>
                            <label class="gen-checkbox-label">
                                <input type="checkbox" id="gen_furnished" onchange="updateGeneratorPreview()">
                                <span>Furnished</span>
                            </label>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success gen-insert-btn" onclick="insertToEditor()">
                    Insert into Editor →
                </button>
            `;
        }

        function generateSubleasePreview() {
            const propertyAddress = getGenValue('gen_propertyAddress', '[PROPERTY ADDRESS]');
            const propertyType = getGenValue('gen_propertyType', 'residential');
            const governingState = getGenValue('gen_governingState', '[STATE]');
            const sublessorName = getGenValue('gen_sublessorName', '[SUBLESSOR NAME]');
            const sublesseeName = getGenValue('gen_sublesseeName', '[SUBLESSEE NAME]');
            const startDate = formatGenDate(getGenValue('gen_startDate'));
            const endDate = formatGenDate(getGenValue('gen_endDate'));
            const monthlyRent = getGenValue('gen_monthlyRent', '[AMOUNT]');
            const securityDeposit = getGenValue('gen_securityDeposit', '[AMOUNT]');
            const rentDueDay = getGenValue('gen_rentDueDay', '1st');
            const utilitiesIncluded = getGenValue('gen_utilitiesIncluded');
            const petsAllowed = getGenValue('gen_petsAllowed');
            const furnished = getGenValue('gen_furnished');

            const isResidential = propertyType === 'residential';
            let sectionNum = 1;
            let sections = '';

            // Premises
            sections += `
                <h2>${sectionNum}. PREMISES</h2>
                <p class="clause">${sectionNum}.1 Sublessor agrees to sublease to Sublessee the ${isResidential ? 'residential' : 'commercial'} property located at:</p>
                <p class="sub-clause"><span class="doc-highlight">${propertyAddress}</span></p>
                <p class="clause">${sectionNum}.2 The premises are subleased ${furnished ? '<span class="doc-highlight">furnished</span>' : 'unfurnished'}.</p>
            `;
            sectionNum++;

            // Term
            sections += `
                <h2>${sectionNum}. TERM</h2>
                <p class="clause">${sectionNum}.1 The sublease term begins on <span class="doc-highlight">${startDate}</span> and ends on <span class="doc-highlight">${endDate}</span>.</p>
                <p class="clause">${sectionNum}.2 This sublease is subject to the terms of the original lease between Sublessor and Landlord.</p>
            `;
            sectionNum++;

            // Rent
            sections += `
                <h2>${sectionNum}. RENT</h2>
                <p class="clause">${sectionNum}.1 Sublessee agrees to pay monthly rent of <span class="doc-highlight">$${monthlyRent}</span>.</p>
                <p class="clause">${sectionNum}.2 Rent is due on the <span class="doc-highlight">${rentDueDay}</span> of each month.</p>
                <p class="clause">${sectionNum}.3 Rent shall be paid to Sublessor by check, electronic transfer, or other agreed method.</p>
                <p class="clause">${sectionNum}.4 Late payments after the 5th day shall incur a late fee of 5% of monthly rent.</p>
            `;
            sectionNum++;

            // Security Deposit
            sections += `
                <h2>${sectionNum}. SECURITY DEPOSIT</h2>
                <p class="clause">${sectionNum}.1 Sublessee shall pay a security deposit of <span class="doc-highlight">$${securityDeposit}</span> upon execution of this Agreement.</p>
                <p class="clause">${sectionNum}.2 The deposit shall be returned within 30 days after the sublease ends, less any deductions for damages or unpaid rent.</p>
            `;
            sectionNum++;

            // Utilities
            sections += `
                <h2>${sectionNum}. UTILITIES</h2>
                <p class="clause">${sectionNum}.1 ${utilitiesIncluded ? '<span class="doc-highlight">Utilities are included</span> in the monthly rent (water, electricity, gas, internet).' : 'Sublessee is responsible for <span class="doc-highlight">all utilities</span> including water, electricity, gas, and internet.'}</p>
            `;
            sectionNum++;

            // Use and Restrictions
            sections += `
                <h2>${sectionNum}. USE OF PREMISES</h2>
                <p class="clause">${sectionNum}.1 The premises shall be used solely for ${isResidential ? 'residential purposes' : 'lawful commercial purposes as described in the original lease'}.</p>
                <p class="clause">${sectionNum}.2 Sublessee shall not engage in any illegal activities on the premises.</p>
                <p class="clause">${sectionNum}.3 ${petsAllowed ? '<span class="doc-highlight">Pets are allowed</span> with prior written consent and may require an additional pet deposit.' : '<span class="doc-highlight">No pets</span> are allowed without prior written consent.'}</p>
            `;
            sectionNum++;

            // Maintenance
            sections += `
                <h2>${sectionNum}. MAINTENANCE</h2>
                <p class="clause">${sectionNum}.1 Sublessee shall maintain the premises in good condition and promptly report any needed repairs.</p>
                <p class="clause">${sectionNum}.2 Sublessee is responsible for minor repairs under $100.</p>
            `;
            sectionNum++;

            // Landlord Consent
            sections += `
                <h2>${sectionNum}. LANDLORD CONSENT</h2>
                <p class="clause">${sectionNum}.1 Sublessor represents that they have obtained written consent from the Landlord for this sublease, or that such consent is not required under the original lease.</p>
            `;
            sectionNum++;

            // General
            sections += `
                <h2>${sectionNum}. GENERAL PROVISIONS</h2>
                <p class="clause">${sectionNum}.1 <strong>Governing Law.</strong> This Agreement is governed by the laws of <span class="doc-highlight">${governingState}</span>.</p>
                <p class="clause">${sectionNum}.2 <strong>Original Lease.</strong> Sublessee agrees to comply with all terms of the original lease.</p>
                <p class="clause">${sectionNum}.3 <strong>Entire Agreement.</strong> This constitutes the entire sublease agreement between the parties.</p>
            `;

            return `
                <h1>Sublease Agreement</h1>

                <div class="parties">
                    <p>This Sublease Agreement is entered into by:</p>
                    <p><strong>Sublessor (Original Tenant):</strong> <span class="doc-highlight">${sublessorName}</span></p>
                    <p><strong>Sublessee (New Tenant):</strong> <span class="doc-highlight">${sublesseeName}</span></p>
                </div>

                <p><strong>WHEREAS,</strong> Sublessor is the tenant under a lease agreement for the property described below;</p>
                <p><strong>WHEREAS,</strong> Sublessor wishes to sublease the property to Sublessee;</p>
                <p><strong>NOW, THEREFORE,</strong> the parties agree as follows:</p>

                ${sections}

                <div class="signature-block">
                    <div class="signature-party">
                        <h3>Sublessor</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line"><span class="doc-highlight">${sublessorName}</span></div>
                        <div class="signature-line">Date</div>
                    </div>
                    <div class="signature-party">
                        <h3>Sublessee</h3>
                        <div class="signature-line">Signature</div>
                        <div class="signature-line"><span class="doc-highlight">${sublesseeName}</span></div>
                        <div class="signature-line">Date</div>
                    </div>
                </div>
            `;
        }

        // ========== FIREBASE & COLLABORATION ==========
        const firebaseConfig = {
            apiKey: "AIzaSyCeACvK3MVTOOaWY4SWG1yNnrcA9ILkkaM",
            authDomain: "termsdocs.firebaseapp.com",
            databaseURL: "https://termsdocs-default-rtdb.firebaseio.com",
            projectId: "termsdocs",
            storageBucket: "termsdocs.firebasestorage.app",
            messagingSenderId: "62791617178",
            appId: "1:62791617178:web:ff79f24f40cc98e88aed23",
            measurementId: "G-PBGF06LDTM"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let userName = '';
        let userColor = '';
        let roomId = '';
        let myUserId = '';
        let contentRef, usersRef, myUserRef, metaRef;
        let isLocalUpdate = false;
        let saveTimeout = null;
        const userColors = ['#ef4444', '#3b82f6', '#22c55e', '#f59e0b', '#8b5cf6', '#ec4899'];

        // Templates (for Edit mode)
        const templates = {
            blank: '',
            stripe: `[YOUR COMPANY NAME]
[YOUR ADDRESS]
[CITY], [STATE] [ZIP]
[PHONE]
[EMAIL]

[DATE]

VIA CERTIFIED MAIL & EMAIL
complaints@stripe.com

Legal Department
Stripe, Inc.
354 Oyster Point Boulevard
South San Francisco, CA 94080

Re: [YOUR COMPANY NAME] - Demand for Release of Withheld Funds
    Account ID: [YOUR STRIPE ACCOUNT ID]
    Amount at Issue: $[AMOUNT]

To Whom It May Concern:

This letter serves as formal notice pursuant to Section 13.3(a) of the Stripe Services Agreement ("SSA") of my intent to commence arbitration proceedings against Stripe, Inc. and Stripe Payments Company unless this matter is resolved within 30 days.

[Continue with your specific details...]`,
            nda: `MUTUAL NON-DISCLOSURE AGREEMENT

This Mutual Non-Disclosure Agreement ("Agreement") is entered into as of [DATE] by and between:

Party A: [PARTY A NAME]
Party B: [PARTY B NAME]

1. DEFINITION OF CONFIDENTIAL INFORMATION
"Confidential Information" means any information disclosed by one party to the other that is designated as confidential or should reasonably be understood to be confidential.

2. OBLIGATIONS
Each party agrees to hold confidential information in strict confidence and not disclose it to third parties.

3. TERM
This Agreement shall remain in effect for [DURATION] years.

[Signatures]`,
            llc: `OPERATING AGREEMENT OF [LLC NAME], LLC

This Operating Agreement is entered into as of [DATE].

ARTICLE I - ORGANIZATION
1.1 Name: [LLC NAME], LLC
1.2 Principal Office: [ADDRESS]

ARTICLE II - MEMBERS
Name: [MEMBER NAME]
Contribution: $[AMOUNT]
Ownership: [PERCENTAGE]%

ARTICLE III - MANAGEMENT
The Company shall be member-managed.

[Continue with additional provisions...]`
        };

        // Get or create room ID
        const urlParams = new URLSearchParams(window.location.search);
        roomId = urlParams.get('room');
        if (!roomId) {
            roomId = Math.random().toString(36).substring(2, 14);
            window.history.replaceState({}, '', `?room=${roomId}`);
        }

        myUserId = Math.random().toString(36).substring(2, 10);

        const savedName = localStorage.getItem('terms-law-name');
        if (savedName) document.getElementById('userName').value = savedName;

        // Event listeners
        document.getElementById('userName').addEventListener('keypress', e => {
            if (e.key === 'Enter') joinSession();
        });
        document.getElementById('joinBtn').addEventListener('click', joinSession);
        document.getElementById('copyBtn').addEventListener('click', copyLink);
        document.getElementById('newBtn').addEventListener('click', () => {
            window.location.href = `?room=${Math.random().toString(36).substring(2, 14)}`;
        });
        document.getElementById('templateBtn').addEventListener('click', () => {
            document.getElementById('templateModal').classList.remove('hidden');
        });
        document.getElementById('cancelTemplateBtn').addEventListener('click', () => {
            document.getElementById('templateModal').classList.add('hidden');
        });

        document.querySelectorAll('.template-card').forEach(card => {
            card.addEventListener('click', () => {
                const templateKey = card.dataset.template;
                const editor = document.getElementById('editor');
                if (templates[templateKey] !== undefined) {
                    editor.value = templates[templateKey];
                    updateContent();
                }
                document.getElementById('templateModal').classList.add('hidden');
                showToast('Template loaded!');
            });
        });

        function joinSession() {
            userName = document.getElementById('userName').value.trim();
            if (!userName) return document.getElementById('userName').focus();

            localStorage.setItem('terms-law-name', userName);
            userColor = userColors[Math.floor(Math.random() * userColors.length)];
            document.getElementById('joinModal').classList.add('hidden');

            initFirebase();
        }

        function initFirebase() {
            contentRef = db.ref(`rooms/${roomId}/content`);
            usersRef = db.ref(`rooms/${roomId}/users`);
            metaRef = db.ref(`rooms/${roomId}/meta`);
            myUserRef = usersRef.child(myUserId);

            const editor = document.getElementById('editor');
            const sessionNameInput = document.getElementById('sessionName');

            myUserRef.set({
                name: userName,
                color: userColor,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            });

            myUserRef.onDisconnect().remove();

            contentRef.on('value', (snapshot) => {
                if (isLocalUpdate) return;
                const content = snapshot.val() || '';
                const cursorPos = editor.selectionStart;
                editor.value = content;
                editor.setSelectionRange(Math.min(cursorPos, content.length), Math.min(cursorPos, content.length));
            });

            metaRef.child('name').on('value', (snapshot) => {
                const name = snapshot.val();
                if (name && document.activeElement !== sessionNameInput) {
                    sessionNameInput.value = name;
                }
            });

            usersRef.on('value', (snapshot) => {
                updateUsers(snapshot.val() || {});
            });

            db.ref('.info/connected').on('value', (snapshot) => {
                const connected = snapshot.val();
                document.getElementById('statusDot').classList.toggle('connected', connected);
                document.getElementById('statusText').textContent = connected ? 'Connected' : 'Connecting...';
                if (connected) showToast(`Joined as ${userName}`);
            });

            editor.addEventListener('input', updateContent);
            sessionNameInput.addEventListener('input', () => {
                metaRef.child('name').set(sessionNameInput.value);
            });
        }

        function updateContent() {
            const editor = document.getElementById('editor');
            const saveStatus = document.getElementById('saveStatus');

            saveStatus.innerHTML = '<span>Saving...</span>';
            saveStatus.className = 'save-status saving';

            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                isLocalUpdate = true;
                contentRef.set(editor.value).then(() => {
                    isLocalUpdate = false;
                    saveStatus.innerHTML = '<span>All changes saved</span>';
                    saveStatus.className = 'save-status saved';
                });
            }, 100);
        }

        function updateUsers(users) {
            const userList = document.getElementById('userList');
            userList.innerHTML = '';
            const userEntries = Object.entries(users);

            if (userEntries.length === 0) {
                userList.innerHTML = '<span style="color:#9ca3af;">Waiting...</span>';
                return;
            }

            userEntries.forEach(([id, user]) => {
                const isYou = id === myUserId;
                const badge = document.createElement('div');
                badge.className = `user-badge${isYou ? ' you' : ''}`;
                badge.innerHTML = `<span class="dot" style="background:${user.color}"></span>
                    <span>${user.name}${isYou ? ' (you)' : ''}</span>`;
                userList.appendChild(badge);
            });
        }

        function copyLink() {
            navigator.clipboard.writeText(window.location.href)
                .then(() => showToast('Link copied!'))
                .catch(() => prompt('Copy:', window.location.href));
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        window.addEventListener('beforeunload', () => {
            if (myUserRef) myUserRef.remove();
        });
    </script>
</body>
</html>
