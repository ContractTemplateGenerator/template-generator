<!DOCTYPE html>
<html lang="ru">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-901N2Y3CDZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-901N2Y3CDZ');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор подоходного налога Таиланда для экспатов | Калькулятор НДФЛ и налога на переводы | Terms.Law</title>
    <meta name="description" content="Рассчитайте ваш подоходный налог в Таиланде как экспат. Включает прогрессивные налоговые ставки, правила налогообложения переводов (изменения 2024), льготы LTR визы, анализ налоговых соглашений и сравнение резидент/нерезидент.">
    <link rel="canonical" href="https://terms.law/Thai/ru/tools/tax-calculator.html">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --thai-red: #EF3340;
            --thai-red-light: #ff4d5a;
            --thai-red-dark: #A51931;
            --thai-blue: #00205B;
            --thai-blue-light: #1a3a7a;
            --thai-blue-dark: #001845;
            --thai-white: #ffffff;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --info: #3b82f6;
            --info-light: #dbeafe;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }
        h2[id], h3[id] { scroll-margin-top: 100px; }

        body {
            font-family: 'Inter', system-ui, sans-serif;
            background: var(--gray-50);
            color: var(--gray-800);
            line-height: 1.7;
        }

        /* Breadcrumbs */
        .breadcrumbs {
            background: var(--gray-100);
            padding: 12px 24px;
            border-bottom: 1px solid var(--gray-200);
        }

        .breadcrumbs-content {
            max-width: 1100px;
            margin: 0 auto;
            font-size: 0.9rem;
            color: var(--gray-600);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .breadcrumbs a {
            color: var(--thai-blue);
            text-decoration: none;
        }

        .breadcrumbs a:hover {
            text-decoration: underline;
        }

        .breadcrumbs span {
            margin: 0 8px;
            color: var(--gray-400);
        }

        .lang-selector {
            display: flex;
            gap: 8px;
            font-size: 1.2rem;
        }

        .lang-selector a {
            text-decoration: none;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .lang-selector a:hover {
            opacity: 1;
        }

        .lang-selector .active {
            opacity: 1;
        }

        /* Container */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 40px 24px 80px;
        }

        /* Header */
        .page-header {
            margin-bottom: 40px;
            text-align: center;
        }

        .page-header h1 {
            font-size: 2.2rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 12px;
        }

        .page-header p {
            font-size: 1.1rem;
            color: var(--gray-600);
            max-width: 700px;
            margin: 0 auto;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn:hover {
            border-color: var(--thai-blue);
            color: var(--thai-blue);
        }

        .tab-btn.active {
            background: var(--thai-blue);
            border-color: var(--thai-blue);
            color: white;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Card */
        .form-card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            border: 1px solid var(--gray-200);
            margin-bottom: 32px;
        }

        .form-section {
            margin-bottom: 28px;
        }

        .form-section:last-of-type {
            margin-bottom: 0;
        }

        .form-section h2 {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--thai-blue);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--thai-red);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--thai-blue);
        }

        .form-group small {
            display: block;
            margin-top: 6px;
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .input-with-prefix {
            position: relative;
        }

        .input-prefix {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-500);
            font-weight: 500;
        }

        .input-with-prefix input {
            padding-left: 50px;
        }

        .currency-row {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .currency-row .form-group:first-child {
            flex: 2;
        }

        .currency-row .form-group:last-child {
            flex: 1;
        }

        /* Toggle Switch */
        .toggle-group {
            display: flex;
            background: var(--gray-100);
            border-radius: 8px;
            padding: 4px;
        }

        .toggle-option {
            flex: 1;
            text-align: center;
        }

        .toggle-option input {
            display: none;
        }

        .toggle-option label {
            display: block;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
            margin-bottom: 0;
        }

        .toggle-option input:checked + label {
            background: var(--thai-blue);
            color: white;
        }

        /* Deductions Grid */
        .deductions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
        }

        .deduction-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--gray-50);
            border-radius: 8px;
            border: 1px solid var(--gray-200);
        }

        .deduction-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .deduction-item label {
            flex: 1;
            font-size: 0.9rem;
            cursor: pointer;
            margin-bottom: 0;
        }

        .deduction-item .amount {
            color: var(--success);
            font-weight: 600;
            font-size: 0.85rem;
        }

        .deduction-input {
            width: 80px !important;
            padding: 8px !important;
            font-size: 0.85rem !important;
        }

        /* Submit Button */
        .submit-btn {
            width: 100%;
            padding: 16px 32px;
            background: linear-gradient(135deg, var(--thai-red) 0%, var(--thai-red-dark) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 24px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(165, 25, 49, 0.3);
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            background: linear-gradient(135deg, var(--thai-blue) 0%, var(--thai-blue-light) 100%);
            color: white;
            border-radius: 16px;
            padding: 24px 32px;
            margin-bottom: 24px;
        }

        .results-header h2 {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .results-header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        /* Tax Breakdown Card */
        .breakdown-card {
            background: white;
            border-radius: 12px;
            border: 1px solid var(--gray-200);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .breakdown-header {
            background: var(--gray-50);
            padding: 16px 24px;
            border-bottom: 1px solid var(--gray-200);
        }

        .breakdown-header h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .breakdown-body {
            padding: 24px;
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .breakdown-row:last-child {
            border-bottom: none;
        }

        .breakdown-row.total {
            border-top: 2px solid var(--gray-200);
            margin-top: 12px;
            padding-top: 16px;
        }

        .breakdown-label {
            color: var(--gray-600);
            font-size: 0.95rem;
        }

        .breakdown-label small {
            display: block;
            font-size: 0.8rem;
            color: var(--gray-400);
        }

        .breakdown-value {
            font-weight: 700;
            color: var(--gray-900);
            text-align: right;
        }

        .breakdown-value.negative {
            color: var(--success);
        }

        .breakdown-value.highlight {
            color: var(--thai-red);
            font-size: 1.2rem;
        }

        /* Tax Bracket Visual */
        .tax-brackets {
            margin: 24px 0;
        }

        .bracket-bar {
            display: flex;
            height: 40px;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .bracket-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 30px;
            transition: all 0.3s;
        }

        .bracket-segment:hover {
            filter: brightness(1.1);
        }

        .bracket-segment.rate-0 { background: #10b981; }
        .bracket-segment.rate-5 { background: #3b82f6; }
        .bracket-segment.rate-10 { background: #8b5cf6; }
        .bracket-segment.rate-15 { background: #f59e0b; }
        .bracket-segment.rate-20 { background: #f97316; }
        .bracket-segment.rate-25 { background: #ef4444; }
        .bracket-segment.rate-30 { background: #dc2626; }
        .bracket-segment.rate-35 { background: #991b1b; }

        .bracket-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        /* Comparison Grid */
        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .comparison-card {
            background: white;
            border-radius: 12px;
            border: 2px solid var(--gray-200);
            overflow: hidden;
        }

        .comparison-card.resident {
            border-color: var(--success);
        }

        .comparison-card.non-resident {
            border-color: var(--warning);
        }

        .comparison-header {
            padding: 16px 20px;
            font-weight: 700;
        }

        .comparison-card.resident .comparison-header {
            background: var(--success-light);
            color: var(--success);
        }

        .comparison-card.non-resident .comparison-header {
            background: var(--warning-light);
            color: var(--warning);
        }

        .comparison-body {
            padding: 20px;
        }

        .comparison-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .comparison-total {
            border-top: 2px solid var(--gray-200);
            margin-top: 12px;
            padding-top: 12px;
            font-weight: 700;
        }

        /* Info Box */
        .info-box {
            background: var(--info-light);
            border: 1px solid var(--info);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .info-box h4 {
            color: var(--thai-blue);
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box p, .info-box li {
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        .info-box ul {
            margin: 12px 0 0 20px;
        }

        /* Warning Box */
        .warning-box {
            background: var(--warning-light);
            border: 1px solid var(--warning);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .warning-box h4 {
            color: #92400e;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .warning-box p {
            color: var(--gray-700);
            font-size: 0.9rem;
        }

        /* LTR Benefits Card */
        .ltr-card {
            background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%);
            border: 2px solid #a855f7;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .ltr-card h3 {
            color: #7c3aed;
            font-size: 1.1rem;
            margin-bottom: 16px;
        }

        .ltr-benefit {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 0;
        }

        .ltr-icon {
            width: 32px;
            height: 32px;
            background: #a855f7;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .ltr-benefit-content h4 {
            font-size: 0.95rem;
            color: var(--gray-900);
            margin-bottom: 4px;
        }

        .ltr-benefit-content p {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        /* Reset Button */
        .reset-btn {
            display: block;
            width: 100%;
            padding: 14px;
            background: var(--gray-100);
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .reset-btn:hover {
            background: var(--gray-200);
        }

        /* Disclaimer */
        .disclaimer {
            background: var(--gray-100);
            border-radius: 12px;
            padding: 20px;
            margin-top: 32px;
        }

        .disclaimer h4 {
            color: var(--gray-800);
            font-weight: 700;
            margin-bottom: 8px;
        }

        .disclaimer p {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        /* Cross Links */
        .cross-links {
            background: var(--gray-100);
            border-radius: 12px;
            padding: 24px;
            margin-top: 40px;
        }

        .cross-links h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: 16px;
        }

        .cross-links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        .cross-link {
            display: block;
            padding: 12px 16px;
            background: white;
            border-radius: 8px;
            text-decoration: none;
            color: var(--thai-blue);
            font-weight: 500;
            font-size: 0.9rem;
            transition: all 0.2s;
            border: 1px solid var(--gray-200);
        }

        .cross-link:hover {
            border-color: var(--thai-blue);
            box-shadow: 0 4px 12px rgba(0,32,91,0.1);
        }

        /* Footer */
        .footer {
            background: var(--thai-blue-dark);
            color: var(--gray-400);
            padding: 40px 24px;
        }

        .footer-content {
            max-width: 1100px;
            margin: 0 auto;
        }

        .footer-brand {
            color: white;
            font-weight: 700;
        }

        .footer-disclaimer {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-size: 0.85rem;
        }

        .footer-links {
            display: flex;
            gap: 24px;
            margin-top: 16px;
        }

        .footer-links a {
            color: var(--gray-400);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .footer-links a:hover {
            color: white;
        }

        /* Chart Container */
        .chart-container {
            height: 300px;
            margin: 24px 0;
            position: relative;
        }

        /* ========================================
           ENHANCED FEATURES - TOOLTIPS, GOTCHA CARDS, CONFIDENCE
           ======================================== */

        /* Tooltip System */
        .tooltip-trigger {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: var(--gray-200);
            color: var(--gray-600);
            border-radius: 50%;
            font-size: 11px;
            font-weight: 700;
            cursor: help;
            margin-left: 6px;
            transition: all 0.2s;
            vertical-align: middle;
        }

        .tooltip-trigger:hover {
            background: var(--thai-blue);
            color: white;
        }

        .tooltip-content {
            display: none;
            position: absolute;
            z-index: 1000;
            background: var(--gray-900);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 400;
            line-height: 1.5;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .tooltip-content::before {
            content: "";
            position: absolute;
            top: -6px;
            left: 20px;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 6px solid var(--gray-900);
        }

        .tooltip-content.show {
            display: block;
            animation: tooltipFadeIn 0.2s ease;
        }

        @keyframes tooltipFadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tooltip-content .tip-title {
            font-weight: 700;
            margin-bottom: 6px;
            color: #60a5fa;
        }

        .tooltip-content .tip-practical {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 0.8rem;
            color: #fbbf24;
        }

        /* Gotcha Cards */
        .gotcha-card {
            display: none;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            padding: 16px 20px;
            margin: 16px 0;
            animation: gotchaSlide 0.3s ease;
        }

        .gotcha-card.show {
            display: block;
        }

        @keyframes gotchaSlide {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .gotcha-card .gotcha-header {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            color: #92400e;
            margin-bottom: 8px;
        }

        .gotcha-card .gotcha-icon {
            font-size: 1.2rem;
        }

        .gotcha-card .gotcha-text {
            font-size: 0.9rem;
            color: #78350f;
            line-height: 1.5;
        }

        /* Confidence Score Badge */
        .confidence-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .confidence-badge.high {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }

        .confidence-badge.medium {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #f59e0b;
        }

        .confidence-badge.low {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .confidence-badge .confidence-icon {
            font-size: 1rem;
        }

        .confidence-factors {
            display: none;
            background: var(--gray-100);
            border-radius: 8px;
            padding: 12px 16px;
            margin-top: 8px;
            font-size: 0.85rem;
        }

        .confidence-factors.show {
            display: block;
        }

        .confidence-factors ul {
            margin: 8px 0 0 16px;
            color: var(--gray-600);
        }

        .confidence-factors li {
            margin: 4px 0;
        }

        /* Paper Trail Checklist */
        .checklist-generator {
            margin-top: 24px;
        }

        .checklist-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: var(--thai-blue);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .checklist-btn:hover {
            background: var(--thai-blue-light);
        }

        .checklist-output {
            display: none;
            margin-top: 16px;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 20px;
        }

        .checklist-output.show {
            display: block;
        }

        .checklist-output h4 {
            font-size: 1rem;
            color: var(--gray-900);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checklist-section {
            margin-bottom: 16px;
        }

        .checklist-section h5 {
            font-size: 0.9rem;
            color: var(--thai-blue);
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--gray-200);
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            padding: 6px 0;
            font-size: 0.85rem;
            color: var(--gray-700);
        }

        .checklist-item input[type="checkbox"] {
            margin-top: 2px;
        }

        .copy-checklist-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            background: var(--gray-100);
            border: 1px solid var(--gray-300);
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-top: 12px;
        }

        .copy-checklist-btn:hover {
            background: var(--gray-200);
        }

        /* Legal Citation Box */
        .legal-citation {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 1px solid #3b82f6;
            border-left: 4px solid #3b82f6;
            border-radius: 8px;
            padding: 16px 20px;
            margin: 20px 0;
            font-size: 0.9rem;
        }

        .legal-citation .citation-header {
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legal-citation .citation-text {
            color: #1e3a8a;
            line-height: 1.6;
        }

        .legal-citation .citation-ref {
            margin-top: 8px;
            font-size: 0.8rem;
            color: #3b82f6;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-header h1 { font-size: 1.8rem; }
            .form-grid { grid-template-columns: 1fr; }
            .comparison-grid { grid-template-columns: 1fr; }
            .currency-row { flex-direction: column; gap: 0; }
            .tabs { gap: 4px; }
            .tab-btn { padding: 10px 16px; font-size: 0.85rem; }
            .form-card { padding: 20px; }
        }
    </style>
</head>
<body>
<script src="/Thai/shared/lang-switcher.js"></script>
    <!-- Sitewide Header -->
    <div id="site-header"></div>
    <script src="/Thai/shared/header-loader.js"></script>

    <!-- Breadcrumbs -->
    <nav class="breadcrumbs">
        <div class="breadcrumbs-content">
            <div>
                <a href="/Thai/ru/">Главная</a>
                <span>></span>
                <a href="/Thai/ru/">Правовой центр Таиланда</a>
                <span>></span>
                <a href="/Thai/ru/tools/">Инструменты</a>
                <span>></span>
                Калькулятор подоходного налога
            </div>
            <div class="lang-selector">
                <a href="/Thai/tools/tax-calculator.html">&#127482;&#127480;</a>
                <span class="active">&#127479;&#127482;</span>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <header class="page-header">
            <h1>Калькулятор подоходного налога Таиланда для экспатов</h1>
            <p>Рассчитайте ваш налог в Таиланде, включая прогрессивные ставки, налог на переводы и льготы LTR визы. Обновлено с учетом изменений налогового законодательства 2024 года.</p>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('income')">Подоходный налог</button>
            <button class="tab-btn" onclick="showTab('remittance')">Налог на переводы</button>
            <button class="tab-btn" onclick="showTab('ltr')">Льготы LTR визы</button>
            <button class="tab-btn" onclick="showTab('brackets')">Налоговые ставки</button>
        </div>

        <!-- Income Tax Tab -->
        <div id="income-tab" class="tab-content active">
            <form id="income-form" class="form-card">
                <div class="form-section">
                    <h2>Статус налогового резидентства</h2>
                    <div class="form-group">
                        <label>Являетесь ли вы налоговым резидентом Таиланда? <span class="tooltip-trigger" data-tooltip="residency">?</span></label>
                        <div class="toggle-group">
                            <div class="toggle-option">
                                <input type="radio" id="resident-yes" name="residency" value="resident" checked>
                                <label for="resident-yes">Резидент (180+ дней/год)</label>
                            </div>
                            <div class="toggle-option">
                                <input type="radio" id="resident-no" name="residency" value="non-resident">
                                <label for="resident-no">Нерезидент (&lt;180 дней)</label>
                            </div>
                        </div>
                        <small>Налоговые резиденты облагаются налогом на доходы из источников в Таиланде и, с 2024 года, на иностранные доходы, переведенные в Таиланд.</small>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Годовой доход</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="thai-income">Доход из источников в Таиланде</label>
                            <div class="currency-row">
                                <div class="form-group">
                                    <div class="input-with-prefix">
                                        <span class="input-prefix">THB</span>
                                        <input type="number" id="thai-income" name="thai_income" min="0" placeholder="напр. 1200000" value="0">
                                    </div>
                                </div>
                            </div>
                            <small>Доход от трудовой деятельности, бизнеса или любой доход, полученный в Таиланде</small>
                        </div>

                        <div class="form-group">
                            <label for="foreign-income">Иностранный доход (если переводится в Таиланд) <span class="tooltip-trigger" data-tooltip="foreign-income">?</span></label>
                            <div class="currency-row">
                                <div class="form-group">
                                    <div class="input-with-prefix">
                                        <span class="input-prefix">USD</span>
                                        <input type="number" id="foreign-income" name="foreign_income" min="0" placeholder="напр. 50000" value="0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <select id="foreign-currency" name="foreign_currency">
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                        <option value="GBP">GBP</option>
                                        <option value="AUD">AUD</option>
                                        <option value="JPY">JPY</option>
                                        <option value="THB">THB</option>
                                    </select>
                                </div>
                            </div>
                            <small>Доход из иностранных источников, переводимый в Таиланд. Для налоговых резидентов доход, полученный с 1 января 2024 года, как правило, облагается налогом при переводе (даже в следующем году); доход до 2024 года обычно регулируется прежними правилами.</small>
                        </div>
                    </div>

                    <!-- Gotcha Card: Foreign Income -->
                    <div id="gotcha-foreign-income" class="gotcha-card">
                        <div class="gotcha-header">
                            <span class="gotcha-icon">&#9888;</span>
                            Важно: Год получения дохода vs Год перевода
                        </div>
                        <div class="gotcha-text">
                            <strong>Налог зависит от того, КОГДА доход был получен, а не когда вы его переводите.</strong><br>
                            Доход, полученный до 1 января 2024 года, как правило, НЕ облагается налогом по новым правилам (разъяснение Por. 162/2566). Также различайте <em>доход</em> (облагаемый) и <em>возврат основного капитала</em> (обычно не является доходом). Банки запросят документы о происхождении средств.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="exchange-rate">Обменный курс к THB</label>
                        <input type="number" id="exchange-rate" name="exchange_rate" step="0.01" value="35.00" min="0">
                        <small>Приблизительный текущий курс. При необходимости скорректируйте для вашего расчета.</small>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Личные вычеты и льготы</h2>
                    <p style="color: var(--gray-600); font-size: 0.9rem; margin-bottom: 16px;">Выберите все, что применимо. Налоговое законодательство Таиланда предусматривает различные вычеты для уменьшения налогооблагаемого дохода.</p>

                    <div class="deductions-grid">
                        <div class="deduction-item">
                            <input type="checkbox" id="ded-personal" checked disabled>
                            <label for="ded-personal">Личный вычет</label>
                            <span class="amount">60,000</span>
                        </div>

                        <div class="deduction-item">
                            <input type="checkbox" id="ded-spouse">
                            <label for="ded-spouse">Вычет на супруга</label>
                            <span class="amount">60,000</span>
                        </div>

                        <div class="deduction-item">
                            <input type="checkbox" id="ded-children">
                            <label for="ded-children">Дети</label>
                            <input type="number" id="ded-children-count" class="deduction-input" value="0" min="0" max="10">
                            <span class="amount">x30,000</span>
                        </div>

                        <div class="deduction-item">
                            <input type="checkbox" id="ded-parents">
                            <label for="ded-parents">Содержание родителей</label>
                            <input type="number" id="ded-parents-count" class="deduction-input" value="0" min="0" max="4">
                            <span class="amount">x30,000</span>
                        </div>

                        <div class="deduction-item">
                            <input type="checkbox" id="ded-life-insurance">
                            <label for="ded-life-insurance">Страхование жизни (THB)</label>
                            <input type="number" id="ded-life-insurance-amount" class="deduction-input" value="0" min="0" max="100000" disabled>
                            <span class="amount">макс 100,000</span>
                        </div>

                        <div class="deduction-item">
                            <input type="checkbox" id="ded-health-insurance">
                            <label for="ded-health-insurance">Медицинское страхование (THB)</label>
                            <input type="number" id="ded-health-insurance-amount" class="deduction-input" value="0" min="0" max="25000" disabled>
                            <span class="amount">макс 25,000</span>
                        </div>

                        <div class="deduction-item">
                            <input type="checkbox" id="ded-ssf">
                            <label for="ded-ssf">Взносы SSF (THB) <span class="tooltip-trigger" data-tooltip="ssf-rmf">?</span></label>
                            <input type="number" id="ded-ssf-amount" class="deduction-input" value="0" min="0" max="200000" disabled>
                            <span class="amount">макс 200,000*</span>
                        </div>

                        <div class="deduction-item">
                            <input type="checkbox" id="ded-rmf">
                            <label for="ded-rmf">RMF / Другие пенсионные (THB)</label>
                            <input type="number" id="ded-rmf-amount" class="deduction-input" value="0" min="0" max="500000" disabled>
                            <span class="amount">суммарно макс 500,000*</span>
                        </div>

                        <div class="deduction-item">
                            <input type="checkbox" id="ded-social-security">
                            <label for="ded-social-security">Социальное страхование</label>
                            <span class="amount">до 9,000</span>
                        </div>
                    </div>
                    <p style="color: var(--gray-600); font-size: 0.85rem; margin-top: 10px;">
                        * Пенсионные вычеты в Таиланде регулируются правилами о процентах от дохода и совокупными лимитами, которые могут включать несколько типов планов (напр., SSF, RMF, провидентный фонд, пенсионное страхование). Этот инструмент применяет упрощенную логику лимитов.
                    </p>

                    <div class="form-group" style="margin-top: 20px;">
                        <label for="expense-deduction">Метод вычета расходов на получение дохода <span class="tooltip-trigger" data-tooltip="expense-deduction">?</span></label>
                        <select id="expense-deduction" name="expense_deduction">
                            <option value="standard">Стандартный 50% (макс 100,000 THB)</option>
                            <option value="actual">Фактические расходы (детализированные)</option>
                        </select>
                        <small>Для трудового дохода обычно используется стандартный вычет 50%, но не более 100,000 THB</small>
                    </div>

                    <div class="form-group" id="actual-expenses-group" style="display: none;">
                        <label for="actual-expenses">Сумма фактических расходов (THB)</label>
                        <div class="input-with-prefix">
                            <span class="input-prefix">THB</span>
                            <input type="number" id="actual-expenses" name="actual_expenses" min="0" value="0">
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Рассчитать налоговые обязательства</button>
            </form>

            <!-- Income Tax Results -->
            <div id="income-results" class="results-section">
                <div class="results-header">
                    <h2>Результаты расчета налога</h2>
                    <p>На основе ваших данных как <span id="result-residency-status">налогового резидента</span></p>
                </div>

                <!-- Confidence Score -->
                <div id="confidence-container">
                    <div id="confidence-badge" class="confidence-badge high">
                        <span class="confidence-icon">&#10003;</span>
                        <span id="confidence-text">Высокая достоверность</span>
                        <span style="cursor:pointer;margin-left:4px;" onclick="toggleConfidenceFactors()">[почему?]</span>
                    </div>
                    <div id="confidence-factors" class="confidence-factors">
                        <strong>Факторы, влияющие на точность оценки:</strong>
                        <ul id="confidence-list"></ul>
                    </div>
                </div>

                <!-- Tax Breakdown -->
                <div class="breakdown-card">
                    <div class="breakdown-header">
                        <h3>Разбивка доходов и вычетов</h3>
                    </div>
                    <div class="breakdown-body">
                        <div class="breakdown-row">
                            <span class="breakdown-label">Доход из источников в Таиланде</span>
                            <span class="breakdown-value" id="result-thai-income">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Иностранный доход (конвертирован в THB)</span>
                            <span class="breakdown-value" id="result-foreign-income">0</span>
                        </div>
                        <div class="breakdown-row total">
                            <span class="breakdown-label">Общий налогооблагаемый доход</span>
                            <span class="breakdown-value" id="result-total-income">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Вычет расходов<small id="expense-method-display">Стандартный 50%</small></span>
                            <span class="breakdown-value negative" id="result-expense-deduction">-0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Личные вычеты<small id="allowances-detail"></small></span>
                            <span class="breakdown-value negative" id="result-allowances">-0</span>
                        </div>
                        <div class="breakdown-row total">
                            <span class="breakdown-label">Чистый налогооблагаемый доход</span>
                            <span class="breakdown-value highlight" id="result-taxable-income">0</span>
                        </div>
                    </div>
                </div>

                <!-- Tax by Bracket -->
                <div class="breakdown-card">
                    <div class="breakdown-header">
                        <h3>Расчет налога по ставкам</h3>
                    </div>
                    <div class="breakdown-body">
                        <div class="tax-brackets">
                            <div class="bracket-bar" id="bracket-bar"></div>
                            <div class="bracket-legend" id="bracket-legend"></div>
                        </div>
                        <div id="bracket-breakdown"></div>
                        <div class="breakdown-row total">
                            <span class="breakdown-label">Общая сумма налога</span>
                            <span class="breakdown-value highlight" id="result-total-tax">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Эффективная ставка налога</span>
                            <span class="breakdown-value" id="result-effective-rate">0%</span>
                        </div>
                    </div>
                </div>

                <!-- Comparison -->
                <div class="comparison-grid">
                    <div class="comparison-card resident">
                        <div class="comparison-header">Сценарий налогового резидента</div>
                        <div class="comparison-body">
                            <div class="comparison-item">
                                <span>Налогооблагаемый доход</span>
                                <span id="compare-resident-income">-</span>
                            </div>
                            <div class="comparison-item">
                                <span>Диапазон ставок</span>
                                <span id="compare-resident-rate">0-35%</span>
                            </div>
                            <div class="comparison-item comparison-total">
                                <span>Общий налог</span>
                                <span id="compare-resident-tax">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-card non-resident">
                        <div class="comparison-header">Сценарий нерезидента</div>
                        <div class="comparison-body">
                            <div class="comparison-item">
                                <span>Только тайский доход</span>
                                <span id="compare-nonresident-income">-</span>
                            </div>
                            <div class="comparison-item">
                                <span>Ставка налога</span>
                                <span id="compare-nonresident-rate">Фиксированная 15%</span>
                            </div>
                            <div class="comparison-item comparison-total">
                                <span>Общий налог</span>
                                <span id="compare-nonresident-tax">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>Ключевые моменты</h4>
                    <ul id="result-notes">
                    </ul>
                </div>

                <!-- Paper Trail Checklist Generator -->
                <div class="checklist-generator">
                    <button type="button" class="checklist-btn" onclick="showChecklist()">
                        Сгенерировать чек-лист документов
                    </button>
                    <div id="checklist-output" class="checklist-output"></div>
                </div>

                <button type="button" class="reset-btn" onclick="resetIncomeForm()">Рассчитать снова</button>
            </div>
        </div>

        <!-- Remittance Tax Tab -->
        <div id="remittance-tab" class="tab-content">
            <div class="legal-citation">
                <div class="citation-header">
                    <span>&#9878;</span> Действующее законодательство: Налогообложение иностранных доходов (с 1 января 2024)
                </div>
                <div class="citation-text">
                    <strong>Если вы являетесь налоговым резидентом Таиланда (как правило, 180+ дней в Таиланде в налоговом году):</strong> Иностранный доход, переводимый в Таиланд с 1 января 2024 года, как правило, облагается тайским подоходным налогом.
                    <br><br>
                    <strong>Важное ограничение (Por. 162/2566):</strong> Инструкция Налогового департамента Por. 162/2566 уточняет, что интерпретация Por. 161/2566 НЕ должна применяться к иностранным доходам, <em>полученным до 1 января 2024 года</em>. Доход до 2024 года, как правило, регулируется прежней интерпретацией (обычно: облагается налогом только при переводе в Таиланд в том же году, когда был получен).
                </div>
                <div class="citation-ref">
                    Правовая основа: Налоговый кодекс Таиланда, статья 41, параграф 2; Инструкция НД Por. 161/2566 (15 сентября 2023); Инструкция НД Por. 162/2566 (20 ноября 2023)
                </div>
            </div>

            <div class="warning-box">
                <h4>Предлагаемые изменения (Проект - еще не принят)</h4>
                <p>Налоговый департамент разрабатывает послабление, которое освободило бы от налога иностранный доход, переводимый в течение года получения или следующего года. По состоянию на конец 2025 года это остается проектом, требующим дополнительных правительственных процедур. Всегда уточняйте текущий статус у тайского налогового консультанта.</p>
            </div>

            <form id="remittance-form" class="form-card">
                <div class="form-section">
                    <h2>Детали перевода</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="remit-amount">Сумма перевода</label>
                            <div class="currency-row">
                                <div class="form-group">
                                    <div class="input-with-prefix">
                                        <span class="input-prefix">USD</span>
                                        <input type="number" id="remit-amount" name="remit_amount" min="0" placeholder="напр. 50000">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <select id="remit-currency" name="remit_currency">
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                        <option value="GBP">GBP</option>
                                        <option value="AUD">AUD</option>
                                        <option value="THB">THB</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="remit-exchange">Обменный курс к THB</label>
                            <input type="number" id="remit-exchange" name="remit_exchange" step="0.01" value="35.00" min="0">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Источник и сроки дохода</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="income-year">Год получения дохода</label>
                            <select id="income-year" name="income_year">
                                <option value="2024">2024 или позже</option>
                                <option value="2023">2023</option>
                                <option value="before2023">До 2023</option>
                            </select>
                            <small>Доход до 2024 года может иметь особый режим налогообложения в зависимости от того, когда он был получен и когда переведен</small>
                        </div>

                        <div class="form-group">
                            <label for="income-type">Тип иностранного дохода</label>
                            <select id="income-type" name="income_type">
                                <option value="employment">Трудовой доход</option>
                                <option value="business">Доход от бизнеса/самозанятости</option>
                                <option value="investment">Инвестиционный доход (дивиденды, проценты)</option>
                                <option value="capital-gains">Прирост капитала</option>
                                <option value="pension">Пенсия/Пенсионные выплаты</option>
                                <option value="rental">Арендный доход</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Анализ налогового соглашения</h2>
                    <div class="form-group">
                        <label for="treaty-country">Страна, где был получен доход</label>
                        <select id="treaty-country" name="treaty_country">
                            <option value="">Выберите страну</option>
                            <option value="US">США</option>
                            <option value="UK">Великобритания</option>
                            <option value="DE">Германия</option>
                            <option value="FR">Франция</option>
                            <option value="JP">Япония</option>
                            <option value="AU">Австралия</option>
                            <option value="SG">Сингапур</option>
                            <option value="HK">Гонконг</option>
                            <option value="AE">ОАЭ (Дубай)</option>
                            <option value="MY">Малайзия</option>
                            <option value="NL">Нидерланды</option>
                            <option value="CH">Швейцария</option>
                            <option value="CA">Канада</option>
                            <option value="NZ">Новая Зеландия</option>
                            <option value="other-treaty">Другая (с налоговым соглашением)</option>
                            <option value="no-treaty">Другая (без налогового соглашения)</option>
                        </select>
                        <small>Таиланд имеет налоговые соглашения с более чем 60 странами, которые могут обеспечить защиту от двойного налогообложения</small>
                    </div>

                    <div class="form-group">
                        <label for="foreign-tax-paid">Налог, уже уплаченный в иностранном государстве (USD)</label>
                        <div class="input-with-prefix">
                            <span class="input-prefix">USD</span>
                            <input type="number" id="foreign-tax-paid" name="foreign_tax_paid" min="0" value="0">
                        </div>
                        <small>Вы можете претендовать на зачет иностранного налога за налоги, уплаченные за рубежом</small>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Анализировать налог на перевод</button>
            </form>

            <!-- Remittance Results -->
            <div id="remittance-results" class="results-section">
                <div class="results-header">
                    <h2>Анализ налога на перевод</h2>
                    <p>Понимание налоговых последствий перевода иностранного дохода в Таиланд</p>
                </div>

                <div class="breakdown-card">
                    <div class="breakdown-header">
                        <h3>Сводка по переводу</h3>
                    </div>
                    <div class="breakdown-body">
                        <div class="breakdown-row">
                            <span class="breakdown-label">Сумма перевода (THB)</span>
                            <span class="breakdown-value" id="remit-result-amount">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Тип дохода</span>
                            <span class="breakdown-value" id="remit-result-type">-</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Статус налогового соглашения</span>
                            <span class="breakdown-value" id="remit-result-treaty">-</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Потенциальный тайский налог (до зачетов)</span>
                            <span class="breakdown-value" id="remit-result-thai-tax">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Зачет иностранного налога<small>С учетом ограничений</small></span>
                            <span class="breakdown-value negative" id="remit-result-credit">-0</span>
                        </div>
                        <div class="breakdown-row total">
                            <span class="breakdown-label">Оценочный чистый тайский налог</span>
                            <span class="breakdown-value highlight" id="remit-result-net-tax">0</span>
                        </div>
                    </div>
                </div>

                <div class="info-box" id="remit-treaty-info">
                    <h4>Особенности налогового соглашения</h4>
                    <p id="remit-treaty-details"></p>
                </div>

                <div class="warning-box">
                    <h4>Важный дисклеймер</h4>
                    <p>Применение налогового соглашения сложно и зависит от конкретных обстоятельств. Зачет иностранного налога ограничен суммой тайского налога на этот доход. Этот анализ предназначен только для образовательных целей. Проконсультируйтесь с налоговым специалистом по вашей конкретной ситуации.</p>
                </div>

                <button type="button" class="reset-btn" onclick="resetRemittanceForm()">Рассчитать снова</button>
            </div>
        </div>

        <!-- LTR Visa Tab -->
        <div id="ltr-tab" class="tab-content">
            <div class="ltr-card">
                <h3>Налоговые льготы LTR визы (Long-Term Resident)</h3>
                <div class="ltr-benefit">
                    <div class="ltr-icon">1</div>
                    <div class="ltr-benefit-content">
                        <h4>Фиксированная ставка 17%</h4>
                        <p>Высококвалифицированные специалисты по LTR визе платят фиксированный налог 17% вместо прогрессивных ставок до 35%.</p>
                    </div>
                </div>
                <div class="ltr-benefit">
                    <div class="ltr-icon">2</div>
                    <div class="ltr-benefit-content">
                        <h4>Освобождение иностранного дохода</h4>
                        <p>Категории "Состоятельный глобальный гражданин" и "Состоятельный пенсионер" могут быть освобождены от налога на иностранный доход, даже при переводе в Таиланд.</p>
                    </div>
                </div>
                <div class="ltr-benefit">
                    <div class="ltr-icon">3</div>
                    <div class="ltr-benefit-content">
                        <h4>Льготы по разрешению на работу</h4>
                        <p>Цифровое разрешение на работу, отсутствие требования о соотношении 4:1 тайских сотрудников, ускоренная обработка.</p>
                    </div>
                </div>
            </div>

            <form id="ltr-form" class="form-card">
                <div class="form-section">
                    <h2>Калькулятор налога LTR</h2>
                    <div class="form-group">
                        <label for="ltr-category">Категория LTR визы</label>
                        <select id="ltr-category" name="ltr_category">
                            <option value="professional">Высококвалифицированный специалист (фикс. ставка 17%)</option>
                            <option value="wealthy-citizen">Состоятельный глобальный гражданин (иностр. доход освобожден)</option>
                            <option value="wealthy-pensioner">Состоятельный пенсионер (иностр. доход освобожден)</option>
                            <option value="remote-worker">Специалист "Работа из Таиланда"</option>
                        </select>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="ltr-thai-income">Доход из Таиланда (THB/год)</label>
                            <div class="input-with-prefix">
                                <span class="input-prefix">THB</span>
                                <input type="number" id="ltr-thai-income" name="ltr_thai_income" min="0" value="0">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="ltr-foreign-income">Переведенный иностранный доход (THB/год)</label>
                            <div class="input-with-prefix">
                                <span class="input-prefix">THB</span>
                                <input type="number" id="ltr-foreign-income" name="ltr_foreign_income" min="0" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Рассчитать выгоду LTR</button>
            </form>

            <!-- LTR Results -->
            <div id="ltr-results" class="results-section">
                <div class="results-header">
                    <h2>Анализ налоговой выгоды LTR</h2>
                    <p>Сравнение вашего налога по LTR визе и стандартному режиму</p>
                </div>

                <div class="comparison-grid">
                    <div class="comparison-card resident">
                        <div class="comparison-header">С LTR визой</div>
                        <div class="comparison-body">
                            <div class="comparison-item">
                                <span>Налог на тайский доход</span>
                                <span id="ltr-with-thai-tax">-</span>
                            </div>
                            <div class="comparison-item">
                                <span>Налог на иностранный доход</span>
                                <span id="ltr-with-foreign-tax">-</span>
                            </div>
                            <div class="comparison-item comparison-total">
                                <span>Общий налог</span>
                                <span id="ltr-with-total">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="comparison-card non-resident">
                        <div class="comparison-header">Без LTR (стандартные ставки)</div>
                        <div class="comparison-body">
                            <div class="comparison-item">
                                <span>Налог на тайский доход</span>
                                <span id="ltr-without-thai-tax">-</span>
                            </div>
                            <div class="comparison-item">
                                <span>Налог на иностранный доход</span>
                                <span id="ltr-without-foreign-tax">-</span>
                            </div>
                            <div class="comparison-item comparison-total">
                                <span>Общий налог</span>
                                <span id="ltr-without-total">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="breakdown-card">
                    <div class="breakdown-header">
                        <h3>Ваша экономия на налогах</h3>
                    </div>
                    <div class="breakdown-body">
                        <div class="breakdown-row total">
                            <span class="breakdown-label">Годовая экономия с LTR</span>
                            <span class="breakdown-value highlight" id="ltr-savings">0</span>
                        </div>
                        <div class="breakdown-row">
                            <span class="breakdown-label">Процент экономии</span>
                            <span class="breakdown-value" id="ltr-savings-pct">0%</span>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>Требования для получения LTR визы</h4>
                    <ul>
                        <li><strong>Высококвалифицированный специалист:</strong> Годовой доход $80,000+, трудоустройство в тайской компании или крупной иностранной компании</li>
                        <li><strong>Состоятельный глобальный гражданин:</strong> Активы $1M+, доход $80,000+, инвестиции в Таиланд $500,000+</li>
                        <li><strong>Состоятельный пенсионер:</strong> Возраст 50+, годовая пенсия $80,000+, инвестиции в Таиланд $250,000+</li>
                        <li><strong>Работа из Таиланда:</strong> Доход $80,000+, работа на крупную иностранную компанию</li>
                    </ul>
                </div>

                <button type="button" class="reset-btn" onclick="resetLTRForm()">Рассчитать снова</button>
            </div>
        </div>

        <!-- Tax Brackets Reference Tab -->
        <div id="brackets-tab" class="tab-content">
            <div class="form-card">
                <div class="form-section">
                    <h2>Ставки подоходного налога Таиланда (2024)</h2>
                    <p style="color: var(--gray-600); margin-bottom: 20px;">Прогрессивные ставки применяются к налоговым резидентам. Эти ставки применяются к чистому налогооблагаемому доходу после вычетов.</p>

                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 24px;">
                        <thead>
                            <tr style="background: var(--thai-blue); color: white;">
                                <th style="padding: 12px 16px; text-align: left; border-radius: 8px 0 0 0;">Налогооблагаемый доход (THB)</th>
                                <th style="padding: 12px 16px; text-align: center;">Ставка</th>
                                <th style="padding: 12px 16px; text-align: right; border-radius: 0 8px 0 0;">Налог в диапазоне</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="background: #d1fae5;">
                                <td style="padding: 12px 16px; border-bottom: 1px solid var(--gray-200);">0 - 150,000</td>
                                <td style="padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--gray-200); font-weight: 600;">0%</td>
                                <td style="padding: 12px 16px; text-align: right; border-bottom: 1px solid var(--gray-200);">0</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px 16px; border-bottom: 1px solid var(--gray-200);">150,001 - 300,000</td>
                                <td style="padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--gray-200); font-weight: 600; color: #3b82f6;">5%</td>
                                <td style="padding: 12px 16px; text-align: right; border-bottom: 1px solid var(--gray-200);">7,500</td>
                            </tr>
                            <tr style="background: var(--gray-50);">
                                <td style="padding: 12px 16px; border-bottom: 1px solid var(--gray-200);">300,001 - 500,000</td>
                                <td style="padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--gray-200); font-weight: 600; color: #8b5cf6;">10%</td>
                                <td style="padding: 12px 16px; text-align: right; border-bottom: 1px solid var(--gray-200);">20,000</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px 16px; border-bottom: 1px solid var(--gray-200);">500,001 - 750,000</td>
                                <td style="padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--gray-200); font-weight: 600; color: #f59e0b;">15%</td>
                                <td style="padding: 12px 16px; text-align: right; border-bottom: 1px solid var(--gray-200);">37,500</td>
                            </tr>
                            <tr style="background: var(--gray-50);">
                                <td style="padding: 12px 16px; border-bottom: 1px solid var(--gray-200);">750,001 - 1,000,000</td>
                                <td style="padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--gray-200); font-weight: 600; color: #f97316;">20%</td>
                                <td style="padding: 12px 16px; text-align: right; border-bottom: 1px solid var(--gray-200);">50,000</td>
                            </tr>
                            <tr>
                                <td style="padding: 12px 16px; border-bottom: 1px solid var(--gray-200);">1,000,001 - 2,000,000</td>
                                <td style="padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--gray-200); font-weight: 600; color: #ef4444;">25%</td>
                                <td style="padding: 12px 16px; text-align: right; border-bottom: 1px solid var(--gray-200);">250,000</td>
                            </tr>
                            <tr style="background: var(--gray-50);">
                                <td style="padding: 12px 16px; border-bottom: 1px solid var(--gray-200);">2,000,001 - 5,000,000</td>
                                <td style="padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--gray-200); font-weight: 600; color: #dc2626;">30%</td>
                                <td style="padding: 12px 16px; text-align: right; border-bottom: 1px solid var(--gray-200);">900,000</td>
                            </tr>
                            <tr style="background: #fee2e2;">
                                <td style="padding: 12px 16px; border-radius: 0 0 0 8px;">Свыше 5,000,000</td>
                                <td style="padding: 12px 16px; text-align: center; font-weight: 700; color: #991b1b;">35%</td>
                                <td style="padding: 12px 16px; text-align: right; border-radius: 0 0 8px 0;">Без ограничений</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="info-box">
                        <h4>Сводка основных вычетов</h4>
                        <ul>
                            <li><strong>Личный вычет:</strong> 60,000 THB (обязательный)</li>
                            <li><strong>Вычет на супруга:</strong> 60,000 THB (если супруг не имеет дохода)</li>
                            <li><strong>Вычет на ребенка:</strong> 30,000 THB на ребенка (в некоторых случаях может быть увеличен)</li>
                            <li><strong>Содержание родителей:</strong> 30,000 THB на родителя (макс. 4 родителя, включая родителей супруга)</li>
                            <li><strong>Вычет расходов:</strong> 50% от дохода, макс 100,000 THB для трудового дохода</li>
                            <li><strong>Страхование жизни:</strong> До 100,000 THB</li>
                            <li><strong>Медицинское страхование:</strong> До 25,000 THB</li>
                            <li><strong>SSF/RMF/Пенсионные:</strong> Действуют процентные лимиты и совокупные ограничения</li>
                            <li><strong>Социальное страхование:</strong> До 9,000 THB</li>
                        </ul>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Примечание для нерезидентов</h2>
                    <p style="color: var(--gray-600); margin-bottom: 16px;">
                        Таиланд облагает налогом как резидентов, так и нерезидентов на доходы из тайских источников от трудовой деятельности или бизнеса, осуществляемого в Таиланде.
                        <strong>Удержание</strong> и <strong>окончательный налог</strong> для нерезидентов может варьироваться в зависимости от типа дохода (зарплата, услуги, дивиденды, проценты, роялти), статуса плательщика и налогового соглашения.
                        Этот калькулятор предназначен в первую очередь для <strong>оценки годовой декларации налоговых резидентов Таиланда</strong>; если вы нерезидент, рассматривайте сравнение "резидент vs нерезидент" как выходящее за рамки и используйте ставки удержания, применимые к вашему конкретному виду дохода.
                    </p>
                </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
            <h4>Важный дисклеймер</h4>
            <p>Этот калькулятор предоставляет оценки только в образовательных целях. Налоговое законодательство Таиланда сложно и подвержено изменениям. Правила налогообложения переводов 2024 года являются новыми, и их интерпретация может развиваться. Налоговые льготы по соглашениям зависят от конкретных обстоятельств и надлежащей документации. Всегда консультируйтесь с квалифицированным тайским налоговым консультантом или бухгалтером по вашей конкретной ситуации. Этот инструмент не является налоговой консультацией.</p>
        </div>

        <!-- Cross Links -->
        <div class="cross-links">
            <h3>Связанные ресурсы</h3>
            <div class="cross-links-grid">
                <a href="/Thai/ru/visas/ltr-10-year-visa.html" class="cross-link">Руководство по LTR визе</a>
                <a href="/Thai/ru/visas/dtv-digital-nomad-visa.html" class="cross-link">Руководство по DTV визе</a>
                <a href="/Thai/ru/tools/visa-eligibility-checker.html" class="cross-link">Проверка права на визу</a>
                <a href="/Thai/ru/banking/" class="cross-link">Банкинг в Таиланде</a>
                <a href="/Thai/ru/tools/" class="cross-link">Все инструменты</a>
                <a href="/Thai/ru/" class="cross-link">Правовой центр Таиланда</a>
            </div>
        </div>
    </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div>
                <span class="footer-brand">Terms.Law</span> - Калькулятор налогов Таиланда
            </div>
            <div class="footer-disclaimer">
                <strong>Образовательный дисклеймер:</strong> Этот калькулятор предоставляет оценки только в образовательных целях и не является налоговой консультацией. Налоговое законодательство Таиланда сложно и подвержено изменениям. Правила налогообложения переводов с 2024 года все еще интерпретируются. Всегда консультируйтесь с квалифицированными тайскими налоговыми специалистами по вашей конкретной ситуации.
            </div>
            <div class="footer-links">
                <a href="/Thai/ru/">Главная</a>
                <a href="/Thai/ru/">Правовой центр Таиланда</a>
                <a href="/Thai/ru/tools/">Все инструменты</a>
                <a href="/Thai/ru/visas/">Визовые руководства</a>
            </div>
        </div>
    </footer>

    <script>
        // Thai Tax Brackets (2024)
        const TAX_BRACKETS = [
            { min: 0, max: 150000, rate: 0 },
            { min: 150000, max: 300000, rate: 0.05 },
            { min: 300000, max: 500000, rate: 0.10 },
            { min: 500000, max: 750000, rate: 0.15 },
            { min: 750000, max: 1000000, rate: 0.20 },
            { min: 1000000, max: 2000000, rate: 0.25 },
            { min: 2000000, max: 5000000, rate: 0.30 },
            { min: 5000000, max: Infinity, rate: 0.35 }
        ];

        // Exchange rates (approximate)
        const EXCHANGE_RATES = {
            USD: 35.00,
            EUR: 38.00,
            GBP: 44.00,
            AUD: 23.00,
            JPY: 0.24,
            THB: 1
        };

        // Tax Treaty Countries with Thailand
        const TAX_TREATIES = {
            US: { name: 'США', hasCredit: true, notes: 'Налоговое соглашение США-Таиланд предусматривает зачет иностранного налога. Пенсии могут иметь особый режим.' },
            UK: { name: 'Великобритания', hasCredit: true, notes: 'Соглашение Великобритания-Таиланд обеспечивает защиту от двойного налогообложения. Разные правила для трудового и инвестиционного дохода.' },
            DE: { name: 'Германия', hasCredit: true, notes: 'Соглашение Германия-Таиланд включает положения о пенсиях и трудовом доходе.' },
            FR: { name: 'Франция', hasCredit: true, notes: 'Соглашение Франция-Таиланд охватывает большинство видов дохода методом зачета.' },
            JP: { name: 'Япония', hasCredit: true, notes: 'Соглашение Япония-Таиланд предусматривает налоговые зачеты и специальные ставки на дивиденды/проценты.' },
            AU: { name: 'Австралия', hasCredit: true, notes: 'Соглашение Австралия-Таиланд обеспечивает комплексную защиту от двойного налогообложения.' },
            SG: { name: 'Сингапур', hasCredit: true, notes: 'Соглашение Сингапур-Таиланд. Примечание: в Сингапуре нет налога на прирост капитала.' },
            HK: { name: 'Гонконг', hasCredit: true, notes: 'Соглашение Гонконг-Таиланд охватывает ограниченный перечень видов дохода.' },
            AE: { name: 'ОАЭ', hasCredit: false, notes: 'Нет налогового соглашения с Таиландом. В ОАЭ нет подоходного налога, поэтому зачет иностранного налога недоступен.' },
            MY: { name: 'Малайзия', hasCredit: true, notes: 'Соглашение Малайзия-Таиланд обеспечивает стандартную защиту от двойного налогообложения.' },
            NL: { name: 'Нидерланды', hasCredit: true, notes: 'Соглашение Нидерланды-Таиланд с комплексным охватом.' },
            CH: { name: 'Швейцария', hasCredit: true, notes: 'Соглашение Швейцария-Таиланд включает специальные ставки на дивиденды и проценты.' },
            CA: { name: 'Канада', hasCredit: true, notes: 'Соглашение Канада-Таиланд предусматривает зачет иностранного налога.' },
            NZ: { name: 'Новая Зеландия', hasCredit: true, notes: 'Соглашение Новая Зеландия-Таиланд обеспечивает защиту от двойного налогообложения.' },
            'other-treaty': { name: 'Другая страна с соглашением', hasCredit: true, notes: 'Таиланд имеет соглашения с более чем 60 странами. Проверьте конкретные положения соглашения.' },
            'no-treaty': { name: 'Нет соглашения', hasCredit: false, notes: 'Без налогового соглашения вы можете столкнуться с двойным налогообложением. Ограниченные возможности для защиты.' }
        };

        // Format currency
        function formatTHB(amount) {
            return new Intl.NumberFormat('th-TH', {
                style: 'currency',
                currency: 'THB',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Calculate progressive tax
        function calculateProgressiveTax(taxableIncome) {
            let totalTax = 0;
            let breakdown = [];

            for (const bracket of TAX_BRACKETS) {
                if (taxableIncome <= bracket.min) break;

                const taxableInBracket = Math.min(taxableIncome - bracket.min, bracket.max - bracket.min);
                const taxInBracket = taxableInBracket * bracket.rate;

                if (taxableInBracket > 0) {
                    breakdown.push({
                        min: bracket.min,
                        max: Math.min(bracket.max, taxableIncome),
                        rate: bracket.rate,
                        amount: taxableInBracket,
                        tax: taxInBracket
                    });
                    totalTax += taxInBracket;
                }
            }

            return { totalTax, breakdown };
        }

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        // Toggle actual expenses field
        document.getElementById('expense-deduction').addEventListener('change', function() {
            const actualGroup = document.getElementById('actual-expenses-group');
            actualGroup.style.display = this.value === 'actual' ? 'block' : 'none';
        });

        // Income Tax Form
        document.getElementById('income-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const isResident = document.querySelector('input[name="residency"]:checked').value === 'resident';
            const thaiIncome = parseFloat(document.getElementById('thai-income').value) || 0;
            const foreignIncome = parseFloat(document.getElementById('foreign-income').value) || 0;
            const foreignCurrency = document.getElementById('foreign-currency').value;
            const exchangeRate = parseFloat(document.getElementById('exchange-rate').value) || EXCHANGE_RATES[foreignCurrency];

            // Convert foreign income to THB
            const foreignIncomeTHB = foreignIncome * exchangeRate;
            const totalIncome = thaiIncome + (isResident ? foreignIncomeTHB : 0);

            // Calculate expense deduction
            const expenseMethod = document.getElementById('expense-deduction').value;
            let expenseDeduction;
            if (expenseMethod === 'standard') {
                expenseDeduction = Math.min(totalIncome * 0.5, 100000);
            } else {
                expenseDeduction = parseFloat(document.getElementById('actual-expenses').value) || 0;
            }

            // Calculate allowances
            let allowances = 60000; // Personal allowance always included
            let allowanceDetails = ['Личный: 60,000'];

            if (document.getElementById('ded-spouse').checked) {
                allowances += 60000;
                allowanceDetails.push('Супруг: 60,000');
            }

            if (document.getElementById('ded-children').checked) {
                const children = parseInt(document.getElementById('ded-children-count').value) || 0;
                const childAllowance = children * 30000;
                allowances += childAllowance;
                if (children > 0) allowanceDetails.push(`Дети: ${childAllowance.toLocaleString()}`);
            }

            if (document.getElementById('ded-parents').checked) {
                const parents = Math.min(parseInt(document.getElementById('ded-parents-count').value) || 0, 4);
                const parentAllowance = parents * 30000;
                allowances += parentAllowance;
                if (parents > 0) allowanceDetails.push(`Родители: ${parentAllowance.toLocaleString()}`);
            }


            if (document.getElementById('ded-life-insurance').checked) {
                const amt = Math.min(parseFloat(document.getElementById('ded-life-insurance-amount').value) || 0, 100000);
                if (amt > 0) {
                    allowances += amt;
                    allowanceDetails.push(`Страх. жизни: ${amt.toLocaleString()}`);
                }
            }

            if (document.getElementById('ded-health-insurance').checked) {
                const amt = Math.min(parseFloat(document.getElementById('ded-health-insurance-amount').value) || 0, 25000);
                if (amt > 0) {
                    allowances += amt;
                    allowanceDetails.push(`Мед. страх.: ${amt.toLocaleString()}`);
                }
            }

            // Retirement deductions (simplified cap logic)
            let ssfDeduction = 0;
            if (document.getElementById('ded-ssf').checked) {
                const raw = parseFloat(document.getElementById('ded-ssf-amount').value) || 0;
                ssfDeduction = Math.min(raw, 200000, totalIncome * 0.30);
            }

            let rmfDeduction = 0;
            if (document.getElementById('ded-rmf') && document.getElementById('ded-rmf').checked) {
                const raw = parseFloat(document.getElementById('ded-rmf-amount').value) || 0;
                rmfDeduction = Math.min(raw, totalIncome * 0.30);
            }

            // Combined statutory cap (simplified): 500,000 for SSF + RMF/other retirement
            if (ssfDeduction + rmfDeduction > 500000) {
                rmfDeduction = Math.max(0, 500000 - ssfDeduction);
            }

            if (ssfDeduction > 0) {
                allowances += ssfDeduction;
                allowanceDetails.push(`SSF: ${ssfDeduction.toLocaleString()}`);
            }
            if (rmfDeduction > 0) {
                allowances += rmfDeduction;
                allowanceDetails.push(`RMF/Пенсионные: ${rmfDeduction.toLocaleString()}`);
            }

            if (document.getElementById('ded-social-security').checked) {
                allowances += 9000;
                allowanceDetails.push('Соц. страх.: 9,000');
            }

            // Calculate taxable income
            const taxableIncome = Math.max(0, totalIncome - expenseDeduction - allowances);

            // Calculate tax
            const { totalTax, breakdown } = calculateProgressiveTax(taxableIncome);

            // Calculate effective rate
            const effectiveRate = totalIncome > 0 ? (totalTax / totalIncome * 100) : 0;

            // Non-resident calculation (Thai income only at 15%)
            const nonResidentTax = thaiIncome * 0.15;
            const { totalTax: residentTax } = calculateProgressiveTax(Math.max(0, thaiIncome + foreignIncomeTHB - expenseDeduction - allowances));

            // Display results
            document.getElementById('result-residency-status').textContent = isResident ? 'налогового резидента' : 'нерезидента';
            document.getElementById('result-thai-income').textContent = formatTHB(thaiIncome);
            document.getElementById('result-foreign-income').textContent = formatTHB(foreignIncomeTHB);
            document.getElementById('result-total-income').textContent = formatTHB(totalIncome);
            document.getElementById('expense-method-display').textContent = expenseMethod === 'standard' ? 'Стандартный 50% (макс 100,000)' : 'Фактические расходы';
            document.getElementById('result-expense-deduction').textContent = '-' + formatTHB(expenseDeduction);
            document.getElementById('allowances-detail').textContent = allowanceDetails.join(', ');
            document.getElementById('result-allowances').textContent = '-' + formatTHB(allowances);
            document.getElementById('result-taxable-income').textContent = formatTHB(taxableIncome);
            document.getElementById('result-total-tax').textContent = formatTHB(totalTax);
            document.getElementById('result-effective-rate').textContent = effectiveRate.toFixed(2) + '%';

            // Build bracket visualization
            const bracketBar = document.getElementById('bracket-bar');
            const bracketLegend = document.getElementById('bracket-legend');
            const bracketBreakdown = document.getElementById('bracket-breakdown');

            bracketBar.innerHTML = '';
            bracketLegend.innerHTML = '';
            bracketBreakdown.innerHTML = '';

            if (breakdown.length > 0) {
                const totalAmount = breakdown.reduce((sum, b) => sum + b.amount, 0);

                breakdown.forEach(b => {
                    const widthPct = (b.amount / totalAmount * 100);
                    const rateClass = 'rate-' + (b.rate * 100);

                    bracketBar.innerHTML += `<div class="bracket-segment ${rateClass}" style="width: ${widthPct}%">${(b.rate * 100)}%</div>`;

                    bracketBreakdown.innerHTML += `
                        <div class="breakdown-row">
                            <span class="breakdown-label">${formatTHB(b.min)} - ${formatTHB(b.max)}<small>@ ${(b.rate * 100)}%</small></span>
                            <span class="breakdown-value">${formatTHB(b.tax)}</span>
                        </div>
                    `;
                });

                const legendItems = [
                    { rate: 0, color: '#10b981' },
                    { rate: 5, color: '#3b82f6' },
                    { rate: 10, color: '#8b5cf6' },
                    { rate: 15, color: '#f59e0b' },
                    { rate: 20, color: '#f97316' },
                    { rate: 25, color: '#ef4444' },
                    { rate: 30, color: '#dc2626' },
                    { rate: 35, color: '#991b1b' }
                ];

                legendItems.forEach(item => {
                    bracketLegend.innerHTML += `
                        <div class="legend-item">
                            <div class="legend-color" style="background: ${item.color}"></div>
                            <span>${item.rate}%</span>
                        </div>
                    `;
                });
            }

            // Comparison
            document.getElementById('compare-resident-income').textContent = formatTHB(taxableIncome);
            document.getElementById('compare-resident-tax').textContent = formatTHB(residentTax);
            document.getElementById('compare-nonresident-income').textContent = formatTHB(thaiIncome);
            document.getElementById('compare-nonresident-tax').textContent = formatTHB(nonResidentTax);

            // Notes
            const notes = document.getElementById('result-notes');
            notes.innerHTML = '';

            if (isResident && foreignIncomeTHB > 0) {
                notes.innerHTML += '<li>Как налоговый резидент, ваш иностранный доход, переведенный в Таиланд, облагается налогом по правилам 2024 года.</li>';
            }

            if (!isResident) {
                notes.innerHTML += '<li>Как нерезидент, только доход из источников в Таиланде облагается налогом по фиксированной ставке удержания 15%.</li>';
            }

            if (taxableIncome <= 150000) {
                notes.innerHTML += '<li>Ваш налогооблагаемый доход попадает в диапазон 0% - подоходный налог не подлежит уплате!</li>';
            }

            if (effectiveRate > 0) {
                notes.innerHTML += `<li>Ваша эффективная ставка налога составляет ${effectiveRate.toFixed(2)}%, что учитывает все вычеты и прогрессивные ставки.</li>`;
            }

            notes.innerHTML += '<li>Срок подачи декларации: обычно 31 марта для бумажной подачи и 8 апреля для электронной подачи (следующий год) (проверяйте объявления Налогового департамента о продлениях).</li>';

            // Calculate and display confidence score
            let deductionCount = 0;
            if (document.getElementById('ded-spouse').checked) deductionCount++;
            if (document.getElementById('ded-children').checked) deductionCount++;
            if (document.getElementById('ded-parents').checked) deductionCount++;
            if (document.getElementById('ded-life-insurance').checked) deductionCount++;
            if (document.getElementById('ded-health-insurance').checked) deductionCount++;
            if (document.getElementById('ded-ssf').checked) deductionCount++;
            if (document.getElementById('ded-rmf') && document.getElementById('ded-rmf').checked) deductionCount++;

            updateConfidenceDisplay({
                thaiIncome: thaiIncome,
                foreignIncome: foreignIncomeTHB,
                totalIncome: totalIncome,
                isResident: isResident,
                deductions: deductionCount
            });

            // Show results
            document.getElementById('income-results').classList.add('active');
            document.getElementById('income-form').style.display = 'none';
            document.getElementById('income-results').scrollIntoView({ behavior: 'smooth' });
        });

        // Remittance Form
        document.getElementById('remittance-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const remitAmount = parseFloat(document.getElementById('remit-amount').value) || 0;
            const remitCurrency = document.getElementById('remit-currency').value;
            const exchangeRate = parseFloat(document.getElementById('remit-exchange').value) || EXCHANGE_RATES[remitCurrency];
            const incomeYear = document.getElementById('income-year').value;
            const incomeType = document.getElementById('income-type').value;
            const treatyCountry = document.getElementById('treaty-country').value;
            const foreignTaxPaid = parseFloat(document.getElementById('foreign-tax-paid').value) || 0;

            const remitTHB = remitAmount * exchangeRate;
            const foreignTaxPaidTHB = foreignTaxPaid * exchangeRate;

            // Calculate potential Thai tax (using progressive rates as estimate)
            let potentialThaiTax = 0;
            // Simplified interpretation for this tool: the "tax-on-remittance" rule applies to foreign income derived from 1 Jan 2024 onward.
            // If the income was derived before 2024 and is remitted in/after 2024, it is generally treated under the prior rule (often not taxable unless remitted in the same year earned).
            if (incomeYear === '2024') {
                potentialThaiTax = calculateProgressiveTax(remitTHB).totalTax;
            } else {
                potentialThaiTax = 0;
            }

            // Foreign tax credit (limited to Thai tax on that income)
            const foreignTaxCredit = Math.min(foreignTaxPaidTHB, potentialThaiTax);
            const netThaiTax = Math.max(0, potentialThaiTax - foreignTaxCredit);

            // Get treaty info
            const treatyInfo = TAX_TREATIES[treatyCountry] || { name: 'Неизвестно', hasCredit: false, notes: 'Пожалуйста, выберите страну.' };

            // Income type display
            const incomeTypeLabels = {
                'employment': 'Трудовой доход',
                'business': 'Доход от бизнеса/самозанятости',
                'investment': 'Инвестиционный доход',
                'capital-gains': 'Прирост капитала',
                'pension': 'Пенсия/Пенсионные выплаты',
                'rental': 'Арендный доход'
            };

            // Display results
            document.getElementById('remit-result-amount').textContent = formatTHB(remitTHB);
            document.getElementById('remit-result-type').textContent = incomeTypeLabels[incomeType];
            document.getElementById('remit-result-treaty').textContent = treatyInfo.name + (treatyInfo.hasCredit ? ' (Соглашение)' : ' (Нет соглашения)');
            document.getElementById('remit-result-thai-tax').textContent = formatTHB(potentialThaiTax);
            document.getElementById('remit-result-credit').textContent = '-' + formatTHB(foreignTaxCredit);
            document.getElementById('remit-result-net-tax').textContent = formatTHB(netThaiTax);

            // Treaty details
            let treatyDetails = treatyInfo.notes;

            if (incomeYear === 'before2023') {
                treatyDetails += ' Примечание: Доход, полученный до 2023 года и не переведенный в том же году, мог быть освобожден от налога по старым правилам. Однако изменения 2024 года применяются ко всем переводам независимо от года получения.';
            }

            if (incomeType === 'capital-gains' && treatyCountry === 'SG') {
                treatyDetails += ' В Сингапуре нет налога на прирост капитала, поэтому зачет иностранного налога для этого вида дохода может быть недоступен.';
            }

            if (incomeType === 'pension') {
                treatyDetails += ' Пенсионный доход часто имеет особые положения в налоговых соглашениях. Некоторые соглашения позволяют стране источника облагать пенсии налогом, другие дают право налогообложения стране резидентства.';
            }

            document.getElementById('remit-treaty-details').textContent = treatyDetails;

            // Show results
            document.getElementById('remittance-results').classList.add('active');
            document.getElementById('remittance-form').style.display = 'none';
            document.getElementById('remittance-results').scrollIntoView({ behavior: 'smooth' });
        });

        // LTR Form
        document.getElementById('ltr-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const category = document.getElementById('ltr-category').value;
            const thaiIncome = parseFloat(document.getElementById('ltr-thai-income').value) || 0;
            const foreignIncome = parseFloat(document.getElementById('ltr-foreign-income').value) || 0;
            const totalIncome = thaiIncome + foreignIncome;

            let ltrThaiTax = 0;
            let ltrForeignTax = 0;

            // LTR tax calculation based on category
            switch (category) {
                case 'professional':
                    // 17% flat rate on Thai income
                    ltrThaiTax = thaiIncome * 0.17;
                    // Foreign income still taxed at progressive rates if remitted
                    const { totalTax: foreignProgressive } = calculateProgressiveTax(foreignIncome);
                    ltrForeignTax = foreignProgressive;
                    break;
                case 'wealthy-citizen':
                case 'wealthy-pensioner':
                    // Foreign income exempt
                    const { totalTax: thaiProgressive } = calculateProgressiveTax(thaiIncome);
                    ltrThaiTax = thaiProgressive;
                    ltrForeignTax = 0;
                    break;
                case 'remote-worker':
                    // Work-from-Thailand Professionals: foreign-sourced income is generally exempt under the LTR program (simplified)
                    const { totalTax: remoteThaiTax } = calculateProgressiveTax(thaiIncome);
                    ltrThaiTax = remoteThaiTax;
                    ltrForeignTax = 0;
                    break;
            }

            const ltrTotal = ltrThaiTax + ltrForeignTax;

            // Standard tax calculation (without LTR)
            const { totalTax: standardThaiTax } = calculateProgressiveTax(thaiIncome);
            const { totalTax: standardForeignTax } = calculateProgressiveTax(foreignIncome);
            const standardTotal = standardThaiTax + standardForeignTax;

            // Savings
            const savings = standardTotal - ltrTotal;
            const savingsPct = standardTotal > 0 ? (savings / standardTotal * 100) : 0;

            // Display results
            document.getElementById('ltr-with-thai-tax').textContent = formatTHB(ltrThaiTax);
            document.getElementById('ltr-with-foreign-tax').textContent = formatTHB(ltrForeignTax);
            document.getElementById('ltr-with-total').textContent = formatTHB(ltrTotal);

            document.getElementById('ltr-without-thai-tax').textContent = formatTHB(standardThaiTax);
            document.getElementById('ltr-without-foreign-tax').textContent = formatTHB(standardForeignTax);
            document.getElementById('ltr-without-total').textContent = formatTHB(standardTotal);

            document.getElementById('ltr-savings').textContent = formatTHB(savings);
            document.getElementById('ltr-savings-pct').textContent = savingsPct.toFixed(1) + '%';

            // Show results
            document.getElementById('ltr-results').classList.add('active');
            document.getElementById('ltr-form').style.display = 'none';
            document.getElementById('ltr-results').scrollIntoView({ behavior: 'smooth' });
        });

        // Reset functions
        function resetIncomeForm() {
            document.getElementById('income-form').reset();
            document.getElementById('income-form').style.display = 'block';
            document.getElementById('income-results').classList.remove('active');
            document.getElementById('actual-expenses-group').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetRemittanceForm() {
            document.getElementById('remittance-form').reset();
            document.getElementById('remittance-form').style.display = 'block';
            document.getElementById('remittance-results').classList.remove('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function resetLTRForm() {
            document.getElementById('ltr-form').reset();
            document.getElementById('ltr-form').style.display = 'block';
            document.getElementById('ltr-results').classList.remove('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Update exchange rate when currency changes
        document.getElementById('foreign-currency').addEventListener('change', function() {
            document.getElementById('exchange-rate').value = EXCHANGE_RATES[this.value] || 35.00;
        });

        document.getElementById('remit-currency').addEventListener('change', function() {
            document.getElementById('remit-exchange').value = EXCHANGE_RATES[this.value] || 35.00;
        });


        // Link deduction checkboxes to their amount inputs (so the calculator doesn't assume the max)
        function linkCheckboxToInput(cbId, inputId) {
            const cb = document.getElementById(cbId);
            const input = document.getElementById(inputId);
            if (!cb || !input) return;
            const update = () => {
                input.disabled = !cb.checked;
                if (!cb.checked) input.value = 0;
            };
            cb.addEventListener('change', update);
            update();
        }

        linkCheckboxToInput('ded-life-insurance', 'ded-life-insurance-amount');
        linkCheckboxToInput('ded-health-insurance', 'ded-health-insurance-amount');
        linkCheckboxToInput('ded-ssf', 'ded-ssf-amount');
        linkCheckboxToInput('ded-rmf', 'ded-rmf-amount');

        // =====================================
        // ENHANCED FEATURES
        // =====================================

        // Tooltip Definitions
        const TOOLTIPS = {
            'residency': {
                title: 'Налоговое резидентство Таиланда',
                content: 'Вы являетесь налоговым резидентом Таиланда, если проживаете в Таиланде 180 дней или более в любом налоговом году (календарный год). Дни не обязательно должны быть последовательными.',
                practical: 'Совет: Сохраняйте записи о штампах въезда/выезда. Иммиграционная служба может предоставить историю путешествий в крупных аэропортах.'
            },
            'foreign-income': {
                title: 'Налогообложение иностранного дохода (после 2024)',
                content: 'С 1 января 2024 года иностранный доход, переводимый в Таиланд налоговыми резидентами, как правило, облагается налогом. Это применяется к доходу, ПОЛУЧЕННОМУ с 1 января 2024 года.',
                practical: 'Ключевое различие: Деньги, заработанные ДО 2024 года, но переведенные ПОСЛЕ 2024 года, как правило, НЕ подпадают под новые правила (Por. 162/2566). Сохраняйте документацию о том, когда доход был получен!'
            },
            'expense-deduction': {
                title: 'Методы вычета расходов',
                content: 'Стандартный: 50% от дохода (макс 100,000 THB). Фактический: Заявите свои реальные деловые расходы с чеками.',
                practical: 'Большинство наемных работников используют стандартный вычет. Самозанятые могут выиграть от фактических расходов при высоких операционных затратах.'
            },
            'ssf-rmf': {
                title: 'Вычеты пенсионных фондов',
                content: 'SSF (Super Savings Fund): До 30% от дохода, макс 200,000 THB. RMF (Retirement Mutual Fund): До 30% от дохода. Совокупный лимит с другими пенсионными фондами: 500,000 THB.',
                practical: 'Это реальные инвестиции, которые вы должны сделать. Досрочное изъятие влечет налоговые штрафы. Отлично подходит для высокооплачиваемых, стремящихся снизить налог.'
            }
        };

        // Tooltip System
        function showTooltip(triggerId) {
            const trigger = document.querySelector(`[data-tooltip="${triggerId}"]`);
            if (!trigger) return;

            const tooltip = TOOLTIPS[triggerId];
            if (!tooltip) return;

            // Remove any existing tooltips
            hideAllTooltips();

            // Create tooltip element
            const tooltipEl = document.createElement('div');
            tooltipEl.className = 'tooltip-content show';
            tooltipEl.id = 'active-tooltip';
            tooltipEl.innerHTML = `
                <div class="tip-title">${tooltip.title}</div>
                <div>${tooltip.content}</div>
                ${tooltip.practical ? `<div class="tip-practical">${tooltip.practical}</div>` : ''}
            `;

            // Position it below the trigger
            const rect = trigger.getBoundingClientRect();
            tooltipEl.style.position = 'fixed';
            tooltipEl.style.top = (rect.bottom + 8) + 'px';
            tooltipEl.style.left = Math.max(10, rect.left - 10) + 'px';
            tooltipEl.style.maxWidth = '300px';

            document.body.appendChild(tooltipEl);

            // Close on click outside
            setTimeout(() => {
                document.addEventListener('click', hideAllTooltips, { once: true });
            }, 10);
        }

        function hideAllTooltips() {
            const existing = document.getElementById('active-tooltip');
            if (existing) existing.remove();
        }

        // Attach tooltip listeners
        document.querySelectorAll('.tooltip-trigger').forEach(trigger => {
            trigger.addEventListener('click', function(e) {
                e.stopPropagation();
                showTooltip(this.getAttribute('data-tooltip'));
            });
        });

        // =====================================
        // GOTCHA CARDS - Show/hide based on input
        // =====================================

        function updateGotchaCards() {
            const foreignIncome = parseFloat(document.getElementById('foreign-income').value) || 0;
            const gotchaForeign = document.getElementById('gotcha-foreign-income');

            if (gotchaForeign) {
                if (foreignIncome > 0) {
                    gotchaForeign.classList.add('show');
                } else {
                    gotchaForeign.classList.remove('show');
                }
            }
        }

        // Listen for foreign income changes
        document.getElementById('foreign-income').addEventListener('input', updateGotchaCards);

        // =====================================
        // CONFIDENCE SCORE SYSTEM
        // =====================================

        function calculateConfidence(inputs) {
            let score = 100;
            let factors = [];

            // Check for foreign income (adds complexity)
            if (inputs.foreignIncome > 0) {
                score -= 15;
                factors.push('Расчеты иностранного дохода зависят от сроков и документации');
            }

            // Check for large amounts (more at stake = recommend verification)
            if (inputs.totalIncome > 5000000) {
                score -= 10;
                factors.push('Высокий доход - рекомендуется профессиональная консультация');
            }

            // Check for multiple deduction types
            const deductionCount = inputs.deductions || 0;
            if (deductionCount > 4) {
                score -= 5;
                factors.push('Множественные вычеты - проверьте право на каждый');
            }

            // Non-resident special cases
            if (!inputs.isResident && inputs.thaiIncome > 0) {
                score -= 10;
                factors.push('Налогообложение нерезидентов варьируется по типу дохода и соглашению');
            }

            // Very high foreign income
            if (inputs.foreignIncome > inputs.thaiIncome * 2) {
                score -= 10;
                factors.push('Высокое соотношение иностранного/тайского дохода - проверьте сроки перевода');
            }

            // Base factors always present
            if (score >= 90) {
                factors.push('Стандартный расчет с типичными вводными данными');
            }

            return { score: Math.max(score, 30), factors };
        }

        function updateConfidenceDisplay(inputs) {
            const { score, factors } = calculateConfidence(inputs);

            const badge = document.getElementById('confidence-badge');
            const text = document.getElementById('confidence-text');
            const list = document.getElementById('confidence-list');

            if (!badge || !text || !list) return;

            // Update badge class and text
            badge.classList.remove('high', 'medium', 'low');

            if (score >= 80) {
                badge.classList.add('high');
                text.textContent = 'Высокая достоверность';
                badge.querySelector('.confidence-icon').innerHTML = '&#10003;';
            } else if (score >= 60) {
                badge.classList.add('medium');
                text.textContent = 'Средняя достоверность';
                badge.querySelector('.confidence-icon').innerHTML = '&#9888;';
            } else {
                badge.classList.add('low');
                text.textContent = 'Низкая достоверность';
                badge.querySelector('.confidence-icon').innerHTML = '&#9888;';
            }

            // Update factors list
            list.innerHTML = factors.map(f => `<li>${f}</li>`).join('');
        }

        function toggleConfidenceFactors() {
            const factors = document.getElementById('confidence-factors');
            if (factors) {
                factors.classList.toggle('show');
            }
        }

        // =====================================
        // PAPER TRAIL CHECKLIST GENERATOR
        // =====================================

        function generateChecklist(inputs) {
            const sections = [];

            // Basic documents everyone needs
            sections.push({
                title: 'Основные налоговые документы',
                items: [
                    'ИНН Таиланда (TIN) - получите в местном налоговом офисе, если у вас его нет',
                    'Копии паспорта (страница с данными + страницы со штампами въезда/выезда в Таиланд)',
                    'Карточки прибытия TM6 (если сохранились)',
                    'Разрешение на работу (если применимо)'
                ]
            });

            // Income documentation
            const incomeItems = [];
            if (inputs.thaiIncome > 0) {
                incomeItems.push('Справки об удержании налога (формы 50 Tawi) от тайских работодателей');
                incomeItems.push('Трудовой договор (доход из тайских источников)');
            }
            if (inputs.foreignIncome > 0) {
                incomeItems.push('Справки/расчетные листы об иностранном доходе (с датами, показывающими когда заработан)');
                incomeItems.push('Банковские выписки, показывающие переводы в Таиланд (с датами)');
                incomeItems.push('Документация, подтверждающая КОГДА иностранный доход был получен (критично для до/после 2024)');
                incomeItems.push('Иностранные налоговые декларации или квитанции об уплате налога (для зачета иностранного налога)');
            }
            if (incomeItems.length > 0) {
                sections.push({ title: 'Документы о доходах', items: incomeItems });
            }

            // Deduction documentation
            const deductionItems = [];
            if (inputs.hasSpouse) {
                deductionItems.push('Свидетельство о браке (с переводом, если иностранное)');
                deductionItems.push('Документы о доходе супруга (для подтверждения права на вычет)');
            }
            if (inputs.hasChildren) {
                deductionItems.push('Свидетельства о рождении детей');
                deductionItems.push('Справки о зачислении в школу (если заявляется вычет на образование)');
            }
            if (inputs.hasInsurance) {
                deductionItems.push('Квитанции об уплате страховых премий по страхованию жизни/здоровья');
                deductionItems.push('Страховой полис, показывающий регистрацию в тайской компании');
            }
            if (inputs.hasRetirement) {
                deductionItems.push('Сертификаты инвестиций SSF/RMF');
                deductionItems.push('Выписки фонда, показывающие взносы');
            }
            if (deductionItems.length > 0) {
                sections.push({ title: 'Подтверждение вычетов', items: deductionItems });
            }

            // Residency proof
            sections.push({
                title: 'Документы о резидентстве',
                items: [
                    'История путешествий из иммиграционной службы (запрос в иммиграции аэропорта)',
                    'Договор аренды или документ о праве собственности (тайский адрес)',
                    'Счета за коммунальные услуги на ваше имя',
                    'Выписки из тайского банка, показывающие местную активность'
                ]
            });

            return sections;
        }

        function showChecklist() {
            // Gather current inputs
            const inputs = {
                thaiIncome: parseFloat(document.getElementById('thai-income').value) || 0,
                foreignIncome: parseFloat(document.getElementById('foreign-income').value) || 0,
                hasSpouse: document.getElementById('ded-spouse').checked,
                hasChildren: document.getElementById('ded-children').checked,
                hasInsurance: document.getElementById('ded-life-insurance').checked || document.getElementById('ded-health-insurance').checked,
                hasRetirement: document.getElementById('ded-ssf').checked || (document.getElementById('ded-rmf') && document.getElementById('ded-rmf').checked)
            };

            const sections = generateChecklist(inputs);
            const output = document.getElementById('checklist-output');

            if (!output) return;

            let html = '<h4>Ваш персонализированный чек-лист налоговых документов</h4>';

            sections.forEach(section => {
                html += `<div class="checklist-section">
                    <h5>${section.title}</h5>
                    ${section.items.map(item => `
                        <div class="checklist-item">
                            <input type="checkbox" id="check-${item.slice(0,20).replace(/\s/g,'-')}">
                            <label>${item}</label>
                        </div>
                    `).join('')}
                </div>`;
            });

            html += `<button class="copy-checklist-btn" onclick="copyChecklist()">
                Копировать как текст
            </button>`;

            output.innerHTML = html;
            output.classList.add('show');
        }

        function copyChecklist() {
            const output = document.getElementById('checklist-output');
            if (!output) return;

            let text = 'ЧЕК-ЛИСТ НАЛОГОВЫХ ДОКУМЕНТОВ ТАИЛАНДА\n';
            text += '==========================================\n\n';

            output.querySelectorAll('.checklist-section').forEach(section => {
                const title = section.querySelector('h5').textContent;
                text += `${title}\n${'-'.repeat(title.length)}\n`;

                section.querySelectorAll('.checklist-item label').forEach(item => {
                    text += `[ ] ${item.textContent}\n`;
                });
                text += '\n';
            });

            text += '\nСгенерировано калькулятором налогов Terms.Law Таиланд';

            navigator.clipboard.writeText(text).then(() => {
                const btn = output.querySelector('.copy-checklist-btn');
                const original = btn.innerHTML;
                btn.innerHTML = 'Скопировано!';
                setTimeout(() => btn.innerHTML = original, 2000);
            });
        }

    </script>
</body>
</html>
